/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

import{useReducer as t,useCallback as e}from"@googleforcreators/react";import{compareDesc as o}from"@googleforcreators/date";import r,{defaultTemplatesState as a,ACTION_TYPES as s}from"../reducer/templates.js";import p from"../serializers/templates.js";import"react";import"prop-types";import"../config/context.js";import m from"../config/useConfig.js";const l=()=>{const[l,i]=t(r,a),{cdnURL:c}=m(),n=e((async()=>{i({type:s.LOADING_TEMPLATES,payload:!0});const t={},{getAllTemplates:e}=await import("@googleforcreators/templates"),r=(await e({cdnURL:c})).map((e=>{const o=p(e);return o.tags.forEach((e=>{t[e]?t[e].push(o.id):t[e]=[o.id]})),o})).sort(((t,e)=>o(t.creationDate,e.creationDate)));i({type:s.FETCH_TEMPLATES_SUCCESS,payload:{page:1,templates:r,totalPages:1,totalTemplates:r.length,templatesByTag:t}})}),[c]),f=e((t=>l.templates[t]?Promise.resolve(l.templates[t]):Promise.reject(new Error)),[l]);return{templates:l,api:{fetchExternalTemplates:n,fetchExternalTemplateById:f}}};export{l as default};
