/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

import"../../constants/index.js";import{STORY_STATUS as t}from"../../constants/stories.js";const s={CREATING_STORY_FROM_TEMPLATE:"creating_story_from_template",CREATE_STORY_FROM_TEMPLATE_SUCCESS:"create_story_from_template_success",CREATE_STORY_FROM_TEMPLATE_FAILURE:"create_story_from_template_failure",LOADING_STORIES:"loading_stories",FETCH_STORIES_SUCCESS:"fetch_stories_success",FETCH_STORIES_FAILURE:"fetch_stories_failure",UPDATE_STORY:"update_story",UPDATE_STORY_FAILURE:"update_story_failure",TRASH_STORY:"trash_story",TRASH_STORY_FAILURE:"trash_story_failure",DUPLICATE_STORY:"duplicate_story",DUPLICATE_STORY_FAILURE:"duplicate_story_failure"},r={error:{},isLoading:!1,stories:{},storiesOrderById:[],totalStoriesByStatus:{},totalPages:null};function e(r,e){switch(e.type){case s.LOADING_STORIES:case s.CREATING_STORY_FROM_TEMPLATE:return{...r,isLoading:e.payload};case s.CREATE_STORY_FROM_TEMPLATE_FAILURE:case s.FETCH_STORIES_FAILURE:case s.UPDATE_STORY_FAILURE:case s.TRASH_STORY_FAILURE:case s.DUPLICATE_STORY_FAILURE:return{...r,error:{...e.payload,id:Date.now()}};case s.CREATE_STORY_FROM_TEMPLATE_SUCCESS:return{...r,error:{}};case s.UPDATE_STORY:return{...r,error:{},stories:{...r.stories,[e.payload.id]:e.payload}};case s.TRASH_STORY:{const s=e.payload.storyStatus===t.DRAFT?t.DRAFT:t.PUBLISH;return{...r,error:{},storiesOrderById:r.storiesOrderById.filter((t=>t!==e.payload.id)),totalStoriesByStatus:{...r.totalStoriesByStatus,all:r.totalStoriesByStatus.all-1,[s]:r.totalStoriesByStatus[s]-1},stories:Object.keys(r.stories).reduce(((t,s)=>(parseInt(s)!==e.payload.id&&(t[s]=r.stories[s]),t)),{})}}case s.DUPLICATE_STORY:return{...r,error:{},storiesOrderById:[e.payload.id,...r.storiesOrderById],totalStoriesByStatus:{...r.totalStoriesByStatus,all:r.totalStoriesByStatus.all+1,[e.payload.status]:r.totalStoriesByStatus[e.payload.status]+1},stories:{...r.stories,[e.payload.id]:e.payload}};case s.FETCH_STORIES_SUCCESS:{const{fetchedStoryIds:t,totalStoriesByStatus:s,totalPages:a,page:o,stories:_}=e.payload,{storiesOrderById:S,stories:T}=r,i=1===o?t:[...S,...t],E=[...new Set(i)];return{...r,error:{},storiesOrderById:E,stories:{...T,..._},totalPages:a,totalStoriesByStatus:s,allPagesFetched:o>=a}}default:return r}}export{s as ACTION_TYPES,e as default,r as defaultStoriesState};
