/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

import t from"react";import{createContext as e,useRef as r,useState as a,useMemo as o,useEffect as n}from"@googleforcreators/react";import"prop-types";import{createHashHistory as c}from"history";import{APP_ROUTES as s}from"../../constants/index.js";const u=e({state:{},actions:{}}),i=t=>{let{availableRoutes:e,currentPath:r,defaultRoute:a}=t;return e.filter((t=>r.startsWith(t))).length<=1?a:r};function RouterProvider(e){let{children:l,...h}=e;const m=r(h.history||c()),[p,f]=a(m.current.location.pathname),[R,d]=a([]),v=s.DASHBOARD,P=o((()=>i({availableRoutes:R,currentPath:p,defaultRoute:v})),[R,p,v]),b=t=>{const e=new URLSearchParams(t);return Object.fromEntries(e)},[y,g]=a(b(m.current.location.search));n((()=>m.current.listen((t=>{let{location:e}=t;g(b(e.search)),f(e.pathname)}))),[]);const A=o((()=>({state:{activeRoute:P,currentPath:p,queryParams:y,availableRoutes:R,defaultRoute:v},actions:{push:m.current.push,replace:m.current.replace,setAvailableRoutes:d}})),[P,R,p,v,y]);return t.createElement(u.Provider,{value:A},l)}export{u as RouterContext,RouterProvider as default,i as getActiveRoute};
