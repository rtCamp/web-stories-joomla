/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

import e from"react";import"prop-types";import{useState as t,useMemo as o,useEffect as r,useCallback as i}from"@googleforcreators/react";import{sprintf,__}from"@googleforcreators/i18n";import{trackEvent as n}from"@googleforcreators/tracking";import{useSnackbar as s,LoadingSpinner as a,Text as l,THEME_CONSTANTS as m}from"@googleforcreators/design-system";import"../../../../../types.js";import c from"../../../../../utils/titleFormatted.js";import"../../../../../utils/keyboardOnlyOutline.js";import{VIEW_STYLE as p}from"../../../../../constants/index.js";import"@googleforcreators/units";import"../../../../../utils/useStoryView.js";import"../../../../../utils/useTemplateView.js";import"../../../../../components/cardGallery/components.js";import"../../../../../components/cardGrid/index.js";import"../../../../../components/cardGridItem/index.js";import"../../../../../components/colorList/index.js";import"../../../../../components/contentGutter/index.js";import d from"../../../../../components/dialog/dialog.js";import"../../../../../components/fileUpload/index.js";import"../../../../../components/infiniteScroller/index.js";import"../../../../../components/inlineInputForm/index.js";import"../../../../../components/layout/provider.js";import"../../../../../components/layout/scrollable.js";import"../../../../../components/layout/fixed.js";import{LoadingContainer as u}from"../../../../../components/pageStructure/pageStructureComponents.js";import"../../../../../components/pageStructure/leftRail.js";import"../../../../../components/pageStructure/menuButton.js";import"../../../../../components/navProvider.js";import"../../../../../components/scrollToTop/index.js";import"../../../../../components/storyMenu/index.js";import"../../../../../components/table/index.js";import"../../../../config/context.js";import"../../../../../components/viewStyleBar/index.js";import g from"../listView/index.js";import y from"../storyGridView/index.js";import{STORY_CONTEXT_MENU_ITEMS as S,STORY_CONTEXT_MENU_ACTIONS as f}from"../../../../../constants/stories.js";function StoriesView(j){let{filterValue:w,loading:b,sort:E,storyActions:x,stories:L,view:h}=j;const[T,D]=t(-1),[O,R]=t(-1),[_,C]=t(""),[I,k]=t(null),[v,P]=t({}),[M,V]=t(null),{showSnackbar:Y}=s(),A="DELETE_STORY"===_&&I,G=o((()=>L.map((e=>{let{id:t}=e;return t}))),[L]);r((()=>{if(v.id&&!M){const e=G.indexOf(v.id),t=e>0?-1:1,o=v.isDeleted?t:0,r=G[e+o];r&&V(r)}}),[v,M,G]),r((()=>{_||k(null)}),[_,k]),r((()=>{_&&(P({}),V(null))}),[_]);const z=i(((e,t)=>{R(-1),n("rename_story"),x.updateStory({...e,title:{raw:t}})}),[x]),F=i((()=>{n("delete_story"),x.trashStory(I),P({id:I.id,isDeleted:!0}),C("")}),[x,I]),N=i((()=>{D(-1),n("open_in_editor")}),[]),W=i((e=>{D(-1),R(e.id)}),[]),B=i((e=>{D(-1),n("duplicate_story"),x.duplicateStory(e),P({id:e.id})}),[x]),K=i((e=>{D(-1),k(e),C("DELETE_STORY")}),[]),U=i((e=>{D(-1),window.navigator.clipboard.writeText(e.link),Y({message:sprintf(
/* translators: %s: story title. */
__("%s has been copied to your clipboard.","web-stories"),c(e.title)),dismissible:!0}),P({id:e.id})}),[Y]),H=S.map((e=>{switch(e?.value){case f.COPY_STORY_LINK:e.action=U;break;case f.DELETE:e.action=K;break;case f.DUPLICATE:e.action=B;break;case f.OPEN_STORY_LINK:e.action=N;break;case f.RENAME:e.action=W;break;default:e.action=()=>D(-1)}return e})),Z=o((()=>({handleMenuToggle:D,contextMenuId:T,menuItems:H})),[T,H,D]),q=o((()=>({id:O,handleOnRenameStory:z,handleCancelRename:()=>R(-1)})),[z,R,O]),J=o((()=>h.style===p.LIST?e.createElement(g,{handleSortChange:E.set,handleSortDirectionChange:E.setDirection,hideStoryList:b?.isLoading&&!b?.showStoriesWhileLoading.current,pageSize:h.pageSize,renameStory:q,sortDirection:E.direction,stories:L,storyMenu:Z,storySort:E.value,storyStatus:w}):!b?.isLoading||b?.isLoading&&b?.showStoriesWhileLoading.current?e.createElement(y,{isLoading:b?.isLoading,pageSize:h.pageSize,renameStory:q,storyMenu:Z,stories:L,returnStoryFocusId:{value:M,set:V}}):null),[b,w,q,M,E,L,Z,h]);return e.createElement(e.Fragment,null,J,b?.isLoading&&!b?.showStoriesWhileLoading.current&&e.createElement(u,null,e.createElement(a,null)),A&&e.createElement(d,{isOpen:!0,contentLabel:__("Dialog to confirm deleting a story","web-stories"),title:__("Delete Story","web-stories"),onClose:()=>{P({id:I.id}),C("")},secondaryText:__("Cancel","web-stories"),secondaryRest:{"aria-label":sprintf(
/* translators: %s: story title. */
__('Cancel deleting story "%s"',"web-stories"),c(I.title))},primaryText:__("Delete","web-stories"),onPrimary:F,primaryRest:{"aria-label":sprintf(
/* translators: %s: story title. */
__('Confirm deleting story "%s"',"web-stories"),c(I.title))}},e.createElement(l,{size:m.TYPOGRAPHY.PRESET_SIZES.SMALL},sprintf(
/* translators: %s: story title. */
__('Are you sure you want to delete "%s"?',"web-stories"),c(I.title)))))}export{StoriesView as default};
