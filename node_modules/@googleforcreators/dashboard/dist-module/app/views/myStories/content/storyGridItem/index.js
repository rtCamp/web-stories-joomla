/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

import e from"react";import{VisuallyHidden as t}from"@googleforcreators/design-system";import{getRelativeDisplayDate as o}from"@googleforcreators/date";import{sprintf,__}from"@googleforcreators/i18n";import"prop-types";import{forwardRef as r,useMemo as n}from"@googleforcreators/react";import{css as s}from"styled-components";import{DEFAULT_GRID_IMG_WIDTH as i,DEFAULT_GRID_IMG_HEIGHT as m}from"../../../../../constants/index.js";import"../../../../../components/cardGallery/components.js";import"../../../../../components/cardGrid/index.js";import"../../../../../components/cardGridItem/index.js";import"../../../../../components/colorList/index.js";import"../../../../../components/contentGutter/index.js";import"../../../../../components/fileUpload/index.js";import"../../../../../components/infiniteScroller/index.js";import"../../../../../components/inlineInputForm/index.js";import"../../../../../components/layout/provider.js";import"../../../../../components/layout/scrollable.js";import"../../../../../components/layout/fixed.js";import"../../../../../components/pageStructure/pageStructureComponents.js";import"../../../../../components/pageStructure/leftRail.js";import"../../../../../components/pageStructure/menuButton.js";import"../../../../../components/navProvider.js";import"../../../../../components/scrollToTop/index.js";import a from"../../../../../components/storyMenu/index.js";import"../../../../../components/table/index.js";import"../../../../config/context.js";import l from"../../../../config/useConfig.js";import"../../../../../components/viewStyleBar/index.js";import{generateStoryMenu as p}from"../../../../../components/popoverMenu/story-menu-generator.js";import"../../../../../types.js";import c from"../../../../../utils/titleFormatted.js";import"../../../../../utils/keyboardOnlyOutline.js";import"@googleforcreators/units";import"../../../../../utils/useStoryView.js";import"../../../../../utils/useTemplateView.js";import{Container as d,Poster as u,Gradient as f,Scrim as g}from"../../../shared/grid/components.js";import{CustomCardGridItem as j,CardWrapper as y,ScrimAnchor as x}from"./components.js";import h from"./storyDisplayContent.js";import{STORY_STATUS as b}from"../../../../../constants/stories.js";function E(){return E=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var r in o)Object.prototype.hasOwnProperty.call(o,r)&&(e[r]=o[r])}return e},E.apply(this,arguments)}const S=r(((r,S)=>{let{onFocus:I,isActive:k,pageSize:v,renameStory:M,story:w,storyMenu:C}=r;const{userId:O}=l(),U=k?0:-1,G=M?{editMode:M?.id===w?.id,onEditComplete:e=>M?.handleOnRenameStory(w,e),onEditCancel:M?.handleCancelRename}:{},T=n((()=>w?.locked&&O!==w?.lockUser.id),[w,O]),F=n((()=>p({menuItems:C.menuItems,story:w,isLocked:T})),[C,w,T]),L=o(w?.status===b.DRAFT?w?.modifiedGmt:w?.createdGmt),A=c(w.title),D=n((()=>F.length?e.createElement(a,{menuLabel:T?sprintf(
/* translators: 1: story title. 2: user currently editing the story. */
__("Context menu for %1$s (locked by %2$s)","web-stories"),A,w?.lockUser.name):sprintf(
/* translators: %s: story title.*/
__("Context menu for %s","web-stories"),A),itemActive:k,tabIndex:U,onMoreButtonSelected:C.handleMenuToggle,contextMenuId:C.contextMenuId,storyId:w.id,isInverted:!0,menuItems:F,menuStyleOverrides:s(["margin:0 0 0 auto;"])}):null),[T,A,w?.lockUser?.name,w.id,k,U,C,F]);return e.createElement(j,{"data-testid":`story-grid-item-${w.id}`,onFocus:I,$posterHeight:v.height,ref:S,"aria-label":sprintf(
/* translators: %s: story title.*/
__("Details about %s","web-stories"),A)},e.createElement(d,null,e.createElement(y,null,e.createElement(u,E({},w.featuredMediaUrl?{alt:sprintf(
/* translators: %s: Story title. */
__("%s Poster image","web-stories"),A),as:"img",src:w.featuredMediaUrl,decoding:"async"}:null,{width:i,height:m})),e.createElement(f,null),e.createElement(g,null,w?.capabilities?.hasEditAction&&e.createElement(x,{className:"grid-item-anchor","data-testid":"story-editor-grid-link",tabIndex:U,href:w.editStoryLink},e.createElement(t,null,sprintf(
/* translators: %s: Story title. */
__("Open %s in Editor","web-stories"),A))),e.createElement(h,E({author:w.author,contextMenu:D,displayDate:L,formattedTitle:A,id:w.id,isLocked:T,lockUser:w?.lockUser,status:w?.status,title:w.title},G))))))}));S.displayName="StoryGridItem";export{S as default};
