/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

import e from"react";import{__}from"@googleforcreators/i18n";import"prop-types";import o from"styled-components";import{useRef as t,useState as r,useMemo as n,useEffect as s,useCallback as i,useFocusOut as m}from"@googleforcreators/react";import{useGridViewKeys as c}from"@googleforcreators/design-system";import"../../../../../constants/index.js";import"../../../../../components/cardGallery/components.js";import p from"../../../../../components/cardGrid/index.js";import"../../../../../components/cardGridItem/index.js";import"../../../../../components/colorList/index.js";import"../../../../../components/contentGutter/index.js";import"../../../../../components/fileUpload/index.js";import"../../../../../components/infiniteScroller/index.js";import"../../../../../components/inlineInputForm/index.js";import"../../../../../components/layout/provider.js";import"../../../../../components/layout/scrollable.js";import"../../../../../components/layout/fixed.js";import"../../../../../components/pageStructure/pageStructureComponents.js";import"../../../../../components/pageStructure/leftRail.js";import"../../../../../components/pageStructure/menuButton.js";import"../../../../../components/navProvider.js";import"../../../../../components/scrollToTop/index.js";import"../../../../../components/storyMenu/index.js";import"../../../../../components/table/index.js";import"../../../../config/context.js";import l from"../../../../config/useConfig.js";import"../../../../../components/viewStyleBar/index.js";import"../../../../../types.js";import a from"../storyGridItem/index.js";import{PAGE_WRAPPER as u}from"../../../../../constants/pageStructure.js";import{STORY_CONTEXT_MENU_ACTIONS as d}from"../../../../../constants/stories.js";const f=o(p).withConfig({displayName:"storyGridView__StoryGrid",componentId:"sc-1fwq7hb-0"})(["width:calc(100% - ","px);"],u.GUTTER),StoryGridView=o=>{let{stories:p,pageSize:u,storyMenu:j,renameStory:g,returnStoryFocusId:y}=o;const{isRTL:x}=l(),S=t(),E=t(),I=t({}),[T,v]=r(),G=t(),R=n((()=>p.map((e=>{let{id:o}=e;return o}))),[p]);c({containerRef:S,gridRef:E,itemRefs:I,isRTL:x,currentItemId:T,items:p}),s((()=>{if(!T&&y?.value&&!G.current){const e=y?.value;v(e);const o=I.current?.[e]?.querySelectorAll(["button","a"])?.[0];o?.focus()}}),[T,y]),s((()=>{T&&(G.current=T)}),[T]);const w=i(((e,o)=>{if(j.handleMenuToggle(o),o<0&&9===e?.keyCode){const o=!e?.shiftKey?R[R.indexOf(T)+1]:T;y.set(o),G.current=null,v(null)}}),[T,R,y,j]),b=i((()=>{G.current=null,v(null),y.set(null)}),[y]);m(S,(()=>v(null)),[]);const h=n((()=>{const e=[d.DELETE,d.RENAME,d.DUPLICATE],o=j.menuItems.map((o=>{const t={...o};return e.includes(o?.value)&&(t.action=e=>{b(),o.action(e)}),t}));return{...j,handleMenuToggle:w,menuItems:o}}),[w,j,b]),L=n((()=>p.map((o=>e.createElement(a,{onFocus:()=>v(o.id),isActive:T===o.id,ref:e=>{I.current[o.id]=e},key:o.id,pageSize:u,renameStory:g,story:o,storyMenu:h})))),[T,h,u,g,p]);return e.createElement("div",{ref:S},e.createElement(f,{pageSize:u,ref:E,role:"list",ariaLabel:__("Viewing stories","web-stories")},L))};export{StoryGridView as default};
