/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

import e from"react";import"prop-types";import{useMemo as t}from"@googleforcreators/react";import{getRelativeDisplayDate as o}from"@googleforcreators/date";import{sprintf,__}from"@googleforcreators/i18n";import{Tooltip as n,Headline as r,THEME_CONSTANTS as s,Text as m}from"@googleforcreators/design-system";import"../../../../../constants/index.js";import"../../../../../components/cardGallery/components.js";import"../../../../../components/cardGrid/index.js";import"../../../../../components/cardGridItem/index.js";import"../../../../../components/colorList/index.js";import"../../../../../components/contentGutter/index.js";import"styled-components";import"../../../../../components/fileUpload/index.js";import"../../../../../components/infiniteScroller/index.js";import i from"../../../../../components/inlineInputForm/index.js";import"../../../../../components/layout/provider.js";import"../../../../../components/layout/scrollable.js";import"../../../../../components/layout/fixed.js";import"../../../../../components/pageStructure/pageStructureComponents.js";import"../../../../../components/pageStructure/leftRail.js";import"../../../../../components/pageStructure/menuButton.js";import"../../../../../components/navProvider.js";import"../../../../../components/scrollToTop/index.js";import l from"../../../../../components/storyMenu/index.js";import{TablePreviewCell as a,TableCell as c,TableStatusCell as p}from"../../../../../components/table/index.js";import"../../../../config/context.js";import"../../../../../components/viewStyleBar/index.js";import{generateStoryMenu as d}from"../../../../../components/popoverMenu/story-menu-generator.js";import"../../../../../types.js";import u from"../../../../../utils/titleFormatted.js";import"../../../../../utils/keyboardOnlyOutline.js";import"@googleforcreators/units";import"../../../../../utils/useStoryView.js";import"../../../../../utils/useTemplateView.js";import{StyledTableRow as E,PreviewWrapper as S,PreviewImage as g,LockIcon as j,TitleTableCellContainer as f}from"./components.js";import{STORY_STATUS as y,DISPLAY_STATUS as x}from"../../../../../constants/stories.js";function P(e){window.getSelection().selectAllChildren(e.target)}function R(){window.getSelection().removeAllRanges()}const StoryListItem=I=>{let{story:T,renameStory:A,userId:M,storyMenu:b,storyStatus:L}=I;const w=t((()=>T?.locked&&M!==T?.lockUser.id),[T,M]),G=u(T.title),Y=t((()=>d({menuItems:b.menuItems,story:T,isLocked:w})),[b,T,w]),h=t((()=>Y.length?e.createElement(l,{menuLabel:sprintf(
/* translators: %s: story title.*/
__("Context menu for %s","web-stories"),G),onMoreButtonSelected:(e,t)=>b.handleMenuToggle(t),contextMenuId:b.contextMenuId,storyId:T.id,menuItems:Y,verticalAlign:"center"}):null),[Y,G,b,T]);return e.createElement(E,{"data-testid":`story-list-item-${T.id}`},e.createElement(a,null,e.createElement(n,{title:w&&T?.lockUser.name?sprintf(
/* translators: %s: user name */
__("%s is currently editing this story","web-stories"),T?.lockUser.name):""},e.createElement(S,null,e.createElement(g,T.featuredMediaUrl?{src:T.featuredMediaUrl,alt:sprintf(
/* translators: %s: Story title. */
__("%s Poster image","web-stories"),G),as:"img",decoding:"async"}:null),w&&e.createElement(j,null)))),e.createElement(c,null,e.createElement(f,null,A.id===T.id?e.createElement(i,{onEditComplete:e=>A.handleOnRenameStory(T,e),onEditCancel:A.handleCancelRename,value:T.title,id:T.id,label:__("Rename story","web-stories")}):e.createElement(e.Fragment,null,e.createElement(r,{tabIndex:0,onFocus:P,onBlur:R,size:s.TYPOGRAPHY.PRESET_SIZES.XXX_SMALL,as:"h3","aria-label":w?sprintf(
/* translators: 1: story title. 2: user currently editing the story. */
__("%1$s (locked by %2$s)","web-stories"),G,T?.lockUser.name):G},G),h))),e.createElement(c,null,e.createElement(m,{as:"span",size:s.TYPOGRAPHY.PRESET_SIZES.SMALL},T.author?.name||"â€”")),e.createElement(c,null,e.createElement(m,{as:"span",size:s.TYPOGRAPHY.PRESET_SIZES.SMALL},o(T.createdGmt))),e.createElement(c,null,e.createElement(m,{as:"span",size:s.TYPOGRAPHY.PRESET_SIZES.SMALL},o(T.modifiedGmt))),L!==y.DRAFT&&e.createElement(p,null,e.createElement(m,{as:"span",size:s.TYPOGRAPHY.PRESET_SIZES.SMALL},x[T?.status])))};export{StoryListItem};
