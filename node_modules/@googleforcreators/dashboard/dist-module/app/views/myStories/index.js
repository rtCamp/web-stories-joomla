/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

import t from"react";import{useRef as e,useEffect as o,useCallback as r,useMemo as s}from"@googleforcreators/react";import"prop-types";import"@googleforcreators/i18n";import"@googleforcreators/design-system";import"../../../constants/index.js";import"../../../components/cardGallery/components.js";import"../../../components/cardGrid/index.js";import"../../../components/cardGridItem/index.js";import"../../../components/colorList/index.js";import"../../../components/contentGutter/index.js";import"styled-components";import"../../../components/fileUpload/index.js";import"../../../components/infiniteScroller/index.js";import"../../../components/inlineInputForm/index.js";import i from"../../../components/layout/index.js";import"../../../components/pageStructure/pageStructureComponents.js";import"../../../components/pageStructure/leftRail.js";import"../../../components/pageStructure/menuButton.js";import"../../../components/navProvider.js";import n from"../../../components/scrollToTop/index.js";import"../../../components/storyMenu/index.js";import"../../../components/table/index.js";import"../../config/context.js";import a from"../../config/useConfig.js";import"../../../components/viewStyleBar/index.js";import"../../../utils/keyboardOnlyOutline.js";import"@googleforcreators/units";import p from"../../../utils/useStoryView.js";import"../../../utils/useTemplateView.js";import{noop as l}from"../../../utils/noop.js";import m from"../../api/useApi.js";import c from"./content/index.js";import u from"./header/index.js";import{STORY_STATUSES as d}from"../../../constants/stories.js";function MyStories(){const{duplicateStory:g,fetchStories:y,trashStory:f,updateStory:S,allPagesFetched:h,isLoading:j,stories:x,storiesOrderById:w,totalPages:v,totalStoriesByStatus:P,getAuthors:A}=m((t=>{let{actions:{storyApi:{duplicateStory:e,fetchStories:o,trashStory:r,updateStory:s},usersApi:{getAuthors:i}},state:{stories:{allPagesFetched:n,isLoading:a,stories:p,storiesOrderById:l,totalPages:m,totalStoriesByStatus:c}}}=t;return{duplicateStory:e,fetchStories:o,trashStory:r,updateStory:s,allPagesFetched:n,isLoading:a,stories:p,storiesOrderById:l,totalPages:m,totalStoriesByStatus:c,getAuthors:i}})),{apiCallbacks:B,canViewDefaultTemplates:L}=a(),I=e(!1);o((()=>(I.current=!0,()=>{I.current=!1})),[]);const{filter:F,page:O,search:T,sort:E,view:k,showStoriesWhileLoading:D,initialPageReady:G,author:V}=p({filters:d,isLoading:j,totalPages:v}),{setQueriedAuthors:b}=V;let C=r((t=>A(t).then((t=>{if(!I.current)return;const e=t.map((t=>{let{id:e,name:o}=t;return{id:e,name:o}}));b((t=>{const o=t.map((t=>{let{id:e}=t;return e})),r=e.filter((t=>!o.includes(t.id)));return[...t,...r]}))}))),[A,b]);A||(C=l),o((()=>{C()}),[C]),o((()=>{y({page:O.value,searchTerm:T.keyword,sortDirection:E.direction,sortOption:E.value,status:F.value,author:V.filterId})}),[y,F.value,O.value,T.keyword,E.direction,E.value,V.filterId,B]);const M=s((()=>w.map((t=>x[t]))),[x,w]),R="function"==typeof A;return t.createElement(i.Provider,null,t.createElement(u,{initialPageReady:G,filter:F,search:T,sort:E,stories:M,totalStoriesByStatus:P,view:k,author:V,queryAuthorsBySearch:C,showAuthorDropdown:R}),t.createElement(c,{allPagesFetched:h,canViewDefaultTemplates:L,filter:F,loading:{isLoading:j,showStoriesWhileLoading:D},page:O,search:T,sort:E,stories:M,storyActions:{duplicateStory:g,trashStory:f,updateStory:S},view:k}),t.createElement(i.Fixed,null,t.createElement(n,null)))}export{MyStories as default};
