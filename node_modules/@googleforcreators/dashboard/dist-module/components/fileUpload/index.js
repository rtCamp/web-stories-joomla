/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

import e from"react";import{useRef as t,useState as o,useCallback as r,useEffect as i}from"@googleforcreators/react";import"prop-types";import n from"styled-components";import{__}from"@googleforcreators/i18n";import{Button as a,themeHelpers as l,Text as s,BUTTON_TYPES as d,BUTTON_SIZES as c}from"@googleforcreators/design-system";import"../../constants/index.js";import{DEFAULT_FILE_UPLOAD_TYPES as p}from"../../constants/components.js";const m=n(a).withConfig({displayName:"fileUpload__StyledButton",componentId:"sc-1egk7ci-0"})([":focus-within{","}"],(e=>{let{theme:t}=e;return l.focusCSS(t.colors.border.focus)})),u=n.input.withConfig({displayName:"fileUpload__Input",componentId:"sc-1egk7ci-1"})(l.visuallyHidden),f=n.div.withConfig({displayName:"fileUpload__UploadFormArea",componentId:"sc-1egk7ci-2"})(["display:flex;flex-direction:column;align-items:center;position:relative;justify-content:flex-end;width:100%;min-height:153px;padding:40px 0;border-radius:4px;border:1px dashed ",";transition:border-color 300ms ease-in;"],(e=>{let{isDragging:t,theme:o}=e;return t?o.colors.border.focus:o.colors.border.defaultNormal})),g=n(s).withConfig({displayName:"fileUpload__UploadHelperText",componentId:"sc-1egk7ci-3"})(["margin:0 auto 16px;padding:0 20%;text-align:center;color:",";"],(e=>{let{theme:t}=e;return t.colors.fg.tertiary})),h=n.div.withConfig({displayName:"fileUpload__LoadingIndicator",componentId:"sc-1egk7ci-4"})(["display:flex;align-items:center;justify-content:center;position:absolute;top:0;width:100%;height:100%;background-color:",";opacity:",";z-index:",";pointer-events:none;transition:opacity ease-in-out 300ms;p{font-style:italic;}"],(e=>{let{theme:t}=e;return t.colors.standard.white}),(e=>{let{isLoading:t}=e;return t?.6:0}),(e=>{let{isLoading:t}=e;return t?"100":"0"}));function y(e){e.preventDefault(),e.stopPropagation()}const FileUpload=n=>{let{id:a,label:l,onSubmit:s,isLoading:b,isMultiple:x,ariaLabel:v,instructionalText:w=__("You can also drag your file here","web-stories"),acceptableFormats:L=p}=n;const _=t(null),E=t(null),[D,I]=o(!1),U=r((e=>{s(Object.values(e))}),[s]),j=r((e=>{y(e),U(e.target.files),E.current.value=null}),[U]),k=r((e=>{y(e);const t=e.dataTransfer.files;t&&U(t),I(!1)}),[U]),C=r((e=>{y(e),I((e=>!e)),D&&e.dataTransfer.clearData()}),[D]);return i((()=>{if(!E?.current)return()=>{};const e=E.current;return e.addEventListener("change",j),()=>{e.removeEventListener("change",j)}}),[j]),e.createElement(f,{ref:_,isDragging:D,onDrop:k,onDragEnter:C,onDragLeave:C,onDragOver:y,"data-testid":"file-upload-drop-area"},e.createElement(h,{isLoading:b},e.createElement("p",null,__("Loadingâ€¦","web-stories"))),e.createElement(g,null,w),e.createElement(m,{forwardedAs:"label",htmlFor:a,"aria-label":v,type:d.PRIMARY,size:c.SMALL},l,e.createElement(u,{ref:E,type:"file",id:a,"data-testid":"upload-file-input",accept:L.join(","),multiple:x,disabled:b,"aria-live":"polite","aria-busy":b})))};export{FileUpload as default};
