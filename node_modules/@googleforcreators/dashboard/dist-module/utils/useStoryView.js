/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

import{useState as e,useRef as r,useCallback as t,useEffect as s,useMemo as o}from"@googleforcreators/react";import i from"prop-types";import{trackEvent as a}from"@googleforcreators/tracking";import{clamp as n}from"@googleforcreators/units";import{VIEW_STYLE as u}from"../constants/index.js";import{PageSizePropType as l}from"../types.js";import c from"./usePagePreviewSize.js";import{STORY_SORT_OPTIONS as f,SORT_DIRECTION as g}from"../constants/stories.js";function h(i){let{filters:l,isLoading:h=!1,totalPages:d}=i;const[p,m]=e(u.GRID),[y,S]=e(f.LAST_MODIFIED),[I,v]=e(l.length>0?l[0].value:null),[b,_]=e(g.DESC),[D,O]=e(1),[w,A]=e(""),[j,L]=e(null),[P,T]=e([]),q=r(!1),[M,R]=e(!1),{pageSize:x}=c({thumbnailMode:p===u.LIST,isGrid:p===u.GRID}),z=t((e=>{O(n(e,{MIN:1,MAX:d}))}),[d]),E=t((e=>{S(e),z(1)}),[z]),G=t((e=>{v(e),z(1)}),[z]),N=t((e=>{e!==b&&_(e)}),[b]),k=t((()=>{const e=p===u.LIST?u.GRID:u.LIST;if(m(e),e===u.LIST){const e=y===f.NAME?g.ASC:g.DESC;N(e)}}),[y,N,p,m]),C=t((e=>{z(1),A(e)}),[z]),F=t((()=>{q.current=!0,z(D+1)}),[D,z]),K=t((e=>{let{id:r}=e;L((e=>e===r?null:r))}),[]);return s((()=>{w.length&&a("search",{search_type:"dashboard_stories",search_term:w,search_filter:I,search_author_filter:j,search_order:b,search_orderby:y,search_view:p})}),[w,I,b,y,p,j]),s((()=>{h||(q.current=!1)}),[h]),s((()=>{d&&!M&&R(!0)}),[d,M]),o((()=>({view:{style:p,toggleStyle:k,pageSize:x},sort:{value:y,direction:b,set:E,setDirection:N},filter:{value:I,set:G},page:{value:D,set:O,requestNextPage:F},search:{keyword:w,setKeyword:C},author:{filterId:j,toggleFilterId:K,queriedAuthors:P,setQueriedAuthors:T},initialPageReady:M,showStoriesWhileLoading:q})),[p,k,x,y,E,b,N,I,M,G,D,F,w,C,j,K,P,T])}i.shape({style:i.oneOf(Object.values(u)),toggleStyle:i.func,pageSize:l}),i.shape({filterId:i.number,toggleFilterId:i.func,queriedAuthors:i.arrayOf(i.shape({id:i.number,name:i.string})).isRequired,setQueriedAuthors:i.func}),i.shape({value:i.oneOfType([i.number,i.string]),set:i.func}),i.shape({value:i.oneOf(Object.values(f)),set:i.func,direction:i.oneOf(Object.values(g)),setDirection:i.func}),i.shape({value:i.number,set:i.func,requestNextPage:i.func}),i.shape({keyword:i.string,setKeyword:i.func}),i.shape({current:i.bool});export{h as default};
