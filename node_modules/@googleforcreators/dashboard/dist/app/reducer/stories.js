/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),require("../../constants/index.js");var t=require("../../constants/stories.js");const e={CREATING_STORY_FROM_TEMPLATE:"creating_story_from_template",CREATE_STORY_FROM_TEMPLATE_SUCCESS:"create_story_from_template_success",CREATE_STORY_FROM_TEMPLATE_FAILURE:"create_story_from_template_failure",LOADING_STORIES:"loading_stories",FETCH_STORIES_SUCCESS:"fetch_stories_success",FETCH_STORIES_FAILURE:"fetch_stories_failure",UPDATE_STORY:"update_story",UPDATE_STORY_FAILURE:"update_story_failure",TRASH_STORY:"trash_story",TRASH_STORY_FAILURE:"trash_story_failure",DUPLICATE_STORY:"duplicate_story",DUPLICATE_STORY_FAILURE:"duplicate_story_failure"};exports.ACTION_TYPES=e,exports.default=function(s,r){switch(r.type){case e.LOADING_STORIES:case e.CREATING_STORY_FROM_TEMPLATE:return{...s,isLoading:r.payload};case e.CREATE_STORY_FROM_TEMPLATE_FAILURE:case e.FETCH_STORIES_FAILURE:case e.UPDATE_STORY_FAILURE:case e.TRASH_STORY_FAILURE:case e.DUPLICATE_STORY_FAILURE:return{...s,error:{...r.payload,id:Date.now()}};case e.CREATE_STORY_FROM_TEMPLATE_SUCCESS:return{...s,error:{}};case e.UPDATE_STORY:return{...s,error:{},stories:{...s.stories,[r.payload.id]:r.payload}};case e.TRASH_STORY:{const e=r.payload.storyStatus===t.STORY_STATUS.DRAFT?t.STORY_STATUS.DRAFT:t.STORY_STATUS.PUBLISH;return{...s,error:{},storiesOrderById:s.storiesOrderById.filter((t=>t!==r.payload.id)),totalStoriesByStatus:{...s.totalStoriesByStatus,all:s.totalStoriesByStatus.all-1,[e]:s.totalStoriesByStatus[e]-1},stories:Object.keys(s.stories).reduce(((t,e)=>(parseInt(e)!==r.payload.id&&(t[e]=s.stories[e]),t)),{})}}case e.DUPLICATE_STORY:return{...s,error:{},storiesOrderById:[r.payload.id,...s.storiesOrderById],totalStoriesByStatus:{...s.totalStoriesByStatus,all:s.totalStoriesByStatus.all+1,[r.payload.status]:s.totalStoriesByStatus[r.payload.status]+1},stories:{...s.stories,[r.payload.id]:r.payload}};case e.FETCH_STORIES_SUCCESS:{const{fetchedStoryIds:t,totalStoriesByStatus:e,totalPages:a,page:o,stories:S}=r.payload,{storiesOrderById:_,stories:T}=s,i=1===o?t:[..._,...t],l=[...new Set(i)];return{...s,error:{},storiesOrderById:l,stories:{...T,...S},totalPages:a,totalStoriesByStatus:e,allPagesFetched:o>=a}}default:return s}},exports.defaultStoriesState={error:{},isLoading:!1,stories:{},storiesOrderById:[],totalStoriesByStatus:{},totalPages:null};
