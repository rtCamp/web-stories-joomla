/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

"use strict";var e=require("react");require("prop-types");var t=require("@googleforcreators/react"),r=require("@googleforcreators/i18n"),i=require("@googleforcreators/tracking"),o=require("@googleforcreators/design-system");require("../../../../../types.js");var s=require("../../../../../utils/titleFormatted.js");require("../../../../../utils/keyboardOnlyOutline.js");var n=require("../../../../../constants/index.js");require("@googleforcreators/units"),require("../../../../../utils/useStoryView.js"),require("../../../../../utils/useTemplateView.js"),require("../../../../../components/cardGallery/components.js"),require("../../../../../components/cardGrid/index.js"),require("../../../../../components/cardGridItem/index.js"),require("../../../../../components/colorList/index.js"),require("../../../../../components/contentGutter/index.js");var a=require("../../../../../components/dialog/dialog.js");require("../../../../../components/fileUpload/index.js"),require("../../../../../components/infiniteScroller/index.js"),require("../../../../../components/inlineInputForm/index.js"),require("../../../../../components/layout/provider.js"),require("../../../../../components/layout/scrollable.js"),require("../../../../../components/layout/fixed.js");var l=require("../../../../../components/pageStructure/pageStructureComponents.js");require("../../../../../components/pageStructure/leftRail.js"),require("../../../../../components/pageStructure/menuButton.js"),require("../../../../../components/navProvider.js"),require("../../../../../components/scrollToTop/index.js"),require("../../../../../components/storyMenu/index.js"),require("../../../../../components/table/index.js"),require("../../../../config/context.js"),require("../../../../../components/viewStyleBar/index.js");var u=require("../listView/index.js"),c=require("../storyGridView/index.js"),d=require("../../../../../constants/stories.js");function S(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var p=S(e);module.exports=function StoriesView(e){let{filterValue:S,loading:m,sort:_,storyActions:E,stories:T,view:g}=e;const[y,f]=t.useState(-1),[q,b]=t.useState(-1),[j,C]=t.useState(""),[O,w]=t.useState(null),[L,x]=t.useState({}),[N,k]=t.useState(null),{showSnackbar:v}=o.useSnackbar(),M="DELETE_STORY"===j&&O,h=t.useMemo((()=>T.map((e=>{let{id:t}=e;return t}))),[T]);t.useEffect((()=>{if(L.id&&!N){const e=h.indexOf(L.id),t=e>0?-1:1,r=L.isDeleted?t:0,i=h[e+r];i&&k(i)}}),[L,N,h]),t.useEffect((()=>{j||w(null)}),[j,w]),t.useEffect((()=>{j&&(x({}),k(null))}),[j]);const R=t.useCallback(((e,t)=>{b(-1),i.trackEvent("rename_story"),E.updateStory({...e,title:{raw:t}})}),[E]),I=t.useCallback((()=>{i.trackEvent("delete_story"),E.trashStory(O),x({id:O.id,isDeleted:!0}),C("")}),[E,O]),Y=t.useCallback((()=>{f(-1),i.trackEvent("open_in_editor")}),[]),A=t.useCallback((e=>{f(-1),b(e.id)}),[]),D=t.useCallback((e=>{f(-1),i.trackEvent("duplicate_story"),E.duplicateStory(e),x({id:e.id})}),[E]),P=t.useCallback((e=>{f(-1),w(e),C("DELETE_STORY")}),[]),U=t.useCallback((e=>{f(-1),window.navigator.clipboard.writeText(e.link),v({message:r.sprintf(
/* translators: %s: story title. */
r.__("%s has been copied to your clipboard.","web-stories"),s(e.title)),dismissible:!0}),x({id:e.id})}),[v]),V=d.STORY_CONTEXT_MENU_ITEMS.map((e=>{switch(e?.value){case d.STORY_CONTEXT_MENU_ACTIONS.COPY_STORY_LINK:e.action=U;break;case d.STORY_CONTEXT_MENU_ACTIONS.DELETE:e.action=P;break;case d.STORY_CONTEXT_MENU_ACTIONS.DUPLICATE:e.action=D;break;case d.STORY_CONTEXT_MENU_ACTIONS.OPEN_STORY_LINK:e.action=Y;break;case d.STORY_CONTEXT_MENU_ACTIONS.RENAME:e.action=A;break;default:e.action=()=>f(-1)}return e})),G=t.useMemo((()=>({handleMenuToggle:f,contextMenuId:y,menuItems:V})),[y,V,f]),X=t.useMemo((()=>({id:q,handleOnRenameStory:R,handleCancelRename:()=>b(-1)})),[R,b,q]),z=t.useMemo((()=>g.style===n.VIEW_STYLE.LIST?p.default.createElement(u,{handleSortChange:_.set,handleSortDirectionChange:_.setDirection,hideStoryList:m?.isLoading&&!m?.showStoriesWhileLoading.current,pageSize:g.pageSize,renameStory:X,sortDirection:_.direction,stories:T,storyMenu:G,storySort:_.value,storyStatus:S}):!m?.isLoading||m?.isLoading&&m?.showStoriesWhileLoading.current?p.default.createElement(c,{isLoading:m?.isLoading,pageSize:g.pageSize,renameStory:X,storyMenu:G,stories:T,returnStoryFocusId:{value:N,set:k}}):null),[m,S,X,N,_,T,G,g]);return p.default.createElement(p.default.Fragment,null,z,m?.isLoading&&!m?.showStoriesWhileLoading.current&&p.default.createElement(l.LoadingContainer,null,p.default.createElement(o.LoadingSpinner,null)),M&&p.default.createElement(a,{isOpen:!0,contentLabel:r.__("Dialog to confirm deleting a story","web-stories"),title:r.__("Delete Story","web-stories"),onClose:()=>{x({id:O.id}),C("")},secondaryText:r.__("Cancel","web-stories"),secondaryRest:{"aria-label":r.sprintf(
/* translators: %s: story title. */
r.__('Cancel deleting story "%s"',"web-stories"),s(O.title))},primaryText:r.__("Delete","web-stories"),onPrimary:I,primaryRest:{"aria-label":r.sprintf(
/* translators: %s: story title. */
r.__('Confirm deleting story "%s"',"web-stories"),s(O.title))}},p.default.createElement(o.Text,{size:o.THEME_CONSTANTS.TYPOGRAPHY.PRESET_SIZES.SMALL},r.sprintf(
/* translators: %s: story title. */
r.__('Are you sure you want to delete "%s"?',"web-stories"),s(O.title)))))};
