/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

"use strict";var e=require("react"),t=require("@googleforcreators/design-system"),r=require("@googleforcreators/date"),n=require("@googleforcreators/i18n");require("prop-types");var o=require("@googleforcreators/react"),s=require("styled-components"),i=require("../../../../../constants/index.js");require("../../../../../components/cardGallery/components.js"),require("../../../../../components/cardGrid/index.js"),require("../../../../../components/cardGridItem/index.js"),require("../../../../../components/colorList/index.js"),require("../../../../../components/contentGutter/index.js"),require("../../../../../components/fileUpload/index.js"),require("../../../../../components/infiniteScroller/index.js"),require("../../../../../components/inlineInputForm/index.js"),require("../../../../../components/layout/provider.js"),require("../../../../../components/layout/scrollable.js"),require("../../../../../components/layout/fixed.js"),require("../../../../../components/pageStructure/pageStructureComponents.js"),require("../../../../../components/pageStructure/leftRail.js"),require("../../../../../components/pageStructure/menuButton.js"),require("../../../../../components/navProvider.js"),require("../../../../../components/scrollToTop/index.js");var a=require("../../../../../components/storyMenu/index.js");require("../../../../../components/table/index.js"),require("../../../../config/context.js");var u=require("../../../../config/useConfig.js");require("../../../../../components/viewStyleBar/index.js");var l=require("../../../../../components/popoverMenu/story-menu-generator.js");require("../../../../../types.js");var d=require("../../../../../utils/titleFormatted.js");require("../../../../../utils/keyboardOnlyOutline.js"),require("@googleforcreators/units"),require("../../../../../utils/useStoryView.js"),require("../../../../../utils/useTemplateView.js");var c=require("../../../shared/grid/components.js"),m=require("./components.js"),p=require("./storyDisplayContent.js"),f=require("../../../../../constants/stories.js");function q(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var g=q(e);function y(){return y=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},y.apply(this,arguments)}const j=o.forwardRef(((e,q)=>{let{onFocus:j,isActive:x,pageSize:v,renameStory:h,story:I,storyMenu:S}=e;const{userId:b}=u(),E=x?0:-1,M=h?{editMode:h?.id===I?.id,onEditComplete:e=>h?.handleOnRenameStory(I,e),onEditCancel:h?.handleCancelRename}:{},_=o.useMemo((()=>I?.locked&&b!==I?.lockUser.id),[I,b]),G=o.useMemo((()=>l.generateStoryMenu({menuItems:S.menuItems,story:I,isLocked:_})),[S,I,_]),T=r.getRelativeDisplayDate(I?.status===f.STORY_STATUS.DRAFT?I?.modifiedGmt:I?.createdGmt),k=d(I.title),C=o.useMemo((()=>G.length?g.default.createElement(a.default,{menuLabel:_?n.sprintf(
/* translators: 1: story title. 2: user currently editing the story. */
n.__("Context menu for %1$s (locked by %2$s)","web-stories"),k,I?.lockUser.name):n.sprintf(
/* translators: %s: story title.*/
n.__("Context menu for %s","web-stories"),k),itemActive:x,tabIndex:E,onMoreButtonSelected:S.handleMenuToggle,contextMenuId:S.contextMenuId,storyId:I.id,isInverted:!0,menuItems:G,menuStyleOverrides:s.css(["margin:0 0 0 auto;"])}):null),[_,k,I?.lockUser?.name,I.id,x,E,S,G]);return g.default.createElement(m.CustomCardGridItem,{"data-testid":`story-grid-item-${I.id}`,onFocus:j,$posterHeight:v.height,ref:q,"aria-label":n.sprintf(
/* translators: %s: story title.*/
n.__("Details about %s","web-stories"),k)},g.default.createElement(c.Container,null,g.default.createElement(m.CardWrapper,null,g.default.createElement(c.Poster,y({},I.featuredMediaUrl?{alt:n.sprintf(
/* translators: %s: Story title. */
n.__("%s Poster image","web-stories"),k),as:"img",src:I.featuredMediaUrl,decoding:"async"}:null,{width:i.DEFAULT_GRID_IMG_WIDTH,height:i.DEFAULT_GRID_IMG_HEIGHT})),g.default.createElement(c.Gradient,null),g.default.createElement(c.Scrim,null,I?.capabilities?.hasEditAction&&g.default.createElement(m.ScrimAnchor,{className:"grid-item-anchor","data-testid":"story-editor-grid-link",tabIndex:E,href:I.editStoryLink},g.default.createElement(t.VisuallyHidden,null,n.sprintf(
/* translators: %s: Story title. */
n.__("Open %s in Editor","web-stories"),k))),g.default.createElement(p,y({author:I.author,contextMenu:C,displayDate:T,formattedTitle:k,id:I.id,isLocked:_,lockUser:I?.lockUser,status:I?.status,title:I.title},M))))))}));j.displayName="StoryGridItem",module.exports=j;
