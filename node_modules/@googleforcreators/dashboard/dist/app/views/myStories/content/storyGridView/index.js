/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

"use strict";var e=require("react"),r=require("@googleforcreators/i18n");require("prop-types");var t=require("styled-components"),n=require("@googleforcreators/react"),o=require("@googleforcreators/design-system");require("../../../../../constants/index.js"),require("../../../../../components/cardGallery/components.js");var s=require("../../../../../components/cardGrid/index.js");require("../../../../../components/cardGridItem/index.js"),require("../../../../../components/colorList/index.js"),require("../../../../../components/contentGutter/index.js"),require("../../../../../components/fileUpload/index.js"),require("../../../../../components/infiniteScroller/index.js"),require("../../../../../components/inlineInputForm/index.js"),require("../../../../../components/layout/provider.js"),require("../../../../../components/layout/scrollable.js"),require("../../../../../components/layout/fixed.js"),require("../../../../../components/pageStructure/pageStructureComponents.js"),require("../../../../../components/pageStructure/leftRail.js"),require("../../../../../components/pageStructure/menuButton.js"),require("../../../../../components/navProvider.js"),require("../../../../../components/scrollToTop/index.js"),require("../../../../../components/storyMenu/index.js"),require("../../../../../components/table/index.js"),require("../../../../config/context.js");var u=require("../../../../config/useConfig.js");require("../../../../../components/viewStyleBar/index.js"),require("../../../../../types.js");var i=require("../storyGridItem/index.js"),c=require("../../../../../constants/pageStructure.js"),a=require("../../../../../constants/stories.js");function l(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var d=l(e);const m=l(t).default(s).withConfig({displayName:"storyGridView__StoryGrid",componentId:"sc-1fwq7hb-0"})(["width:calc(100% - ","px);"],c.PAGE_WRAPPER.GUTTER);module.exports=e=>{let{stories:t,pageSize:s,storyMenu:c,renameStory:l,returnStoryFocusId:p}=e;const{isRTL:f}=u(),q=n.useRef(),j=n.useRef(),y=n.useRef({}),[g,S]=n.useState(),T=n.useRef(),E=n.useMemo((()=>t.map((e=>{let{id:r}=e;return r}))),[t]);o.useGridViewKeys({containerRef:q,gridRef:j,itemRefs:y,isRTL:f,currentItemId:g,items:t}),n.useEffect((()=>{if(!g&&p?.value&&!T.current){const e=p?.value;S(e);const r=y.current?.[e]?.querySelectorAll(["button","a"])?.[0];r?.focus()}}),[g,p]),n.useEffect((()=>{g&&(T.current=g)}),[g]);const x=n.useCallback(((e,r)=>{if(c.handleMenuToggle(r),r<0&&9===e?.keyCode){const r=!e?.shiftKey?E[E.indexOf(g)+1]:g;p.set(r),T.current=null,S(null)}}),[g,E,p,c]),R=n.useCallback((()=>{T.current=null,S(null),p.set(null)}),[p]);n.useFocusOut(q,(()=>S(null)),[]);const v=n.useMemo((()=>{const e=[a.STORY_CONTEXT_MENU_ACTIONS.DELETE,a.STORY_CONTEXT_MENU_ACTIONS.RENAME,a.STORY_CONTEXT_MENU_ACTIONS.DUPLICATE],r=c.menuItems.map((r=>{const t={...r};return e.includes(r?.value)&&(t.action=e=>{R(),r.action(e)}),t}));return{...c,handleMenuToggle:x,menuItems:r}}),[x,c,R]),_=n.useMemo((()=>t.map((e=>d.default.createElement(i,{onFocus:()=>S(e.id),isActive:g===e.id,ref:r=>{y.current[e.id]=r},key:e.id,pageSize:s,renameStory:l,story:e,storyMenu:v})))),[g,v,s,l,t]);return d.default.createElement("div",{ref:q},d.default.createElement(m,{pageSize:s,ref:j,role:"list",ariaLabel:r.__("Viewing stories","web-stories")},_))};
