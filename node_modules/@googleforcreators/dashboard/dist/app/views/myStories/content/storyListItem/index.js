/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react");require("prop-types");var t=require("@googleforcreators/react"),r=require("@googleforcreators/date"),n=require("@googleforcreators/i18n"),l=require("@googleforcreators/design-system");require("../../../../../constants/index.js"),require("../../../../../components/cardGallery/components.js"),require("../../../../../components/cardGrid/index.js"),require("../../../../../components/cardGridItem/index.js"),require("../../../../../components/colorList/index.js"),require("../../../../../components/contentGutter/index.js"),require("styled-components"),require("../../../../../components/fileUpload/index.js"),require("../../../../../components/infiniteScroller/index.js");var o=require("../../../../../components/inlineInputForm/index.js");require("../../../../../components/layout/provider.js"),require("../../../../../components/layout/scrollable.js"),require("../../../../../components/layout/fixed.js"),require("../../../../../components/pageStructure/pageStructureComponents.js"),require("../../../../../components/pageStructure/leftRail.js"),require("../../../../../components/pageStructure/menuButton.js"),require("../../../../../components/navProvider.js"),require("../../../../../components/scrollToTop/index.js");var s=require("../../../../../components/storyMenu/index.js"),a=require("../../../../../components/table/index.js");require("../../../../config/context.js"),require("../../../../../components/viewStyleBar/index.js");var i=require("../../../../../components/popoverMenu/story-menu-generator.js");require("../../../../../types.js");var u=require("../../../../../utils/titleFormatted.js");require("../../../../../utils/keyboardOnlyOutline.js"),require("@googleforcreators/units"),require("../../../../../utils/useStoryView.js"),require("../../../../../utils/useTemplateView.js");var c=require("./components.js"),d=require("../../../../../constants/stories.js");function m(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var p=m(e);function S(e){window.getSelection().selectAllChildren(e.target)}function T(){window.getSelection().removeAllRanges()}exports.StoryListItem=e=>{let{story:m,renameStory:f,userId:E,storyMenu:q,storyStatus:g}=e;const y=t.useMemo((()=>m?.locked&&E!==m?.lockUser.id),[m,E]),j=u(m.title),_=t.useMemo((()=>i.generateStoryMenu({menuItems:q.menuItems,story:m,isLocked:y})),[q,m,y]),x=t.useMemo((()=>_.length?p.default.createElement(s.default,{menuLabel:n.sprintf(
/* translators: %s: story title.*/
n.__("Context menu for %s","web-stories"),j),onMoreButtonSelected:(e,t)=>q.handleMenuToggle(t),contextMenuId:q.contextMenuId,storyId:m.id,menuItems:_,verticalAlign:"center"}):null),[_,j,q,m]);return p.default.createElement(c.StyledTableRow,{"data-testid":`story-list-item-${m.id}`},p.default.createElement(a.TablePreviewCell,null,p.default.createElement(l.Tooltip,{title:y&&m?.lockUser.name?n.sprintf(
/* translators: %s: user name */
n.__("%s is currently editing this story","web-stories"),m?.lockUser.name):""},p.default.createElement(c.PreviewWrapper,null,p.default.createElement(c.PreviewImage,m.featuredMediaUrl?{src:m.featuredMediaUrl,alt:n.sprintf(
/* translators: %s: Story title. */
n.__("%s Poster image","web-stories"),j),as:"img",decoding:"async"}:null),y&&p.default.createElement(c.LockIcon,null)))),p.default.createElement(a.TableCell,null,p.default.createElement(c.TitleTableCellContainer,null,f.id===m.id?p.default.createElement(o,{onEditComplete:e=>f.handleOnRenameStory(m,e),onEditCancel:f.handleCancelRename,value:m.title,id:m.id,label:n.__("Rename story","web-stories")}):p.default.createElement(p.default.Fragment,null,p.default.createElement(l.Headline,{tabIndex:0,onFocus:S,onBlur:T,size:l.THEME_CONSTANTS.TYPOGRAPHY.PRESET_SIZES.XXX_SMALL,as:"h3","aria-label":y?n.sprintf(
/* translators: 1: story title. 2: user currently editing the story. */
n.__("%1$s (locked by %2$s)","web-stories"),j,m?.lockUser.name):j},j),x))),p.default.createElement(a.TableCell,null,p.default.createElement(l.Text,{as:"span",size:l.THEME_CONSTANTS.TYPOGRAPHY.PRESET_SIZES.SMALL},m.author?.name||"â€”")),p.default.createElement(a.TableCell,null,p.default.createElement(l.Text,{as:"span",size:l.THEME_CONSTANTS.TYPOGRAPHY.PRESET_SIZES.SMALL},r.getRelativeDisplayDate(m.createdGmt))),p.default.createElement(a.TableCell,null,p.default.createElement(l.Text,{as:"span",size:l.THEME_CONSTANTS.TYPOGRAPHY.PRESET_SIZES.SMALL},r.getRelativeDisplayDate(m.modifiedGmt))),g!==d.STORY_STATUS.DRAFT&&p.default.createElement(a.TableStatusCell,null,p.default.createElement(l.Text,{as:"span",size:l.THEME_CONSTANTS.TYPOGRAPHY.PRESET_SIZES.SMALL},d.DISPLAY_STATUS[m?.status])))};
