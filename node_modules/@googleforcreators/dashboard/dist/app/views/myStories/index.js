/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

"use strict";var e=require("react"),t=require("@googleforcreators/react");require("prop-types"),require("@googleforcreators/i18n"),require("@googleforcreators/design-system"),require("../../../constants/index.js"),require("../../../components/cardGallery/components.js"),require("../../../components/cardGrid/index.js"),require("../../../components/cardGridItem/index.js"),require("../../../components/colorList/index.js"),require("../../../components/contentGutter/index.js"),require("styled-components"),require("../../../components/fileUpload/index.js"),require("../../../components/infiniteScroller/index.js"),require("../../../components/inlineInputForm/index.js");var r=require("../../../components/layout/index.js");require("../../../components/pageStructure/pageStructureComponents.js"),require("../../../components/pageStructure/leftRail.js"),require("../../../components/pageStructure/menuButton.js"),require("../../../components/navProvider.js");var o=require("../../../components/scrollToTop/index.js");require("../../../components/storyMenu/index.js"),require("../../../components/table/index.js"),require("../../config/context.js");var s=require("../../config/useConfig.js");require("../../../components/viewStyleBar/index.js"),require("../../../utils/keyboardOnlyOutline.js"),require("@googleforcreators/units");var i=require("../../../utils/useStoryView.js");require("../../../utils/useTemplateView.js");var n=require("../../../utils/noop.js"),a=require("../../api/useApi.js"),u=require("./content/index.js"),l=require("./header/index.js"),c=require("../../../constants/stories.js");function d(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var p=d(e);module.exports=function MyStories(){const{duplicateStory:e,fetchStories:d,trashStory:f,updateStory:g,allPagesFetched:m,isLoading:y,stories:S,storiesOrderById:q,totalPages:h,totalStoriesByStatus:j,getAuthors:v}=a((e=>{let{actions:{storyApi:{duplicateStory:t,fetchStories:r,trashStory:o,updateStory:s},usersApi:{getAuthors:i}},state:{stories:{allPagesFetched:n,isLoading:a,stories:u,storiesOrderById:l,totalPages:c,totalStoriesByStatus:d}}}=e;return{duplicateStory:t,fetchStories:r,trashStory:o,updateStory:s,allPagesFetched:n,isLoading:a,stories:u,storiesOrderById:l,totalPages:c,totalStoriesByStatus:d,getAuthors:i}})),{apiCallbacks:x,canViewDefaultTemplates:w}=s(),P=t.useRef(!1);t.useEffect((()=>(P.current=!0,()=>{P.current=!1})),[]);const{filter:A,page:B,search:E,sort:T,view:L,showStoriesWhileLoading:I,initialPageReady:O,author:F}=i({filters:c.STORY_STATUSES,isLoading:y,totalPages:h}),{setQueriedAuthors:b}=F;let k=t.useCallback((e=>v(e).then((e=>{if(!P.current)return;const t=e.map((e=>{let{id:t,name:r}=e;return{id:t,name:r}}));b((e=>{const r=e.map((e=>{let{id:t}=e;return t})),o=t.filter((e=>!r.includes(e.id)));return[...e,...o]}))}))),[v,b]);v||(k=n.noop),t.useEffect((()=>{k()}),[k]),t.useEffect((()=>{d({page:B.value,searchTerm:E.keyword,sortDirection:T.direction,sortOption:T.value,status:A.value,author:F.filterId})}),[d,A.value,B.value,E.keyword,T.direction,T.value,F.filterId,x]);const R=t.useMemo((()=>q.map((e=>S[e]))),[S,q]),C="function"==typeof v;return p.default.createElement(r.default.Provider,null,p.default.createElement(l,{initialPageReady:O,filter:A,search:E,sort:T,stories:R,totalStoriesByStatus:j,view:L,author:F,queryAuthorsBySearch:k,showAuthorDropdown:C}),p.default.createElement(u,{allPagesFetched:m,canViewDefaultTemplates:w,filter:A,loading:{isLoading:y,showStoriesWhileLoading:I},page:B,search:E,sort:T,stories:R,storyActions:{duplicateStory:e,trashStory:f,updateStory:g},view:L}),p.default.createElement(r.default.Fixed,null,p.default.createElement(o,null)))};
