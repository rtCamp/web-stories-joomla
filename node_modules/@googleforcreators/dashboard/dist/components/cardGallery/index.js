/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

"use strict";var e=require("react");require("prop-types");var t=require("@googleforcreators/react"),r=require("@googleforcreators/i18n"),a=require("@googleforcreators/design-system"),s=require("../../constants/index.js"),l=require("./components.js");function n(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var i=n(e);function u(e){return r.sprintf(
/* translators: %s: page number. */
r.__("Poster of template page %s","web-stories"),e)}module.exports=function CardGallery(e){let{galleryPosters:n,isRTL:c,galleryLabel:o}=e;const[f,g]=t.useState(0),[d,m]=t.useState(),p=t.useRef(),_=t.useRef(),E=t.useRef({}),b=t.useCallback((e=>{g(e),m(e)}),[]),y=t.useCallback((e=>{m(e)}),[]);t.useEffect((()=>{n&&(g(0),m())}),[n]),a.useGridViewKeys({containerRef:p,gridRef:_,itemRefs:E,isRTL:c,currentItemId:d,items:n});const I=t.useMemo((()=>n.map(((e,t)=>{const a=`gallery_item_${t}`,n=t+1,c=d?d===t:f===t;return i.default.createElement("div",{key:a,ref:e=>{E.current[t]=e},onFocus:()=>y(t)},i.default.createElement(l.ThumbnailButton,{$isSelected:f===t,tabIndex:c?0:-1,onClick:()=>b(t),"aria-label":f===t?r.sprintf(
/* translators: %s: page number. */
r.__("Page %s (current page)","web-stories"),n):r.sprintf(
/* translators: %s: page number. */
r.__("Page %s","web-stories"),n)},i.default.createElement("picture",null,i.default.createElement("source",{srcSet:e.webp,type:"image/webp"}),i.default.createElement("source",{srcSet:e.png,type:"image/png"}),i.default.createElement("img",{src:e.png,decoding:"async",alt:u(n),width:s.DEFAULT_GRID_IMG_WIDTH,height:s.DEFAULT_GRID_IMG_HEIGHT}))))}))),[n,f,d,y,b]);return i.default.createElement(l.GalleryContainer,{ref:p},i.default.createElement(l.Thumbnails,{ref:_,role:"group","aria-label":o,"data-testid":"mini-cards-container"},I),i.default.createElement(l.DisplayPage,null,n[f]&&i.default.createElement("picture",null,i.default.createElement("source",{srcSet:n[f].webp,type:"image/webp"}),i.default.createElement("source",{srcSet:n[f].png,type:"image/png"}),i.default.createElement("img",{src:n[f].png,decoding:"async",alt:r.sprintf(
/* translators: %s: active preview page number */
r.__("Active Page Preview - Page %s","web-stories"),f+1),width:s.DEFAULT_GRID_IMG_WIDTH,height:s.DEFAULT_GRID_IMG_HEIGHT}))))};
