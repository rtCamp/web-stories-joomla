/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

"use strict";var e=require("react"),t=require("@googleforcreators/react");require("prop-types");var a=require("styled-components"),r=require("@googleforcreators/i18n"),i=require("@googleforcreators/design-system");require("../../constants/index.js");var o=require("../../constants/components.js");function n(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var l=n(e),s=n(a);const d=s.default(i.Button).withConfig({displayName:"fileUpload__StyledButton",componentId:"sc-1egk7ci-0"})([":focus-within{","}"],(e=>{let{theme:t}=e;return i.themeHelpers.focusCSS(t.colors.border.focus)})),u=s.default.input.withConfig({displayName:"fileUpload__Input",componentId:"sc-1egk7ci-1"})(i.themeHelpers.visuallyHidden),c=s.default.div.withConfig({displayName:"fileUpload__UploadFormArea",componentId:"sc-1egk7ci-2"})(["display:flex;flex-direction:column;align-items:center;position:relative;justify-content:flex-end;width:100%;min-height:153px;padding:40px 0;border-radius:4px;border:1px dashed ",";transition:border-color 300ms ease-in;"],(e=>{let{isDragging:t,theme:a}=e;return t?a.colors.border.focus:a.colors.border.defaultNormal})),p=s.default(i.Text).withConfig({displayName:"fileUpload__UploadHelperText",componentId:"sc-1egk7ci-3"})(["margin:0 auto 16px;padding:0 20%;text-align:center;color:",";"],(e=>{let{theme:t}=e;return t.colors.fg.tertiary})),f=s.default.div.withConfig({displayName:"fileUpload__LoadingIndicator",componentId:"sc-1egk7ci-4"})(["display:flex;align-items:center;justify-content:center;position:absolute;top:0;width:100%;height:100%;background-color:",";opacity:",";z-index:",";pointer-events:none;transition:opacity ease-in-out 300ms;p{font-style:italic;}"],(e=>{let{theme:t}=e;return t.colors.standard.white}),(e=>{let{isLoading:t}=e;return t?.6:0}),(e=>{let{isLoading:t}=e;return t?"100":"0"}));function g(e){e.preventDefault(),e.stopPropagation()}module.exports=e=>{let{id:a,label:n,onSubmit:s,isLoading:m,isMultiple:b,ariaLabel:h,instructionalText:y=r.__("You can also drag your file here","web-stories"),acceptableFormats:_=o.DEFAULT_FILE_UPLOAD_TYPES}=e;const v=t.useRef(null),x=t.useRef(null),[E,L]=t.useState(!1),w=t.useCallback((e=>{s(Object.values(e))}),[s]),T=t.useCallback((e=>{g(e),w(e.target.files),x.current.value=null}),[w]),U=t.useCallback((e=>{g(e);const t=e.dataTransfer.files;t&&w(t),L(!1)}),[w]),k=t.useCallback((e=>{g(e),L((e=>!e)),E&&e.dataTransfer.clearData()}),[E]);return t.useEffect((()=>{if(!x?.current)return()=>{};const e=x.current;return e.addEventListener("change",T),()=>{e.removeEventListener("change",T)}}),[T]),l.default.createElement(c,{ref:v,isDragging:E,onDrop:U,onDragEnter:k,onDragLeave:k,onDragOver:g,"data-testid":"file-upload-drop-area"},l.default.createElement(f,{isLoading:m},l.default.createElement("p",null,r.__("Loadingâ€¦","web-stories"))),l.default.createElement(p,null,y),l.default.createElement(d,{forwardedAs:"label",htmlFor:a,"aria-label":h,type:i.BUTTON_TYPES.PRIMARY,size:i.BUTTON_SIZES.SMALL},n,l.default.createElement(u,{ref:x,type:"file",id:a,"data-testid":"upload-file-input",accept:_.join(","),multiple:b,disabled:m,"aria-live":"polite","aria-busy":m})))};
