/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

"use strict";var e=require("react"),t=require("@googleforcreators/i18n"),r=require("@googleforcreators/react");require("prop-types");var o=require("styled-components"),n=require("@googleforcreators/design-system");function a(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var l=a(e),s=a(o);const i=s.default.div.withConfig({displayName:"infiniteScroller__ScrollMessage",componentId:"sc-1gpz4fk-0"})(["width:100%;padding:140px 0 40px;margin:-100px auto 0;text-align:center;p{color:",";}"],(e=>{let{theme:t}=e;return t.colors.fg.tertiary})),c=s.default.div.withConfig({displayName:"infiniteScroller__LoadingContainer",componentId:"sc-1gpz4fk-1"})(["display:flex;justify-content:center;"]),d=s.default.span.withConfig({displayName:"infiniteScroller__AriaOnlyAlert",componentId:"sc-1gpz4fk-2"})(n.themeHelpers.visuallyHidden),u="loadable",f="loading_internal",g="loading_external",p="complete",m="internal on load",E="external on load",_="all loaded",S="load success",y="can load more",M={[u]:{[m]:f,[E]:g},[f]:{[_]:p,[S]:u},[g]:{[_]:p,[S]:u},[p]:{[y]:u}},x=(e,t)=>M[e][t]||e;module.exports=e=>{let{allDataLoadedMessage:o=t.__("No more stories","web-stories"),allDataLoadedAriaMessage:a=t.__("All stories are loaded","web-stories"),onLoadMore:s,canLoadMore:p,isLoading:M,loadingAriaMessage:L=t.__("Loading more stories","web-stories")}=e;const h=r.useRef(null),v=r.useRef(s);v.current=s;const[b,w]=r.useReducer(x,u),A=r.useMemo((()=>b===f?L:b===g||p?null:a),[a,L,b,p]);r.useEffect((()=>{b===f&&v.current()}),[b]),r.useEffect((()=>{M&&w(E)}),[M]),r.useEffect((()=>{M||w(p?S:_)}),[M,p]),r.useEffect((()=>{p&&w(y)}),[p]),r.useEffect((()=>{if(!h.current)return()=>{};const e=new IntersectionObserver((e=>{e.forEach((e=>{e.isIntersecting&&w(m)}))}),{rootMargin:"0px",threshold:0}),t=h.current;return e.observe(t),()=>{e.unobserve(t)}}),[]);const q=r.useMemo((()=>b===g?null:p?l.default.createElement(c,null,l.default.createElement(n.LoadingSpinner,{animationSize:50,circleSize:6})):l.default.createElement(n.Text,{size:n.THEME_CONSTANTS.TYPOGRAPHY.PRESET_SIZES.SMALL},o)),[o,p,b]);return l.default.createElement(i,{"data-testid":"load-more-on-scroll",ref:h},A&&l.default.createElement(d,{role:"status"},A),q)};
