/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

"use strict";var e=require("@googleforcreators/react"),t=require("prop-types"),a=require("@googleforcreators/tracking"),u=require("@googleforcreators/units"),r=require("../constants/index.js"),s=require("../types.js"),l=require("./usePagePreviewSize.js"),f=require("../constants/stories.js");function i(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var o=i(t);o.default.shape({style:o.default.oneOf(Object.values(r.VIEW_STYLE)),toggleStyle:o.default.func,pageSize:s.PageSizePropType}),o.default.shape({filterId:o.default.number,toggleFilterId:o.default.func,queriedAuthors:o.default.arrayOf(o.default.shape({id:o.default.number,name:o.default.string})).isRequired,setQueriedAuthors:o.default.func}),o.default.shape({value:o.default.oneOfType([o.default.number,o.default.string]),set:o.default.func}),o.default.shape({value:o.default.oneOf(Object.values(f.STORY_SORT_OPTIONS)),set:o.default.func,direction:o.default.oneOf(Object.values(f.SORT_DIRECTION)),setDirection:o.default.func}),o.default.shape({value:o.default.number,set:o.default.func,requestNextPage:o.default.func}),o.default.shape({keyword:o.default.string,setKeyword:o.default.func}),o.default.shape({current:o.default.bool}),module.exports=function(t){let{filters:s,isLoading:i=!1,totalPages:o}=t;const[d,c]=e.useState(r.VIEW_STYLE.GRID),[n,S]=e.useState(f.STORY_SORT_OPTIONS.LAST_MODIFIED),[I,g]=e.useState(s.length>0?s[0].value:null),[T,h]=e.useState(f.SORT_DIRECTION.DESC),[O,E]=e.useState(1),[_,p]=e.useState(""),[b,R]=e.useState(null),[y,v]=e.useState([]),C=e.useRef(!1),[L,q]=e.useState(!1),{pageSize:D}=l.default({thumbnailMode:d===r.VIEW_STYLE.LIST,isGrid:d===r.VIEW_STYLE.GRID}),k=e.useCallback((e=>{const t={MIN:1,MAX:o};E(u.clamp(e,t))}),[o]),N=e.useCallback((e=>{S(e),k(1)}),[k]),P=e.useCallback((e=>{g(e),k(1)}),[k]),Y=e.useCallback((e=>{e!==T&&h(e)}),[T]),m=e.useCallback((()=>{const e=d===r.VIEW_STYLE.LIST?r.VIEW_STYLE.GRID:r.VIEW_STYLE.LIST;if(c(e),e===r.VIEW_STYLE.LIST){const e=n===f.STORY_SORT_OPTIONS.NAME?f.SORT_DIRECTION.ASC:f.SORT_DIRECTION.DESC;Y(e)}}),[n,Y,d,c]),W=e.useCallback((e=>{k(1),p(e)}),[k]),j=e.useCallback((()=>{C.current=!0,k(O+1)}),[O,k]),w=e.useCallback((e=>{let{id:t}=e;R((e=>e===t?null:t))}),[]);return e.useEffect((()=>{_.length&&a.trackEvent("search",{search_type:"dashboard_stories",search_term:_,search_filter:I,search_author_filter:b,search_order:T,search_orderby:n,search_view:d})}),[_,I,T,n,d,b]),e.useEffect((()=>{i||(C.current=!1)}),[i]),e.useEffect((()=>{o&&!L&&q(!0)}),[o,L]),e.useMemo((()=>({view:{style:d,toggleStyle:m,pageSize:D},sort:{value:n,direction:T,set:N,setDirection:Y},filter:{value:I,set:P},page:{value:O,set:E,requestNextPage:j},search:{keyword:_,setKeyword:W},author:{filterId:b,toggleFilterId:w,queriedAuthors:y,setQueriedAuthors:v},initialPageReady:L,showStoriesWhileLoading:C})),[d,m,D,n,N,T,Y,I,L,P,O,j,_,W,b,w,y,v])};
