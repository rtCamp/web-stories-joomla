/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

import t from"react";import e from"prop-types";import{useState as n,useRef as r,useLayoutEffect as o,useEffect as a}from"@googleforcreators/react";import i,{css as s}from"styled-components";import{BEZIER as l}from"../../theme/constants/index.js";import{DIRECTIONS as m,CORNER_DIRECTIONS as u}from"../../utils/directions.js";import{Popover as c,Shadow as d}from"./styled.js";function f(){return f=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},f.apply(this,arguments)}const p={[m.TOP]:100,[m.RIGHT]:0,[m.BOTTOM]:-100,[m.LEFT]:-50},h=`transform 0.175s ${l.default}`,g=s(["top:0;right:0;bottom:0;left:0;"]),_=i.div.withConfig({displayName:"animationContainer__MenuWrapper",componentId:"sc-10ar2ad-0"})(["position:absolute;"]),T=i.div.withConfig({displayName:"animationContainer__MenuRevealer",componentId:"sc-10ar2ad-1"})(["overflow:",";border-radius:",";",""],(t=>{let{animationFinished:e}=t;return e?"normal":"hidden"}),(t=>{let{theme:e}=t;return e.borders.radius.small}),g),b=i.div.withConfig({displayName:"animationContainer__MenuCounterRevealer",componentId:"sc-10ar2ad-2"})(["border-radius:",";"],(t=>{let{theme:e}=t;return e.borders.radius.small})),y=i(c).withConfig({displayName:"animationContainer__ButtonInner",componentId:"sc-10ar2ad-3"})([""," ",";transform:",";","{","}","{transition:",";","}","{transition:",";","}","{transition:",";transform:",";transform-origin:",";}"],g,(t=>{let{isInline:e}=t;return e&&"position: relative"}),(t=>{switch(t.align){case u.top_left:return`translate(${p[m.LEFT]}%, ${p[m.TOP]}%)`;case u.top_right:return`translate(${p[m.RIGHT]}%, ${p[m.TOP]}%)`;case u.bottom_right:return`translate(${p[m.RIGHT]}%, ${p[m.BOTTOM]}%)`;case u.bottom_left:default:return`translate(${p[m.LEFT]}%, ${p[m.BOTTOM]}%)`}}),_,(t=>{switch(t.align){case u.top_right:return s(["top:0;right:0;"]);case u.top_left:return s(["top:0;left:0;"]);case u.bottom_right:return s(["right:0;bottom:0;"]);case u.bottom_left:default:return s(["left:0;bottom:0;"])}}),T,(t=>t.isReady?h:"none"),(t=>{switch(t.align){case u.top_right:return s(["transform:",";"],t.isReady?"none":"translate(50%, -50%)");case u.top_left:return s(["transform:",";"],t.isReady?"none":"translate(-50%, -50%)");case u.bottom_right:return s(["transform:",";"],t.isReady?"none":"translate(50%, 50%)");case u.bottom_left:default:return s(["transform:",";"],t.isReady?"none":"translate(-50%, 50%)")}}),b,(t=>t.isReady?h:"none"),(t=>{switch(t.align){case u.top_right:return s(["transform:",";"],t.isReady?"none":"translate(-50%, 50%)");case u.top_left:return s(["transform:",";"],t.isReady?"none":"translate(50%, 50%)");case u.bottom_right:return s(["transform:",";"],t.isReady?"none":"translate(-50%, -50%)");case u.bottom_left:default:return s(["transform:",";"],t.isReady?"none":"translate(50%, -50%)")}}),d,(t=>t.isReady?h:"none"),(t=>t.isReady?"none":"scale(0.5)"),(t=>{switch(t.align){case u.top_right:return"right top";case u.top_left:return"left top";case u.bottom_right:return"right bottom";case u.bottom_left:default:return"left bottom"}}));function AnimationContainer(e){let{children:i,isOpen:s,...l}=e;const[c,h]=n(null),[g,R]=n(!1),[O,w]=n(!0),C=r(null),v=r(null);return o((()=>{if(!s)return void h(null);if(!v.current||!C.current)return;const t=v.current.getBoundingClientRect(),e=C.current.getBoundingClientRect(),n=t.left+t.width*(p[m.LEFT]/100),r=t.bottom+t.height*(p[m.BOTTOM]/100),o=n+e.width>window.innerWidth?m.RIGHT:m.LEFT,a=0>r-e.height?m.TOP:m.BOTTOM;h(u[`${a}_${o}`])}),[s]),a((()=>{let t;return s&&(w(!1),t=setTimeout((()=>w(!0)),175)),()=>clearTimeout(t)}),[s]),a((()=>{const t=requestAnimationFrame((()=>R(Boolean(c))));return()=>cancelAnimationFrame(t)}),[c]),t.createElement(y,f({align:c,isOpen:s,isReady:g,ref:v},l),t.createElement(_,null,t.createElement(T,{animationFinished:s&&O},t.createElement(b,{ref:C},i)),t.createElement(d,null)))}y.propTypes={align:e.oneOf(Object.values(u)),isReady:e.bool};export{AnimationContainer as default};
