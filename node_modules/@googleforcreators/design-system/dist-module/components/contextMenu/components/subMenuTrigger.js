/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

import e from"react";import{useRef as r,useDebouncedCallback as t,useEffect as n,useCallback as o}from"@googleforcreators/react";import"prop-types";import{useKeyDownEffect as i}from"../../keyboard/index.js";import u from"./item.js";import c from"../contextMenuProvider/useContextMenu.js";import{FOCUSABLE_SELECTORS as s,KEYS as a}from"../../../utils/constants.js";function l(){return l=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},l.apply(this,arguments)}function SubMenuTrigger(p){let{openSubMenu:d,closeSubMenu:f,isSubMenuOpen:m,isRTL:v=!1,subMenuRef:g,parentMenuRef:y,...h}=p;const b=r(),M=r({}),{setFocusedId:x}=c((e=>{let{actions:r}=e;return{setFocusedId:r.setFocusedId}})),E=e=>{const{x:r,y:t,width:n,height:o}=e.getBoundingClientRect(),{x:i,y:u}=M.current;if(void 0===i||void 0===u)return!0;return i<r-2||i>r+n+2||u<t-2||u>t+o+2},S=t((()=>{b.current&&g.current?.firstChild&&E(b.current)&&E(g.current.firstChild)&&f()}),200);n((()=>{if(m&&g.current){const r=(e=g.current,Array.from(e.querySelectorAll(s.join(", "))));r[0].focus(),x(r[0].id)}var e}),[m,g,x]),n((()=>{const e=y.current?.querySelector('[role="dialog"]');if(!m||!e)return;const r=e=>{M.current.x=e.clientX,M.current.y=e.clientY,S()};return e.addEventListener("pointermove",r),()=>{e.removeEventListener("pointermove",r)}}),[m,y,S]);const j=o((e=>{const{code:r}=e;[a.SPACE,a.ENTER].includes(r)?m?f():d():(!v&&a.RIGHT===r||(v&&a.LEFT)===r)&&(m||d())}),[d,f,m,v]);return i(b,{key:["enter","space","left","right"]},j,[j]),e.createElement(u,l({},h,{ref:b,onPointerEnter:d,onPointerLeave:()=>{M.current={},S()},onClick:e=>e.preventDefault(),"aria-haspopup":!0,"aria-expanded":m,dismissOnClick:!1}))}export{SubMenuTrigger as default};
