/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

import o from"react";import e from"prop-types";import{forwardRef as n,useRef as t,useCombinedRefs as r,useCallback as s,useEffect as i,useMemo as c}from"@googleforcreators/react";import u,{css as l}from"styled-components";import{useKeyDownEffect as a}from"../keyboard/index.js";import d from"./contextMenuProvider/useContextMenu.js";import p from"../../utils/useMouseDownOutsideRef.js";import{KEYS as m,FOCUSABLE_SELECTORS as f}from"../../utils/constants.js";import{noop as b}from"../../utils/noop.js";function g(){return g=Object.assign||function(o){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(o[t]=n[t])}return o},g.apply(this,arguments)}const h=200,x=u.div.withConfig({displayName:"menu__MenuWrapper",componentId:"sc-1xfj06c-0"})((o=>{let{theme:e}=o;return l(["background-color:",";border-radius:",";border:1px solid ",";gap:6px;display:flex;"," *:last-child{margin-bottom:0;}"],(o=>{let{isSecondary:n}=o;return n?e.colors.bg.secondary:e.colors.bg.primary}),(o=>{let{isHorizontal:n}=o;return n?e.borders.radius.medium:e.borders.radius.small}),e.colors.border.disable,(o=>{let{isHorizontal:e,isIconMenu:n}=o;return e?l(["height:52px;padding:7px 10px;align-items:center;"]):l(["flex-direction:column;width:",";padding:",";max-width:","px;",";"],n?"40px":"auto",n?"4px 3px":"8px 0",300,!n&&l(["min-width:","px;"],200))}))}));function y(o,e){const n=Array.from(o.querySelectorAll(f.join(", ")));return e?n:n.filter((o=>!o.matches('[role="menu"], [role="menu"] [role="menu"] *')))}x.propTypes={isIconMenu:e.bool,isHorizontal:e.bool,isSecondary:e.bool};const I=n(((e,n)=>{let{children:u,disableControlledTabNavigation:l,isOpen:f,onFocus:h=b,isSubMenu:I=!1,isSecondary:M=!1,parentMenuRef:S,onCloseSubMenu:j=b,dismissOnEscape:v=!0,...H}=e;const{isRTL:O}=H,{focusedId:T,isIconMenu:w,isHorizontal:F,onDismiss:z,setFocusedId:E}=d((o=>{let{state:e,actions:n}=o;return{focusedId:e.focusedId,isIconMenu:e.isIconMenu,isHorizontal:e.isHorizontal,onDismiss:n.onDismiss,setFocusedId:n.setFocusedId}})),R=p((()=>{f&&!I&&z()})),k=t(null),C=r(R,k,n),D=s((o=>{h(o);const e=k.current.children||[],n=e.length&&![...e].some((e=>e.contains(o.target)));if(k.current===o.target&&n){y(k.current)?.[0]?.focus()}}),[h]),L=s((o=>{const{key:e}=o;if("Escape"===e)return void z(o);const n=y(k.current,I);let t=n.findIndex((o=>o.id===T));-1===t&&n.length&&(E(n[0].id),t=0);const r=F?m.LEFT:m.UP;if([r,F?m.RIGHT:m.DOWN].includes(e)){let o=t+(r===e?-1:1);-1===o&&(o=n.length-1);const s=n[o%n.length];return s?.focus(),void E(s?.id||-1)}const s=F?m.UP:O?m.RIGHT:m.LEFT;if(I&&s===e){S.current.querySelector('button[aria-expanded="true"]')?.focus(),j()}}),[T,z,E,O,I,F,j,S]);i((()=>{if(f){const o=y(k.current);o.length&&(o?.[0]?.focus(),E(o?.[0]?.id))}}),[f,E]);const N=c((()=>l?{key:[]}:{key:["tab"],shift:!0}),[l]);return a(k,{key:v?["esc","down","up","left","right"]:["down","up","left","right"]},L,[L,v]),a(k,N,z,[N,z]),o.createElement(x,g({ref:C,"data-testid":"context-menu-list",role:"menu",isIconMenu:w,isHorizontal:F,isSecondary:M,tabIndex:k.current?.contains(document.activeElement)?-1:0,onFocus:D},H),u)})),M={children:e.node,onFocus:e.func,disableControlledTabNavigation:e.bool,isOpen:e.bool,onCloseSubMenu:e.func,isSubMenu:e.bool,isSecondary:e.bool,isRTL:e.bool,parentMenuRef:e.object,dismissOnEscape:e.bool};export{h as CONTEXT_MENU_MIN_WIDTH,M as MenuPropTypes,I as default};
