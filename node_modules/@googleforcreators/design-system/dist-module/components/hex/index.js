/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

import r from"react";import{forwardRef as e,useState as t,useRef as o,useEffect as n,useCallback as a}from"@googleforcreators/react";import"prop-types";import{parseToRgb as c}from"polished";import{getPreviewText as l,getHexFromValue as p}from"@googleforcreators/patterns";import{useKeyDownEffect as i}from"../keyboard/index.js";import{Input as u}from"../input/index.js";function s(){return s=Object.assign||function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(r[o]=t[o])}return r},s.apply(this,arguments)}const f=e((function Hex(e,f){let{value:m,placeholder:g,onChange:d,...b}=e;const[h,y]=t(""),v=o(null),j=o(!1),x=l(m);n((()=>y(x)),[x]);const k=a((r=>{const e=r.target.value.trim().replace(/^#/,"");y(e)}),[]),O=a((()=>{const r=p(h)??x;if(y(r),r!==x){const{red:e,green:t,blue:o}=c(`#${r}`),n=m.color.a;d({color:{r:e,g:t,b:o,a:n}})}}),[h,x,d,m]),C=a((()=>{O()}),[O]),w=a((()=>{j.current||O(),j.current=!1}),[O]),B=a((()=>{y(x),j.current=!0;(f?.current?f:v).current.blur()}),[x,f]);return i(v,{key:["escape"],editable:!0},B,[B]),i(v,{key:["enter"],editable:!0},C,[C]),r.createElement(u,s({ref:f||v,value:h||"",onChange:k,onBlur:w,placeholder:g},b))}));export{f as HexInput};
