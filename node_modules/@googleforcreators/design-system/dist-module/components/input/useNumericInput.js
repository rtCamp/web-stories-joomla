/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

import r from"big.js";import{useRef as t,useState as n,useMemo as e,useCallback as l,useEffect as o}from"@googleforcreators/react";import{parseInput as a,isInputValid as u}from"./validation.js";const i=i=>{let{allowEmpty:c,isFloat:m,max:s,min:p,onChange:d,value:h}=i;const f=t(null),g=t(h),w=t(!1),[v,y]=n(h),x=e((()=>({allowEmpty:c,isFloat:m,max:s,min:p})),[c,m,s,p]),b=l((r=>{let t=a(g.current,x);if(!w.current){const r=a(v,x);null!==r&&(t=r)}w.current=!1,null!==t&&(y(t),t!==g.current&&d(r,t))}),[v,d,x]),A=l((r=>{y(r.target.value)}),[]),E=l((t=>{const{altKey:n,key:e}=t;let l=u(v,x)?a(v,x):0;const o=r(x.isFloat&&n?.1:1);"ArrowUp"===e?l=void 0!==s?Math.min(s,r(l).plus(o)):r(l).plus(o):"ArrowDown"===e&&(l=void 0!==p?Math.max(p,r(l).minus(o)):r(l).minus(o)),d(t,Number(l))}),[v,s,p,d,x]),F=l((()=>{y(g.current),w.current=!0,f&&f.current?.blur()}),[]);return o((()=>{g.current=h,y(h)}),[h]),{currentValue:v,inputRef:f,handleBlur:b,handleChange:A,handleEsc:F,handleKeyUpAndDown:E,isIndeterminate:g.current===v}};export{i as useNumericInput};
