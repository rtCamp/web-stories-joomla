/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

import{useState as r,useMemo as t,useEffect as e}from"@googleforcreators/react";import{useKeyDownEffect as n}from"../index.js";import{getGridColumnAndRowCount as o,getIndex as s,focusOnPage as c,getRow as i,getColumn as u,getArrowDir as f}from"./utils.js";function m(m){const{currentItemId:w,items:l,containerRef:a,gridRef:g,itemRefs:h,isRTL:d,arrangeItem:A}=m,[p,R]=r(),k=t((()=>l.map((r=>{let{id:t}=r;return t}))),[l]);e((()=>{R(w)}),[w]),n(a,{key:["up","down","left","right"]},(r=>{let{key:t}=r;switch(t){case"ArrowLeft":case"ArrowRight":{const r=f(t,"ArrowRight","ArrowLeft",d);if(0===r)return;const e=k.indexOf(p)+r;if(e<0||e===k.length)return;const n=k[e];R(n);const o=h?.current?.[n];c(o);break}case"ArrowUp":case"ArrowDown":{const{rows:r,columns:e}=o(g?.current,k.length),n=k.indexOf(p),f="ArrowDown"===t?1:-1,m=i(n,e),w=u(n,e),l=s({row:m+f,column:w,numRows:r,numColumns:e,numItems:k.length});if(l<0)return;const a=k[l];R(a);const d=h?.current?.[a];c(d);break}}}),[p,d,k,h,g,w]),n(a,{key:["mod+up","mod+down","mod+left","mod+right"],shift:!0},(r=>{const{key:t,shiftKey:e}=r;switch(r.preventDefault(),t){case"ArrowLeft":case"ArrowRight":{const r=f(t,"ArrowRight","ArrowLeft",d);if(0===r)return;const n=k.indexOf(p);let o=n;e?o=r<0?0:k.length-1:o+=r;if(o!==n&&o>=0&&o<=k.length-1){A&&A(p,o);const r=h?.current?.[k[o]];c(r)}break}case"ArrowUp":case"ArrowDown":{const{rows:r,columns:e}=o(g.current,k.length),n=k.indexOf(p),f="ArrowDown"===t?1:-1,m=i(n,e),w=u(n,e),l=s({row:m+f,column:w,numRows:r,numColumns:e,numItems:k.length});if(l<0)return;if(l!==n&&l>=0&&l<=k.length-1){A&&A(p,l);const r=h?.current?.[k[l]];c(r)}break}}}),[w,k,d,g,h,p,A])}export{m as default};
