/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

import e from"react";import t from"mousetrap";import"prop-types";import{createRef as r,useState as n,useCallback as o,useEffect as i,useContext as l,useBatchingCallback as c}from"@googleforcreators/react";import{__}from"@googleforcreators/i18n";import a from"./context.js";const s="__WEB_STORIES_MT__",u=["submit","button","checkbox","radio","image","file","range","reset","hidden"],d=["submit","button","checkbox","radio","image","file","reset"],f=r();function p(){f.current||(f.current=document.documentElement)}function m(e,t,r,n){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:void 0;const{keys:s}=l(a),u=c(n,o||[]);i((()=>{const n=void 0!==e?.current?e.current:e;if(!n)return;if(1!==n.nodeType&&9!==n.nodeType)throw new Error("only an element or a document node can be used");const o=T(s,t);if(1===o.key.length&&""===o.key[0])return;const i=C(n),l=A(n,o,u);return i.bind(o.key,l,r),()=>{i.unbind(o.key,r)}}),[u,s])}function b(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0;m(e,t,void 0,r,n)}function h(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0;m(e,t,"keydown",r,n)}function g(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0;m(e,t,"keyup",r,n)}function v(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;const[l,c]=n(!1),a=o((()=>{c(!1)}),[]);return i((()=>(window.addEventListener("blur",a),function(){window.removeEventListener("blur",a)})),[a]),h(e,t,(()=>c(!0)),r),g(e,t,(()=>c(!1)),r),l}function w(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;p(),h(f,e,t,r)}function y(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;p(),g(f,e,t,r)}function k(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;return p(),v(f,e,t)}function E(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;h(e,{key:"esc",editable:!0},(()=>{const t=void 0!==e?.current?e.current:e,{activeElement:r}=document;t.contains(r)&&r.blur()}),t)}function C(e){return e[s]||(e[s]=new t(e))}function T(e,t){const r="string"==typeof t||Array.isArray(t)?{key:t}:t,{key:n,shift:o=!1,repeat:i=!0,clickable:l=!0,editable:c=!1,dialog:a=!1,allowDefault:s=!1}=r,u=function(e,t){if(!t)return e;return e.concat(e.map((e=>`shift+${e}`)))}([].concat(n).map((t=>e[t]||t)).flat(),o);return{key:u,shift:o,clickable:l,repeat:i,editable:c,dialog:a,allowDefault:s}}function A(e,t,r){let{repeat:n,editable:o,clickable:i,dialog:l,allowDefault:c=!1}=t;return t=>{const{repeat:a,target:s}=t;if((n||!a)&&(o||!function(e){let{tagName:t,isContentEditable:r,type:n,readOnly:o}=e;if(!0===o)return!1;if(r||"TEXTAREA"===t)return!0;if("INPUT"===t)return!u.includes(n);return!1}(s))&&(i||!function(e){let{tagName:t,type:r}=e;if(["BUTTON","A"].includes(t))return!0;if("INPUT"===t)return d.includes(r);return!1}(s))&&(l||!function(e,t){if(1!==e.nodeType)return!1;const r=e.closest('dialog,[role="dialog"]');return r&&t!==r&&t.contains(r)}(s,e)))return r(t),c}}function S(){const{platform:e}=window.navigator;return e.includes("Mac")||["iPad","iPhone"].includes(e)}function _(e){const t=S();return{alt:t?"⌥":"Alt",ctrl:t?"^":"Ctrl",mod:t?"⌘":"Ctrl",cmd:"⌘",shift:t?"⇧":"Shift"}[e]||e}function N(e){const t=S()?"":"+";return e.toLowerCase().replace("alt",_("alt")).replace("ctrl",_("ctrl")).replace("mod",_("mod")).replace("cmd",_("cmd")).replace("shift",_("shift")).replace("left","←").replace("up","↑").replace("right","→").replace("down","↓").replace("delete","⌫").replace("enter","⏎").split("+").map((e=>e.charAt(0).toUpperCase()+e.slice(1))).join(t)}function P(e){const t=S(),r=__("Command","web-stories"),n=__("Control","web-stories"),o=__("Option","web-stories"),i=__("Alt","web-stories"),l={alt:t?o:i,mod:t?r:n,
/* translators: Control key on the keyboard */
ctrl:__("Control","web-stories"),
/* translators: shift key on the keyboard */
shift:__("Shift","web-stories"),
/* translators: delete key on the keyboard */
delete:__("Delete","web-stories"),
/* translators: comma character ',' */
",":__("Comma","web-stories"),
/* translators: period character '.' */
".":__("Period","web-stories"),
/* translators: backtick character '`' */
"`":__("Backtick","web-stories")},c=t?" ":"+";
/* translators: Command key on the keyboard */return e.toLowerCase().replace("alt",l.alt).replace("ctrl",l.ctrl).replace("mod",l.mod).replace("cmd",l.cmd).replace("shift",l.shift).replace("delete",l.delete).replace(",",l[","]).replace(".",l["."]).replace("`",l["`"]).split(/[\s+]/).map((e=>e.charAt(0).toUpperCase()+e.slice(1))).join(c)}const Kbd=()=>e.createElement("kbd",null);function Shortcut(t){let{component:r=Kbd,shortcut:n=""}=t;const o=n.split(" ");return e.createElement(r,{"aria-label":P(n)},o.map(((t,n)=>e.createElement(r,{key:`${n}-${t}`},N(t)))))}export{Shortcut,P as createShortcutAriaLabel,_ as getKeyForOS,S as isPlatformMacOS,N as prettifyShortcut,E as useEscapeToBlurEffect,k as useGlobalIsKeyPressed,w as useGlobalKeyDownEffect,y as useGlobalKeyUpEffect,v as useIsKeyPressed,h as useKeyDownEffect,b as useKeyEffect,g as useKeyUpEffect};
