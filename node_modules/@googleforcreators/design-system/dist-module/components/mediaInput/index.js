/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

import e from"react";import t,{css as o,keyframes as n}from"styled-components";import"prop-types";import{forwardRef as r,useState as a,useMemo as i,useRef as s}from"@googleforcreators/react";import{v4 as p}from"uuid";import{__}from"@googleforcreators/i18n";import{Tooltip as l}from"../tooltip/index.js";import{Popup as m}from"../popup/index.js";import c from"./icons/landscape.svg.js";import{MEDIA_VARIANTS as d}from"./constants.js";export{MEDIA_VARIANTS}from"./constants.js";import u from"../../icons/pencil.svg.js";import{PLACEMENT as h}from"../popup/constants.js";import{Menu as g}from"../menu/menu.js";import{Button as f}from"../button/button.js";import{BUTTON_VARIANTS as w,BUTTON_TYPES as v,BUTTON_SIZES as I}from"../button/constants.js";function x(){return x=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(e[n]=o[n])}return e},x.apply(this,arguments)}const y=t.section.withConfig({displayName:"mediaInput__MediaRectangle",componentId:"sc-1aevzta-0"})(["width:100%;height:100%;background-color:",";border-radius:4px;position:relative;"],(e=>{let{theme:t}=e;return t.colors.bg.primary})),b=t(y).withConfig({displayName:"mediaInput__MediaCircle",componentId:"sc-1aevzta-1"})(["border-radius:100px;height:100%;width:100%;"]),E=t.div.withConfig({displayName:"mediaInput__EmptyMediaWrapper",componentId:"sc-1aevzta-2"})([""]),N=t.div.withConfig({displayName:"mediaInput__ImageWrapper",componentId:"sc-1aevzta-3"})(["border-radius:","px;overflow:hidden;height:100%;display:flex;"],(e=>{let{variant:t}=e;return t===d.CIRCLE?100:4})),_=t.div.withConfig({displayName:"mediaInput__DefaultImageWrapper",componentId:"sc-1aevzta-4"})(["padding:8px;"]),C=t(c).withConfig({displayName:"mediaInput__DefaultImage",componentId:"sc-1aevzta-5"})(["width:100%;height:100%;display:block;color:",";"],(e=>{let{theme:t}=e;return t.colors.standard.white})),j=t.img.withConfig({displayName:"mediaInput__Img",componentId:"sc-1aevzta-6"})(["width:100%;height:100%;object-fit:cover;"]),O=o(["min-width:100px;margin-top:0;li{display:block;}"]),M=t(f).withConfig({displayName:"mediaInput__Button",componentId:"sc-1aevzta-7"})((e=>{let{showImage:t}=e;return o(["background-color:",";position:relative;"," &:hover{background-color:",";}"],(e=>{let{theme:t}=e;return t.colors.interactiveBg.secondaryNormal}),t&&o(["position:absolute;bottom:-8px;right:-8px;"]),(e=>{let{theme:t}=e;return t.colors.interactiveBg.secondaryHover}))})),R={[d.RECTANGLE]:y,[d.CIRCLE]:b,[d.NONE]:E},L=n(["0%,20%{color:transparent;text-shadow:6px 0 0 transparent,12px 0 0 transparent;}40%{color:white;text-shadow:6px 0 0 transparent,12px 0 0 transparent;}60%{text-shadow:6px 0 0 ",",12px 0 0 transparent;}80%,100%{text-shadow:6px 0 0 ",",12px 0 0 ",";}"],(e=>{let{theme:t}=e;return t.colors.standard.white}),(e=>{let{theme:t}=e;return t.colors.standard.white}),(e=>{let{theme:t}=e;return t.colors.standard.white})),z=t.div.withConfig({displayName:"mediaInput__LoadingDots",componentId:"sc-1aevzta-8"})(["position:absolute;top:0px;left:0px;width:100%;height:100%;pointer-events:none;border-radius:50%;flex-direction:column;justify-content:center;align-items:center;display:flex;&:after{pointer-events:none;color:",";content:'.';font-weight:bold;animation:"," 1s steps(5,end) infinite;margin-left:-12px;}"],(e=>{let{theme:t}=e;return t.colors.standard.white}),L),k=r((function Media(t,o){let{className:n,onBlur:r,alt:c=__("Preview image","web-stories"),value:f,ariaLabel:y=__("Choose an image","web-stories"),variant:b=d.RECTANGLE,isLoading:E,menuOptions:L=[],onMenuOption:k,openMediaPicker:T,canUpload:A=!0,menuProps:B={},imgProps:D={},isRTL:P=!1,...S}=t;const W=L?.length>0,[G,U]=a(!1),$=i((()=>`list-${p()}`),[]),H=i((()=>`button-${p()}`),[]),Q=s(null),V=R[b],Y=[{group:L}];return e.createElement(V,{className:n},b!==d.NONE&&e.createElement(N,{variant:b},f?e.createElement(j,{src:f,alt:c,crossOrigin:"anonymous",decoding:"async",width:D?.width||null,height:D?.height||null}):e.createElement(_,null,e.createElement(C,null)),E&&e.createElement(z,null)),A&&e.createElement(l,{title:W?null:__("Open media picker","web-stories")},e.createElement(M,x({ref:e=>{"function"==typeof o?o(e):o&&(o.current=e),Q.current=e},id:H,showImage:b!==d.NONE,variant:w.SQUARE,type:v.TERTIARY,size:I.SMALL,"aria-label":y,onClick:W?()=>U(!0):T,"aria-owns":W?$:null,"aria-pressed":G,"aria-expanded":G},S),e.createElement(u,null))),e.createElement(m,{placement:h.BOTTOM_END,anchor:Q,isOpen:G,isRTL:P},e.createElement(g,x({parentId:H,listId:$,hasMenuRole:!0,options:Y,onMenuItemClick:(e,t)=>{k(e,t),U(!1)},onDismissMenu:()=>U(!1),menuStylesOverride:O},B))))}));export{k as MediaInput};
