/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

import{useMemo as e,useState as t,useCallback as n,useEffect as r,useFocusOut as o}from"@googleforcreators/react";import{useKeyDownEffect as i}from"../keyboard/index.js";import{KEYS as s,KEYS_SELECT_ITEM as l,KEYS_CLOSE_MENU as u,KEYS_SHIFT_FOCUS as R}from"./constants.js";import a from"../../utils/isNullOrUndefinedOrEmptyString.js";function d(d){let{activeValue:f,handleMenuItemSelect:c,handleReturnToParent:O,isRTL:m,options:W=[],listRef:p,onDismissMenu:A}=d;const _=e((()=>W.flatMap((e=>e.group))),[W]),g=_.length,[T,y]=t(f),I=n((()=>_.findIndex((e=>e?.value?.toString()===T.toString()))),[_,T]);r((()=>{if(a(T))return;-1===I()&&y(null)}),[T,I]);const h=e((()=>{if(a(T))return 0;return I()}),[T,I]),k=n((e=>y(_[h+e].value)),[_,h]),v=n((e=>{let{key:t}=e;[s.ARROW_UP,m?s.ARROW_RIGHT:s.ARROW_LEFT].includes(t)&&0!==h?k(-1):[s.ARROW_DOWN,m?s.ARROW_LEFT:s.ARROW_RIGHT].includes(t)&&h<g-1?k(1):[s.ARROW_UP,m?s.ARROW_RIGHT:s.ARROW_LEFT].includes(t)&&0===h&&O?.()}),[h,k,O,m,g]),L=n((e=>{const t=_[h]?.disabled;if(t)return()=>{};const n=T||_[h].value;return c(e,{value:n})}),[_,h,T,c]);return i(p,{key:l,shift:!0},L,[L]),i(p,{key:u},(e=>A?.(e)),[A]),i(p,{key:R},v,[v]),o(p,(e=>A?.(e)),[]),e((()=>({focusedValue:T,focusedIndex:h,listLength:g})),[h,T,g])}export{d as default};
