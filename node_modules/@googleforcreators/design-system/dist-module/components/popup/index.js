/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

import t from"react";import e from"styled-components";import{useState as n,useRef as o,useEffect as r,useCallback as i,useLayoutEffect as s,useResizeEffect as l,createPortal as p}from"@googleforcreators/react";import"prop-types";import{PLACEMENT as f}from"./constants.js";export{PLACEMENT}from"./constants.js";import{getTransforms as c}from"./utils/getTransforms.js";import{noop as a}from"../../utils/noop.js";import{getOffset as u}from"./utils/getOffset.js";const h=0,m=2,d=e.div.attrs((t=>{let{$offset:{x:e,y:n,width:o,height:r},fillWidth:i,fillHeight:s,placement:l,isRTL:p,invisible:f,zIndex:a}=t;return{style:{transform:`translate(${e}px, ${n}px) ${c(l,p)}`,...i?{width:`${o}px`}:{},...s?{height:`${r}px`}:{},...f?{visibility:"hidden"}:{},zIndex:a}}})).withConfig({displayName:"popup__Container",componentId:"sc-16aopg7-0"})(["/*! @noflip */ left:0px;top:0px;position:fixed;",";max-height:",";"],(t=>{let{noOverFlow:e}=t;return e?"":"overflow-y: auto;"}),(t=>{let{topOffset:e}=t;return`calc(100vh - ${e}px)`}));function Popup(e){let{isRTL:c=!1,anchor:g,dock:x,children:O,renderContents:v,placement:y=f.BOTTOM,spacing:T,isOpen:C,invisible:$=!1,fillWidth:b=!1,fillHeight:w=!1,onPositionUpdate:L=a,refCallback:R=a,topOffset:j=h,zIndex:E=m,noOverFlow:I=!1,ignoreMaxOffsetY:z,resetXOffset:M=!1}=e;const[P,k]=n(null),B=o(!1),F=o(null);r((()=>(B.current=!0,()=>{B.current=!1})),[]);const H=i((t=>{B.current&&g?.current&&(t?.target?.nodeType&&F.current?.contains(t.target)||k({offset:g.current?u({placement:y,spacing:T,anchor:g,dock:x,popup:F,isRTL:c,topOffset:j,ignoreMaxOffsetY:z,resetXOffset:M}):{},height:F.current?.getBoundingClientRect()?.height}))}),[g,y,T,x,c,j,z,M]);return r((()=>{P?.height&&P.height!==F.current?.getBoundingClientRect()?.height&&H()}),[P?.height,H]),s((()=>{if(C)return B.current=!0,H(),document.addEventListener("scroll",H,!0),()=>{document.removeEventListener("scroll",H,!0),B.current=!1}}),[C,H]),s((()=>{B.current&&(L(P),R(F))}),[P,L,R]),l({current:document.body},H,[H]),P&&C?p(t.createElement(d,{ref:F,fillWidth:b,fillHeight:w,placement:y,$offset:P.offset,invisible:$,topOffset:j,noOverFlow:I,isRTL:c,zIndex:E},v?v({propagateDimensionChange:H}):O),document.body):null}export{Popup};
