/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

import e from"react";import t from"prop-types";import o from"styled-components";import{useState as n,useRef as r,useEffect as i,useMemo as a,useCallback as s,useDebouncedCallback as c}from"@googleforcreators/react";import{Popup as l}from"../popup/index.js";import{prettifyShortcut as p}from"../keyboard/index.js";import{THEME_CONSTANTS as m}from"../../theme/constants/index.js";import{PLACEMENT as u}from"../popup/constants.js";export{PLACEMENT as TOOLTIP_PLACEMENT,RTL_PLACEMENT as TOOLTIP_RTL_PLACEMENT}from"../popup/constants.js";import{TAIL_HEIGHT as T,SvgForTail as f,SVG_TOOLTIP_TAIL_ID as d,Tail as h}from"./tail.js";import{Text as g}from"../typography/text/index.js";import{noop as E}from"../../utils/noop.js";function O(){return O=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(e[n]=o[n])}return e},O.apply(this,arguments)}const x=T,P=o.div.withConfig({displayName:"tooltip__Wrapper",componentId:"sc-7e0t34-0"})(["position:relative;"]),_=o.div.withConfig({displayName:"tooltip__TooltipContainer",componentId:"sc-7e0t34-1"})(["margin:0;display:flex;justify-content:center;align-items:center;text-align:center;flex-direction:row;max-width:14em;transition:0.4s opacity;opacity:",";pointer-events:",";z-index:9999;border-radius:4px;background-color:",";filter:drop-shadow(0px 4px 4px rgba(0,0,0,0.25));"],(e=>{let{shown:t}=e;return t?1:0}),(e=>{let{shown:t}=e;return t?"all":"none"}),(e=>{let{theme:t}=e;return t.colors.inverted.bg.primary})),b=o(g).withConfig({displayName:"tooltip__TooltipText",componentId:"sc-7e0t34-2"})(["color:",";padding:10px;"],(e=>{let{theme:t}=e;return t.colors.inverted.fg.primary})),y=e=>{let{x:t,width:o}=e;return t+o/2};let L=null;function Tooltip(t){let{title:o,shortcut:T,hasTail:g,placement:R=u.BOTTOM,children:w,onPointerEnter:v=E,onPointerLeave:N=E,onFocus:j=E,onBlur:A=E,isDelayed:I=!1,forceAnchorRef:C=null,tooltipProps:M=null,className:B=null,popupZIndexOverride:S,ignoreMaxOffsetY:F=!1,...D}=t;const[H,W]=n(!1),[k,G]=n(null),Y=r(null),z=r(null),Z=r(R),[$,U]=n(R),X=r(!1);i((()=>(X.current=!0,()=>{X.current=!1})),[]);const q=a((()=>({x:R.startsWith("left")||R.startsWith("right")?x:0,y:R.startsWith("top")||R.startsWith("bottom")?x:0})),[R]),J=s((()=>{const e=Z.current;switch(e){case u.BOTTOM_START:case u.TOP_START:case u.RIGHT_START:break;case u.BOTTOM_END:case u.TOP_END:case u.RIGHT_END:U(e.replace("-end","-start"));break;case u.LEFT_END:U(u.RIGHT_END);break;case u.LEFT_START:U(u.RIGHT_START);break;case u.LEFT:U(u.RIGHT);break;default:U(`${e}-start`)}}),[]),K=s((e=>{let{offset:t}=e;const o=t.y+t.popupHeight+x,n=$.startsWith("bottom")&&o>=window.innerHeight,r=t.popupLeft<0;n?$.endsWith("-start")?U(u.TOP_START):$.endsWith("-end")?U(u.TOP_END):U(u.TOP):r&&J()}),[$,J]),Q=s((e=>{const t=Y.current?.getBoundingClientRect(),o=z.current?.getBoundingClientRect();if(!o||!t)return;K(e);const n=y(t)-y(o);G(n)}),[K]),V=c((()=>{U(Z.current)}),100),ee=r(),te=s((e=>{const t=()=>{X.current&&(W(!0),v(e))};if(I){performance.now()-L<500&&t(),clearTimeout(ee.current),ee.current=setTimeout(t,1e3)}else t()}),[I,v]),oe=s((e=>{W(!1),N(e),V(),I&&(clearTimeout(ee.current),H&&(L=performance.now()))}),[N,V,I,H]);return e.createElement(e.Fragment,null,e.createElement(P,O({onPointerEnter:te,onPointerLeave:oe,onFocus:e=>{W(!0),j(e)},onBlur:e=>{W(!1),A(e),V()},ref:Y},D),w),e.createElement(l,{anchor:C||Y,placement:$,spacing:q,isOpen:Boolean(H&&(T||o)),onPositionUpdate:Q,zIndex:S,noOverFlow:!0,ignoreMaxOffsetY:F},e.createElement(_,O({className:B,ref:z,placement:$,shown:H},M),e.createElement(b,{size:m.TYPOGRAPHY.PRESET_SIZES.X_SMALL},T?`${o} (${p(T)})`:o),g&&e.createElement(e.Fragment,null,e.createElement(f,null,e.createElement("clipPath",{id:d,clipPathUnits:"objectBoundingBox"},e.createElement("path",{d:"M1,1 L0.868,1 C0.792,1,0.72,0.853,0.676,0.606 L0.585,0.098 C0.562,-0.033,0.513,-0.033,0.489,0.098 L0.399,0.606 C0.355,0.853,0.283,1,0.207,1 L0,1 L1,1"}))),e.createElement(h,{placement:$,translateX:k})))))}const R={children:t.node.isRequired,hasTail:t.bool,placement:t.oneOf(Object.values(u)),onBlur:t.func,onFocus:t.func,onPointerEnter:t.func,onPointerLeave:t.func,shortcut:t.string,title:t.oneOfType([t.node,t.string]),forceAnchorRef:t.object,tooltipProps:t.object,className:t.string,isDelayed:t.bool,popupZIndexOverride:t.number,ignoreMaxOffsetY:t.bool};export{Tooltip,R as TooltipPropTypes};
