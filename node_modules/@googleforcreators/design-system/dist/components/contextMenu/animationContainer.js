/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

"use strict";var t=require("react"),e=require("prop-types"),r=require("@googleforcreators/react"),n=require("styled-components"),a=require("../../theme/constants/index.js"),o=require("../../utils/directions.js"),s=require("./styled.js");function i(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var l=i(t),R=i(e),u=i(n);function I(){return I=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},I.apply(this,arguments)}const c={[o.DIRECTIONS.TOP]:100,[o.DIRECTIONS.RIGHT]:0,[o.DIRECTIONS.BOTTOM]:-100,[o.DIRECTIONS.LEFT]:-50},O=`transform 0.175s ${a.BEZIER.default}`,E=n.css(["top:0;right:0;bottom:0;left:0;"]),d=u.default.div.withConfig({displayName:"animationContainer__MenuWrapper",componentId:"sc-10ar2ad-0"})(["position:absolute;"]),C=u.default.div.withConfig({displayName:"animationContainer__MenuRevealer",componentId:"sc-10ar2ad-1"})(["overflow:",";border-radius:",";",""],(t=>{let{animationFinished:e}=t;return e?"normal":"hidden"}),(t=>{let{theme:e}=t;return e.borders.radius.small}),E),f=u.default.div.withConfig({displayName:"animationContainer__MenuCounterRevealer",componentId:"sc-10ar2ad-2"})(["border-radius:",";"],(t=>{let{theme:e}=t;return e.borders.radius.small})),N=u.default(s.Popover).withConfig({displayName:"animationContainer__ButtonInner",componentId:"sc-10ar2ad-3"})([""," ",";transform:",";","{","}","{transition:",";","}","{transition:",";","}","{transition:",";transform:",";transform-origin:",";}"],E,(t=>{let{isInline:e}=t;return e&&"position: relative"}),(t=>{switch(t.align){case o.CORNER_DIRECTIONS.top_left:return`translate(${c[o.DIRECTIONS.LEFT]}%, ${c[o.DIRECTIONS.TOP]}%)`;case o.CORNER_DIRECTIONS.top_right:return`translate(${c[o.DIRECTIONS.RIGHT]}%, ${c[o.DIRECTIONS.TOP]}%)`;case o.CORNER_DIRECTIONS.bottom_right:return`translate(${c[o.DIRECTIONS.RIGHT]}%, ${c[o.DIRECTIONS.BOTTOM]}%)`;case o.CORNER_DIRECTIONS.bottom_left:default:return`translate(${c[o.DIRECTIONS.LEFT]}%, ${c[o.DIRECTIONS.BOTTOM]}%)`}}),d,(t=>{switch(t.align){case o.CORNER_DIRECTIONS.top_right:return n.css(["top:0;right:0;"]);case o.CORNER_DIRECTIONS.top_left:return n.css(["top:0;left:0;"]);case o.CORNER_DIRECTIONS.bottom_right:return n.css(["right:0;bottom:0;"]);case o.CORNER_DIRECTIONS.bottom_left:default:return n.css(["left:0;bottom:0;"])}}),C,(t=>t.isReady?O:"none"),(t=>{switch(t.align){case o.CORNER_DIRECTIONS.top_right:return n.css(["transform:",";"],t.isReady?"none":"translate(50%, -50%)");case o.CORNER_DIRECTIONS.top_left:return n.css(["transform:",";"],t.isReady?"none":"translate(-50%, -50%)");case o.CORNER_DIRECTIONS.bottom_right:return n.css(["transform:",";"],t.isReady?"none":"translate(50%, 50%)");case o.CORNER_DIRECTIONS.bottom_left:default:return n.css(["transform:",";"],t.isReady?"none":"translate(-50%, 50%)")}}),f,(t=>t.isReady?O:"none"),(t=>{switch(t.align){case o.CORNER_DIRECTIONS.top_right:return n.css(["transform:",";"],t.isReady?"none":"translate(-50%, 50%)");case o.CORNER_DIRECTIONS.top_left:return n.css(["transform:",";"],t.isReady?"none":"translate(50%, 50%)");case o.CORNER_DIRECTIONS.bottom_right:return n.css(["transform:",";"],t.isReady?"none":"translate(-50%, -50%)");case o.CORNER_DIRECTIONS.bottom_left:default:return n.css(["transform:",";"],t.isReady?"none":"translate(50%, -50%)")}}),s.Shadow,(t=>t.isReady?O:"none"),(t=>t.isReady?"none":"scale(0.5)"),(t=>{switch(t.align){case o.CORNER_DIRECTIONS.top_right:return"right top";case o.CORNER_DIRECTIONS.top_left:return"left top";case o.CORNER_DIRECTIONS.bottom_right:return"right bottom";case o.CORNER_DIRECTIONS.bottom_left:default:return"left bottom"}}));N.propTypes={align:R.default.oneOf(Object.values(o.CORNER_DIRECTIONS)),isReady:R.default.bool},module.exports=function AnimationContainer(t){let{children:e,isOpen:n,...a}=t;const[i,R]=r.useState(null),[u,O]=r.useState(!1),[E,T]=r.useState(!0),m=r.useRef(null),_=r.useRef(null);return r.useLayoutEffect((()=>{if(!n)return void R(null);if(!_.current||!m.current)return;const t=_.current.getBoundingClientRect(),e=m.current.getBoundingClientRect(),r=t.left+t.width*(c[o.DIRECTIONS.LEFT]/100),a=t.bottom+t.height*(c[o.DIRECTIONS.BOTTOM]/100),s=r+e.width>window.innerWidth?o.DIRECTIONS.RIGHT:o.DIRECTIONS.LEFT,i=0>a-e.height?o.DIRECTIONS.TOP:o.DIRECTIONS.BOTTOM;R(o.CORNER_DIRECTIONS[`${i}_${s}`])}),[n]),r.useEffect((()=>{let t;return n&&(T(!1),t=setTimeout((()=>T(!0)),175)),()=>clearTimeout(t)}),[n]),r.useEffect((()=>{const t=requestAnimationFrame((()=>O(Boolean(i))));return()=>cancelAnimationFrame(t)}),[i]),l.default.createElement(N,I({align:i,isOpen:n,isReady:u,ref:_},a),l.default.createElement(d,null,l.default.createElement(C,{animationFinished:n&&E},l.default.createElement(f,{ref:m},e)),l.default.createElement(s.Shadow,null)))};
