/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

"use strict";var e=require("react"),r=require("@googleforcreators/react");require("prop-types");var t=require("../../keyboard/index.js"),n=require("./item.js"),u=require("../contextMenuProvider/useContextMenu.js"),o=require("../../../utils/constants.js");function i(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var c=i(e);function s(){return s=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},s.apply(this,arguments)}module.exports=function SubMenuTrigger(e){let{openSubMenu:i,closeSubMenu:a,isSubMenuOpen:l,isRTL:f=!1,subMenuRef:d,parentMenuRef:p,...E}=e;const v=r.useRef(),y=r.useRef({}),{setFocusedId:S}=u((e=>{let{actions:r}=e;return{setFocusedId:r.setFocusedId}})),b=e=>{const{x:r,y:t,width:n,height:u}=e.getBoundingClientRect(),{x:o,y:i}=y.current;if(void 0===o||void 0===i)return!0;return o<r-2||o>r+n+2||i<t-2||i>t+u+2},g=r.useDebouncedCallback((()=>{v.current&&d.current?.firstChild&&b(v.current)&&b(d.current.firstChild)&&a()}),200);r.useEffect((()=>{if(l&&d.current){const r=(e=d.current,Array.from(e.querySelectorAll(o.FOCUSABLE_SELECTORS.join(", "))));r[0].focus(),S(r[0].id)}var e}),[l,d,S]),r.useEffect((()=>{const e=p.current?.querySelector('[role="dialog"]');if(!l||!e)return;const r=e=>{y.current.x=e.clientX,y.current.y=e.clientY,g()};return e.addEventListener("pointermove",r),()=>{e.removeEventListener("pointermove",r)}}),[l,p,g]);const C=r.useCallback((e=>{const{code:r}=e;[o.KEYS.SPACE,o.KEYS.ENTER].includes(r)?l?a():i():(!f&&o.KEYS.RIGHT===r||(f&&o.KEYS.LEFT)===r)&&(l||i())}),[i,a,l,f]);return t.useKeyDownEffect(v,{key:["enter","space","left","right"]},C,[C]),c.default.createElement(n,s({},E,{ref:v,onPointerEnter:i,onPointerLeave:()=>{y.current={},g()},onClick:e=>e.preventDefault(),"aria-haspopup":!0,"aria-expanded":l,dismissOnClick:!1}))};
