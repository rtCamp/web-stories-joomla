/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react"),o=require("prop-types"),t=require("@googleforcreators/react"),n=require("styled-components"),r=require("../keyboard/index.js"),s=require("./contextMenuProvider/useContextMenu.js"),i=require("../../utils/useMouseDownOutsideRef.js"),u=require("../../utils/constants.js"),l=require("../../utils/noop.js");function c(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var a=c(e),d=c(o);function f(){return f=Object.assign||function(e){for(var o=1;o<arguments.length;o++){var t=arguments[o];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},f.apply(this,arguments)}const p=c(n).default.div.withConfig({displayName:"menu__MenuWrapper",componentId:"sc-1xfj06c-0"})((e=>{let{theme:o}=e;return n.css(["background-color:",";border-radius:",";border:1px solid ",";gap:6px;display:flex;"," *:last-child{margin-bottom:0;}"],(e=>{let{isSecondary:t}=e;return t?o.colors.bg.secondary:o.colors.bg.primary}),(e=>{let{isHorizontal:t}=e;return t?o.borders.radius.medium:o.borders.radius.small}),o.colors.border.disable,(e=>{let{isHorizontal:o,isIconMenu:t}=e;return o?n.css(["height:52px;padding:7px 10px;align-items:center;"]):n.css(["flex-direction:column;width:",";padding:",";max-width:","px;",";"],t?"40px":"auto",t?"4px 3px":"8px 0",300,!t&&n.css(["min-width:","px;"],200))}))}));function b(e,o){const t=Array.from(e.querySelectorAll(u.FOCUSABLE_SELECTORS.join(", ")));return o?t:t.filter((e=>!e.matches('[role="menu"], [role="menu"] [role="menu"] *')))}p.propTypes={isIconMenu:d.default.bool,isHorizontal:d.default.bool,isSecondary:d.default.bool};const m=t.forwardRef(((e,o)=>{let{children:n,disableControlledTabNavigation:c,isOpen:d,onFocus:m=l.noop,isSubMenu:y=!1,isSecondary:x=!1,parentMenuRef:g,onCloseSubMenu:h=l.noop,dismissOnEscape:E=!0,...M}=e;const{isRTL:S}=M,{focusedId:I,isIconMenu:T,isHorizontal:v,onDismiss:O,setFocusedId:j}=s((e=>{let{state:o,actions:t}=e;return{focusedId:o.focusedId,isIconMenu:o.isIconMenu,isHorizontal:o.isHorizontal,onDismiss:t.onDismiss,setFocusedId:t.setFocusedId}})),C=i((()=>{d&&!y&&O()})),q=t.useRef(null),w=t.useCombinedRefs(C,q,o),R=t.useCallback((e=>{m(e);const o=q.current.children||[],t=o.length&&![...o].some((o=>o.contains(e.target)));if(q.current===e.target&&t){b(q.current)?.[0]?.focus()}}),[m]),H=t.useCallback((e=>{const{key:o}=e;if("Escape"===o)return void O(e);const t=b(q.current,y);let n=t.findIndex((e=>e.id===I));-1===n&&t.length&&(j(t[0].id),n=0);const r=v?u.KEYS.LEFT:u.KEYS.UP;if([r,v?u.KEYS.RIGHT:u.KEYS.DOWN].includes(o)){let e=n+(r===o?-1:1);-1===e&&(e=t.length-1);const s=t[e%t.length];return s?.focus(),void j(s?.id||-1)}const s=v?u.KEYS.UP:S?u.KEYS.RIGHT:u.KEYS.LEFT;if(y&&s===o){g.current.querySelector('button[aria-expanded="true"]')?.focus(),h()}}),[I,O,j,S,y,v,h,g]);t.useEffect((()=>{if(d){const e=b(q.current);e.length&&(e?.[0]?.focus(),j(e?.[0]?.id))}}),[d,j]);const F=t.useMemo((()=>c?{key:[]}:{key:["tab"],shift:!0}),[c]);return r.useKeyDownEffect(q,{key:E?["esc","down","up","left","right"]:["down","up","left","right"]},H,[H,E]),r.useKeyDownEffect(q,F,O,[F,O]),a.default.createElement(p,f({ref:w,"data-testid":"context-menu-list",role:"menu",isIconMenu:T,isHorizontal:v,isSecondary:x,tabIndex:q.current?.contains(document.activeElement)?-1:0,onFocus:R},M),n)})),y={children:d.default.node,onFocus:d.default.func,disableControlledTabNavigation:d.default.bool,isOpen:d.default.bool,onCloseSubMenu:d.default.func,isSubMenu:d.default.bool,isSecondary:d.default.bool,isRTL:d.default.bool,parentMenuRef:d.default.object,dismissOnEscape:d.default.bool};exports.CONTEXT_MENU_MIN_WIDTH=200,exports.MenuPropTypes=y,exports.default=m;
