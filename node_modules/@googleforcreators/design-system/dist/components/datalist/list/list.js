/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

"use strict";var e=require("react"),t=require("@googleforcreators/react");require("prop-types");var r=require("uuid"),o=require("@googleforcreators/i18n"),n=require("styled-components"),s=require("../utils.js"),i=require("../../../theme/constants/index.js"),a=require("../../../utils/noop.js"),l=require("./styled.js"),u=require("./defaultRenderer.js"),c=require("../../typography/text/index.js");function p(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var d=p(e);const f=p(n).default(c.Text).attrs({forwardedAs:"span",size:i.THEME_CONSTANTS.TYPOGRAPHY.PRESET_SIZES.X_SMALL}).withConfig({displayName:"list__StyledLabel",componentId:"sc-1c2a66-0"})(["color:",";"],(e=>{let{theme:t}=e;return t.colors.fg.tertiary})),g=t.forwardRef((function OptionList(e,n){let{keyword:i="",value:c="",onSelect:p=a.noop,onClose:g=a.noop,onExpandedChange:m=a.noop,focusTrigger:b=0,options:y=[],primaryOptions:E,primaryLabel:h,priorityOptionGroups:v=[],searchResultsLabel:q,renderer:w=u,onObserve:O,focusSearch:S=a.noop,listId:x,listStyleOverrides:T}=e;const L=w,_=t.useRef([]),[I,M]=t.useState(-1),R=t.useRef([]),j=t.useMemo((()=>s.isKeywordFilterable(i)&&y?[{label:q,options:s.createOptionFilter(y)(i)}]:[...v?.length?v:[],{label:h,options:E}]),[i,y,v,E,h,q]),k=t.useMemo((()=>new window.IntersectionObserver((e=>{if(O){const t=e.filter((e=>e.isIntersecting)).map((e=>e.target.dataset.option));R.current=s.addUniqueEntries(R.current,...t),O(R.current)}}),{root:n.current,rootMargin:"60px"})),[O,n]);t.useLayoutEffect((()=>{const e=_.current;return O&&e.forEach((e=>e&&k.observe(e))),()=>{O&&e.forEach((e=>e&&k.unobserve(e))),_.current=[]}}),[k,O,j,w]);const A=t.useMemo((()=>s.getOptions(j)),[j]),C=t.useCallback((e=>{const{key:t}=e;e.stopPropagation(),e.preventDefault(),"Tab"===t&&e.shiftKey&&S(),"Escape"===t?g():"Enter"===t?A[I]&&p(A[I]):"ArrowUp"===t?M((e=>Math.max(0,e-1))):"ArrowDown"===t&&M((e=>Math.min(A.length-1,e+1)))}),[I,A,g,p,S]);t.useFocusOut(n,(()=>M(-1)),[]),t.useEffect((()=>{const e=n.current;if(!e)return;if(-1===I)return void e.scrollTo(0,0);const t=_.current[I];t&&(t.focus(),e.scrollTo(0,t.offsetTop-e.clientHeight/2))}),[I,A,i,g,n]);const N=A.length>0;return t.useEffect((()=>m(N)),[m,N]),t.useEffect((()=>{b>0&&M(0)}),[b]),A.length<=0?d.default.createElement(l.NoResult,null,o.__("No matches found","web-stories")):d.default.createElement(l.List,{ref:n,tabIndex:0,id:x,role:"listbox",onKeyDown:C,"aria-label":o.__("Option List Selector","web-stories"),"aria-required":!1,$listStyleOverrides:T},j.map(((e,t)=>{const o=`group-${r.v4()}`;return e.options.length>0&&d.default.createElement(l.Group,{key:o,role:"group","aria-labelledby":o},e.label&&d.default.createElement(l.GroupLabel,{id:o,role:"presentation"},d.default.createElement(f,null,e.label)),e.options.map(((e,r)=>{const o=s.getInset(j,t,r);return d.default.createElement(L,{key:e.id||"",role:"option",tabIndex:"-1","aria-selected":c===e.id,"aria-posinset":o+1,"aria-setsize":A.length,"data-option":e.id,onClick:()=>p(e),ref:e=>_.current[o]=e,option:e,value:c})})))})))}));var m=t.memo(g);module.exports=m;
