/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

"use strict";var e=require("@googleforcreators/react"),r=require("../index.js"),t=require("./utils.js");module.exports=function(n){const{currentItemId:o,items:s,containerRef:u,gridRef:c,itemRefs:i,isRTL:w,arrangeItem:f}=n,[g,m]=e.useState(),l=e.useMemo((()=>s.map((e=>{let{id:r}=e;return r}))),[s]);e.useEffect((()=>{m(o)}),[o]),r.useKeyDownEffect(u,{key:["up","down","left","right"]},(e=>{let{key:r}=e;switch(r){case"ArrowLeft":case"ArrowRight":{const e=t.getArrowDir(r,"ArrowRight","ArrowLeft",w);if(0===e)return;const n=l.indexOf(g)+e;if(n<0||n===l.length)return;const o=l[n];m(o);const s=i?.current?.[o];t.focusOnPage(s);break}case"ArrowUp":case"ArrowDown":{const{rows:e,columns:n}=t.getGridColumnAndRowCount(c?.current,l.length),o=l.indexOf(g),s="ArrowDown"===r?1:-1,u=t.getRow(o,n),w=t.getColumn(o,n),f=t.getIndex({row:u+s,column:w,numRows:e,numColumns:n,numItems:l.length});if(f<0)return;const a=l[f];m(a);const d=i?.current?.[a];t.focusOnPage(d);break}}}),[g,w,l,i,c,o]),r.useKeyDownEffect(u,{key:["mod+up","mod+down","mod+left","mod+right"],shift:!0},(e=>{const{key:r,shiftKey:n}=e;switch(e.preventDefault(),r){case"ArrowLeft":case"ArrowRight":{const e=t.getArrowDir(r,"ArrowRight","ArrowLeft",w);if(0===e)return;const o=l.indexOf(g);let s=o;n?s=e<0?0:l.length-1:s+=e;if(s!==o&&s>=0&&s<=l.length-1){f&&f(g,s);const e=i?.current?.[l[s]];t.focusOnPage(e)}break}case"ArrowUp":case"ArrowDown":{const{rows:e,columns:n}=t.getGridColumnAndRowCount(c.current,l.length),o=l.indexOf(g),s="ArrowDown"===r?1:-1,u=t.getRow(o,n),w=t.getColumn(o,n),m=t.getIndex({row:u+s,column:w,numRows:e,numColumns:n,numItems:l.length});if(m<0)return;if(m!==o&&m>=0&&m<=l.length-1){f&&f(g,m);const e=i?.current?.[l[m]];t.focusOnPage(e)}break}}}),[o,l,w,c,i,g,f])};
