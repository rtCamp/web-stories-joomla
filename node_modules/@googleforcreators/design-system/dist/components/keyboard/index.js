/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react"),t=require("mousetrap");require("prop-types");var r=require("@googleforcreators/react"),o=require("@googleforcreators/i18n"),n=require("./context.js");function i(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var l=i(e),c=i(t);const a="__WEB_STORIES_MT__",s=["submit","button","checkbox","radio","image","file","range","reset","hidden"],u=["submit","button","checkbox","radio","image","file","reset"],d=r.createRef();function f(){d.current||(d.current=document.documentElement)}function p(e,t,o,i){let l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:void 0;const{keys:c}=r.useContext(n),a=r.useBatchingCallback(i,l||[]);r.useEffect((()=>{const r=void 0!==e?.current?e.current:e;if(!r)return;if(1!==r.nodeType&&9!==r.nodeType)throw new Error("only an element or a document node can be used");const n=g(c,t);if(1===n.key.length&&""===n.key[0])return;const i=y(r),l=v(r,n,a);return i.bind(n.key,l,o),()=>{i.unbind(n.key,o)}}),[a,c])}function m(e,t,r){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0;p(e,t,"keydown",r,o)}function b(e,t,r){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0;p(e,t,"keyup",r,o)}function h(e,t){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;const[n,i]=r.useState(!1),l=r.useCallback((()=>{i(!1)}),[]);return r.useEffect((()=>(window.addEventListener("blur",l),function(){window.removeEventListener("blur",l)})),[l]),m(e,t,(()=>i(!0)),o),b(e,t,(()=>i(!1)),o),n}function y(e){return e[a]||(e[a]=new c.default(e))}function g(e,t){const r="string"==typeof t||Array.isArray(t)?{key:t}:t,{key:o,shift:n=!1,repeat:i=!0,clickable:l=!0,editable:c=!1,dialog:a=!1,allowDefault:s=!1}=r,u=function(e,t){if(!t)return e;return e.concat(e.map((e=>`shift+${e}`)))}([].concat(o).map((t=>e[t]||t)).flat(),n);return{key:u,shift:n,clickable:l,repeat:i,editable:c,dialog:a,allowDefault:s}}function v(e,t,r){let{repeat:o,editable:n,clickable:i,dialog:l,allowDefault:c=!1}=t;return t=>{const{repeat:a,target:d}=t;if((o||!a)&&(n||!function(e){let{tagName:t,isContentEditable:r,type:o,readOnly:n}=e;if(!0===n)return!1;if(r||"TEXTAREA"===t)return!0;if("INPUT"===t)return!s.includes(o);return!1}(d))&&(i||!function(e){let{tagName:t,type:r}=e;if(["BUTTON","A"].includes(t))return!0;if("INPUT"===t)return u.includes(r);return!1}(d))&&(l||!function(e,t){if(1!==e.nodeType)return!1;const r=e.closest('dialog,[role="dialog"]');return r&&t!==r&&t.contains(r)}(d,e)))return r(t),c}}function w(){const{platform:e}=window.navigator;return e.includes("Mac")||["iPad","iPhone"].includes(e)}function _(e){const t=w();return{alt:t?"⌥":"Alt",ctrl:t?"^":"Ctrl",mod:t?"⌘":"Ctrl",cmd:"⌘",shift:t?"⇧":"Shift"}[e]||e}function k(e){const t=w()?"":"+";return e.toLowerCase().replace("alt",_("alt")).replace("ctrl",_("ctrl")).replace("mod",_("mod")).replace("cmd",_("cmd")).replace("shift",_("shift")).replace("left","←").replace("up","↑").replace("right","→").replace("down","↓").replace("delete","⌫").replace("enter","⏎").split("+").map((e=>e.charAt(0).toUpperCase()+e.slice(1))).join(t)}function E(e){const t=w(),r=o.__("Command","web-stories"),n=o.__("Control","web-stories"),i=o.__("Option","web-stories"),l=o.__("Alt","web-stories"),c={alt:t?i:l,mod:t?r:n,
/* translators: Control key on the keyboard */
ctrl:o.__("Control","web-stories"),
/* translators: shift key on the keyboard */
shift:o.__("Shift","web-stories"),
/* translators: delete key on the keyboard */
delete:o.__("Delete","web-stories"),
/* translators: comma character ',' */
",":o.__("Comma","web-stories"),
/* translators: period character '.' */
".":o.__("Period","web-stories"),
/* translators: backtick character '`' */
"`":o.__("Backtick","web-stories")},a=t?" ":"+";
/* translators: Command key on the keyboard */return e.toLowerCase().replace("alt",c.alt).replace("ctrl",c.ctrl).replace("mod",c.mod).replace("cmd",c.cmd).replace("shift",c.shift).replace("delete",c.delete).replace(",",c[","]).replace(".",c["."]).replace("`",c["`"]).split(/[\s+]/).map((e=>e.charAt(0).toUpperCase()+e.slice(1))).join(a)}const Kbd=()=>l.default.createElement("kbd",null);exports.Shortcut=function Shortcut(e){let{component:t=Kbd,shortcut:r=""}=e;const o=r.split(" ");return l.default.createElement(t,{"aria-label":E(r)},o.map(((e,r)=>l.default.createElement(t,{key:`${r}-${e}`},k(e)))))},exports.createShortcutAriaLabel=E,exports.getKeyForOS=_,exports.isPlatformMacOS=w,exports.prettifyShortcut=k,exports.useEscapeToBlurEffect=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;m(e,{key:"esc",editable:!0},(()=>{const t=void 0!==e?.current?e.current:e,{activeElement:r}=document;t.contains(r)&&r.blur()}),t)},exports.useGlobalIsKeyPressed=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;return f(),h(d,e,t)},exports.useGlobalKeyDownEffect=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;f(),m(d,e,t,r)},exports.useGlobalKeyUpEffect=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;f(),b(d,e,t,r)},exports.useIsKeyPressed=h,exports.useKeyDownEffect=m,exports.useKeyEffect=function(e,t,r){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0;p(e,t,void 0,r,o)},exports.useKeyUpEffect=b;
