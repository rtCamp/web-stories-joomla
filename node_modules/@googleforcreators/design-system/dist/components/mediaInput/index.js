/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react"),t=require("styled-components");require("prop-types");var a=require("@googleforcreators/react"),n=require("uuid"),r=require("@googleforcreators/i18n"),i=require("../tooltip/index.js"),o=require("../popup/index.js"),s=require("./icons/landscape.svg.js"),l=require("./constants.js"),d=require("../../icons/pencil.svg.js"),u=require("../popup/constants.js"),p=require("../menu/menu.js"),c=require("../button/button.js"),m=require("../button/constants.js");function h(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var f=h(e),g=h(t);function I(){return I=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},I.apply(this,arguments)}const v=g.default.section.withConfig({displayName:"mediaInput__MediaRectangle",componentId:"sc-1aevzta-0"})(["width:100%;height:100%;background-color:",";border-radius:4px;position:relative;"],(e=>{let{theme:t}=e;return t.colors.bg.primary})),_=g.default(v).withConfig({displayName:"mediaInput__MediaCircle",componentId:"sc-1aevzta-1"})(["border-radius:100px;height:100%;width:100%;"]),w=g.default.div.withConfig({displayName:"mediaInput__EmptyMediaWrapper",componentId:"sc-1aevzta-2"})([""]),E=g.default.div.withConfig({displayName:"mediaInput__ImageWrapper",componentId:"sc-1aevzta-3"})(["border-radius:","px;overflow:hidden;height:100%;display:flex;"],(e=>{let{variant:t}=e;return t===l.MEDIA_VARIANTS.CIRCLE?100:4})),A=g.default.div.withConfig({displayName:"mediaInput__DefaultImageWrapper",componentId:"sc-1aevzta-4"})(["padding:8px;"]),N=g.default(s).withConfig({displayName:"mediaInput__DefaultImage",componentId:"sc-1aevzta-5"})(["width:100%;height:100%;display:block;color:",";"],(e=>{let{theme:t}=e;return t.colors.standard.white})),x=g.default.img.withConfig({displayName:"mediaInput__Img",componentId:"sc-1aevzta-6"})(["width:100%;height:100%;object-fit:cover;"]),y=t.css(["min-width:100px;margin-top:0;li{display:block;}"]),b=g.default(c.Button).withConfig({displayName:"mediaInput__Button",componentId:"sc-1aevzta-7"})((e=>{let{showImage:a}=e;return t.css(["background-color:",";position:relative;"," &:hover{background-color:",";}"],(e=>{let{theme:t}=e;return t.colors.interactiveBg.secondaryNormal}),a&&t.css(["position:absolute;bottom:-8px;right:-8px;"]),(e=>{let{theme:t}=e;return t.colors.interactiveBg.secondaryHover}))})),T={[l.MEDIA_VARIANTS.RECTANGLE]:v,[l.MEDIA_VARIANTS.CIRCLE]:_,[l.MEDIA_VARIANTS.NONE]:w},M=t.keyframes(["0%,20%{color:transparent;text-shadow:6px 0 0 transparent,12px 0 0 transparent;}40%{color:white;text-shadow:6px 0 0 transparent,12px 0 0 transparent;}60%{text-shadow:6px 0 0 ",",12px 0 0 transparent;}80%,100%{text-shadow:6px 0 0 ",",12px 0 0 ",";}"],(e=>{let{theme:t}=e;return t.colors.standard.white}),(e=>{let{theme:t}=e;return t.colors.standard.white}),(e=>{let{theme:t}=e;return t.colors.standard.white})),R=g.default.div.withConfig({displayName:"mediaInput__LoadingDots",componentId:"sc-1aevzta-8"})(["position:absolute;top:0px;left:0px;width:100%;height:100%;pointer-events:none;border-radius:50%;flex-direction:column;justify-content:center;align-items:center;display:flex;&:after{pointer-events:none;color:",";content:'.';font-weight:bold;animation:"," 1s steps(5,end) infinite;margin-left:-12px;}"],(e=>{let{theme:t}=e;return t.colors.standard.white}),M),C=a.forwardRef((function Media(e,t){let{className:s,onBlur:c,alt:h=r.__("Preview image","web-stories"),value:g,ariaLabel:v=r.__("Choose an image","web-stories"),variant:_=l.MEDIA_VARIANTS.RECTANGLE,isLoading:w,menuOptions:M=[],onMenuOption:C,openMediaPicker:O,canUpload:S=!0,menuProps:j={},imgProps:q={},isRTL:D=!1,...L}=e;const k=M?.length>0,[z,V]=a.useState(!1),B=a.useMemo((()=>`list-${n.v4()}`),[]),P=a.useMemo((()=>`button-${n.v4()}`),[]),U=a.useRef(null),W=T[_],G=[{group:M}];return f.default.createElement(W,{className:s},_!==l.MEDIA_VARIANTS.NONE&&f.default.createElement(E,{variant:_},g?f.default.createElement(x,{src:g,alt:h,crossOrigin:"anonymous",decoding:"async",width:q?.width||null,height:q?.height||null}):f.default.createElement(A,null,f.default.createElement(N,null)),w&&f.default.createElement(R,null)),S&&f.default.createElement(i.Tooltip,{title:k?null:r.__("Open media picker","web-stories")},f.default.createElement(b,I({ref:e=>{"function"==typeof t?t(e):t&&(t.current=e),U.current=e},id:P,showImage:_!==l.MEDIA_VARIANTS.NONE,variant:m.BUTTON_VARIANTS.SQUARE,type:m.BUTTON_TYPES.TERTIARY,size:m.BUTTON_SIZES.SMALL,"aria-label":v,onClick:k?()=>V(!0):O,"aria-owns":k?B:null,"aria-pressed":z,"aria-expanded":z},L),f.default.createElement(d,null))),f.default.createElement(o.Popup,{placement:u.PLACEMENT.BOTTOM_END,anchor:U,isOpen:z,isRTL:D},f.default.createElement(p.Menu,I({parentId:P,listId:B,hasMenuRole:!0,options:G,onMenuItemClick:(e,t)=>{C(e,t),V(!1)},onDismissMenu:()=>V(!1),menuStylesOverride:y},j))))}));exports.MEDIA_VARIANTS=l.MEDIA_VARIANTS,exports.MediaInput=C;
