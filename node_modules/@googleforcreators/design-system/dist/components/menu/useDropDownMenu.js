/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

"use strict";var e=require("@googleforcreators/react"),t=require("../keyboard/index.js"),u=require("./constants.js"),s=require("../../utils/isNullOrUndefinedOrEmptyString.js");module.exports=function(n){let{activeValue:r,handleMenuItemSelect:l,handleReturnToParent:i,isRTL:o,options:a=[],listRef:c,onDismissMenu:E}=n;const R=e.useMemo((()=>a.flatMap((e=>e.group))),[a]),S=R.length,[f,d]=e.useState(r),K=e.useCallback((()=>R.findIndex((e=>e?.value?.toString()===f.toString()))),[R,f]);e.useEffect((()=>{if(s(f))return;-1===K()&&d(null)}),[f,K]);const O=e.useMemo((()=>{if(s(f))return 0;return K()}),[f,K]),_=e.useCallback((e=>d(R[O+e].value)),[R,O]),Y=e.useCallback((e=>{let{key:t}=e;[u.KEYS.ARROW_UP,o?u.KEYS.ARROW_RIGHT:u.KEYS.ARROW_LEFT].includes(t)&&0!==O?_(-1):[u.KEYS.ARROW_DOWN,o?u.KEYS.ARROW_LEFT:u.KEYS.ARROW_RIGHT].includes(t)&&O<S-1?_(1):[u.KEYS.ARROW_UP,o?u.KEYS.ARROW_RIGHT:u.KEYS.ARROW_LEFT].includes(t)&&0===O&&i?.()}),[O,_,i,o,S]),T=e.useCallback((e=>{const t=R[O]?.disabled;if(t)return()=>{};const u=f||R[O].value;return l(e,{value:u})}),[R,O,f,l]);return t.useKeyDownEffect(c,{key:u.KEYS_SELECT_ITEM,shift:!0},T,[T]),t.useKeyDownEffect(c,{key:u.KEYS_CLOSE_MENU},(e=>E?.(e)),[E]),t.useKeyDownEffect(c,{key:u.KEYS_SHIFT_FOCUS},Y,[Y]),e.useFocusOut(c,(e=>E?.(e)),[]),e.useMemo((()=>({focusedValue:f,focusedIndex:O,listLength:S})),[O,f,S])};
