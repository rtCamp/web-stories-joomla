/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react"),t=require("styled-components"),r=require("@googleforcreators/react");require("prop-types");var n=require("./constants.js"),o=require("./utils/getTransforms.js"),i=require("../../utils/noop.js"),s=require("./utils/getOffset.js");function f(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var l=f(e);const u=0,c=2,a=f(t).default.div.attrs((e=>{let{$offset:{x:t,y:r,width:n,height:i},fillWidth:s,fillHeight:f,placement:l,isRTL:u,invisible:c,zIndex:a}=e;return{style:{transform:`translate(${t}px, ${r}px) ${o.getTransforms(l,u)}`,...s?{width:`${n}px`}:{},...f?{height:`${i}px`}:{},...c?{visibility:"hidden"}:{},zIndex:a}}})).withConfig({displayName:"popup__Container",componentId:"sc-16aopg7-0"})(["/*! @noflip */ left:0px;top:0px;position:fixed;",";max-height:",";"],(e=>{let{noOverFlow:t}=e;return t?"":"overflow-y: auto;"}),(e=>{let{topOffset:t}=e;return`calc(100vh - ${t}px)`}));exports.PLACEMENT=n.PLACEMENT,exports.Popup=function Popup(e){let{isRTL:t=!1,anchor:o,dock:f,children:p,renderContents:d,placement:h=n.PLACEMENT.BOTTOM,spacing:g,isOpen:x,invisible:m=!1,fillWidth:v=!1,fillHeight:O=!1,onPositionUpdate:y=i.noop,refCallback:E=i.noop,topOffset:T=u,zIndex:C=c,noOverFlow:L=!1,ignoreMaxOffsetY:b,resetXOffset:R=!1}=e;const[q,P]=r.useState(null),$=r.useRef(!1),w=r.useRef(null);r.useEffect((()=>($.current=!0,()=>{$.current=!1})),[]);const M=r.useCallback((e=>{$.current&&o?.current&&(e?.target?.nodeType&&w.current?.contains(e.target)||P({offset:o.current?s.getOffset({placement:h,spacing:g,anchor:o,dock:f,popup:w,isRTL:t,topOffset:T,ignoreMaxOffsetY:b,resetXOffset:R}):{},height:w.current?.getBoundingClientRect()?.height}))}),[o,h,g,f,t,T,b,R]);return r.useEffect((()=>{q?.height&&q.height!==w.current?.getBoundingClientRect()?.height&&M()}),[q?.height,M]),r.useLayoutEffect((()=>{if(x)return $.current=!0,M(),document.addEventListener("scroll",M,!0),()=>{document.removeEventListener("scroll",M,!0),$.current=!1}}),[x,M]),r.useLayoutEffect((()=>{$.current&&(y(q),E(w))}),[q,y,E]),r.useResizeEffect({current:document.body},M,[M]),q&&x?r.createPortal(l.default.createElement(a,{ref:w,fillWidth:v,fillHeight:O,placement:h,$offset:q.offset,invisible:m,topOffset:T,noOverFlow:L,isRTL:t,zIndex:C},d?d({propagateDimensionChange:M}):p),document.body):null};
