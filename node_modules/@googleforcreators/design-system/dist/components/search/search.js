/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react"),a=require("@googleforcreators/react");require("prop-types");var t=require("uuid"),l=require("@googleforcreators/i18n"),r=require("styled-components"),n=require("../../theme/constants/index.js"),s=require("../popup/index.js"),u=require("./components.js"),o=require("./constants.js"),i=require("./input/index.js"),c=require("./useSearch.js"),p=require("../popup/constants.js"),d=require("../menu/menu.js");function E(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var b=E(e);function h(){return h=Object.assign||function(e){for(var a=1;a<arguments.length;a++){var t=arguments[a];for(var l in t)Object.prototype.hasOwnProperty.call(t,l)&&(e[l]=t[l])}return e},h.apply(this,arguments)}const v=E(r).default.div.withConfig({displayName:"search__SearchInputWrapper",componentId:"sc-63vr7b-0"})([""]);exports.Search=e=>{let{ariaInputLabel:r=o.DEFAULT_ARIA_INPUT_LABEL,ariaClearLabel:E=o.DEFAULT_ARIA_CLEAR_LABEL,disabled:m,handleSearchValueChange:f,hasError:C,hint:L,label:A,onMenuItemClick:T,onClear:O,options:_=[],placeholder:I=o.DEFAULT_PLACEHOLDER,placement:S=p.PLACEMENT.BOTTOM,popupFillWidth:M=o.DEFAULT_POPUP_FILL_WIDTH,popupZIndex:g,selectedValue:P={},...k}=e;const q=a.useMemo((()=>`list-${t.v4()}`),[]),j=a.useMemo((()=>`select-button-${t.v4()}`),[]),D=a.useMemo((()=>`clear-button-${t.v4()}`),[]),R=a.useRef(),y=a.useRef(),{activeOption:F,getActiveOption:w,inputState:x,isMenuFocused:H,isOpen:N,normalizedOptions:V}=c({options:_,selectedValue:P,handleSearchValueChange:f}),U=a.useMemo((()=>Boolean(m||0===x?.value?.length)),[m,x]),B=a.useCallback((()=>{N.set(!0),H.set(!1)}),[N,H]),z=a.useCallback((e=>{e.preventDefault(),N.set(!0)}),[N]),W=a.useCallback((e=>{(!D||e?.srcElement?.id!==D&&e?.srcElement?.nearestViewportElement?.id!==D)&&N.set(!1)}),[D,N]),Y=a.useCallback(((e,a)=>{N.set(!1);const t=w(a)||{label:a,value:a};x.set(t.label),T?.(e,t)}),[w,x,N,T]),Z=a.useCallback((()=>R?.current?.focus()),[]),$=a.useCallback((e=>{let{target:a}=e;x.set(a.value),a.value.length>0&&!N.value&&N.set(!N.value)}),[x,N]),G=a.useCallback((()=>{x.set(void 0),O(),Z()}),[Z,x,O]),K=a.useCallback((()=>{N.set(!1),H.set(!1)}),[N,H]),J=a.useCallback((()=>H.set(!0)),[H]),Q=a.useCallback((()=>{(U||0===x.value?.trim().length)&&(H.set(!1),N.set(!1))}),[x,H,U,N]),X=a.useCallback((e=>{const{key:a}=e;"Escape"===a?U||H.set(!1):"Tab"===a?Q(e):"ArrowDown"===a?J():"Enter"===a&&x.value.trim().length>0&&Y(e,x.value)}),[U,H,Q,J,Y,x.value]);return a.useFocusOut(y,Q,[Q]),b.default.createElement(u.DropDownContainer,null,A&&b.default.createElement(u.Label,{size:n.THEME_CONSTANTS.TYPOGRAPHY.PRESET_SIZES.SMALL,disabled:m,forwardedAs:"span",isBold:!0},A),b.default.createElement(v,{ref:y},b.default.createElement(i,h({"aria-label":r,hasError:C,id:j,onChange:$,onClick:z,onFocus:B,onKeyDown:X,placeholder:I,ariaClearLabel:E,clearId:D,disabled:m,handleClearInput:G,handleTabClear:K,inputValue:x?.value||"",isOpen:N?.value,listId:q,ref:R},k))),!U&&b.default.createElement(s.Popup,{anchor:R,isOpen:N?.value,placement:S,fillWidth:M,zIndex:g},b.default.createElement(d.Menu,h({activeValue:F?.value,handleReturnToParent:Z,isMenuFocused:H.value,listId:q,menuAriaLabel:l.sprintf(
/* translators: %s: dropdown aria label or general dropdown label if there is no specific aria label. */
l.__("%s Option List Selector","web-stories"),r),onDismissMenu:W,onMenuItemClick:Y,options:V,parentId:j},k))),L&&b.default.createElement(u.Hint,{hasError:C,size:n.THEME_CONSTANTS.TYPOGRAPHY.PRESET_SIZES.SMALL},L))};
