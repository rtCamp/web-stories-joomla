/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react"),t=require("prop-types"),r=require("styled-components"),n=require("@googleforcreators/react"),o=require("../popup/index.js"),a=require("../keyboard/index.js"),l=require("../../theme/constants/index.js"),i=require("../popup/constants.js"),s=require("./tail.js"),u=require("../typography/text/index.js"),c=require("../../utils/noop.js");function p(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var d=p(e),f=p(t),T=p(r);function E(){return E=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},E.apply(this,arguments)}const P=s.TAIL_HEIGHT,m=T.default.div.withConfig({displayName:"tooltip__Wrapper",componentId:"sc-7e0t34-0"})(["position:relative;"]),L=T.default.div.withConfig({displayName:"tooltip__TooltipContainer",componentId:"sc-7e0t34-1"})(["margin:0;display:flex;justify-content:center;align-items:center;text-align:center;flex-direction:row;max-width:14em;transition:0.4s opacity;opacity:",";pointer-events:",";z-index:9999;border-radius:4px;background-color:",";filter:drop-shadow(0px 4px 4px rgba(0,0,0,0.25));"],(e=>{let{shown:t}=e;return t?1:0}),(e=>{let{shown:t}=e;return t?"all":"none"}),(e=>{let{theme:t}=e;return t.colors.inverted.bg.primary})),h=T.default(u.Text).withConfig({displayName:"tooltip__TooltipText",componentId:"sc-7e0t34-2"})(["color:",";padding:10px;"],(e=>{let{theme:t}=e;return t.colors.inverted.fg.primary})),C=e=>{let{x:t,width:r}=e;return t+r/2};let N=null;const g={children:f.default.node.isRequired,hasTail:f.default.bool,placement:f.default.oneOf(Object.values(i.PLACEMENT)),onBlur:f.default.func,onFocus:f.default.func,onPointerEnter:f.default.func,onPointerLeave:f.default.func,shortcut:f.default.string,title:f.default.oneOfType([f.default.node,f.default.string]),forceAnchorRef:f.default.object,tooltipProps:f.default.object,className:f.default.string,isDelayed:f.default.bool,popupZIndexOverride:f.default.number,ignoreMaxOffsetY:f.default.bool};exports.TOOLTIP_PLACEMENT=i.PLACEMENT,exports.TOOLTIP_RTL_PLACEMENT=i.RTL_PLACEMENT,exports.Tooltip=function Tooltip(e){let{title:t,shortcut:r,hasTail:u,placement:p=i.PLACEMENT.BOTTOM,children:f,onPointerEnter:T=c.noop,onPointerLeave:g=c.noop,onFocus:A=c.noop,onBlur:O=c.noop,isDelayed:M=!1,forceAnchorRef:b=null,tooltipProps:x=null,className:_=null,popupZIndexOverride:y,ignoreMaxOffsetY:R=!1,...v}=e;const[I,S]=n.useState(!1),[w,j]=n.useState(null),k=n.useRef(null),q=n.useRef(null),B=n.useRef(p),[H,D]=n.useState(p),F=n.useRef(!1);n.useEffect((()=>(F.current=!0,()=>{F.current=!1})),[]);const G=n.useMemo((()=>({x:p.startsWith("left")||p.startsWith("right")?P:0,y:p.startsWith("top")||p.startsWith("bottom")?P:0})),[p]),W=n.useCallback((()=>{const e=B.current;switch(e){case i.PLACEMENT.BOTTOM_START:case i.PLACEMENT.TOP_START:case i.PLACEMENT.RIGHT_START:break;case i.PLACEMENT.BOTTOM_END:case i.PLACEMENT.TOP_END:case i.PLACEMENT.RIGHT_END:D(e.replace("-end","-start"));break;case i.PLACEMENT.LEFT_END:D(i.PLACEMENT.RIGHT_END);break;case i.PLACEMENT.LEFT_START:D(i.PLACEMENT.RIGHT_START);break;case i.PLACEMENT.LEFT:D(i.PLACEMENT.RIGHT);break;default:D(`${e}-start`)}}),[]),Y=n.useCallback((e=>{let{offset:t}=e;const r=t.y+t.popupHeight+P,n=H.startsWith("bottom")&&r>=window.innerHeight,o=t.popupLeft<0;n?H.endsWith("-start")?D(i.PLACEMENT.TOP_START):H.endsWith("-end")?D(i.PLACEMENT.TOP_END):D(i.PLACEMENT.TOP):o&&W()}),[H,W]),z=n.useCallback((e=>{const t=k.current?.getBoundingClientRect(),r=q.current?.getBoundingClientRect();if(!r||!t)return;Y(e);const n=C(t)-C(r);j(n)}),[Y]),Z=n.useDebouncedCallback((()=>{D(B.current)}),100),$=n.useRef(),U=n.useCallback((e=>{const t=()=>{F.current&&(S(!0),T(e))};if(M){performance.now()-N<500&&t(),clearTimeout($.current),$.current=setTimeout(t,1e3)}else t()}),[M,T]),X=n.useCallback((e=>{S(!1),g(e),Z(),M&&(clearTimeout($.current),I&&(N=performance.now()))}),[g,Z,M,I]);return d.default.createElement(d.default.Fragment,null,d.default.createElement(m,E({onPointerEnter:U,onPointerLeave:X,onFocus:e=>{S(!0),A(e)},onBlur:e=>{S(!1),O(e),Z()},ref:k},v),f),d.default.createElement(o.Popup,{anchor:b||k,placement:H,spacing:G,isOpen:Boolean(I&&(r||t)),onPositionUpdate:z,zIndex:y,noOverFlow:!0,ignoreMaxOffsetY:R},d.default.createElement(L,E({className:_,ref:q,placement:H,shown:I},x),d.default.createElement(h,{size:l.THEME_CONSTANTS.TYPOGRAPHY.PRESET_SIZES.X_SMALL},r?`${t} (${a.prettifyShortcut(r)})`:t),u&&d.default.createElement(d.default.Fragment,null,d.default.createElement(s.SvgForTail,null,d.default.createElement("clipPath",{id:s.SVG_TOOLTIP_TAIL_ID,clipPathUnits:"objectBoundingBox"},d.default.createElement("path",{d:"M1,1 L0.868,1 C0.792,1,0.72,0.853,0.676,0.606 L0.585,0.098 C0.562,-0.033,0.513,-0.033,0.489,0.098 L0.399,0.606 C0.355,0.853,0.283,1,0.207,1 L0,1 L1,1"}))),d.default.createElement(s.Tail,{placement:H,translateX:w})))))},exports.TooltipPropTypes=g;
