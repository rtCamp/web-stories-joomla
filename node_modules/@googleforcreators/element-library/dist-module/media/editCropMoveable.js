/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

import e from"react";import"prop-types";import{useRef as t,useEffect as o}from"@googleforcreators/react";import{useUnits as r,calcRotatedResizeOffset as a}from"@googleforcreators/units";import{getFocalFromOffset as i}from"@googleforcreators/media";import{Moveable as s}from"@googleforcreators/moveable";import{getTransformFlip as l}from"@googleforcreators/elements";function EditCropMoveable(n){let{setProperties:c,cropBox:d,croppedMedia:f,flip:p,x:m,y:h,width:g,height:u,rotationAngle:y,offsetX:x,offsetY:b,mediaWidth:T,mediaHeight:z}=n;const{editorToDataX:$,editorToDataY:v}=r((e=>({editorToDataX:e.actions.editorToDataX,editorToDataY:e.actions.editorToDataY}))),D=t(),w=t([0,0,0,0,0,0]),X=l(p);return o((()=>{D.current?.updateRect()})),e.createElement(s,{ref:D,className:"crop-moveable",targets:d,origin:!1,resizable:!0,onResize:e=>{let{width:t,height:o,direction:r,delta:a,drag:i}=e;const[s,l]=[i.beforeTranslate[0],i.beforeTranslate[1]],[n,c]=r,p=t-g,m=o-u,h=n<0?p:0,y=n>0?p:0,x=c<0?m:0,b=c>0?m:0;w.current=[s,l,h,y,x,b],d.style.transform=`translate(${s}px, ${l}px)`,f.style.transform=`translate(${-s}px, ${-l}px) ${X??""}`,a[0]&&(d.style.width=`${t}px`),a[1]&&(d.style.height=`${o}px`)},onResizeEnd:()=>{const[e,t,o,r,s,l]=w.current;if(w.current=[0,0,0,0,0,0],d.style.transform="",f.style.transform="",d.style.width="",d.style.height="",0===o&&0===r&&0===s&&0===l)return;const n=g+o+r,D=u+s+l,[X,Y]=a(y,o,r,s,l),E=100*Math.min(T/n,z/D),M=i(n,T,x+e),R=i(D,z,b+t);c({x:$(m+X),y:v(h+Y),width:$(n),height:v(D),resizeWidth:n,resizeHeight:D,scale:E,focalX:p?.horizontal?100-M:M,focalY:p?.vertical?100-R:R})},snappable:!0,verticalGuidelines:[m-x,m-x+T],horizontalGuidelines:[h-b,h-b+z]})}export{EditCropMoveable as default};
