/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

import t from"react";import"prop-types";import{useRef as e,useCallback as o,useEffect as r}from"@googleforcreators/react";import{getFocalFromOffset as a}from"@googleforcreators/media";import{useKeyDownEffect as i,getKeyboardMovement as l}from"@googleforcreators/design-system";import{Moveable as n}from"@googleforcreators/moveable";import{getTransformFlip as s}from"@googleforcreators/elements";function EditPanMoveable(c){let{setProperties:f,fullMedia:p,croppedMedia:g,flip:m,x:d,y:h,width:u,height:v,rotationAngle:y,offsetX:b,offsetY:x,mediaWidth:z,mediaHeight:$}=c;const E=e(),M=e([0,0]),D=s(m),P=o((()=>{const[t,e]=M.current;p.style.transform=`translate(${t}px, ${e}px) ${D??""}`,g.style.transform=`translate(${t}px, ${e}px) ${D??""}`}),[g,p,D]);return r((()=>{E.current?.updateRect()})),i(g,{key:["up","down","left","right"],shift:!0},(t=>{let{key:e,shiftKey:o}=t,{dx:r,dy:i}=l(e,o);m?.vertical&&(i=-i),m?.horizontal&&(r=-r);const n=a(u,z,b-r),s=a(v,$,x-i);f({focalX:m?.horizontal?100-n:n,focalY:m?.vertical?100-s:s}),P()}),[P,m?.horizontal,m?.vertical,b,x,f,u,v,$,z]),t.createElement(n,{ref:E,targets:g,origin:!0,draggable:!0,throttleDrag:0,onDrag:t=>{let{dist:e}=t,[o,r]=e;m?.vertical&&(r=-r),m?.horizontal&&(o=-o),M.current=[o,r],P()},onDragEnd:()=>{g.focus();const[t,e]=M.current;M.current=[0,0];const o=a(u,z,b-t),r=a(v,$,x-e);f({focalX:m?.horizontal?100-o:o,focalY:m?.vertical?100-r:r}),P()},snappable:!0,snapCenter:!0,bounds:0===y?{left:d+u-z,top:h+v-$,right:d+z,bottom:h+$}:{},verticalGuidelines:0===y?[d,d+u/2,d+u]:[d+u/2],horizontalGuidelines:0===y?[h,h+v/2,h+v]:[h+v/2]})}export{EditPanMoveable as default};
