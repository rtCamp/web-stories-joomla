/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

import e from"react";import t from"styled-components";import{useRef as o,useMemo as r,useEffect as n}from"@googleforcreators/react";import"prop-types";import{createSolid as i}from"@googleforcreators/patterns";import{useUnits as a}from"@googleforcreators/units";import{useTransformHandler as l}from"@googleforcreators/transform";import{getHTMLInfo as d,getHTMLFormatters as s}from"@googleforcreators/rich-text";import{stripHTML as p}from"@googleforcreators/dom";import{shouldDisplayBorder as c,getResponsiveBorder as m}from"@googleforcreators/masks";import{BACKGROUND_TEXT_MODE as g}from"@googleforcreators/elements";import{elementWithBorder as f,elementFillContent as h,elementWithFont as u,elementWithTextParagraphStyle as y,elementWithBackgroundColor as b,elementWithHighlightBorderRadius as w}from"../shared/shared.js";import"../shared/layerText.js";import E from"../shared/useColorTransformHandler.js";import{getHighlightLineheight as _,generateFontFamily as k,calcFontMetrics as x,generateParagraphTextStyle as S}from"./util.js";function v(){return v=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var r in o)Object.prototype.hasOwnProperty.call(o,r)&&(e[r]=o[r])}return e},v.apply(this,arguments)}const I=t.div.withConfig({displayName:"display__OutsideBorder",componentId:"sc-o6jk50-0"})(["",""],f),T=t.div.withConfig({displayName:"display__HighlightWrapperElement",componentId:"sc-o6jk50-1"})([""," "," "," line-height:",";padding:0;"],h,u,y,(e=>{let{lineHeight:t,verticalPadding:o}=e;return _(t,o)})),j=t.p.withConfig({displayName:"display__HighlightElement",componentId:"sc-o6jk50-2"})(["font-size:inherit;line-height:inherit;margin:0;position:absolute;width:",";"],(e=>{let{verticalPadding:t}=e;return`calc(100% - ${t}px)`})),C=t.span.withConfig({displayName:"display__MarginedElement",componentId:"sc-o6jk50-3"})(["position:relative;display:block;top:0;left:0;"]),H=t.span.withConfig({displayName:"display__Span",componentId:"sc-o6jk50-4"})([""," "," box-decoration-break:clone;position:relative;"],b,y),N=t(H).withConfig({displayName:"display__BackgroundSpan",componentId:"sc-o6jk50-5"})([""," color:transparent;"],w),M=t(H).withConfig({displayName:"display__ForegroundSpan",componentId:"sc-o6jk50-6"})(["background:none;"]),z=t.p.attrs((e=>{let{theme:t,previewMode:o,fontStyle:r,fontSize:n,fontWeight:i,font:a,marginOffset:l,padding:d,lineHeight:s,textAlign:p,dataToEditorY:c}=e;return o?{style:{zIndex:1,whiteSpace:"pre-wrap",wordBreak:"break-word",letterSpacing:"normal",color:t.colors.standard.black,fontStyle:r,fontSize:`${n}px`,fontWeight:i,fontFamily:k(a),margin:-c(l/2)+"px 0",padding:d||0,lineHeight:s,textAlign:p}}:{}})).withConfig({displayName:"display__FillElement",componentId:"sc-o6jk50-7"})(["margin:0;"," "," ",""],h,(e=>{let{previewMode:t}=e;return!t&&u}),(e=>{let{previewMode:t}=e;return!t&&y})),O=t.div.withConfig({displayName:"display__Background",componentId:"sc-o6jk50-8"})([""," "," "," margin:0;"],b,h,f);function TextDisplay(t){let{element:f,element:{id:h,content:u,backgroundColor:y,backgroundTextMode:b,border:w,borderRadius:_,...k},previewMode:H,maybeEnqueueFontStyle:R}=t;const L=o(null),F=o(null),P=o(null),W=o(null),{dataToEditorX:Y,dataToEditorY:$}=a((e=>({dataToEditorX:e.actions.dataToEditorX,dataToEditorY:e.actions.dataToEditorY}))),{font:B,width:X,height:A}=k,D=r((()=>{const e=d(u);return{fontStyle:e.isItalic?"italic":"normal",fontWeight:e.fontWeight,content:p(u)}}),[u]),{marginOffset:G}=x(f),q={font:B,element:f,marginOffset:$(G),...b===g.NONE?{}:{backgroundColor:y},...S(k,(e=>`${Y(e)}px`),(e=>`${$(e)}px`),$,f),horizontalPadding:Y(k.padding?.horizontal||0),verticalPadding:Y(k.padding?.vertical||0)};n((()=>{R([{...D,font:B}])}),[B,D,R]);const J=b===g.HIGHLIGHT,K=J?F:P;l(h,(e=>{const t=L?.current||W.current;if(!t)return;const o=e?.updates?.fontSize;t.style.fontSize=o?`${$(o)}px`:"";const r=e?.updates?.marginOffset;if(t.style.margin=r?$(-r)/2+"px 0":"",(F.current||P.current)&&e){const{resize:t}=e;if(t&&0!==t[0]&&0!==t[1]){const[e,o]=t;c(f)&&(K.current.style.width=e+w.left+w.right+"px",K.current.style.height=o+w.top+w.bottom+"px")}}})),E({id:h,targetRef:P,expectedStyle:"background"}),E({id:h,targetRef:W,expectedStyle:"color"}),E({id:h,targetRef:K,expectedStyle:"border-color"});const Q=r((()=>s().setColor(u,i(0,0,0))),[u]);return J?e.createElement(I,{ref:F,border:m(w,H,Y),borderRadius:_,width:X,height:A},e.createElement(T,v({ref:L},q),e.createElement(j,q,e.createElement(C,q,e.createElement(N,v({ref:P},q,{borderRadius:_,dataToEditorY:$,dangerouslySetInnerHTML:{__html:Q}})))),e.createElement(j,q,e.createElement(C,q,e.createElement(M,v({ref:W},q,{dangerouslySetInnerHTML:{__html:u}})))))):e.createElement(O,{ref:P,backgroundColor:b===g.FILL&&y,borderRadius:_,border:m(w,H,Y),width:X,height:A},e.createElement(z,v({ref:W,dangerouslySetInnerHTML:{__html:u},previewMode:H},q)))}export{TextDisplay as default};
