/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

import e from"react";import"prop-types";import t from"styled-components";import{useRef as r,useEffect as o}from"@googleforcreators/react";import{useUnits as n}from"@googleforcreators/units";import{areEventsDragging as a}from"@googleforcreators/moveable";import"@googleforcreators/elements";import{getCaretCharacterOffsetWithin as i}from"@googleforcreators/rich-text";import{elementFillContent as s,elementWithFont as m,elementWithTextParagraphStyle as l}from"../shared/shared.js";import"../shared/layerText.js";import"@googleforcreators/patterns";import"@googleforcreators/transform";import{generateParagraphTextStyle as c}from"./util.js";function p(){return p=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e},p.apply(this,arguments)}const d=t.p.withConfig({displayName:"frame__Element",componentId:"sc-cj57v5-0"})([""," "," "," opacity:0;user-select:none;"],s,m,l);function TextFrame(t){let{element:s,element:{id:m,content:l,...f},wrapperRef:u,setEditingElementWithState:g,isOnlySelectedElement:y}=t;const{dataToEditorX:E,dataToEditorY:v}=n((e=>({dataToEditorX:e.actions.dataToEditorX,dataToEditorY:e.actions.dataToEditorY}))),h=c(f,(e=>`${E(e)}px`),(e=>`${v(e)}px`),v,s),T=r();return o((()=>{if(!y)return;const e=u.current,t=T.current;let r=0,o=null;const n=e=>{e.metaKey||e.altKey||e.ctrlKey||("Enter"===e.key||/^\w$/.test(e.key))&&(g(m,{selectAll:!0}),e.stopPropagation(),"Enter"===e.key&&e.preventDefault())},s=e=>{r=e.timeStamp,o={clientX:e.clientX,clientY:e.clientY}},l=e=>{o&&!a({timeStamp:r,...o},e)&&(e.stopPropagation(),g(m,{offset:i(T.current,e.clientX,e.clientY)}))};return e.addEventListener("keydown",n),t.addEventListener("mousedown",s),t.addEventListener("mouseup",l),()=>{e.removeEventListener("keydown",n),t.removeEventListener("mousedown",s),t.removeEventListener("mouseup",l)}}),[m,u,y,g]),e.createElement(d,p({ref:T,"data-testid":"textFrame","data-fix-caret":!0,className:"syncMargin",dangerouslySetInnerHTML:{__html:l},element:s},h))}export{TextFrame as default};
