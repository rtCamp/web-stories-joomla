/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

import e from"react";import"prop-types";import t,{css as n}from"styled-components";import{useState as o,useCallback as r,useEffect as i,useDebouncedCallback as s,useRef as a}from"@googleforcreators/react";import{CSSTransition as p}from"react-transition-group";import{__}from"@googleforcreators/i18n";import{rgba as l}from"polished";import{Icons as c,useKeyDownEffect as u,Popup as d}from"@googleforcreators/design-system";import"@googleforcreators/elements";function m(){return m=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},m.apply(this,arguments)}const f=t.div.withConfig({displayName:"playPauseButton__Controls",componentId:"sc-8unnuk-0"})(["position:absolute;z-index:2;left:",";top:",";width:",";height:",";pointer-events:none;"],(e=>{let{x:t}=e;return`${t}px`}),(e=>{let{y:t}=e;return`${t}px`}),(e=>{let{width:t}=e;return`${t}px`}),(e=>{let{height:t}=e;return`${t}px`})),y=t.div.attrs({role:"button",tabIndex:-1}).withConfig({displayName:"playPauseButton__ButtonWrapper",componentId:"sc-8unnuk-1"})([""," cursor:pointer;pointer-events:initial;width:","px;height:","px;overflow:hidden;opacity:",";&.button-enter{opacity:0;}&.button-enter-active,&.button-enter-done{opacity:1;transition:opacity 100ms;}&.button-exit{opacity:1;}&.button-exit-active,&.button-exit-done{opacity:0;transition:opacity 100ms;}"],(e=>{let{isAbove:t}=e;return!t&&n(["position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);"])}),82,82,(e=>{let{isAbove:t}=e;return t?1:0})),h=n(["width:","px;height:","px;pointer-events:none;transform:translate( ","px,","px );color:",";filter:drop-shadow( 0px 0px 10px "," );"],72,72,(e=>{let{$isRTL:t}=e;return 5*(t?-1:1)}),5,(e=>{let{theme:t}=e;return t.colors.standard.white}),(e=>{let{theme:t}=e;return l(t.colors.bg.primary,.4)})),v=t(c.PlayFilled).withConfig({displayName:"playPauseButton__Play",componentId:"sc-8unnuk-2"})(["",";"],h),g=t(c.StopFilled).withConfig({displayName:"playPauseButton__Pause",componentId:"sc-8unnuk-3"})(["",";"],h),b={y:22};function PlayPauseButton(t){let{box:n,isActive:l=!0,isTransforming:c=!1,shouldResetOnEnd:h=!0,elementRef:x,element:w,videoRef:E=null,isRTL:P,topOffset:L=0}=t;const B=Boolean(w.resource.src),R=w.width<108||w.height<120,[k,C]=o(!1),[_,O]=o(!0),[T,$]=o(!c&&B),{id:I}=w,N=r((()=>E?E.current:document.getElementById(`video-${I}`)),[E,I]);i((()=>{const e=N();l||(e&&(e.pause(),e.currentTime=0),O(!1))}),[N,l]),i((()=>{const e=N();!e||e.paused||c||e.pause()}),[N,c]),i((()=>{const e=N();if(!e||!h)return;const t=()=>{e.currentTime=0,$(!1)};return e.addEventListener("ended",t),()=>e.removeEventListener("ended",t)}),[h,N,I]),i((()=>{const e=N();if(!e)return;const t=()=>$(!0),n=()=>$(!1);return e.addEventListener("play",t),e.addEventListener("pause",n),()=>{e.removeEventListener("play",t),e.removeEventListener("pause",n)}}),[N,I]);const A=s((()=>{R||O(!T)}),2e3),j=s((e=>{const t=x.current;if(!t)return;const n=t.getBoundingClientRect(),o=e.clientX>=n.left&&e.clientX<=n.right&&e.clientY>=n.top&&e.clientY<=n.bottom;C(o),O(!0),A()}),10);i((()=>(document.addEventListener("pointermove",j),()=>{document.removeEventListener("pointermove",j)})),[j]);const F=e=>{e.stopPropagation();const t=N();t&&(T?(t.pause(),O(!0)):t.play().catch((()=>{})))};u(x,{key:["space"]},F,[F]);const X=a();if(!l)return null;const Y=__(T?"Click to pause":"Click to play","web-stories"),z=R?t=>{let{children:n}=t;return e.createElement(d,{isRTL:P,anchor:x,isOpen:!0,placement:"top",spacing:b,topOffset:L},n)}:p,D=T?g:v;return e.createElement(f,m({"data-controls-id":I},n),_&&w.resource.src&&e.createElement(z,{in:k,appear:!0,nodeRef:X,classNames:"button",timeout:100},e.createElement(y,{ref:X,"aria-label":Y,"aria-pressed":T,key:"wrapper",onMouseDown:F,isAbove:R},e.createElement(D,{$isRTL:P}))))}export{PlayPauseButton as default};
