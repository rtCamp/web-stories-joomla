/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

"use strict";var e=require("react");require("prop-types");var t=require("@googleforcreators/react"),r=require("@googleforcreators/media"),o=require("@googleforcreators/design-system"),a=require("@googleforcreators/moveable"),l=require("@googleforcreators/elements");function i(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var s=i(e);module.exports=function EditPanMoveable(e){let{setProperties:i,fullMedia:n,croppedMedia:f,flip:c,x:u,y:g,width:d,height:p,rotationAngle:m,offsetX:h,offsetY:v,mediaWidth:y,mediaHeight:b}=e;const F=t.useRef(),q=t.useRef([0,0]),x=l.getTransformFlip(c),z=t.useCallback((()=>{const[e,t]=q.current;n.style.transform=`translate(${e}px, ${t}px) ${x??""}`,f.style.transform=`translate(${e}px, ${t}px) ${x??""}`}),[f,n,x]);return t.useEffect((()=>{F.current?.updateRect()})),o.useKeyDownEffect(f,{key:["up","down","left","right"],shift:!0},(e=>{let{key:t,shiftKey:a}=e,{dx:l,dy:s}=o.getKeyboardMovement(t,a);c?.vertical&&(s=-s),c?.horizontal&&(l=-l);const n=r.getFocalFromOffset(d,y,h-l),f=r.getFocalFromOffset(p,b,v-s);i({focalX:c?.horizontal?100-n:n,focalY:c?.vertical?100-f:f}),z()}),[z,c?.horizontal,c?.vertical,h,v,i,d,p,b,y]),s.default.createElement(a.Moveable,{ref:F,targets:f,origin:!0,draggable:!0,throttleDrag:0,onDrag:e=>{let{dist:t}=e,[r,o]=t;c?.vertical&&(o=-o),c?.horizontal&&(r=-r),q.current=[r,o],z()},onDragEnd:()=>{f.focus();const[e,t]=q.current;q.current=[0,0];const o=r.getFocalFromOffset(d,y,h-e),a=r.getFocalFromOffset(p,b,v-t);i({focalX:c?.horizontal?100-o:o,focalY:c?.vertical?100-a:a}),z()},snappable:!0,snapCenter:!0,bounds:0===m?{left:u+d-y,top:g+p-b,right:u+y,bottom:g+b}:{},verticalGuidelines:0===m?[u,u+d/2,u+d]:[u+d/2],horizontalGuidelines:0===m?[g,g+p/2,g+p]:[g+p/2]})};
