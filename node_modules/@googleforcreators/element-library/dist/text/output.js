/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react");require("prop-types");var t=require("@googleforcreators/react"),a=require("@googleforcreators/patterns"),r=require("@googleforcreators/units"),o=require("classnames"),n=require("@googleforcreators/elements"),l=require("@googleforcreators/rich-text"),i=require("./util.js");function d(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var s=d(e),c=d(o);function TextOutputWithUnits(e){let{element:r,dataToStyleX:o,dataToStyleY:d,dataToFontSizeY:u,dataToPaddingX:g,dataToPaddingY:p,className:f}=e;const{content:m,backgroundColor:T,backgroundTextMode:h,padding:x,borderRadius:y,tagName:E="p",...b}=r;u||(u=d),g||(g=o),p||(p=d);const v={vertical:x.vertical?p(x.vertical):0,horizontal:x.horizontal?g(x.horizontal):0},S=v.vertical||v.horizontal?`${v.vertical} ${v.horizontal}`:0,k=h!==n.BACKGROUND_TEXT_MODE.NONE?a.generatePatternStyles(T):void 0,{dataToEditorY:O,font:_,...$}=i.generateParagraphTextStyle(b,o,d,u,r,p),H={...$,color:"#000000",padding:S},M=x.vertical?parseFloat(d(x.vertical)):0,N=parseFloat(d(b.fontSize)),q=i.getHighlightLineheight(b.lineHeight,M/N,"em"),z={...H,...k,margin:0,padding:0,background:"none",lineHeight:q,overflowWrap:"break-word"},Y={...z,position:"absolute",top:0,left:0,right:0},B=e=>{const{marginOffset:t}=i.calcFontMetrics(e);return{display:"block",position:"relative",left:0,top:"0",margin:`${p(-t/2)} 0`,WebkitBoxDecorationBreak:"clone",boxDecorationBreak:"clone"}},D={...k,WebkitBoxDecorationBreak:"clone",boxDecorationBreak:"clone",position:"relative",padding:S,textAlign:$.textAlign,borderRadius:`${y?.topLeft||0}px ${y?.topRight||0}px ${y?.bottomRight||0}px ${y?.bottomLeft||0}px`},F={...D,color:"transparent"},L={...D,background:"none"},P=m.replace(/\n$/,"\n\n"),W=t.useMemo((()=>l.getHTMLFormatters().setColor(P,a.createSolid(0,0,0))),[P]);return f=c.default(f,"text-wrapper"),h===n.BACKGROUND_TEXT_MODE.HIGHLIGHT?s.default.createElement(s.default.Fragment,null,s.default.createElement(E,{className:f,style:z},s.default.createElement("span",{style:B(r)},s.default.createElement("span",{style:F,dangerouslySetInnerHTML:{__html:W}}))),s.default.createElement(E,{className:f,style:Y,"aria-hidden":"true"},s.default.createElement("span",{style:B(r)},s.default.createElement("span",{style:L,dangerouslySetInnerHTML:{__html:P}})))):s.default.createElement(E,{className:f,style:H},s.default.createElement("span",{dangerouslySetInnerHTML:{__html:P}}))}exports.TextOutputWithUnits=TextOutputWithUnits,exports.default=function TextOutput(e){let{element:t}=e;const{width:a}=t;return s.default.createElement(TextOutputWithUnits,{element:t,className:"fill",dataToStyleX:e=>`${r.dataToEditorX(e,100)}%`,dataToStyleY:e=>`${r.dataToEditorY(e,100)}%`,dataToFontSizeY:e=>`${r.dataToFontSizeY(e,100)}em`,dataToPaddingX:e=>e/a*100+"%",dataToPaddingY:e=>e/a*100+"%"})};
