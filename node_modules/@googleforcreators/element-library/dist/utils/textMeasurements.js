/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("react"),e=require("@googleforcreators/react"),n=require("@googleforcreators/units"),r=require("../text/output.js"),o=require("../text/util.js");function i(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var a=i(t);function l(){return l=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},l.apply(this,arguments)}const u={boxSizing:"border-box",visibility:"hidden",position:"fixed",contain:"layout paint",top:"-9999px",left:"-9999px",zIndex:-1,overflowWrap:"break-word",...!1},c={dataToStyleX:t=>`${t}px`,dataToStyleY:t=>`${t}px`},s="__WEB_STORIES_LASTEL__";function f(t){let n=document.body.__WEB_STORIES_MEASURER__;return n||(n=document.createElement("div"),n.id="__web-stories-text-measurer",n.className="web-stories-content",p(n,u),document.body.appendChild(n),document.body.__WEB_STORIES_MEASURER__=n),function(t,e){const n=t[s];if(t[s]=e,!t.firstElementChild||!n)return!0;return n!==e}(n,t)&&(n.innerHTML=e.renderToStaticMarkup(a.default.createElement(r.TextOutputWithUnits,l({element:t},c)),n)),n.firstElementChild}function p(t,e){for(const n in e)if(Object.prototype.hasOwnProperty.call(e,n)){const r=e[n];t.style[n]=null===r?"":r}}exports.calculateFitTextFontSize=function(t,e,r){const i=f(t);p(i,{width:`${e}px`,height:null,fontSize:null});let a,l=1,u=n.PAGE_HEIGHT;for(;u-l>1;){const e=n.dataPixels((l+u)/2),{marginOffset:c}=o.calcFontMetrics({...t,fontSize:e});a=c,p(i,{fontSize:`${e}px`,margin:-c/2+"px 0"});i.offsetHeight-c>r?u=e:l=e}return p(i,{fontSize:`${l}px`,margin:-a/2+"px 0"}),{fontSize:l,marginOffset:a}},exports.calculateTextHeight=function(t,e){const n=f(t);return p(n,{width:`${e}px`,height:null}),n.parentNode.offsetHeight};
