/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

import e from"react";import{useMemo as t}from"@googleforcreators/react";import"prop-types";import{v4 as r}from"uuid";import{getTransformFlip as o}from"@googleforcreators/elements";import{MaskTypes as n}from"./constants.js";import{getElementMask as l,canSupportMultiBorder as a,getBorderedMaskProperties as i}from"./masks.js";import{getBorderColor as s}from"./utils/elementBorder.js";function m(){return m=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e},m.apply(this,arguments)}const c={position:"absolute",top:0,left:0,right:0,bottom:0},p={position:"absolute",top:0,left:0,right:0,bottom:0,height:"100%",width:"100%"};function BorderedMaskedElement(d){let{hasFill:f=!1,style:h,children:u,applyFlip:E=!0,postfix:g="",getBorderWidth:y,element:k,elementWidth:v,elementHeight:b,forceRectangularMask:B=!1,...$}=d;const j=t(r,[]),w=l(k),{id:M,flip:x,isBackground:P,border:W}=k,O=E&&o(x)||"",R=`${h?.transform||""} ${O}`.trim(),A={...f?c:{},...h,transform:R||null},C=y(),F=W?.color?s({color:W.color}):"none";if(!w?.type||P&&w.type!==n.RECTANGLE||B)return e.createElement("div",m({style:A},$),u);const T=!a(k)&&C>0&&"none"!==F,G=`mask-${w.type}-${M}-display${g}-${j}`;if(T){const{viewBox:t,groupTransform:r,borderWrapperStyle:o}=i(w,C,v,b),n={...h,...o,transform:R,pointerEvents:"none"};return e.createElement("div",{style:h},e.createElement("div",{style:n},e.createElement("svg",{viewBox:t,width:"100%",height:"100%",preserveAspectRatio:"none",style:p},e.createElement("g",{transform:r},e.createElement("path",{d:w.path,stroke:F,strokeWidth:C,vectorEffect:"non-scaling-stroke",fill:"transparent"})))),e.createElement(MaskedElement,m({style:{...A,opacity:1},mask:w,id:G},$),u))}return e.createElement(MaskedElement,m({style:A,mask:w,id:G},$),u)}function MaskedElement(t){let{style:r,id:o,mask:{ratio:n,path:l},children:a,...i}=t;return e.createElement("div",m({style:{...r,clipPath:`url(#${o})`,WebkitClipPath:`url(#${o})`}},i),e.createElement("svg",{width:0,height:0},e.createElement("defs",null,e.createElement("clipPath",{id:o,transform:`scale(1 ${n})`,clipPathUnits:"objectBoundingBox"},e.createElement("path",{d:l})))),a)}export{BorderedMaskedElement as default};
