/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

import e from"react";import"prop-types";import t,{css as r}from"styled-components";import{forwardRef as o,useState as i,useRef as n,useEffect as a}from"@googleforcreators/react";import{getTransformFlip as s}from"@googleforcreators/elements";import{MaskTypes as c}from"./constants.js";import{getElementMask as l}from"./masks.js";function p(){return p=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e},p.apply(this,arguments)}const g={position:"absolute",top:0,left:0,right:0,bottom:0},d=r(["position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none;"]),m=t.svg.withConfig({displayName:"frame__DropTargetSVG",componentId:"sc-1cagagv-0"})([""," z-index:",";"],d,(e=>{let{active:t}=e;return t?1:-1})),h=t.svg.withConfig({displayName:"frame__Filler",componentId:"sc-1cagagv-1"})(["",""],d),u=t.path.withConfig({displayName:"frame__FillerPath",componentId:"sc-1cagagv-2"})(["pointer-events:all;"]),f=t.path.withConfig({displayName:"frame__DropTargetPath",componentId:"sc-1cagagv-3"})(["transition:opacity 0.5s;pointer-events:visibleStroke;opacity:",";stroke:",";"],(e=>{let{active:t}=e;return t?.3:0}),(e=>{let{theme:t}=e;return t.colors.border.selection})),v=t.div.withConfig({displayName:"frame__Wrapper",componentId:"sc-1cagagv-4"})(["width:100%;height:100%;::before{transition:opacity 0.5s;opacity:",";display:block;content:'';position:absolute;width:calc(100% + 8px);height:calc(100% + 8px);border-radius:8px;left:-4px;top:-4px;border:1px solid ",";}"],(e=>{let{hasBackgroundOutline:t}=e;return t?1:0}),(e=>{let{theme:t}=e;return t.colors.border.selection}));function WithDropTarget(t){let{element:r,children:o,hover:i,draggingResource:s,activeDropTargetId:c,isDropSource:g,registerDropTarget:d,unregisterDropTarget:h}=t;const u=n(null),{id:y,resource:D,isBackground:E}=r,b=l(r);if(a((()=>(d(y,u.current),()=>{h(y)})),[y,d,h]),!b)return o;const k=i&&!s||Boolean(s)&&g(s.type)&&s!==D,w=k&&!E,T=k&&E,x={vectorEffect:"non-scaling-stroke",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",d:b?.path};return e.createElement(v,{hasBackgroundOutline:T},o,e.createElement(m,{viewBox:"0 0 1 "+1/b.ratio,width:"100%",height:"100%",preserveAspectRatio:"none",active:c===r.id},e.createElement(f,p({},x,{strokeWidth:"3",style:{opacity:w?1:0}})),e.createElement(f,p({ref:u,strokeWidth:"48"},x))))}const y=o(((t,r)=>{let{element:o,fill:n,style:a,children:d,flip:m,draggingResource:f,activeDropTargetId:v,isDropSource:y,registerDropTarget:D,unregisterDropTarget:E,...b}=t;const[k,w]=i(!1),{isBackground:T}=o,x={draggingResource:f,activeDropTargetId:v,isDropSource:y,registerDropTarget:D,unregisterDropTarget:E},_=l(o),B=m?{transform:s(m)}:null;if(!_?.type||T&&_.type!==c.RECTANGLE)return e.createElement("div",p({style:{...n?g:{},...a,...B}},b),d);const I=`mask-${_.type}-${o.id}-frame`;return e.createElement("div",p({ref:r,style:{...n?g:{},...a,...B,...T?{}:{clipPath:`url(#${I})`}}},b,{onPointerOver:()=>w(!0),onPointerOut:()=>w(!1)}),e.createElement("svg",{width:0,height:0},e.createElement("defs",null,e.createElement("clipPath",{id:I,transform:`scale(1 ${_.ratio})`,clipPathUnits:"objectBoundingBox"},e.createElement("path",{d:_.path})))),e.createElement(h,{viewBox:"0 0 1 "+1/_.ratio,width:"100%",height:"100%",preserveAspectRatio:"none"},e.createElement(u,{fill:"none",d:_?.path})),e.createElement(WithDropTarget,p({element:o,hover:k},x,b),d))}));export{y as default};
