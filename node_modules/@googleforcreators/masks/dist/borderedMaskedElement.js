/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

"use strict";var e=require("react"),t=require("@googleforcreators/react");require("prop-types");var r=require("uuid"),l=require("@googleforcreators/elements"),a=require("./constants.js"),o=require("./masks.js"),n=require("./utils/elementBorder.js");function s(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var i=s(e);function d(){return d=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var l in r)Object.prototype.hasOwnProperty.call(r,l)&&(e[l]=r[l])}return e},d.apply(this,arguments)}const u={position:"absolute",top:0,left:0,right:0,bottom:0},c={position:"absolute",top:0,left:0,right:0,bottom:0,height:"100%",width:"100%"};function MaskedElement(e){let{style:t,id:r,mask:{ratio:l,path:a},children:o,...n}=e;return i.default.createElement("div",d({style:{...t,clipPath:`url(#${r})`,WebkitClipPath:`url(#${r})`}},n),i.default.createElement("svg",{width:0,height:0},i.default.createElement("defs",null,i.default.createElement("clipPath",{id:r,transform:`scale(1 ${l})`,clipPathUnits:"objectBoundingBox"},i.default.createElement("path",{d:a})))),o)}module.exports=function BorderedMaskedElement(e){let{hasFill:s=!1,style:p,children:f,applyFlip:m=!0,postfix:h="",getBorderWidth:g,element:y,elementWidth:E,elementHeight:k,forceRectangularMask:v=!1,...b}=e;const B=t.useMemo(r.v4,[]),M=o.getElementMask(y),{id:$,flip:q,isBackground:j,border:w}=y,P=m&&l.getTransformFlip(q)||"",x=`${p?.transform||""} ${P}`.trim(),W={...s?u:{},...p,transform:x||null},T=g(),C=w?.color?n.getBorderColor({color:w.color}):"none";if(!M?.type||j&&M.type!==a.MaskTypes.RECTANGLE||v)return i.default.createElement("div",d({style:W},b),f);const F=!o.canSupportMultiBorder(y)&&T>0&&"none"!==C,O=`mask-${M.type}-${$}-display${h}-${B}`;if(F){const{viewBox:e,groupTransform:t,borderWrapperStyle:r}=o.getBorderedMaskProperties(M,T,E,k),l={...p,...r,transform:x,pointerEvents:"none"};return i.default.createElement("div",{style:p},i.default.createElement("div",{style:l},i.default.createElement("svg",{viewBox:e,width:"100%",height:"100%",preserveAspectRatio:"none",style:c},i.default.createElement("g",{transform:t},i.default.createElement("path",{d:M.path,stroke:C,strokeWidth:T,vectorEffect:"non-scaling-stroke",fill:"transparent"})))),i.default.createElement(MaskedElement,d({style:{...W,opacity:1},mask:M,id:O},b),f))}return i.default.createElement(MaskedElement,d({style:W,mask:M,id:O},b),f)};
