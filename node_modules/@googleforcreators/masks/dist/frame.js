/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

"use strict";var e=require("react");require("prop-types");var t=require("styled-components"),r=require("@googleforcreators/react"),o=require("@googleforcreators/elements"),a=require("./constants.js"),n=require("./masks.js");function i(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var l=i(e),s=i(t);function c(){return c=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e},c.apply(this,arguments)}const p={position:"absolute",top:0,left:0,right:0,bottom:0},u=t.css(["position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none;"]),d=s.default.svg.withConfig({displayName:"frame__DropTargetSVG",componentId:"sc-1cagagv-0"})([""," z-index:",";"],u,(e=>{let{active:t}=e;return t?1:-1})),g=s.default.svg.withConfig({displayName:"frame__Filler",componentId:"sc-1cagagv-1"})(["",""],u),f=s.default.path.withConfig({displayName:"frame__FillerPath",componentId:"sc-1cagagv-2"})(["pointer-events:all;"]),h=s.default.path.withConfig({displayName:"frame__DropTargetPath",componentId:"sc-1cagagv-3"})(["transition:opacity 0.5s;pointer-events:visibleStroke;opacity:",";stroke:",";"],(e=>{let{active:t}=e;return t?.3:0}),(e=>{let{theme:t}=e;return t.colors.border.selection})),m=s.default.div.withConfig({displayName:"frame__Wrapper",componentId:"sc-1cagagv-4"})(["width:100%;height:100%;::before{transition:opacity 0.5s;opacity:",";display:block;content:'';position:absolute;width:calc(100% + 8px);height:calc(100% + 8px);border-radius:8px;left:-4px;top:-4px;border:1px solid ",";}"],(e=>{let{hasBackgroundOutline:t}=e;return t?1:0}),(e=>{let{theme:t}=e;return t.colors.border.selection}));function WithDropTarget(e){let{element:t,children:o,hover:a,draggingResource:i,activeDropTargetId:s,isDropSource:p,registerDropTarget:u,unregisterDropTarget:g}=e;const f=r.useRef(null),{id:v,resource:y,isBackground:E}=t,k=n.getElementMask(t);if(r.useEffect((()=>(u(v,f.current),()=>{g(v)})),[v,u,g]),!k)return o;const D=a&&!i||Boolean(i)&&p(i.type)&&i!==y,T=D&&!E,b=D&&E,w={vectorEffect:"non-scaling-stroke",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",d:k?.path};return l.default.createElement(m,{hasBackgroundOutline:b},o,l.default.createElement(d,{viewBox:"0 0 1 "+1/k.ratio,width:"100%",height:"100%",preserveAspectRatio:"none",active:s===t.id},l.default.createElement(h,c({},w,{strokeWidth:"3",style:{opacity:T?1:0}})),l.default.createElement(h,c({ref:f,strokeWidth:"48"},w))))}const v=r.forwardRef(((e,t)=>{let{element:i,fill:s,style:u,children:d,flip:h,draggingResource:m,activeDropTargetId:v,isDropSource:y,registerDropTarget:E,unregisterDropTarget:k,...D}=e;const[T,b]=r.useState(!1),{isBackground:w}=i,x={draggingResource:m,activeDropTargetId:v,isDropSource:y,registerDropTarget:E,unregisterDropTarget:k},_=n.getElementMask(i),B=h?{transform:o.getTransformFlip(h)}:null;if(!_?.type||w&&_.type!==a.MaskTypes.RECTANGLE)return l.default.createElement("div",c({style:{...s?p:{},...u,...B}},D),d);const I=`mask-${_.type}-${i.id}-frame`;return l.default.createElement("div",c({ref:t,style:{...s?p:{},...u,...B,...w?{}:{clipPath:`url(#${I})`}}},D,{onPointerOver:()=>b(!0),onPointerOut:()=>b(!1)}),l.default.createElement("svg",{width:0,height:0},l.default.createElement("defs",null,l.default.createElement("clipPath",{id:I,transform:`scale(1 ${_.ratio})`,clipPathUnits:"objectBoundingBox"},l.default.createElement("path",{d:_.path})))),l.default.createElement(g,{viewBox:"0 0 1 "+1/_.ratio,width:"100%",height:"100%",preserveAspectRatio:"none"},l.default.createElement(f,{fill:"none",d:_?.path})),l.default.createElement(WithDropTarget,c({element:i,hover:T},x,D),d))}));module.exports=v;
