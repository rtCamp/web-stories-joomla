/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

import t from"./getMediaSizePositionProps.js";import e from"./preloadVideo.js";import a from"./seekVideo.js";async function o(o,i,r,s){const{width:n,height:c,scale:l,focalX:h,focalY:f,flip:d}=o,{src:m,length:g}=i,w=s,p=w/c*n,u=Math.ceil(r/p),v=r/u,z=v/p*n,{width:j,height:P,offsetX:x,offsetY:y}=t(i,z,c,l,d?.horizontal?100-h:h,d?.vertical?100-f:f),M=g/(u-1),V=await e(m);V.width=j,V.height=P,await a(V,1e-6);const X=document.createElement("canvas");X.width=r,X.height=s;const Y=X.getContext("2d");let k=0,C=0;const D=async()=>{await a(V,k);const t=C*v;return(d.vertical||d.horizontal)&&(Y.translate(t+v/2,w/2),Y.scale(d.horizontal?-1:1,d.vertical?-1:1),Y.translate(-(t+v/2),-w/2)),Y.drawImage(V,x,y,z,c,t,0,v,w),Y.setTransform(1,0,0,1,0,0),C+=1,C===u?Promise.resolve():(k+=M,D())};return D().then((()=>X.toDataURL()))}export{o as default};
