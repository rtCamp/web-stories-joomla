/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

import e from"react";import"prop-types";import{generatePatternStyles as t}from"@googleforcreators/patterns";import{PAGE_WIDTH as a,PAGE_HEIGHT as r}from"@googleforcreators/units";import{StoryAnimation as o}from"@googleforcreators/animation";import{isElementBelowLimit as l,ELEMENT_TYPES as n}from"@googleforcreators/elements";import{DEFAULT_AUTO_ADVANCE as i,DEFAULT_PAGE_DURATION as m}from"./constants.js";import s from"./element.js";import c from"./utils/backgroundAudio.js";import p from"./utils/getTextElementTagNames.js";import u from"./utils/getAutoAdvanceAfter.js";import g from"./utils/outlink.js";import d from"./utils/shoppingAttachment.js";const f=`${a}:${r}`;function OutputPage(a){let{page:r,autoAdvance:y=i,defaultPageDuration:E=m,flags:v}=a;const{id:h,animations:k,elements:b,backgroundColor:A,backgroundAudio:N={},pageAttachment:j={}}=r,[P,...x]=b,C=P?.resource?.baseColor,D=C?{backgroundColor:C}:{backgroundColor:"white",...t(A)},O=y?u({animations:k,elements:b,defaultPageDuration:E,backgroundAudio:N,id:h}):void 0,$=p(x.filter((e=>{let{type:t}=e;return"text"===t}))),T=x.map((e=>{const{id:t,type:a,tagName:r="auto"}=e;return"text"===a&&"auto"===r&&(e.tagName=$.get(t)),j?.url&&l(e)&&delete e.link,e})),I=b.filter((e=>{let{type:t}=e;return t===n.PRODUCT})).map((e=>{let{product:t}=e;return t})).filter(Boolean),w=b.filter((e=>{let{type:t,tracks:a}=e;return t===n.VIDEO&&a?.length>0})).map((e=>{let{id:t}=e;return`el-${t}-captions`})),B=N.resource?.src,M=N.tracks?.length>0,R=!1===N.loop&&N.resource?.length,U=M||R;return B&&M&&w.push(`el-${h}-captions`),e.createElement("amp-story-page",{id:h,"auto-advance-after":O,"background-audio":B&&!U?B:void 0},e.createElement(o.Provider,{animations:k,elements:b},e.createElement(o.AMPAnimations,null),P&&e.createElement("amp-story-grid-layer",{template:"vertical","aspect-ratio":f,class:"grid-layer"},e.createElement("div",{className:"page-fullbleed-area",style:D},e.createElement("div",{className:"page-safe-area"},e.createElement(s,{element:P}),P.overlay&&e.createElement("div",{className:"page-background-overlay-area",style:t(P.overlay)})))),e.createElement("amp-story-grid-layer",{template:"vertical","aspect-ratio":f,class:"grid-layer"},e.createElement("div",{className:"page-fullbleed-area"},e.createElement("div",{className:"page-safe-area"},T.map((t=>e.createElement(s,{key:t.id,element:t}))))))),B&&U&&e.createElement(c,{backgroundAudio:N,id:h}),w.length>0&&e.createElement("amp-story-grid-layer",{template:"vertical","aspect-ratio":f,class:"grid-layer align-bottom"},e.createElement("div",{className:"captions-area"},w.map((t=>e.createElement("amp-story-captions",{key:t,id:t,layout:"fixed-height",height:"100"}))))),j?.url&&e.createElement(g,j),I.length>0&&v?.shoppingIntegration&&e.createElement(d,{products:I,theme:j.theme}))}export{OutputPage as default};
