/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

"use strict";var e=require("react");require("prop-types");var t=require("@googleforcreators/patterns"),a=require("@googleforcreators/units"),r=require("@googleforcreators/animation"),l=require("@googleforcreators/elements"),o=require("./constants.js"),n=require("./element.js"),i=require("./utils/backgroundAudio.js"),u=require("./utils/getTextElementTagNames.js"),s=require("./utils/getAutoAdvanceAfter.js"),c=require("./utils/outlink.js"),d=require("./utils/shoppingAttachment.js");function m(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var g=m(e);const p=`${a.PAGE_WIDTH}:${a.PAGE_HEIGHT}`;module.exports=function OutputPage(e){let{page:a,autoAdvance:m=o.DEFAULT_AUTO_ADVANCE,defaultPageDuration:f=o.DEFAULT_PAGE_DURATION,flags:E}=e;const{id:y,animations:A,elements:v,backgroundColor:h,backgroundAudio:k={},pageAttachment:b={}}=a,[q,...N]=v,P=q?.resource?.baseColor,T=P?{backgroundColor:P}:{backgroundColor:"white",...t.generatePatternStyles(h)},D=m?s({animations:A,elements:v,defaultPageDuration:f,backgroundAudio:k,id:y}):void 0,j=u(N.filter((e=>{let{type:t}=e;return"text"===t}))),_=N.map((e=>{const{id:t,type:a,tagName:r="auto"}=e;return"text"===a&&"auto"===r&&(e.tagName=j.get(t)),b?.url&&l.isElementBelowLimit(e)&&delete e.link,e})),C=v.filter((e=>{let{type:t}=e;return t===l.ELEMENT_TYPES.PRODUCT})).map((e=>{let{product:t}=e;return t})).filter(Boolean),S=v.filter((e=>{let{type:t,tracks:a}=e;return t===l.ELEMENT_TYPES.VIDEO&&a?.length>0})).map((e=>{let{id:t}=e;return`el-${t}-captions`})),x=k.resource?.src,I=k.tracks?.length>0,L=!1===k.loop&&k.resource?.length,O=I||L;return x&&I&&S.push(`el-${y}-captions`),g.default.createElement("amp-story-page",{id:y,"auto-advance-after":D,"background-audio":x&&!O?x:void 0},g.default.createElement(r.StoryAnimation.Provider,{animations:A,elements:v},g.default.createElement(r.StoryAnimation.AMPAnimations,null),q&&g.default.createElement("amp-story-grid-layer",{template:"vertical","aspect-ratio":p,class:"grid-layer"},g.default.createElement("div",{className:"page-fullbleed-area",style:T},g.default.createElement("div",{className:"page-safe-area"},g.default.createElement(n,{element:q}),q.overlay&&g.default.createElement("div",{className:"page-background-overlay-area",style:t.generatePatternStyles(q.overlay)})))),g.default.createElement("amp-story-grid-layer",{template:"vertical","aspect-ratio":p,class:"grid-layer"},g.default.createElement("div",{className:"page-fullbleed-area"},g.default.createElement("div",{className:"page-safe-area"},_.map((e=>g.default.createElement(n,{key:e.id,element:e}))))))),x&&O&&g.default.createElement(i,{backgroundAudio:k,id:y}),S.length>0&&g.default.createElement("amp-story-grid-layer",{template:"vertical","aspect-ratio":p,class:"grid-layer align-bottom"},g.default.createElement("div",{className:"captions-area"},S.map((e=>g.default.createElement("amp-story-captions",{key:e,id:e,layout:"fixed-height",height:"100"}))))),b?.url&&g.default.createElement(c,b),C.length>0&&E?.shoppingIntegration&&g.default.createElement(d,{products:C,theme:b.theme}))};
