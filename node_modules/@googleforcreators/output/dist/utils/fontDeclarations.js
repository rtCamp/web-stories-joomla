/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

"use strict";var e=require("react");require("prop-types");var t=require("@googleforcreators/fonts"),r=require("@googleforcreators/rich-text");function o(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}require("@googleforcreators/elements");var n=o(e);const s=(e,t)=>e.some((e=>e[0]===t[0]&&e[1]===t[1])),a=(e,t)=>Math.abs(e[0]+e[1]-t[0]-t[1]),l=(e,t)=>e.reduce(((e,r)=>a(r,t)<a(e,t)?r:e));module.exports=function FontDeclarations(e){let{pages:o}=e;const a=new Map;for(const{elements:e}of o){const t=e.filter((e=>{let{type:t}=e;return"text"===t}));for(const{font:e,content:o}of t){const{service:t,family:n,variants:u=[],url:c}=e;if(!t||"system"===t)continue;const f=a.get(t)||new Map;a.set(t,f);const i=f.get(n)||{family:n,variants:[],url:c},m=r.getFontVariants(o);if(u.length>0)for(const e of m){const t=l(u,e),r=s(i.variants,t),o=s(u,t);!r&&o&&i.variants.push(t)}f.set(n,i)}}return n.default.createElement(n.default.Fragment,null,Array.from(a.keys()).map((e=>{const r=a.get(e);switch(e){case"fonts.google.com":return n.default.createElement("link",{key:e,href:t.getGoogleFontURL(Array.from(r.values())),rel:"stylesheet"});case"custom":return Array.from(r.values()).map((e=>{let{family:r,url:o}=e;const s=t.getFontCSS(r,o);return n.default.createElement("style",{key:r,dangerouslySetInnerHTML:{__html:s}})}));default:return null}})))};
