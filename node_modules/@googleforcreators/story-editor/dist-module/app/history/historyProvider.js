/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

import r from"react";import"prop-types";import{useState as e,useRef as o,useEffect as t,useCallback as s}from"@googleforcreators/react";import{useGlobalKeyDownEffect as i}from"@googleforcreators/design-system";import n from"../../utils/usePreventWindowUnload.js";import a from"./useHistoryReducer.js";import d from"./context.js";function HistoryProvider(c){let{children:u,size:m}=c;const{requestedState:y,stateToHistory:l,clearHistory:f,currentEntry:p,offset:g,historyLength:h,undo:v,redo:H,versionNumber:P}=a(m),[N,j]=e(!1),w=n(),E=o(1);t((()=>(w("history",N),()=>w("history",!1))),[w,N]),t((()=>{j(P!==E.current)}),[P]);const b=s((()=>{E.current=P,j(!1)}),[P]),k={state:{currentEntry:p,hasNewChanges:N,requestedState:y,canUndo:g<h-1,canRedo:g>0,versionNumber:P},actions:{stateToHistory:l,clearHistory:f,resetNewChanges:b,undo:v,redo:H}};return i({key:"undo",dialog:!0},(()=>v()),[v]),i({key:"redo",dialog:!0},(()=>H()),[H]),r.createElement(d.Provider,{value:k},u)}HistoryProvider.defaultProps={size:50};export{HistoryProvider as default};
