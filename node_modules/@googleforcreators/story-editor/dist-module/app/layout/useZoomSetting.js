/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

import{useReduction as e,useMemo as t}from"@googleforcreators/react";import{PAGE_WIDTH as o,FULLBLEED_RATIO as a,PAGE_RATIO as l}from"@googleforcreators/units";import{themeHelpers as i}from"@googleforcreators/design-system";import{ZOOM_SETTING as r,PAGE_WIDTH_FACTOR as s,PAGE_NAV_WIDTH as n}from"../../constants/index.js";const c={zoomSetting:r.FIT,zoomLevel:null,workspaceSize:{width:null,height:null,availableHeight:null},scrollOffset:{left:0,top:0}},h={setZoomSetting:(e,t)=>{let{payload:o}=t;return{...e,zoomSetting:o,scrollOffset:{left:0,top:0}}},setZoomLevel:(e,t)=>{let{payload:o}=t;return{...e,zoomLevel:o,zoomSetting:r.FIXED}},setScrollOffset:(e,t)=>{let{payload:o}=t;return{...e,scrollOffset:o}},setWorkspaceSize:(e,t)=>{let{payload:o}=t;return{...e,workspaceSize:o}}};function g(){const[g,f]=e(c,h),{zoomSetting:p,zoomLevel:d,workspaceSize:m,scrollOffset:w}=g,u=t((()=>function(e,t,c){let h;const g=e.width/e.availableHeight;switch(t){case r.FILL:h=g>a?e.width-i.SCROLLBAR_WIDTH-72:(e.availableHeight-i.SCROLLBAR_WIDTH)*a-72;break;case r.FIT:{const t=e.width-144;h=g>a?Math.min(t,(e.availableHeight-72)*a):t;break}default:if(isNaN(c))break;h=c*o}h=Math.max(0,h);const f=s*Math.floor(h/s),p=f/l,d=f/a,m=f>=e.width-72-2*s,w=p>=e.availableHeight-72-2*s,u=m||w,v=u?72:12;return{pageWidth:f,pageHeight:p,hasHorizontalOverflow:m,hasVerticalOverflow:w,hasPageNavigation:!u&&f<e.width-2*n,pagePadding:v,viewportWidth:u?e.width:f+v,viewportHeight:u?e.availableHeight:d+v}}(m,p,d)),[m,p,d]),{pageWidth:v}=u,z=t((()=>{const e=Math.ceil(v/s*s);switch(p){case r.FILL:case r.FIT:return e/o;default:return d}}),[d,v,p]);return{state:{...u,zoomSetting:p,zoomLevel:z,workspaceWidth:m.width,workspaceHeight:m.height,scrollLeft:w.left,scrollTop:w.top},actions:f}}export{g as default};
