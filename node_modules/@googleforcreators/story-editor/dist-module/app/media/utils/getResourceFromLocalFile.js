/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

import{getTypeFromMime as t,getResourceSize as e,createResource as a,getFileName as i,createFileReader as o,createBlob as r,getImageDimensions as s,preloadVideo as n,getVideoLength as m,seekVideo as p,hasVideoGotAudio as l,blobToFile as c,getImageFromVideo as h}from"@googleforcreators/media";import{v4 as y}from"uuid";import"../../../constants/fonts.js";import{MEDIA_POSTER_IMAGE_MIME_TYPE as d}from"../../../constants/media.js";import"../../../constants/multipleValue.js";import g from"./getPosterName.js";const w=o=>{const r=i(o),s=t(o.type);return n={type:s||"image",mimeType:"image"===s?"image/png":"video/mp4",src:"",...e({}),alt:r},a({...n,isPlaceholder:!0});var n},u=async u=>{const f=t(u.type);let F=w(u),j=null;try{if("image"===f&&(F=await(async t=>{const n=i(t),m=t.type,p=await o(t),l=r(new window.Blob([p.result],{type:m})),{width:c,height:h}=await s(l);return a({type:"image",mimeType:m,src:l,...e({width:c,height:h}),alt:n})})(u)),"video"===f){const t=await(async t=>{const y=i(t),w=t.type,u=await o(t),f=r(new Blob([u.result],{type:w})),F=await n(f),j=""!==F.canPlayType(w),{length:v,lengthFormatted:T}=m(F);await p(F);const P=l(F),b=c(await h(F),g(i(t)),d),B=r(b),{width:x,height:M}=await s(B);return{resource:a({type:"video",mimeType:w,src:j?f:"",...e({width:x,height:M}),poster:B,isMuted:!P,length:v,lengthFormatted:T,alt:y}),posterFile:b}})(u);F=t.resource,j=t.posterFile}}catch{}return F.id=y(),{resource:F,posterFile:j}};export{u as default};
