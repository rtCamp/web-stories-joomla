/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

import r from"clone-deep";import{useRef as e,useEffect as t}from"@googleforcreators/react";import"../../history/historyProvider.js";import s from"../../history/useHistory.js";import o from"../utils/deleteNestedKeys.js";const i=["resource.baseColor","resource.blurHash","resource.id","resource.isMuted","resource.posterId","resource.poster"];function c(c){let{story:n,current:u,pages:a,selection:l,capabilities:p}=c;const{state:{currentEntry:y},actions:{stateToHistory:f}}=s(),g=e();t((()=>{y&&(g.current=r(y))}),[y]);const m=e(),d=e();t((()=>{m.current=u,d.current=l}),[u,l]);const h=e=>r(e).map((r=>(r.elements.forEach(o(i)),r)));t((()=>{let r=!1;if(i.length&&g.current&&a?.length){const e={story:n,capabilities:p};if(Object.keys(e).every((r=>JSON.stringify(e[r])===JSON.stringify(g.current[r])))){const e=h(a),t=h(g.current.pages);r=JSON.stringify(e)===JSON.stringify(t)}}r||f({story:n,current:m.current,selection:d.current,pages:a,capabilities:p})}),[n,a,f,p])}export{c as default};
