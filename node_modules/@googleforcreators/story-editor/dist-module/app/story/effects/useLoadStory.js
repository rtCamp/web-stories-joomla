/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

import{useEffect as t}from"@googleforcreators/react";import{migrate as o}from"@googleforcreators/migration";import{createPage as e}from"@googleforcreators/elements";import"react";import"prop-types";import"@googleforcreators/templates";import"../../config/context.js";import"../../api/context.js";import r from"../../api/useAPI.js";import"../../history/historyProvider.js";import s from"../../history/useHistory.js";import i from"../../../utils/getUniquePresets.js";function a(t,r,s,a){const{title:{raw:l=""}={},status:n,slug:p,date:u,modified:c,excerpt:{raw:d=""}={},link:m,storyData:g,permalinkTemplate:f,stylePresets:y={},password:x,previewLink:S,editLink:h,embedPostLink:k,author:b,capabilities:L={publish:!1,"assign-author":!1},extras:v={},featuredMedia:P,publisherLogo:j,taxonomies:w,terms:A}=r,[I,D]=f?f.split(/%(?:postname|pagename)%/):[],H=void 0!==I&&void 0!==D?{prefix:I,suffix:D}:null,M="auto-draft"===n?"draft":n;a();const q=g&&o(g,g.version||0),B=q?.pages?.length>0?q.pages:[e()];y.colors?y.colors=i(y.colors):y.colors=[],y.textStyles?y.textStyles=i(y.textStyles):y.textStyles=[];s({pages:B,story:{storyId:t,title:l,status:M,author:b,date:u,modified:c,excerpt:d,slug:p,link:m,extras:v,featuredMedia:P,permalinkConfig:H,publisherLogo:j,password:x,previewLink:S,editLink:h,embedPostLink:k,currentStoryStyles:{colors:q?.currentStoryStyles?.colors?i(q.currentStoryStyles.colors):[]},globalStoryStyles:y,autoAdvance:q?.autoAdvance,defaultPageDuration:q?.defaultPageDuration,backgroundAudio:q?.backgroundAudio,taxonomies:w,terms:A},selection:[],current:null,capabilities:L})}function l(o){let{storyId:e,story:i,shouldLoad:l,restore:n}=o;const{actions:{getStoryById:p}}=r(),{actions:{clearHistory:u}}=s();t((()=>{e&&l&&(i?a(e,i,n,u):p(e).then((t=>{a(e,t,n,u)})))}),[e,i,l,n,p,u])}export{l as default};
