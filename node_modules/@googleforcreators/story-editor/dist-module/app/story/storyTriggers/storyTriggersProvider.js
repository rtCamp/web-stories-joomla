/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

import r from"react";import{createContext as e,useReducer as t,useMemo as o,useEffect as n,useCallback as s}from"@googleforcreators/react";import"prop-types";import{StoryEventRegisters as c}from"./storyEvents/index.js";import{STORY_EVENTS as i}from"./storyEvents/types.js";const a=e({state:{},actions:{}});function m(){return Object.values(i).reduce(((r,e)=>({...r,[e]:new Map})),{})}function l(r,e){let[t]=r;return[e,t]}function StoryTriggersProvider(e){let{children:i,story:p}=e;const[[u,y],f]=t(l,[p,null]),v=o(m,[]);n((()=>f(p)),[p]);const d=s(((r,e)=>{const t=Symbol();return v[r].set(t,e),()=>v[r].delete(t)}),[v]),g=s((r=>{v[r]?.forEach((r=>r(u)))}),[v,u]),E=o((()=>[d,g]),[d,g]);return r.createElement(a.Provider,{value:E},r.createElement(r.Fragment,null,c.map((e=>r.createElement(e,{key:e.name,currentStory:u,previousStory:y,dispatchStoryEvent:g}))),i))}export{a as Context,StoryTriggersProvider};
