/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

import e from"../../../../utils/objectWithout.js";import{moveArrayElement as t,removeAnimationsWithElementIds as n}from"./utils.js";function i(i,s){let{elementId:l}=s;const o=i.pages.findIndex((e=>{let{id:t}=e;return t===i.current})),c=i.pages[o],a=c.elements[0];let r,d=i.selection;if(null===l){if(a.isDefaultBackground)return i;const t=c.defaultBackgroundElement,n=c.elements.map((t=>t.isBackground?e(t,["isBackground"]):t));r={...c,elements:[t,...n]},d=[t.id]}else{const e=c.elements.findIndex((e=>{let{id:t}=e;return t===l})),n=0===e;if(!(-1!==e)||n)return i;const s=a.isDefaultBackground?a:c.defaultBackgroundElement,o=c.elements.slice(1),u=e-1;i.selection.includes(a.id)&&(d=i.selection.filter((e=>e!==a.id)));const m=t(o,u,0).map((e=>e.id===l?{...e,isBackground:!0,...Object.prototype.hasOwnProperty.call(e,"opacity")&&{opacity:100}}:e));i.selection.includes(l)&&i.selection.length>1&&(d=i.selection.filter((e=>e!==l))),r={...c,defaultBackgroundElement:s,elements:m}}const u=c.elements.find((e=>e.isBackground)),m=n(c.animations,[l,u.id]),f=[...i.pages.slice(0,o),{...r,animations:m||[]},...i.pages.slice(o+1)];return{...i,pages:f,selection:d}}export{i as default};
