/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

import{STORY_ANIMATION_STATE as e}from"@googleforcreators/animation";import{intersect as t,updateElementWithUpdater as n,updateAnimations as i}from"./utils.js";function r(r,s){let{elementIds:a,properties:o}=s;if([e.PLAYING,e.PLAYING_SELECTED,e.SCRUBBING].includes(r.animationState))return r;const l=null===a?r.selection:a;if(0===l.length)return r;const u=r.pages.findIndex((e=>{let{id:t}=e;return t===r.current})),c=r.pages[u],m=c.elements.map((e=>{let{id:t}=e;return t}));if(!(t(m,l).length>0))return r;const d=c.elements.reduce(((e,t)=>{if(!l.includes(t.id))return e;const{animation:i,...r}=n(t,o),s=i?{[i.id]:{...i,targets:[r.id]}}:{};return{...e,...s}}),{}),f=c.elements.reduce(((e,t)=>{if(!l.includes(t.id))return[...e,t];const{animation:i,...r}=n(t,o);return[...e,r]}),[]),g=Object.keys(d).length>0,p=g?i(c.animations||[],d):c.animations,I=p&&{animations:p},h={elements:f},E={...c,...g?I:h},G=[...r.pages.slice(0,u),E,...r.pages.slice(u+1)];return{...r,pages:G}}export{r as default};
