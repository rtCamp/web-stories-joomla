/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

import{useMemo as o,useCallback as e}from"@googleforcreators/react";import{__,sprintf,translateToExclusiveList as t}from"@googleforcreators/i18n";import{getExtensionsFromMimeType as r,getFileName as i}from"@googleforcreators/media";import"react";import"prop-types";import"@googleforcreators/templates";import"../config/context.js";import s from"../config/useConfig.js";import"../api/context.js";import a from"../api/useAPI.js";import l from"../../utils/createError.js";import"../../constants/fonts.js";import{MEDIA_TRANSCODING_MAX_FILE_SIZE as n}from"../../constants/media.js";import"../../constants/multipleValue.js";const p=o=>Math.round(o/Math.pow(1024,2));function m(){const{actions:{uploadMedia:m}}=a(),{storyId:c,maxUpload:d,allowedMimeTypes:{image:f,vector:u,video:g},capabilities:{hasUploadMediaAction:h}}=s(),w=o((()=>[...f,...u,...g]),[f,u,g]),y=o((()=>w.map((o=>r(o))).flat()),[w]),M=e((o=>{let{type:e}=o;return w.includes(e)}),[w]),j=e((o=>{let{size:e}=o;return e<=d}),[d]),b=e(((o,e,r)=>{if(!h){const e=__("Sorry, you are not allowed to upload files.","web-stories");throw l("PermissionError",o.name,e)}if(e){if(r){const e=sprintf(
/* translators: 1: File size in MB. 2: Maximum allowed file size in MB. */
__("Your file is too large (%1$s MB) and cannot be processed. Please try again with a file that is smaller than %2$s MB.","web-stories"),p(o.size),p(n));throw l("SizeError",o.name,e)}}else{if(!j(o)){const e=sprintf(
/* translators: first %s is the file size in MB and second %s is the upload file limit in MB */
__("Your file is %1$sMB and the upload limit is %2$sMB. Please resize and try again!","web-stories"),p(o.size),p(d));throw l("SizeError",o.name,e)}if(!M(o)){let e=__("No file types are currently supported.","web-stories");throw y.length&&(
/* translators: %s is a list of allowed file extensions. */
e=sprintf(
/* translators: %s: list of allowed file types. */
__("Please choose only %s to upload.","web-stories"),t(y))),l("ValidError",o.name,e)}}}),[h,j,d,y,M]),z=e((function(o){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};b(o);const t={storyId:c,altText:i(o),mediaSource:"editor",...e};return m(o,t)}),[b,m,c]);return o((()=>({actions:{uploadFile:z,validateFileForUpload:b}})),[b,z])}export{m as default};
