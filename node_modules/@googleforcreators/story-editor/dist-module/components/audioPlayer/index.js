/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

import e from"react";import"prop-types";import t,{css as r}from"styled-components";import{useState as o,useRef as a,useCallback as n,useEffect as i}from"@googleforcreators/react";import{Button as l,themeHelpers as s,THEME_CONSTANTS as c,BUTTON_TYPES as p,BUTTON_SIZES as m,BUTTON_VARIANTS as d,Icons as u}from"@googleforcreators/design-system";import{__}from"@googleforcreators/i18n";import"@googleforcreators/media";import{Z_INDEX_STORY_DETAILS as y}from"../../constants/zIndex.js";import f from"../tooltip/tooltip.js";import g from"../../utils/useCORSProxy.js";const E=t(l).withConfig({displayName:"audioPlayer__StyledButton",componentId:"sc-cot87i-0"})(["",";"],(e=>{let{theme:t}=e;return s.focusableOutlineCSS(t.colors.border.focus,t.colors.bg.secondary)})),h=t.div.withConfig({displayName:"audioPlayer__Wrapper",componentId:"sc-cot87i-1"})((e=>{let{theme:t}=e;return r(["position:relative;min-width:40px;width:100%;height:36px;display:flex;align-items:center;justify-content:space-between;color:",";",";"],t.colors.fg.primary,s.expandPresetStyles({preset:{...t.typography.presets.paragraph[c.TYPOGRAPHY.PRESET_SIZES.SMALL]},theme:t}))})),v=t.audio.withConfig({displayName:"audioPlayer__Audio",componentId:"sc-cot87i-2"})(["display:none;"]);function AudioPlayer(t){let{title:r,src:l,mimeType:s,tracks:c=[],audioId:P,loop:S}=t;const[L,x]=o(!1),b=a(),{getProxiedUrl:k}=g(),A=n((()=>{const e=b.current;e&&(L?e.pause():e.play().catch((()=>{})))}),[L]);i((()=>{const e=b.current;if(!e)return;const t=()=>x(!0),r=()=>x(!1),o=()=>{e.currentTime=0,x(!1)};return e.addEventListener("play",t),e.addEventListener("pause",r),e.addEventListener("ended",o),()=>{e.removeEventListener("play",t),e.removeEventListener("pause",r),e.removeEventListener("ended",o)}}),[b]);const I=__(L?"Pause":"Play","web-stories"),w=c.map((e=>{const t=k(e,e?.track);return{...e,track:t}}));return e.createElement(h,null,e.createElement(v,{crossOrigin:"anonymous",loop:S,ref:b,id:P},e.createElement("source",{src:l,type:s}),w&&w.map(((t,r)=>{let{srclang:o,label:a,track:n,id:i}=t;return e.createElement("track",{srcLang:o,label:a,kind:"metadata",src:n,key:i,default:0===r})}))),e.createElement("div",null,r),e.createElement(f,{hasTail:!0,title:I,popupZIndexOverride:y},e.createElement(E,{type:p.TERTIARY,size:m.SMALL,variant:d.SQUARE,"aria-label":I,onClick:A},L?e.createElement(u.StopFilled,null):e.createElement(u.PlayFilled,null))))}export{AudioPlayer as default};
