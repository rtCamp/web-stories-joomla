/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

import e from"react";import"prop-types";import t from"styled-components";import{memo as o,useRef as r,useState as i,useEffect as s,useCallback as a}from"@googleforcreators/react";import{_x,__}from"@googleforcreators/i18n";import{useKeyDownEffect as p}from"@googleforcreators/design-system";import{withOverlay as n}from"@googleforcreators/moveable";import{getDefinitionForType as m}from"@googleforcreators/elements";import"../../types.js";import"@googleforcreators/transform";import"../dropTargets/provider.js";import"../dropTargets/context.js";import"../../app/history/historyProvider.js";import"../../app/history/context.js";import"@googleforcreators/templates";import"../../app/config/context.js";import"../../app/api/context.js";import"@googleforcreators/fonts";import"@googleforcreators/dom";import"../../constants/fonts.js";import"../../constants/multipleValue.js";import"../../app/font/context.js";import"@googleforcreators/media";import"@googleforcreators/tracking";import"@googleforcreators/animation";import"uuid";import"@googleforcreators/masks";import"@googleforcreators/element-library";import"../../app/story/context.js";import"@googleforcreators/migration";import"../../app/story/actions/useSaveStory.js";import"clone-deep";import"../../app/story/useStoryReducer/useStoryReducer.js";import"@googleforcreators/output";import"../../app/story/storyTriggers/storyTriggersProvider.js";import"../../app/story/storyTriggers/storyEvents/onInitialElementAddedRegister.js";import"../../app/story/storyTriggers/storyEvents/onPageAddedRegister.js";import l from"../../app/story/useStory.js";import"../../app/media/useUploadMedia.js";import"@googleforcreators/patterns";import"../../utils/generateBlurhash.worker.js";import"../../app/media/media3p/providerConfiguration.js";import"../../app/media/utils/useFFmpeg.js";import"../../app/media/media3p/api/context.js";import"../../app/media/local/constants.js";import"../../app/media/media3p/providerReducer.js";import"../../app/media/context.js";import"sat";import"@googleforcreators/units";import"../../app/layout/context.js";import"../../app/layout/useZoomSetting.js";import"@googleforcreators/rich-text";import c from"./useFocusCanvas.js";import"@googleforcreators/stickers";import"../library/panes/text/textPresets.js";import"../../app/canvas/context.js";import d from"../../app/canvas/useCanvas.js";import"../../app/currentUser/context.js";import"../../app/helpCenter/provider.js";import"../../app/helpCenter/context.js";import"../helpCenter/constants.js";import"../../app/rightClickMenu/context.js";import{Z_INDEX_EDIT_LAYER as g}from"../../constants/zIndex.js";import u from"../videoTrim/useVideoTrim.js";import f from"../videoTrim/videoTrimmer.js";import y from"./editElement.js";import{Layer as j,PageArea as v,FooterArea as E}from"./layout.js";import h from"./singleSelectionMoveable/index.js";const w=n(t(j).withConfig({displayName:"editLayer__LayerWithGrayout",componentId:"sc-1j9iuj3-0"})(["background-color:",";"],(e=>{let{grayout:t,theme:o}=e;return t?o.colors.opacity.overlayDark:"transparent"}))),x=n(v);function EditLayerForElement(t){let{element:o,showOverflow:n}=t;const l=r(null),j=r(null),{editModeGrayout:v}=m(o.type),{isTrimMode:b}=u((e=>{let{state:{isTrimMode:t}}=e;return{isTrimMode:t}})),{clearEditing:M,onMoveableMount:T}=d((e=>({clearEditing:e.actions.clearEditing,onMoveableMount:e.state.onMoveableMount}))),C=c(),[k,P]=i(null);p(l,{key:"esc",editable:!0},(()=>M()),[M]),s((()=>()=>C(!1)),[C]);const S=r(null),L=a((e=>{S.current=e,T?.(e)}),[T]),O=a((()=>{S.current&&S.current.updateRect()}),[]),{hasEditModeMoveable:R}=m(o.type);return e.createElement(w,{ref:l,"aria-label":_x("Edit layer","compound noun","web-stories"),"data-testid":"editLayer",grayout:v,zIndex:g,onPointerDown:e=>{e.target!==l.current&&e.target!==j.current||M()}},e.createElement(x,{ref:j,fullBleedContainerLabel:__("Fullbleed area (Edit layer)","web-stories"),isControlled:!0,showOverflow:n,overflow:n?"visible":"hidden"},e.createElement(y,{editWrapper:R&&k,onResize:O,element:o,ref:P})),R&&k&&e.createElement(h,{selectedElement:o,targetEl:k,isEditMode:!0,ref:L}),b&&e.createElement(E,{showOverflow:!0},e.createElement(f,null)))}var b=o((function EditLayer(){const{currentPage:t}=l((e=>({currentPage:e.state.currentPage}))),{editingElement:o,showOverflow:r=!0}=d((e=>{let{state:{editingElement:t,editingElementState:{showOverflow:o}={}}}=e;return{editingElement:t,showOverflow:o}})),i=o&&t&&t.elements.find((e=>e.id===o));return i?e.createElement(EditLayerForElement,{element:i,showOverflow:r}):null}));export{b as default};
