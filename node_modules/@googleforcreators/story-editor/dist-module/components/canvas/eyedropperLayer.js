/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

import e from"react";import{useRef as r,useFocusOut as t}from"@googleforcreators/react";import o from"styled-components";import{rgba as p,readableColor as a}from"polished";import{FULLBLEED_RATIO as i}from"@googleforcreators/units";import{useGlobalKeyDownEffect as n,CircularProgress as s}from"@googleforcreators/design-system";import"@googleforcreators/transform";import"../dropTargets/provider.js";import"../dropTargets/context.js";import"../../app/history/historyProvider.js";import"../../app/history/context.js";import"prop-types";import"@googleforcreators/templates";import"../../app/config/context.js";import"../../app/api/context.js";import"@googleforcreators/fonts";import"@googleforcreators/dom";import"../../constants/fonts.js";import"../../constants/multipleValue.js";import"../../app/font/context.js";import"@googleforcreators/media";import"@googleforcreators/tracking";import"@googleforcreators/animation";import"uuid";import"@googleforcreators/masks";import"@googleforcreators/element-library";import"@googleforcreators/elements";import"../../app/story/context.js";import"@googleforcreators/migration";import"../../app/story/actions/useSaveStory.js";import"clone-deep";import"../../app/story/useStoryReducer/useStoryReducer.js";import"@googleforcreators/output";import"../../app/story/storyTriggers/storyTriggersProvider.js";import"../../app/story/storyTriggers/storyEvents/onInitialElementAddedRegister.js";import"../../app/story/storyTriggers/storyEvents/onPageAddedRegister.js";import"@googleforcreators/i18n";import"../../app/media/useUploadMedia.js";import"@googleforcreators/patterns";import"../../utils/generateBlurhash.worker.js";import"../../app/media/media3p/providerConfiguration.js";import"../../app/media/utils/useFFmpeg.js";import"../../app/media/media3p/api/context.js";import"../../app/media/local/constants.js";import"../../app/media/media3p/providerReducer.js";import"../../app/media/context.js";import"sat";import l from"../../app/layout/useLayout.js";import"../../app/layout/context.js";import"../../app/layout/useZoomSetting.js";import"@googleforcreators/rich-text";import"@googleforcreators/stickers";import"../library/panes/text/textPresets.js";import"../../app/canvas/context.js";import m from"../../app/canvas/useCanvas.js";import"../../app/currentUser/context.js";import"../../app/helpCenter/provider.js";import"../../app/helpCenter/context.js";import"../helpCenter/constants.js";import"../../app/rightClickMenu/context.js";import{Layer as c,PageArea as d}from"./layout.js";import g from"./utils/getColorFromPixelData.js";const y=o(c).withConfig({displayName:"eyedropperLayer__EyedropperBackground",componentId:"sc-nf74gq-0"})(["background:",";cursor:not-allowed;z-index:2;"],(e=>{let{theme:r}=e;return r.colors.opacity.black64})),f=o(d).withConfig({displayName:"eyedropperLayer__DisplayPageArea",componentId:"sc-nf74gq-1"})(["position:absolute;"]),u=o.div.withConfig({displayName:"eyedropperLayer__EyedropperCanvas",componentId:"sc-nf74gq-2"})(["background:transparent;border-radius:5px;position:absolute;z-index:2;transform:translateZ(0);top:0;left:0;bottom:0;right:0;cursor:default;"]),h=o.div.withConfig({displayName:"eyedropperLayer__ColorInfo",componentId:"sc-nf74gq-3"})(["text-transform:uppercase;margin-top:30px;padding:9px;min-width:102px;text-align:center;"]),x=o.div.withConfig({displayName:"eyedropperLayer__Circle",componentId:"sc-nf74gq-4"})(["transform:translateY(20px);background:",";border:2px solid black;border-radius:50%;overflow:hidden;width:","px;height:","px;"],(e=>{let{theme:r}=e;return r.colors.bg.primary}),198,200),j=o.div.withConfig({displayName:"eyedropperLayer__Magnifier",componentId:"sc-nf74gq-5"})(["position:absolute;top:0;left:0;transform:translateY(-2000px);pointer-events:none;"]),E=o.div.withConfig({displayName:"eyedropperLayer__Center",componentId:"sc-nf74gq-6"})(["position:absolute;top:0;left:0;right:0;bottom:0;z-index:3;background:",";cursor:not-allowed;display:flex;justify-content:center;align-items:center;"],(e=>{let{theme:r}=e;return r.colors.opacity.black64})),b=o.img.withConfig({displayName:"eyedropperLayer__CanvasImage",componentId:"sc-nf74gq-7"})(["width:100%;"]);function EyedropperLayer(){const{fullbleedContainer:o,isEyedropperActive:c,eyedropperCallback:d,eyedropperImg:v,eyedropperPixelData:C,setIsEyedropperActive:I,setEyedropperImg:w,setEyedropperPixelData:k}=m((e=>{let{state:{fullbleedContainer:r,isEyedropperActive:t,eyedropperCallback:o,eyedropperImg:p,eyedropperPixelData:a},actions:{setIsEyedropperActive:i,setEyedropperImg:n,setEyedropperPixelData:s}}=e;return{fullbleedContainer:r,isEyedropperActive:t,eyedropperCallback:o,eyedropperImg:p,eyedropperPixelData:a,setIsEyedropperActive:i,setEyedropperImg:n,setEyedropperPixelData:s}})),{pageWidth:_}=l((e=>{let{state:{pageWidth:r}}=e;return{pageWidth:r}})),P=_/i,L=v,D=r(),S=r(),A=r(),M=r(),q=r(),N=()=>{I(!1),w(null),k(null)};if(t(q,N,[c,L]),n("esc",N),c&&!L)return e.createElement(e.Fragment,null,e.createElement(E,{onClick:N},e.createElement(s,null)));if(!c||!L)return null;return e.createElement(y,{"data-testid":"eyedropperLayer",onMouseMove:e=>{const{left:r,top:t,width:i,height:n}=o.getBoundingClientRect(),s=(e.clientX-r)*(_/i),l=(e.clientY-t)*(P/n);if(s<0||l<0||s>i||l>n)return void(A.current.style.display="none");A.current.style.display="block",A.current.style.transform=`translate(${s-100}px, ${l}px)`,function(e,r){const t=S.current;if(t){const o=t.getContext("2d");o.imageSmoothingEnabled=!1,o.mozImageSmoothingEnabled=!1,o.webkitImageSmoothingEnabled=!1,o.msImageSmoothingEnabled=!1,o.clearRect(0,0,200,200),o.drawImage(D.current,Math.round(e-3.5),Math.round(r-3.5),7,7,0,0,200,200),o.beginPath(),o.rect(Math.round(100)-14.285714285714286,Math.round(100)-14.285714285714286,28.571428571428573,28.571428571428573),o.stroke()}}(s,l);const m=g(C,s,l,i),{r:c,g:d,b:y,a:f}=m,u=p(c,d,y,f);M.current.style.background=`rgba(${c},${d},${y},${f})`,M.current.style.color=a(u,"#333","#EDEDED",!1),M.current.innerText=u}},e.createElement(f,{withSafezone:!1,showOverflow:!0},e.createElement(u,{ref:q,onClick:e=>{const{left:r,top:t,width:p,height:a}=o.getBoundingClientRect(),i=(e.clientX-r)*(_/p),n=(e.clientY-t)*(P/a),s=g(C,i,n,_);d(s)}},e.createElement(b,{ref:D,src:L,alt:""}),e.createElement(j,{ref:A},e.createElement(x,null,e.createElement("canvas",{ref:S,width:200,height:200})),e.createElement(h,{ref:M})))))}export{EyedropperLayer as default};
