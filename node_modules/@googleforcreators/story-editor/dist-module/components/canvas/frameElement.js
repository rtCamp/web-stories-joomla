/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

import e from"react";import t from"styled-components";import{sprintf,__}from"@googleforcreators/i18n";import{memo as r,useState as o,useRef as s,useCombinedRefs as i,useLayoutEffect as n,useCallback as a}from"@googleforcreators/react";import{useUnits as p}from"@googleforcreators/units";import{useTransform as m,useTransformHandler as l}from"@googleforcreators/transform";import"prop-types";import{getDefinitionForType as c}from"@googleforcreators/elements";import{elementWithPosition as g,elementWithSize as d,elementWithRotation as u}from"@googleforcreators/element-library";import{FrameWithMask as f}from"@googleforcreators/masks";import{prettifyShortcut as E,useLiveRegion as y,useKeyDownEffect as j}from"@googleforcreators/design-system";import"../dropTargets/provider.js";import v from"../dropTargets/useDropTargets.js";import"../../app/history/historyProvider.js";import"../../app/history/context.js";import"@googleforcreators/templates";import"../../app/config/context.js";import T from"../../app/config/useConfig.js";import"../../app/api/context.js";import"@googleforcreators/fonts";import"@googleforcreators/dom";import"../../constants/fonts.js";import"../../constants/multipleValue.js";import{TRACKING_EVENTS as h}from"../../constants/performanceTrackingEvents.js";import"../../app/font/context.js";import"@googleforcreators/media";import"@googleforcreators/tracking";import"@googleforcreators/animation";import"uuid";import"../../app/story/context.js";import"@googleforcreators/migration";import"../../app/story/actions/useSaveStory.js";import"clone-deep";import"../../app/story/useStoryReducer/useStoryReducer.js";import"@googleforcreators/output";import"../../app/story/storyTriggers/storyTriggersProvider.js";import"../../app/story/storyTriggers/storyEvents/onInitialElementAddedRegister.js";import"../../app/story/storyTriggers/storyEvents/onPageAddedRegister.js";import S from"../../app/story/useStory.js";import"../../app/media/useUploadMedia.js";import"@googleforcreators/patterns";import"../../utils/generateBlurhash.worker.js";import"../../app/media/media3p/providerConfiguration.js";import"../../app/media/utils/useFFmpeg.js";import"../../app/media/media3p/api/context.js";import"../../app/media/local/constants.js";import"../../app/media/media3p/providerReducer.js";import"../../app/media/context.js";import"sat";import"../../app/layout/context.js";import"../../app/layout/useZoomSetting.js";import"@googleforcreators/rich-text";import"@googleforcreators/stickers";import"../library/panes/text/textPresets.js";import"../../app/canvas/context.js";import x from"../../app/canvas/useCanvas.js";import"../../app/currentUser/context.js";import"../../app/helpCenter/provider.js";import"../../app/helpCenter/context.js";import"../helpCenter/constants.js";import"../../app/rightClickMenu/context.js";import D from"../elementLink/frame.js";import k from"../../utils/useDoubleClick.js";import F from"../../utils/usePerformanceTracking.js";import"./editLayerFocusManager/context.js";import C from"./editLayerFocusManager/useFocusGroupRef.js";import M from"./editLayerFocusManager/useEditLayerFocusManager.js";import R from"./editLayerFocusManager/constants.js";function b(){return b=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e},b.apply(this,arguments)}const L=t.div.withConfig({displayName:"frameElement__Wrapper",componentId:"sc-80q0sm-0"})([""," "," "," outline:1px solid transparent;transition:outline-color 0.5s;&:focus,&:active,&:hover{outline-color:",";}"],g,d,u,(e=>{let{theme:t,hasMask:r}=e;return r?"transparent":t.colors.border.selection})),I=t.div.withConfig({displayName:"frameElement__EmptyFrame",componentId:"sc-80q0sm-1"})(["position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none;"]),NOOP=()=>{},P=sprintf(
/* translators: 1: Ctrl Key 2: Alt Key */
__("To exit the canvas area, press Escape. Press Tab to move to the next group or element. To enter floating menu, press %1$s %2$s p.","web-stories"),E("ctrl"),E("alt"));var w=r((function FrameElement(t){let{id:r}=t;const g=y(),d=M((e=>{let{enterFocusGroup:t}=e;return t})),[u,E]=o(!1),w=C(R.ELEMENT_SELECTION),{setNodeForElement:N,handleSelectElement:O,isEditing:_,setEditingElement:A,setEditingElementWithState:W}=x((e=>{let{state:t,actions:r}=e;return{setNodeForElement:r.setNodeForElement,handleSelectElement:r.handleSelectElement,isEditing:t.isEditing,setEditingElement:r.setEditingElement,setEditingElementWithState:r.setEditingElementWithState}})),{isSelected:B,isOnlySelectedElement:q,isActive:G,isBackground:U,element:$}=S((e=>{let{state:t}=e;const o=t.selectedElementIds.includes(r),s=o&&1===t.selectedElementIds.length,i=s&&!u&&!_;return{isSelected:o,isBackground:t.currentPage?.elements[0].id===r,element:t.currentPage?.elements.find((e=>e.id===r)),isOnlySelectedElement:s,isActive:i}})),{type:V,flip:Z}=$,{Frame:z,isMaskable:H,Controls:J}=c(V),K=s(),Q=i(K,w),[X,Y]=o(!1),{isRTL:ee,styleConstants:{topOffset:te}={}}=T(),{draggingResource:re,activeDropTargetId:oe,isDropSource:se,registerDropTarget:ie,unregisterDropTarget:ne}=v((e=>{let{state:{draggingResource:t,activeDropTargetId:r},actions:{isDropSource:o,registerDropTarget:s,unregisterDropTarget:i}}=e;return{draggingResource:t,activeDropTargetId:r,isDropSource:o,registerDropTarget:s,unregisterDropTarget:i}})),ae=m((e=>{let{state:t}=e;return!B&&X&&!t.isAnythingTransforming})),pe=p((e=>{let{actions:t}=e;return t.getBox}));n((()=>{N(r,K.current)}),[r,N]);const me=pe($);l(r,(e=>{const t=K.current;void 0!==e?.dropTargets?.hover&&(t.style.opacity=e.dropTargets.hover?0:1),E(null!==e)}));const{isMedia:le}=c(V),ce=a((e=>{B||O(r,e),A(r)}),[r,A,O,B]),ge=k(NOOP,ce),de=a((e=>{B||O(r,e),U||g(P)}),[O,r,U,B,g]),ue=a((e=>{B||O(r,e),K.current.focus({preventScroll:!0}),U||e.stopPropagation()}),[O,r,U,B]);return F({node:K.current,eventData:{...h.SELECT_ELEMENT,label:$.type},eventType:"pointerdown"}),j(K,{key:["ctrl+alt+p"]},(()=>{d({groupId:R.EDIT_ELEMENT,cleanup:()=>K.current?.focus()})}),[d]),e.createElement(D,{element:$,active:ae,anchorRef:K},J&&e.createElement(J,{isTransforming:u,box:me,elementRef:K,element:$,isRTL:ee,topOffset:te,isActive:G}),e.createElement(L,b({ref:Q,"data-element-id":r},me,{tabIndex:-1,role:"presentation",hasMask:H,"data-testid":"frameElement",onMouseDown:ue,onFocus:de,onPointerEnter:()=>Y(!0),onPointerLeave:()=>Y(!1),onClick:le?ge(r):null}),e.createElement(f,{element:$,fill:!0,flip:Z,draggingResource:re,activeDropTargetId:oe,isDropSource:se,registerDropTarget:ie,unregisterDropTarget:ne},z?e.createElement(z,{wrapperRef:K,element:$,box:me,isOnlySelectedElement:q,setEditingElementWithState:W}):e.createElement(I,null))))}));export{w as default};
