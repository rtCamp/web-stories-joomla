/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

import e from"react";import t from"styled-components";import"prop-types";import{memo as r,useRef as o,useCallback as s}from"@googleforcreators/react";import{__}from"@googleforcreators/i18n";import{PAGE_WIDTH as a}from"@googleforcreators/units";import{STORY_ANIMATION_STATE as i}from"@googleforcreators/animation";import{themeHelpers as n,useLiveRegion as p,useKeyDownEffect as m}from"@googleforcreators/design-system";import{DESIGN_SPACE_MARGIN as l,STABLE_ARRAY as c}from"../../constants/index.js";import{useTransform as g}from"@googleforcreators/transform";import"../dropTargets/provider.js";import"../dropTargets/context.js";import"../../app/history/historyProvider.js";import"../../app/history/context.js";import"@googleforcreators/templates";import"../../app/config/context.js";import"../../app/api/context.js";import"@googleforcreators/fonts";import"@googleforcreators/dom";import"../../app/font/context.js";import"@googleforcreators/media";import"@googleforcreators/tracking";import"uuid";import"@googleforcreators/masks";import"@googleforcreators/element-library";import"@googleforcreators/elements";import"../../app/story/context.js";import"@googleforcreators/migration";import"../../app/story/actions/useSaveStory.js";import"clone-deep";import"../../app/story/useStoryReducer/useStoryReducer.js";import"@googleforcreators/output";import"../../app/story/storyTriggers/storyTriggersProvider.js";import"../../app/story/storyTriggers/storyEvents/onInitialElementAddedRegister.js";import"../../app/story/storyTriggers/storyEvents/onPageAddedRegister.js";import u from"../../app/story/useStory.js";import"../../app/media/useUploadMedia.js";import"@googleforcreators/patterns";import"../../utils/generateBlurhash.worker.js";import"../../app/media/media3p/providerConfiguration.js";import"../../app/media/utils/useFFmpeg.js";import"../../app/media/media3p/api/context.js";import"../../app/media/local/constants.js";import"../../app/media/media3p/providerReducer.js";import"../../app/media/context.js";import"sat";import d from"../../app/layout/useLayout.js";import"../../app/layout/context.js";import"../../app/layout/useZoomSetting.js";import"@googleforcreators/rich-text";import"@googleforcreators/stickers";import"../library/panes/text/textPresets.js";import"../../app/canvas/context.js";import f from"../../app/canvas/useCanvas.js";import"../../app/currentUser/context.js";import"../../app/helpCenter/provider.js";import"../../app/helpCenter/context.js";import"../helpCenter/constants.js";import y from"../../app/rightClickMenu/useRightClickMenu.js";import j from"../../app/canvas/useCanvasKeys.js";import{PageArea as v,Layer as x,NavPrevArea as E,NavNextArea as h}from"./layout.js";import b from"./frameElement.js";import S from"./selection.js";import C from"./pagenav/index.js";import"./editLayerFocusManager/context.js";import F from"./editLayerFocusManager/useEditLayerFocusManager.js";import L from"./editLayerFocusManager/constants.js";const T=t(v).withConfig({displayName:"framesLayer__FramesPageArea",componentId:"sc-5ltl4w-0"})(["pointer-events:initial;"]),w=l/a*100,M=t.div.withConfig({displayName:"framesLayer__FocusContainer",componentId:"sc-5ltl4w-1"})(["grid-row:2 / -1;grid-column:1 / -1;margin:5px;",";"],n.focusableOutlineCSS),A=__("Canvas Area. To navigate into the page, press Enter.","web-stories"),I=__("To exit the canvas area, press Escape. Press Tab to move to the next group or element.","web-stories"),N=t.div.withConfig({displayName:"framesLayer__DesignSpaceGuidelineBorder",componentId:"sc-5ltl4w-2"})(["border:1px solid ",";left:","%;right:","%;top:0;bottom:0;position:absolute;pointer-events:none;z-index:1;visibility:",";"],(e=>{let{theme:t}=e;return t.colors.border.negativePress}),w,w,(e=>{let{isVisible:t}=e;return t?"visible":"hidden"}));function DesignSpaceGuideline(){const t=f((e=>{let{actions:t}=e;return t.setDesignSpaceGuideline})),{isAnythingTransforming:r}=g((e=>{let{state:t}=e;return{isAnythingTransforming:t.isAnythingTransforming}}));return e.createElement(N,{ref:t,isVisible:r})}function FramesNavAndSelection(t){let{children:r}=t;const s=o(null),a=y((e=>e.onOpenMenu));return m(s,"mod+alt+shift+m",a),e.createElement(x,{ref:s,"data-testid":"FramesLayer",pointerEvents:"initial",tabIndex:"-1","aria-label":__("Frames layer","web-stories")},r,e.createElement(E,null,e.createElement(C,{isNext:!1})),e.createElement(h,null,e.createElement(C,null)),e.createElement(S,{onContextMenu:a}))}function FrameElements(){const t=u((e=>{let{state:t}=e;return t.currentPage?.elements?.map((e=>e.id))||c})),r=u((e=>{let{state:t}=e;return[i.PLAYING,i.SCRUBBING].includes(t.animationState)})),o=y((e=>e.onOpenMenu)),{setScrollOffset:a}=d((e=>{let{actions:{setScrollOffset:t}}=e;return{setScrollOffset:t}})),n=s((e=>a({left:e.target.scrollLeft,top:e.target.scrollTop})),[a]);return!r&&e.createElement(T,{fullBleedContainerLabel:__("Fullbleed area (Frames layer)","web-stories"),onContextMenu:o,onScroll:n},t.map((t=>e.createElement(b,{key:t,id:t}))),e.createElement(DesignSpaceGuideline,null))}var P=r((function FramesLayer(){const t=o(),r=p(),s=F((e=>{let{enterFocusGroup:t}=e;return t}));return j(t),m(t,{key:["enter"]},(()=>{s({groupId:L.ELEMENT_SELECTION,cleanup:()=>t.current?.focus()}),r(I)}),[s,r]),e.createElement(FramesNavAndSelection,null,e.createElement(M,{role:"region","data-testid":"canvas-focus-container",ref:t,"aria-label":A,tabIndex:0}),e.createElement(FrameElements,null))}));export{P as default};
