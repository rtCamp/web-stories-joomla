/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

import e from"react";import t from"styled-components";import"prop-types";import{forwardRef as o,createRef as r,useRef as a,useEffect as i,useResizeEffect as p}from"@googleforcreators/react";import{__}from"@googleforcreators/i18n";import{generatePatternStyles as n}from"@googleforcreators/patterns";import{FULLBLEED_RATIO as l}from"@googleforcreators/units";import{THEME_CONSTANTS as s,themeHelpers as c}from"@googleforcreators/design-system";import{HEADER_HEIGHT as d,HEADER_GAP as g}from"../../constants/index.js";import"@googleforcreators/transform";import"../dropTargets/provider.js";import"../dropTargets/context.js";import"../../app/history/historyProvider.js";import"../../app/history/context.js";import"@googleforcreators/templates";import"../../app/config/context.js";import"../../app/api/context.js";import"@googleforcreators/fonts";import"@googleforcreators/dom";import"../../app/font/context.js";import"@googleforcreators/media";import"@googleforcreators/tracking";import"@googleforcreators/animation";import"uuid";import"@googleforcreators/masks";import"@googleforcreators/element-library";import"@googleforcreators/elements";import"../../app/story/context.js";import"@googleforcreators/migration";import"../../app/story/actions/useSaveStory.js";import"clone-deep";import"../../app/story/useStoryReducer/useStoryReducer.js";import"@googleforcreators/output";import"../../app/story/storyTriggers/storyTriggersProvider.js";import"../../app/story/storyTriggers/storyEvents/onInitialElementAddedRegister.js";import"../../app/story/storyTriggers/storyEvents/onPageAddedRegister.js";import"../../app/media/useUploadMedia.js";import"../../utils/generateBlurhash.worker.js";import"../../app/media/media3p/providerConfiguration.js";import"../../app/media/utils/useFFmpeg.js";import"../../app/media/media3p/api/context.js";import"../../app/media/local/constants.js";import"../../app/media/media3p/providerReducer.js";import"../../app/media/context.js";import"sat";import m from"../../app/layout/useLayout.js";import"../../app/layout/context.js";import"../../app/layout/useZoomSetting.js";import"@googleforcreators/rich-text";import"@googleforcreators/stickers";import"../library/panes/text/textPresets.js";import"../../app/canvas/context.js";import"../../app/currentUser/context.js";import"../../app/helpCenter/provider.js";import"../../app/helpCenter/context.js";import"../helpCenter/constants.js";import"../../app/rightClickMenu/context.js";import f from"../footer/useFooterHeight.js";import{FOOTER_BOTTOM_MARGIN as h}from"../footer/constants.js";import v from"../../utils/pointerEventsCss.js";import w from"./usePinchToZoom.js";function u(){return u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var r in o)Object.prototype.hasOwnProperty.call(o,r)&&(e[r]=o[r])}return e},u.apply(this,arguments)}const x=s.LARGE_BUTTON_SIZE+8,y=t.section.withConfig({displayName:"layout__LayerGrid",componentId:"sc-1n0mp4m-0"})([""," position:absolute;top:0;left:0;right:0;bottom:0;"," display:grid;grid:'h h h h h h h' ","px '. . . . . . .' minmax(16px,1fr) '. b . p . f .' var(--viewport-height-px) '. . . . . . .' 1fr 'w w w w w w w' ","px '. . . . . . .' ","px / 1fr var(--page-nav-width) var(--page-nav-gap) var(--viewport-width-px) var(--page-nav-gap) var(--page-nav-width) 1fr;height:100%;"],v,(e=>{let{zIndex:t}=e;return"number"==typeof t?`z-index: ${t};`:""}),d,(e=>{let{footerHeight:t}=e;return t}),h),j=t.div.withConfig({displayName:"layout__Area",componentId:"sc-1n0mp4m-1"})([""," grid-area:",";overflow:",";position:relative;width:100%;height:100%;",";"],v,(e=>{let{area:t}=e;return t}),(e=>{let{showOverflow:t}=e;return t?"visible":"hidden"}),(e=>{let{zIndex:t}=e;return void 0!==t?`z-index: ${t}`:null})),b=t(j).attrs({area:"p"}).withConfig({displayName:"layout__PageAreaContainer",componentId:"sc-1n0mp4m-2"})(["position:relative;display:flex;justify-content:",";align-items:",";overflow:",";",""],(e=>{let{hasHorizontalOverflow:t}=e;return t?"flex-start":"center"}),(e=>{let{hasVerticalOverflow:t}=e;return t?"flex-start":"center"}),(e=>{let{showOverflow:t}=e;return t?"visible":"var(--overflow-x) var(--overflow-y)"}),(e=>{let{isControlled:t,hasVerticalOverflow:o,hasHorizontalOverflow:r,showOverflow:a}=e;return t&&`\n      overflow: ${a?"visible":"hidden"};\n      width: calc(\n        100% - ${o?c.SCROLLBAR_WIDTH:0}px\n      );\n      height: calc(\n        100% - ${r?c.SCROLLBAR_WIDTH:0}px\n      );\n    `})),O=o((function Layer(t,o){let{children:r,...a}=t;const i=f();return e.createElement(y,u({ref:o,footerHeight:i},a),r)})),_=t.div.withConfig({displayName:"layout__PaddedPage",componentId:"sc-1n0mp4m-3"})(["padding:calc(0.5 * var(--page-padding-px));"]),C=t.div.withConfig({displayName:"layout__PageClip",componentId:"sc-1n0mp4m-4"})(["",""],(e=>{let{hasHorizontalOverflow:t,hasVerticalOverflow:o}=e;return(t||o)&&`\n      overflow: hidden;\n      width: ${t?"calc(var(--page-width-px) + var(--page-padding-px))":`calc(var(--viewport-width-px) - ${c.SCROLLBAR_WIDTH}px)`};\n      flex-basis: ${t?"calc(var(--page-width-px) + var(--page-padding-px))":`calc(var(--viewport-width-px) - ${c.SCROLLBAR_WIDTH}px)`};\n      height: ${o?"calc(var(--fullbleed-height-px) + var(--page-padding-px))":`calc(var(--viewport-height-px) - ${c.SCROLLBAR_WIDTH}px)`};\n      flex-shrink: 0;\n      flex-grow: 0;\n      display: flex;\n      justify-content: center;\n      align-items: center;\n    `})),H=t.div.withConfig({displayName:"layout__FullbleedContainer",componentId:"sc-1n0mp4m-5"})([""," overflow:visible;position:relative;width:var(--page-width-px);height:var(--fullbleed-height-px);display:flex;justify-content:center;align-items:center;border-radius:5px;",";",""],(e=>{let{background:t}=e;return n(t)}),(e=>{let{isControlled:t}=e;return t&&"\n      left: var(--scroll-left-px);\n      top: var(--scroll-top-px);\n    "}),(e=>{let{isBackgroundSelected:t,theme:o}=e;return t&&`\n      &:before {\n        content: '';\n        position: absolute;\n        top: -4px;\n        left: -4px;\n        right: -4px;\n        bottom: -4px;\n        border: ${o.colors.border.selection} 1px solid;\n        border-radius: ${o.borders.radius.medium};\n      }\n    `})),N=t.div.withConfig({displayName:"layout__PageAreaWithoutOverflow",componentId:"sc-1n0mp4m-6"})(["overflow:",";position:relative;width:var(--page-width-px);height:var(--fullbleed-height-px);display:flex;justify-content:center;align-items:center;"],(e=>{let{showOverflow:t}=e;return t?"initial":"hidden"})),I=t.div.withConfig({displayName:"layout__PageAreaSafeZone",componentId:"sc-1n0mp4m-7"})(["width:var(--page-width-px);height:var(--page-height-px);overflow:visible;position:relative;"]),z=t(j).attrs({area:"h"}).withConfig({displayName:"layout__HeadArea",componentId:"sc-1n0mp4m-8"})([""]);t(j).attrs({area:"m"}).withConfig({displayName:"layout__MenuArea",componentId:"sc-1n0mp4m-9"})([""]);const L=t(j).withConfig({displayName:"layout__NavArea",componentId:"sc-1n0mp4m-10"})(["display:flex;align-items:center;justify-content:center;"]),S=t(L).attrs({area:"b"}).withConfig({displayName:"layout__NavPrevArea",componentId:"sc-1n0mp4m-11"})([""]),A=t(L).attrs({area:"f"}).withConfig({displayName:"layout__NavNextArea",componentId:"sc-1n0mp4m-12"})([""]),P=t.div.withConfig({displayName:"layout__PageMenuArea",componentId:"sc-1n0mp4m-13"})(["grid-area:p;position:absolute;right:calc(-24px + var(--page-padding-px));top:calc(0.5 * var(--page-padding-px));min-height:calc(100% - var(--page-padding-px));"]),T=t(j).attrs({area:"w",showOverflow:!0}).withConfig({displayName:"layout__FooterArea",componentId:"sc-1n0mp4m-14"})([""]);function $(e){const{setWorkspaceSize:t}=m((e=>{let{actions:{setWorkspaceSize:t}}=e;return{setWorkspaceSize:t}})),o=f();p(e,(e=>{let{width:r,height:a}=e;t({width:r,height:a,availableHeight:a-d-g-o-h})}),[t,o])}function R(){const{pageWidth:e,pageHeight:t,pagePadding:o,viewportWidth:r,viewportHeight:a,hasPageNavigation:i,hasVerticalOverflow:p,hasHorizontalOverflow:n,scrollLeft:s,scrollTop:c}=m((e=>{let{state:{pageWidth:t,pageHeight:o,pagePadding:r,viewportWidth:a,viewportHeight:i,hasPageNavigation:p,hasVerticalOverflow:n,hasHorizontalOverflow:l,scrollLeft:s,scrollTop:c}}=e;return{pageWidth:t,pageHeight:o,pagePadding:r,viewportWidth:a,viewportHeight:i,hasPageNavigation:p,hasVerticalOverflow:n,hasHorizontalOverflow:l,scrollLeft:s,scrollTop:c}}));return{"--page-nav-width":`${i?x:0}px`,"--page-nav-gap":(i?20:0)+"px","--page-width-px":`${e}px`,"--page-height-px":`${t}px`,"--page-padding-px":`${o}px`,"--fullbleed-height-px":`${e/l}px`,"--viewport-width-px":`${r}px`,"--viewport-height-px":`${a}px`,"--overflow-x":n?"scroll":"visible","--overflow-y":p?"scroll":"visible","--scroll-left-px":-s+"px","--scroll-top-px":-c+"px"}}const k=o((function PageArea(t,o){let{children:p,fullbleedRef:n=null,fullBleedContainerLabel:l=__("Fullbleed area","web-stories"),overlay:s=[],background:c,isControlled:d=!1,className:g="",showOverflow:f=!1,isBackgroundSelected:h=!1,pageAreaRef:v=r(),withSafezone:x=!0,...y}=t;const j=a(),O=n||j,{hasVerticalOverflow:z,hasHorizontalOverflow:L,zoomSetting:S,scrollLeft:A,scrollTop:P}=m((e=>{let{state:{hasVerticalOverflow:t,hasHorizontalOverflow:o,zoomSetting:r,scrollLeft:a,scrollTop:i}}=e;return{hasVerticalOverflow:t,hasHorizontalOverflow:o,zoomSetting:r,scrollLeft:a,scrollTop:i}})),T=a();T.current={top:P,left:A},i((()=>{d||(O.current.scrollTop=T.current.top,O.current.scrollLeft=T.current.left)}),[d,S,O]);const $=a(null);return w({containerRef:$}),e.createElement(b,u({showOverflow:f,isControlled:d,hasHorizontalOverflow:L,hasVerticalOverflow:z,className:g,"data-scroll-container":!0},y),e.createElement(C,{hasHorizontalOverflow:L,hasVerticalOverflow:z},e.createElement(_,{ref:$},e.createElement(H,{"aria-label":l,role:"region",ref:O,"data-testid":"fullbleed",background:c,isControlled:d,isBackgroundSelected:h},e.createElement(N,{ref:v,showOverflow:f},x?e.createElement(I,{ref:o,"data-testid":"safezone"},p):p,s)))))}));export{T as FooterArea,z as HeadArea,O as Layer,A as NavNextArea,S as NavPrevArea,k as PageArea,P as PageMenuArea,$ as useLayoutParams,R as useLayoutParamsCssVars};
