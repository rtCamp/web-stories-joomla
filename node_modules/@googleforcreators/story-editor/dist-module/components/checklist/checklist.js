/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

import e from"react";import{__}from"@googleforcreators/i18n";import"prop-types";import{forwardRef as t,useRef as o,useEffect as n,useCallback as s}from"@googleforcreators/react";import{FOCUSABLE_SELECTORS as i}from"@googleforcreators/design-system";import r from"styled-components";import{Z_INDEX_FOOTER as c}from"../../constants/zIndex.js";import l from"../directionAware/index.js";import p from"../secondaryPopup/index.js";import"uuid";import{Tablist as a}from"../tablist/styles.js";import{Toggle as m}from"./toggle/index.js";import{POPUP_ID as u,CHECKLIST_TITLE as d,ISSUE_TYPES as C,PANEL_EXPANSION_BY_CHECKPOINT as h,CATEGORY_LABELS as k,PANEL_VISIBILITY_BY_STATE as I}from"./constants.js";import{DesignChecks as f}from"./checklistContent/designChecks.js";import{AccessibilityChecks as g}from"./checklistContent/accessibilityChecks.js";import{PriorityChecks as E}from"./checklistContent/priorityChecks.js";import y from"./checklistContent/emptyContent.js";import{useCategoryCount as O}from"./countContext/checkCountContext.js";import"@googleforcreators/tracking";import"./checklistContext/context.js";import{useChecklist as j}from"./checklistContext/useChecklist.js";import{useCheckpoint as x}from"./checkpointContext/checkpointContext.js";import{getTabPanelMaxHeight as S}from"./styles.js";import P from"../secondaryPopup/navigationWrapper.js";import{TopNavigation as b}from"../secondaryPopup/topNavigation.js";const T=r.div.withConfig({displayName:"checklist__Wrapper",componentId:"sc-ai4sw8-0"})(["z-index:",";"],c),M=r(P).withConfig({displayName:"checklist__StyledNavigationWrapper",componentId:"sc-ai4sw8-1"})([""]),R=t((function ThroughputPopup(t,s){let{isOpen:i,children:r,close:c}=t;const l=o(),{checklistFocused:m,isChecklistMounted:C,resetChecklistFocused:h,setIsChecklistMounted:k}=j((e=>{let{state:{isChecklistMounted:t,checklistFocused:o},actions:{setIsChecklistMounted:n,resetChecklistFocused:s}}=e;return{checklistFocused:o,isChecklistMounted:t,resetChecklistFocused:s,setIsChecklistMounted:n}}));return n((()=>{m&&l.current&&l.current.focus(),h()}),[m,h]),e.createElement(p,{popupId:u,isOpen:i,ariaLabel:d,shouldKeepMounted:!0,onEnter:()=>k(!0),onExited:()=>k(!1)},C?e.createElement(M,{ref:s,isOpen:i},e.createElement(b,{ref:l,onClose:c,label:d,popupId:u}),e.createElement(a,{id:"pre-publish-checklist","data-isexpanded":i,"aria-label":__("Potential Story issues by category","web-stories")},r),e.createElement(y,null)):r)}));function Checklist(t){let{items:r={}}=t;const{close:c,openPanel:p,toggle:a,isOpen:y,isChecklistMounted:P,setOpenPanel:b}=j((e=>{let{actions:{close:t,toggle:o,setOpenPanel:n},state:{isOpen:s,isChecklistMounted:i,openPanel:r}}=e;return{close:t,toggle:o,isOpen:s,isChecklistMounted:i,openPanel:r,setOpenPanel:n}})),M=O(C.PRIORITY),Y=O(C.DESIGN),N=O(C.ACCESSIBILITY),{checkpoint:A}=x((e=>{let{state:{checkpoint:t}}=e;return{checkpoint:t}})),w=o(),B=s((e=>()=>b((t=>t===e?null:e))),[b]);n((()=>{if(P){const e=w.current?.querySelector(i.join(", "));e?.focus()}}),[P]),n((()=>{A&&b(h[A])}),[A,b]);const D=I[A],F=D.includes(C.PRIORITY)?M:0,L=D.includes(C.DESIGN)?Y:0,G=D.includes(C.ACCESSIBILITY)?N:0,v=S([F,L,G].filter((e=>Boolean(e))).length),{Priority:_,Design:H,Accessibility:W}=r;return e.createElement(l,null,e.createElement(T,{role:"region","aria-label":d},e.createElement(R,{ref:w,close:c,isOpen:y},_&&e.createElement(E,{badgeCount:F,isOpen:y&&p===C.PRIORITY,onClick:B(C.PRIORITY),maxHeight:v,title:k[C.PRIORITY]},e.createElement(_,null)),H&&e.createElement(f,{badgeCount:L,isOpen:y&&p===C.DESIGN,onClick:B(C.DESIGN),maxHeight:v,title:k[C.DESIGN]},e.createElement(H,null)),W&&e.createElement(g,{badgeCount:G,isOpen:y&&p===C.ACCESSIBILITY,onClick:B(C.ACCESSIBILITY),maxHeight:v,title:k[C.ACCESSIBILITY]},e.createElement(W,null))),e.createElement(m,{isOpen:y,onClick:a,popupId:u})))}export{Checklist};
