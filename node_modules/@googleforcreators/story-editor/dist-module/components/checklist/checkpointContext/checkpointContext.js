/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

import o from"react";import{createContext as t,useContextSelector as r,identity as e,useReducer as s,useState as i,useEffect as p,useCallback as a,useMemo as m}from"@googleforcreators/react";import"prop-types";import"@googleforcreators/transform";import"../../dropTargets/provider.js";import"../../dropTargets/context.js";import"../../../app/history/historyProvider.js";import"../../../app/history/context.js";import"@googleforcreators/templates";import"../../../app/config/context.js";import"../../../app/api/context.js";import"@googleforcreators/fonts";import"@googleforcreators/dom";import"../../../constants/fonts.js";import"../../../constants/multipleValue.js";import"../../../app/font/context.js";import"@googleforcreators/media";import"@googleforcreators/tracking";import"@googleforcreators/animation";import"uuid";import"@googleforcreators/masks";import"@googleforcreators/element-library";import"@googleforcreators/elements";import"../../../app/story/context.js";import"@googleforcreators/migration";import"../../../app/story/actions/useSaveStory.js";import"clone-deep";import"../../../app/story/useStoryReducer/useStoryReducer.js";import"@googleforcreators/output";import{useStoryTriggerListener as n}from"../../../app/story/storyTriggers/useStoryTriggers.js";import"../../../app/story/storyTriggers/storyTriggersProvider.js";import"../../../app/story/storyTriggers/storyEvents/onInitialElementAddedRegister.js";import"../../../app/story/storyTriggers/storyEvents/onPageAddedRegister.js";import{STORY_EVENTS as c}from"../../../app/story/storyTriggers/storyEvents/types.js";import g from"../../../app/story/useStory.js";import"@googleforcreators/i18n";import"../../../app/media/useUploadMedia.js";import"@googleforcreators/patterns";import"../../../utils/generateBlurhash.worker.js";import"@googleforcreators/design-system";import"../../../app/media/media3p/providerConfiguration.js";import"../../../app/media/utils/useFFmpeg.js";import"../../../app/media/media3p/api/context.js";import"../../../app/media/local/constants.js";import"../../../app/media/media3p/providerReducer.js";import"../../../app/media/context.js";import"sat";import"@googleforcreators/units";import"../../../app/layout/context.js";import"../../../app/layout/useZoomSetting.js";import"@googleforcreators/rich-text";import"@googleforcreators/stickers";import"../../library/panes/text/textPresets.js";import"../../../app/canvas/context.js";import"../../../app/currentUser/context.js";import"../../../app/helpCenter/provider.js";import"../../../app/helpCenter/context.js";import"../../helpCenter/constants.js";import"../../../app/rightClickMenu/context.js";import{PPC_CHECKPOINT_STATE as l}from"../constants.js";const d={ON_INITIAL_ELEMENT_ADDED:"story is no longer empty",ON_PUBLISH_CLICKED:"publish button is pressed",ON_STORY_HAS_2_PAGES:"story 'recommended' section enabled",ON_STORY_HAS_5_PAGES:"story 'high priority' section enabled",ON_STORY_IS_PUBLISHED:"story is published, regardless of recommendations"},_={[l.UNAVAILABLE]:{[d.ON_INITIAL_ELEMENT_ADDED]:l.ONLY_RECOMMENDED,[d.ON_PUBLISH_CLICKED]:l.ALL,[d.ON_STORY_IS_PUBLISHED]:l.ALL,[d.ON_STORY_HAS_2_PAGES]:l.ONLY_RECOMMENDED},[l.ONLY_RECOMMENDED]:{[d.ON_STORY_HAS_5_PAGES]:l.ALL,[d.ON_PUBLISH_CLICKED]:l.ALL,[d.ON_STORY_IS_PUBLISHED]:l.ALL},[l.ALL]:{}},y=(o,t)=>_[o][t]||o,E=t({state:{},actions:{}});function ChecklistCheckpointProvider(t){let{children:r}=t;const[e,_]=s(y,l.UNAVAILABLE),[u,S]=i(),[L,j]=i(),f=u>0,A=g((o=>{let{state:{story:t}}=o;return t.status}));p((()=>{"publish"===A&&_(d.ON_STORY_IS_PUBLISHED)}),[A]),n(c.onSecondPageAdded,a((()=>{_(d.ON_STORY_HAS_2_PAGES)}),[])),n(c.onFifthPageAdded,a((()=>{_(d.ON_STORY_HAS_5_PAGES)}),[])),n(c.onInitialElementAdded,a((()=>{_(d.ON_INITIAL_ELEMENT_ADDED)}),[]));const O=a((o=>{S(o)}),[]),h=a((()=>_(d.ON_PUBLISH_CLICKED)),[]),I=a((()=>{j(!0)}),[]),N=a((()=>{j(!1)}),[]),P=m((()=>({state:{checkpoint:e,hasHighPriorityIssues:f,reviewChecklistRequested:L},actions:{updateHighPriorityCount:O,handleResetReviewChecklist:N,handleReviewChecklist:I,showPriorityIssues:h}})),[e,I,h,N,L,f,O]);return o.createElement(E.Provider,{value:P},r)}function u(o){return r(E,o??e)}export{ChecklistCheckpointProvider,E as CheckpointContext,d as PPC_CHECKPOINT_ACTION,u as useCheckpoint};
