/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

import t from"react";import{useState as o,useEffect as r,useCallback as e}from"@googleforcreators/react";import{__}from"@googleforcreators/i18n";import"@googleforcreators/transform";import"../../../dropTargets/provider.js";import"../../../dropTargets/context.js";import"../../../../app/history/historyProvider.js";import"../../../../app/history/context.js";import"prop-types";import"@googleforcreators/templates";import"../../../../app/config/context.js";import"../../../../app/api/context.js";import"@googleforcreators/fonts";import"@googleforcreators/dom";import"../../../../constants/fonts.js";import"../../../../constants/multipleValue.js";import"../../../../app/font/context.js";import"@googleforcreators/media";import"@googleforcreators/tracking";import"@googleforcreators/animation";import"uuid";import"@googleforcreators/masks";import"@googleforcreators/element-library";import"@googleforcreators/elements";import"../../../../app/story/context.js";import"@googleforcreators/migration";import"../../../../app/story/actions/useSaveStory.js";import"clone-deep";import"../../../../app/story/useStoryReducer/useStoryReducer.js";import"@googleforcreators/output";import"../../../../app/story/storyTriggers/storyTriggersProvider.js";import"../../../../app/story/storyTriggers/storyEvents/onInitialElementAddedRegister.js";import"../../../../app/story/storyTriggers/storyEvents/onPageAddedRegister.js";import s from"../../../../app/story/useStory.js";import"../../../../app/media/useUploadMedia.js";import"@googleforcreators/patterns";import"../../../../utils/generateBlurhash.worker.js";import"@googleforcreators/design-system";import"../../../../app/media/media3p/providerConfiguration.js";import"../../../../app/media/utils/useFFmpeg.js";import"../../../../app/media/media3p/api/context.js";import"../../../../app/media/local/constants.js";import"../../../../app/media/media3p/providerReducer.js";import"../../../../app/media/context.js";import"sat";import"@googleforcreators/units";import p from"../../../../app/layout/useLayout.js";import"../../../../app/layout/context.js";import"../../../../app/layout/useZoomSetting.js";import"@googleforcreators/rich-text";import"@googleforcreators/stickers";import"../../../library/panes/text/textPresets.js";import"../../../../app/canvas/context.js";import"../../../../app/currentUser/context.js";import"../../../../app/helpCenter/provider.js";import"../../../../app/helpCenter/context.js";import"../../../helpCenter/constants.js";import"../../../../app/rightClickMenu/context.js";import"../../../../app/highlights/styles.js";import i from"../../../../app/highlights/useHighlights.js";import"../../../../app/highlights/context.js";import"../../../../app/highlights/states.js";import"../../../../app/highlights/quickActions/constants.js";import"../../../../app/highlights/quickActions/useQuickActions.js";import"../../../checklistCard/styles.js";import a from"../../../checklistCard/checklistCard.js";import{CARD_TYPE as m}from"../../../checklistCard/constants.js";import{DefaultFooterText as n}from"../../../checklistCard/defaultFooterText.js";import{THUMBNAIL_TYPES as c}from"../../../thumbnail/constants.js";import g from"../../../thumbnail/thumbnail.js";import"../../../thumbnail/styles.js";import{ACCESSIBILITY_COPY as l}from"../../constants.js";import{ThumbnailPagePreview as u}from"../../utils/thumbnailPagePreview.js";import{useRegisterCheck as h}from"../../countContext/checkCountContext.js";import{useIsChecklistMounted as d}from"../../popupMountedContext.js";import{getPagesWithFailedContrast as j}from"./check.js";const PageBackgroundTextLowContrast=()=>{const f=d(),[y,x]=o([]),k=s((t=>{let{state:o}=t;return o?.pages})),C=p((t=>{let{state:{pageWidth:o,pageHeight:r}}=t;return{width:o,height:r}}));r((()=>{let t=!1;return j(k,C).then((o=>{if(t)return;const r=o.map((t=>{let{page:o}=t;return o}));x(r)})).catch((()=>{})),()=>{t=!0}}),[k,C]);const E=i((t=>{let{setHighlights:o}=t;return o})),v=e((t=>E({pageId:t})),[E]),S=y.length>0;h("PageBackgroundTextLowContrast",S);const{title:b,footer:T}=l.lowContrast;return S&&f?t.createElement(a,{title:b,cardType:y.length>1?m.MULTIPLE_ISSUE:m.SINGLE_ISSUE,footer:t.createElement(n,null,T),thumbnails:y.map((o=>t.createElement(g,{key:o.id,onClick:()=>v(o.id),type:c.PAGE,displayBackground:t.createElement(u,{page:o}),"aria-label":__("Go to offending page","web-stories")})))}):null};export{PageBackgroundTextLowContrast as default};
