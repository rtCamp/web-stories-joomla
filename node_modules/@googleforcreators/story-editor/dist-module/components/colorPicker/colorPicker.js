/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

import e from"react";import{CSSTransition as o}from"react-transition-group";import"prop-types";import r from"styled-components";import{useState as t,useCallback as a,useDebouncedCallback as s,useRef as n,useEffect as l,useFocusOut as i}from"@googleforcreators/react";import{__}from"@googleforcreators/i18n";import{hasGradient as c}from"@googleforcreators/patterns";import{themeHelpers as p,useKeyDownEffect as m}from"@googleforcreators/design-system";import{useTransform as d}from"@googleforcreators/transform";import g from"../../utils/useFocusTrapping.js";import u from"../../app/story/useStory.js";import f from"./customColorPicker.js";import h from"./basicColorPicker.js";const C=r.div.withConfig({displayName:"colorPicker__Container",componentId:"sc-1xsejx6-0"})(["border-radius:8px;background:",";user-select:none;display:flex;flex-direction:column;gap:12px;align-items:stretch;",";overflow:hidden;&.picker-appear{opacity:0.01;margin-top:-10px;&.picker-appear-active{opacity:1;margin-top:0;transition:300ms ease-out;transition-property:opacity,margin-top;}}"],(e=>{let{theme:o}=e;return o.colors.bg.secondary}),(e=>{let{maxHeight:o}=e;return o?`\n          height: ${o}px;\n          width: ${208+p.SCROLLBAR_WIDTH}px;\n        `:"\n          width: 208px;\n        "}));function ColorPicker(r){let{onChange:p,isEyedropperActive:y=!1,color:w=null,allowsGradient:x=!1,allowsOpacity:k=!0,allowsSavedColors:E=!1,hasEyedropper:S=!0,maxHeight:v=null,onClose:b=(()=>{}),changedStyle:P="background",onDimensionChange:D=(()=>{}),allowsSavedColorDeletion:j=!0,shouldCloseOnSelection:I=!1}=r;const[O,H]=t(!1),[T,R]=t(c(w)),_=a((()=>{R(!0),D()}),[D]),A=a((()=>{R(!1),D()}),[D]),{actions:{pushTransform:G}}=d(),{selectedElementIds:L=[]}=u((e=>{let{state:{selectedElementIds:o}}=e;return{selectedElementIds:o}})),N=s(p,100,{leading:!0}),$=n(!0);l((()=>()=>{$.current=!1}),[]);const B=a((e=>{$.current?N(e):p(e),L.forEach((o=>{G(o,{color:e,style:P,staticTransformation:!0})}))}),[p,N,L,P,G]),F=n();i(F,(()=>{y||O||b()}),[y,O]);const W=n(document.activeElement),q=a((e=>{W.current&&W.current.focus(),b(e)}),[b]);m(F,"esc",q),g({ref:F});const z=T?f:h;return e.createElement(o,{nodeRef:F,in:!0,appear:!0,classNames:"picker",timeout:300},e.createElement(C,{role:"dialog","aria-label":__("Color and gradient picker","web-stories"),ref:F,maxHeight:v},e.createElement(z,{color:w,allowsGradient:x,allowsOpacity:k,handleColorChange:B,showCustomPicker:_,hideCustomPicker:A,handleClose:q,hasEyedropper:S,allowsSavedColors:E,showDialog:O,setShowDialog:H,changedStyle:P,allowsSavedColorDeletion:j,shouldCloseOnSelection:I})))}export{ColorPicker as default};
