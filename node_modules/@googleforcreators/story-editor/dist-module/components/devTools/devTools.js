/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

import e from"react";import{useState as t,useRef as o,useEffect as r}from"@googleforcreators/react";import s from"styled-components";import{DATA_VERSION as a}from"@googleforcreators/migration";import{useSnackbar as n,useGlobalKeyDownEffect as i}from"@googleforcreators/design-system";import"../../constants/fonts.js";import"../../constants/multipleValue.js";import"@googleforcreators/animation";import"uuid";import"@googleforcreators/masks";import"@googleforcreators/element-library";import"@googleforcreators/elements";import"prop-types";import"../../app/story/context.js";import"@googleforcreators/templates";import"../../app/config/context.js";import"../../app/api/context.js";import"../../app/history/historyProvider.js";import"../../app/history/context.js";import"../../app/story/actions/useSaveStory.js";import"clone-deep";import"../../app/story/useStoryReducer/useStoryReducer.js";import"@googleforcreators/output";import"../../app/story/storyTriggers/storyTriggersProvider.js";import"../../app/story/storyTriggers/storyEvents/onInitialElementAddedRegister.js";import"../../app/story/storyTriggers/storyEvents/onPageAddedRegister.js";import c from"../../app/story/useStory.js";import{dummyVideo as l,dummyImage as p}from"./dummyData.js";const m=s.div.withConfig({displayName:"devTools__Container",componentId:"sc-1mo3vwv-0"})(["position:fixed;z-index:2147483646;bottom:0;left:0;display:flex;flex-direction:column;width:35%;height:50%;border:6px solid ",";background:",";color:",";"],(e=>{let{theme:t}=e;return t.colors.bg.secondary}),(e=>{let{theme:t}=e;return t.colors.bg.primary}),(e=>{let{theme:t}=e;return t.colors.fg.secondary})),u=s.textarea.withConfig({displayName:"devTools__Textarea",componentId:"sc-1mo3vwv-1"})(["flex:1;border:0;background:",";color:",";white-space:nowrap;overflow:auto;"],(e=>{let{theme:t}=e;return t.colors.bg.primary}),(e=>{let{theme:t}=e;return t.colors.fg.secondary})),d=s.div.withConfig({displayName:"devTools__Options",componentId:"sc-1mo3vwv-2"})(["display:flex;justify-content:space-between;padding:6px;"]),g=s.label.withConfig({displayName:"devTools__Label",componentId:"sc-1mo3vwv-3"})(["margin-right:6px;"]),y=s.button.withConfig({displayName:"devTools__Button",componentId:"sc-1mo3vwv-4"})(["margin-left:6px;"]),f=e=>{const t=[];return[{...e,pages:e.pages.map((e=>({...e,elements:e.elements.map((e=>{const o={...e};return"resource"in e&&(o.resource={...e.resource},"video"===e.type&&(o.resource.mimeType="video/mp4",o.resource.src=l,o.resource.poster=p,t.push(o.id)),"image"===e.type&&(o.resource.mimeType="image/png",o.resource.src=p)),o}))})))},t]},h=e=>{if(!e.length)return e;const t=e.match(/\/([^/?#]+)[^/]*$/);return t.length>1?`__WEB_STORIES_TEMPLATE_BASE_URL__/images/templates/%%templateName%%/${t[1]}`:e};function DevTools(){const[s,l]=t(!1),[p,v]=t(!1),[b,E]=t(!1),[T,x]=t(!1),{showSnackbar:w}=n(),S=o(),{reducerState:C,restore:_}=c((e=>{let{internal:t}=e;return{reducerState:t.reducerState,restore:t.restore}})),{pages:j,current:k,selection:I,story:{globalStoryStyles:N}}=C,R={current:k,selection:I,story:{globalStoryStyles:N},version:a,pages:j},B=b?f(R)[0]:T?(D=R,{...D,current:null,selection:[],story:{},pages:D.pages.map((e=>({...e,elements:e.elements.map((e=>{const t={...e};return"resource"in e&&(t.resource={...e.resource},"video"===e.type&&(t.resource.id=0,t.resource.posterId=0,t.resource.src=h(t.resource.src),t.resource.poster=h(t.resource.poster)),"image"===e.type&&(t.resource.id=0,t.resource.sizes=[],t.resource.src=h(t.resource.src))),t})),pageTemplateType:e?.pageTemplateType??""})))}):R;var D;const L=()=>l((e=>!e));i({key:"mod+shift+alt+j",editable:!0},L);const A=JSON.stringify(B,null,2),O=p?window.btoa(A):A,[P,$]=t(O);r((()=>$(O)),[O]);return s?e.createElement(m,null,e.createElement(d,null,e.createElement("div",null,e.createElement(g,{title:"For easier sharing thru various channels"},e.createElement("input",{type:"checkbox",checked:p,onChange:()=>v((e=>!e))}),"Base64"),e.createElement(g,{title:"Replace resources with dummy resources"},e.createElement("input",{type:"checkbox",checked:b,onChange:()=>E((e=>!e))}),"Dummy resources"),e.createElement(g,{title:"Export as Template"},e.createElement("input",{type:"checkbox",checked:T,onChange:()=>x((e=>!e))}),"Template")),e.createElement("div",null,e.createElement(y,{title:"Load data from input",onClick:()=>{let e=P;try{e=window.atob(e)}catch(e){}const t=JSON.parse(e),o={...t,story:{...C.story,...t.story},capabilities:C.capabilities},[r,s]=b?f(o):[o,[]];_(r),s.length>0&&s.forEach((e=>{const t=document.getElementById(`video-${e}`);t&&t.load()})),w({message:"Story restored from input",timeout:1200})}},"Load"),e.createElement(y,{title:"Copy data to clipboard",onClick:()=>{S.current.select(),document.execCommand("copy"),S.current.setSelectionRange(0,0),w({message:"Copied to clipboard",timeout:1200})}},"Copy"),e.createElement(y,{title:"Close DevTools",onClick:L},"X"))),e.createElement(u,{ref:S,className:"mousetrap",value:P,onChange:e=>$(e.target.value)})):null}export{DevTools as default};
