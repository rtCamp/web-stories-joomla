/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

import t from"react";import{useState as e,useRef as r,useCallback as o,useEffect as s}from"@googleforcreators/react";import{useTransform as p}from"@googleforcreators/transform";import"../dropTargets/provider.js";import"../dropTargets/context.js";import"../../app/history/historyProvider.js";import"../../app/history/context.js";import"prop-types";import"@googleforcreators/templates";import"../../app/config/context.js";import"../../app/api/context.js";import"@googleforcreators/fonts";import"@googleforcreators/dom";import{FLOATING_MENU_DISTANCE as i}from"../../constants/index.js";import"../../app/font/context.js";import"@googleforcreators/media";import"@googleforcreators/tracking";import"@googleforcreators/animation";import"uuid";import"@googleforcreators/masks";import"@googleforcreators/element-library";import"@googleforcreators/elements";import"../../app/story/context.js";import"@googleforcreators/migration";import"../../app/story/actions/useSaveStory.js";import"clone-deep";import"../../app/story/useStoryReducer/useStoryReducer.js";import"@googleforcreators/output";import"../../app/story/storyTriggers/storyTriggersProvider.js";import"../../app/story/storyTriggers/storyEvents/onInitialElementAddedRegister.js";import"../../app/story/storyTriggers/storyEvents/onPageAddedRegister.js";import a from"../../app/story/useStory.js";import"@googleforcreators/i18n";import"../../app/media/useUploadMedia.js";import"@googleforcreators/patterns";import"../../utils/generateBlurhash.worker.js";import"@googleforcreators/design-system";import"../../app/media/media3p/providerConfiguration.js";import"../../app/media/utils/useFFmpeg.js";import"../../app/media/media3p/api/context.js";import"../../app/media/local/constants.js";import"../../app/media/media3p/providerReducer.js";import"../../app/media/context.js";import"sat";import"@googleforcreators/units";import n from"../../app/layout/useLayout.js";import"../../app/layout/context.js";import"../../app/layout/useZoomSetting.js";import"@googleforcreators/rich-text";import"@googleforcreators/stickers";import"../library/panes/text/textPresets.js";import"../../app/canvas/context.js";import m from"../../app/canvas/useCanvas.js";import"../../app/currentUser/context.js";import"../../app/helpCenter/provider.js";import"../../app/helpCenter/context.js";import"../helpCenter/constants.js";import"../../app/rightClickMenu/context.js";import{SELECTED_ELEMENT_TYPES as c}from"./constants.js";import l from"./menu.js";function FloatingMenuLayer(){const{setMoveableMount:g,isEyedropperActive:d}=m((t=>{let{actions:e,state:r}=t;return{setMoveableMount:e.setMoveableMount,isEyedropperActive:r.isEyedropperActive}})),{workspaceWidth:u,workspaceHeight:f}=n((t=>{let{state:{workspaceWidth:e,workspaceHeight:r}}=t;return{workspaceWidth:e,workspaceHeight:r}})),{selectedElementType:y,selectionIdentifier:j}=a((t=>{let{state:{selectedElements:e}}=t;return{selectedElementType:1!==e.length||e[0].isBackground?e.length>1?c.MULTIPLE:c.NONE:e[0]?.type,selectionIdentifier:e.map((t=>{let{id:e}=t;return e})).join("")}})),h=p((t=>{let{state:e}=t;return e.isAnythingTransforming})),[v,x]=e(null),E=r(),w=r(),[b,k]=e(!1),M=o((()=>k(!0)),[]);s((()=>k(!1)),[j]),s((()=>(g((()=>x)),()=>g(null))),[g]),s((()=>{k(!!d)}),[d]),s((()=>{w.current={width:u,height:f}}),[u,f]);const T=y!==c.NONE&&!b&&v;return s((()=>{const t=E.current;if(!t||!v)return;const e=()=>{const e=v.getRect(),{width:r,height:o}=w.current,s=e.left+e.width/2;t.style.left=`clamp(0px, ${s}px - (var(--width) / 2), ${r}px - var(--width))`;const p=e.top+e.height+i;t.style.top=`clamp(0px, ${p}px, ${o}px - var(--height))`};e();const r=new MutationObserver(e),o=document.querySelector(".moveable-control-box");return r.observe(o,{attributes:!0,subtree:!0,attributeFilter:["style"]}),()=>r.disconnect()}),[v,T]),!!T&&t.createElement(l,{ref:E,handleDismiss:M,selectedElementType:y,selectionIdentifier:j,visuallyHidden:h})}export{FloatingMenuLayer as default};
