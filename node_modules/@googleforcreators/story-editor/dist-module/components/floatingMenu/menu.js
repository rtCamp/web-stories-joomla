/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

import e from"react";import{memo as t,forwardRef as o,useCallback as s,useLayoutEffect as r}from"@googleforcreators/react";import"prop-types";import i from"styled-components";import{__}from"@googleforcreators/i18n";import{useLiveRegion as n,ContextMenu as a}from"@googleforcreators/design-system";import{Z_INDEX_FLOATING_MENU as l}from"../../constants/zIndex.js";import"../canvas/editLayerFocusManager/context.js";import c from"../canvas/editLayerFocusManager/useFocusGroupRef.js";import m from"../canvas/editLayerFocusManager/constants.js";import"./context/context.js";import p from"./context/provider.js";import d from"./menus/selector.js";const u=__("To exit the floating menu, press Escape.","web-stories"),y=i.section.withConfig({displayName:"menu__MenuWrapper",componentId:"sc-pi2qzl-0"})(["display:flex;position:absolute;z-index:",";opacity:",";transition:140ms opacity;"],l,(e=>{let{visuallyHidden:t}=e;return t?0:1})),f=t(o((function FloatingMenu(t,o){let{selectionIdentifier:i,selectedElementType:f,handleDismiss:g,visuallyHidden:x}=t;const h=c(m.EDIT_ELEMENT),w=n(),E=s((()=>{w(u)}),[w]);return r((()=>{const e=o.current,t=()=>{e.style.width="";const t=e.getBoundingClientRect();e.style.setProperty("--width",`${t.width.toFixed(2)}px`),e.style.setProperty("--height",`${t.height.toFixed(2)}px`),e.style.width="var(--width)"};t();const s=new MutationObserver(t),r=e.querySelector("[role=menu]");return s.observe(r,{childList:!0}),()=>s.disconnect()}),[o,i]),e.createElement(y,{ref:o,"aria-label":__("Design menu","web-stories"),visuallyHidden:x},e.createElement(p,{handleDismiss:g},e.createElement(a,{isInline:!0,isHorizontal:!0,isSecondary:!0,isAlwaysVisible:!0,tabIndex:-1,ref:h,dismissOnEscape:!1,onFocus:E,"aria-label":__("Design options for selected element","web-stories"),onMouseDown:e=>{e.stopPropagation()},popoverZIndex:l},e.createElement(d,{selectedElementType:f}))))})));export{f as default};
