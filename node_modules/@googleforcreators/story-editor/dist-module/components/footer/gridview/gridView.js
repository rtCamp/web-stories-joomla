/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

import e from"react";import t from"styled-components";import"prop-types";import{useState as r,useRef as o,useResizeEffect as i,useCallback as a}from"@googleforcreators/react";import{__,sprintf}from"@googleforcreators/i18n";import{PAGE_RATIO as s}from"@googleforcreators/units";import{Button as p,Slider as n,useGridViewKeys as m,BUTTON_VARIANTS as l,BUTTON_TYPES as g,BUTTON_SIZES as d,Icons as c}from"@googleforcreators/design-system";import"@googleforcreators/transform";import"../../dropTargets/provider.js";import"../../dropTargets/context.js";import"../../../app/history/historyProvider.js";import"../../../app/history/context.js";import"@googleforcreators/templates";import"../../../app/config/context.js";import f from"../../../app/config/useConfig.js";import"../../../app/api/context.js";import"@googleforcreators/fonts";import"@googleforcreators/dom";import"../../../constants/fonts.js";import"../../../constants/multipleValue.js";import"../../../app/font/context.js";import"@googleforcreators/media";import"@googleforcreators/tracking";import"@googleforcreators/animation";import"uuid";import"@googleforcreators/masks";import"@googleforcreators/element-library";import"@googleforcreators/elements";import"../../../app/story/context.js";import"@googleforcreators/migration";import"../../../app/story/actions/useSaveStory.js";import"clone-deep";import"../../../app/story/useStoryReducer/useStoryReducer.js";import"@googleforcreators/output";import"../../../app/story/storyTriggers/storyTriggersProvider.js";import"../../../app/story/storyTriggers/storyEvents/onInitialElementAddedRegister.js";import"../../../app/story/storyTriggers/storyEvents/onPageAddedRegister.js";import u from"../../../app/story/useStory.js";import"../../../app/media/useUploadMedia.js";import"@googleforcreators/patterns";import"../../../utils/generateBlurhash.worker.js";import"../../../app/media/media3p/providerConfiguration.js";import"../../../app/media/utils/useFFmpeg.js";import"../../../app/media/media3p/api/context.js";import"../../../app/media/local/constants.js";import"../../../app/media/media3p/providerReducer.js";import"../../../app/media/context.js";import"sat";import"../../../app/layout/context.js";import"../../../app/layout/useZoomSetting.js";import"@googleforcreators/rich-text";import"@googleforcreators/stickers";import"../../library/panes/text/textPresets.js";import"../../../app/canvas/context.js";import"../../../app/currentUser/context.js";import"../../../app/helpCenter/provider.js";import"../../../app/helpCenter/context.js";import"../../helpCenter/constants.js";import"../../../app/rightClickMenu/context.js";import h from"../../reorderable/reorderable.js";import y from"../../reorderable/reorderableItem.js";import x from"../../reorderable/reorderableSeparator.js";import"../../reorderable/context.js";import w from"../pagepreview/index.js";const j=t.section.withConfig({displayName:"gridView__Container",componentId:"sc-ytsaos-0"})(["display:flex;flex-direction:column;height:100%;width:100%;padding:32px;"]),b=t.header.withConfig({displayName:"gridView__TopRow",componentId:"sc-ytsaos-1"})(["display:flex;justify-content:space-between;align-items:center;margin-bottom:36px;@media ","{margin-bottom:72px;}@media ","{margin-bottom:112px;}"],(e=>{let{theme:t}=e;return t.breakpoint.desktop}),(e=>{let{theme:t}=e;return t.breakpoint.wide})),I=t(h).withConfig({displayName:"gridView__Wrapper",componentId:"sc-ytsaos-2"})(["position:relative;overflow-y:auto;overflow-y:overlay;overflow-x:hidden;flex-grow:1;display:flex;flex-direction:column;pointer-events:all;padding:4px;"]),C=t.div.withConfig({displayName:"gridView__Grid",componentId:"sc-ytsaos-3"})(["position:relative;display:grid;grid-template-columns:",";grid-template-rows:repeat(auto-fill,","px);grid-gap:","px;justify-content:center;align-items:flex-start;flex-grow:1;"],(e=>{let{pageWidth:t}=e;return`repeat(auto-fit, minmax(${t}px, max-content))`}),(e=>{let{pageHeight:t}=e;return t}),(e=>{let{gapWidth:t}=e;return t})),v=t.div.withConfig({displayName:"gridView__NoButton",componentId:"sc-ytsaos-4"})(["flex:0 0 56px;"]),P=t(p).withConfig({displayName:"gridView__ClickableButton",componentId:"sc-ytsaos-5"})(["pointer-events:all;"]),E=t(n).withConfig({displayName:"gridView__ClickableSlider",componentId:"sc-ytsaos-6"})(["pointer-events:all;width:366px;"]),_=t(x).withConfig({displayName:"gridView__PageSeparator",componentId:"sc-ytsaos-7"})(["position:absolute;bottom:0;left:","px;width:","px;height:","px;display:flex;justify-content:center;align-items:center;",""],(e=>{let{width:t}=e;return t/2}),(e=>{let{width:t,margin:r}=e;return t+r}),(e=>{let{height:t}=e;return t}),(e=>{let{before:t,width:r,margin:o}=e;return t&&`\n      left: -${(r+2*o)/2}px;\n    `})),k=t.div.withConfig({displayName:"gridView__Line",componentId:"sc-ytsaos-8"})(["background:",";height:","px;width:2px;margin:0px;"],(e=>{let{theme:t}=e;return t.colors.border.selection}),(e=>{let{height:t}=e;return t})),R=t.div.withConfig({displayName:"gridView__ItemContainer",componentId:"sc-ytsaos-9"})(["display:flex;flex-direction:row;position:relative;"]);function GridView(t){let{onClose:p}=t;const{pages:n,currentPageId:h,currentPageIndex:x,setCurrentPage:V,arrangePage:S}=u((e=>{let{state:{pages:t,currentPageIndex:r,currentPageId:o},actions:{setCurrentPage:i,arrangePage:a}}=e;return{pages:t,currentPageIndex:r,currentPageId:o,setCurrentPage:i,arrangePage:a}})),{isRTL:N}=f(),[T,M]=r(4),[A,G]=r(null),W=o();i(W,(e=>{let{width:t}=e;return G(t)}),[]);const L=(A-20*(T-1))/T,U=12*Math.floor(L/12),z=U*T,B=Math.floor((A-z)/(T-1)),F=U/s,H=e=>()=>V({pageId:e.id}),$=o(),D=o({}),Q=a(((e,t)=>{S({pageId:e,position:t})}),[S]);m({containerRef:W,gridRef:$,itemRefs:D,isRTL:N,currentItemId:h,items:n,arrangeItem:Q});const Y=Math.min(F-24,64);return e.createElement(j,{"aria-label":__("Grid View","web-stories")},e.createElement(b,null,e.createElement(P,{variant:l.SQUARE,type:g.TERTIARY,size:d.MEDIUM,onClick:p,"aria-label":__("Close","web-stories")},e.createElement(c.Cross,null)),e.createElement(E,{min:4,max:12,majorStep:1,minorStep:1,value:T,handleChange:e=>M(e),"aria-label":__("Pages per row","web-stories")}),e.createElement(v,null)),e.createElement(I,{"aria-label":__("Grid View Pages List","web-stories"),ref:W,onPositionChange:(e,t)=>{const r=n[e].id;S({pageId:r,position:t}),V({pageId:r})},mode:"grid",getItemSize:()=>F,scrollSize:64},e.createElement(C,{pageWidth:U,pageHeight:F,gapWidth:B,ref:$},n.map(((t,r)=>{const o=r===x,i=n.length>1;return e.createElement(R,{key:t.id,ref:e=>{D.current[t.id]=e}},e.createElement(_,{position:r,width:U,height:F,margin:B,before:!0},e.createElement(k,{height:Y})),e.createElement(y,{position:r},e.createElement(w,{key:t.id,label:sprintf(
/* translators: %s: page number. */
__(o?"Page %s (current page)":"Page %s","web-stories"),r+1),tabIndex:o&&i?0:-1,isActive:o&&i,page:t,width:U,height:F,onClick:H(t),isInteractive:i,gridRef:$,role:"option"})),e.createElement(_,{position:r+1,width:U,height:F,margin:B},e.createElement(k,{height:Y})))})))))}export{GridView as default};
