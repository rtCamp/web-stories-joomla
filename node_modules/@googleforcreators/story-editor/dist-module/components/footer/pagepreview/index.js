/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

import e from"react";import r,{css as t}from"styled-components";import{rgba as o}from"polished";import"prop-types";import{generatePatternStyles as a}from"@googleforcreators/patterns";import{UnitsProvider as i}from"@googleforcreators/units";import{useState as s,useCallback as p,useEffect as n,useMemo as l}from"@googleforcreators/react";import{TransformProvider as c}from"@googleforcreators/transform";import"../../../types.js";import"../../../utils/storyPageToNode.js";import"@ap.cx/hues";import"../../../constants/fonts.js";import"../../../constants/multipleValue.js";import{TRACKING_EVENTS as m}from"../../../constants/performanceTrackingEvents.js";import"@googleforcreators/animation";import"uuid";import"@googleforcreators/masks";import"@googleforcreators/element-library";import"@googleforcreators/elements";import"../../../app/story/context.js";import"@googleforcreators/migration";import"@googleforcreators/templates";import"../../../app/config/context.js";import"../../../app/api/context.js";import"../../../app/history/historyProvider.js";import"../../../app/history/context.js";import"../../../app/story/actions/useSaveStory.js";import"clone-deep";import"../../../app/story/useStoryReducer/useStoryReducer.js";import"@googleforcreators/output";import"../../../app/story/storyTriggers/storyTriggersProvider.js";import"../../../app/story/storyTriggers/storyEvents/onInitialElementAddedRegister.js";import"../../../app/story/storyTriggers/storyEvents/onPageAddedRegister.js";import"../../../app/pageCanvas/context.js";import"../../../app/pageCanvas/pageCanvasCacheValidator.js";import g from"../../../app/pageCanvas/usePageCanvas.js";import d from"../../canvas/displayElement.js";import f from"../../../utils/usePerformanceTracking.js";function u(){return u=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e},u.apply(this,arguments)}const v=r.button.withConfig({displayName:"pagepreview__Page",componentId:"sc-f0c590-0"})(["display:block;position:relative;cursor:",";padding:0;border:0;background-color:transparent;height:","px;width:","px;flex:none;outline:0;&::after{content:'';display:block;position:absolute;left:-4px;right:-4px;top:-4px;bottom:-4px;pointer-events:none;border-style:solid;border-width:1px;border-radius:8px;border-color:",";}",""],(e=>{let{isInteractive:r}=e;return r?"pointer":"default"}),(e=>{let{height:r}=e;return r}),(e=>{let{width:r}=e;return r}),(e=>{let{isActive:r,isInteractive:t,theme:o}=e;return t&&r?o.colors.border.defaultActive:"transparent"}),(e=>{let{isInteractive:r,isActive:a,theme:i}=e;return r&&t(["&:focus::after{border-color:",";}"],o(i.colors.border.selection,a?1:.7))})),y=r.div.withConfig({displayName:"pagepreview__PreviewWrapper",componentId:"sc-f0c590-1"})(["height:100%;position:relative;overflow:hidden;background-color:white;border-radius:4px;",""],(e=>{let{background:r}=e;return a(r)})),h=r.img.withConfig({displayName:"pagepreview__Image",componentId:"sc-f0c590-2"})(["position:absolute;width:100%;left:0;top:50%;transform:translateY(-50%);"]);function PagePreview(r){let{page:t,label:o,...a}=r;const{backgroundColor:b}=t,{width:j,height:w,isActive:C}=a,{pageCanvas:P,generateDeferredPageCanvas:x}=g((e=>{let{state:r,actions:o}=e;return{pageCanvas:r.pageCanvasMap[t.id],generateDeferredPageCanvas:o.generateDeferredPageCanvas}})),[E,k]=s(),I=p((e=>e&&k(e)),[]);n((()=>{C||P||x([t.id,t])}),[t,P,C,x]);const _=l((()=>P?P.toDataURL("image/png"):null),[P]);return f({node:E,eventData:m.PAGE_PREVIEW_CLICK}),e.createElement(i,{pageSize:{width:j,height:w}},e.createElement(c,null,e.createElement(v,u({ref:I,"aria-label":o},a),e.createElement(y,{background:b},_?e.createElement(h,{src:_,alt:o,decoding:"async"}):t.elements.map((r=>e.createElement(d,{key:r.id,previewMode:!0,element:r})))))))}export{PagePreview as default};
