/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

import e from"react";import t,{css as o}from"styled-components";import"prop-types";import{forwardRef as r,useState as p,useRef as i,useCallback as n,useUnmount as a}from"@googleforcreators/react";import{__}from"@googleforcreators/i18n";import{getOpaquePattern as s,getPreviewText as l}from"@googleforcreators/patterns";import{HexInput as c,Swatch as m,PLACEMENT as d,Text as g,THEME_CONSTANTS as u,Icons as f,Popup as h}from"@googleforcreators/design-system";import"../../../constants/fonts.js";import{MULTIPLE_DISPLAY_VALUE as x,MULTIPLE_VALUE as y}from"../../../constants/multipleValue.js";import j from"../../colorPicker/colorPicker.js";import v from"../../sidebar/useSidebar.js";import b from"../../tooltip/tooltip.js";import{inputContainerStyleOverride as C,focusStyle as E}from"../../panels/shared/styles.js";import"@googleforcreators/transform";import"../../dropTargets/provider.js";import"../../dropTargets/context.js";import"../../../app/history/historyProvider.js";import"../../../app/history/context.js";import"@googleforcreators/templates";import"../../../app/config/context.js";import I from"../../../app/config/useConfig.js";import"../../../app/api/context.js";import"@googleforcreators/fonts";import"@googleforcreators/dom";import"../../../app/font/context.js";import"@googleforcreators/media";import"@googleforcreators/tracking";import"@googleforcreators/animation";import"uuid";import"@googleforcreators/masks";import"@googleforcreators/element-library";import"@googleforcreators/elements";import"../../../app/story/context.js";import"@googleforcreators/migration";import"../../../app/story/actions/useSaveStory.js";import"clone-deep";import"../../../app/story/useStoryReducer/useStoryReducer.js";import"@googleforcreators/output";import"../../../app/story/storyTriggers/storyTriggersProvider.js";import"../../../app/story/storyTriggers/storyEvents/onInitialElementAddedRegister.js";import"../../../app/story/storyTriggers/storyEvents/onPageAddedRegister.js";import"../../../app/media/useUploadMedia.js";import"../../../utils/generateBlurhash.worker.js";import"../../../app/media/media3p/providerConfiguration.js";import"../../../app/media/utils/useFFmpeg.js";import"../../../app/media/media3p/api/context.js";import"../../../app/media/local/constants.js";import"../../../app/media/media3p/providerReducer.js";import"../../../app/media/context.js";import"sat";import"@googleforcreators/units";import"../../../app/layout/context.js";import"../../../app/layout/useZoomSetting.js";import"@googleforcreators/rich-text";import"@googleforcreators/stickers";import"../../library/panes/text/textPresets.js";import"../../../app/canvas/context.js";import w from"../../../app/canvas/useCanvas.js";import"../../../app/currentUser/context.js";import"../../../app/helpCenter/provider.js";import"../../../app/helpCenter/context.js";import"../../helpCenter/constants.js";import"../../../app/rightClickMenu/context.js";function S(){return S=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var r in o)Object.prototype.hasOwnProperty.call(o,r)&&(e[r]=o[r])}return e},S.apply(this,arguments)}const P=t.div.withConfig({displayName:"colorInput__Preview",componentId:"sc-1h4cp44-0"})(["height:36px;color:",";cursor:pointer;position:relative;width:100%;padding:0;"],(e=>{let{theme:t}=e;return t.colors.fg.primary})),_=t(c).withConfig({displayName:"colorInput__Input",componentId:"sc-1h4cp44-1"})(["min-width:100px;div{background-color:transparent;}input{padding-left:26px;}"]),T=t(b).withConfig({displayName:"colorInput__Tooltip",componentId:"sc-1h4cp44-2"})(["width:100%;height:100%;"]),k=o(["position:absolute;top:0;left:0;border-radius:50px;width:24px;height:24px;"]),R=o(["overflow:hidden;border:1px solid ",";outline:none;background:transparent;"],(e=>{let{theme:t}=e;return t.colors.border.defaultNormal})),A=o(["",";padding-right:6px;"],C),O=t(P).attrs({as:"button",type:"button"}).withConfig({displayName:"colorInput__ColorButton",componentId:"sc-1h4cp44-3"})(["border-radius:4px;"," display:flex;&:focus{box-shadow:0px 0px 0 2px ",",0px 0px 0 4px ",";border-color:",";}"],R,(e=>{let{theme:t}=e;return t.colors.bg.primary}),(e=>{let{theme:t}=e;return t.colors.border.focus}),(e=>{let{theme:t}=e;return t.colors.border.defaultHover})),N=t.div.withConfig({displayName:"colorInput__ColorPreview",componentId:"sc-1h4cp44-4"})([""," top:6px;left:6px;padding:0;background:transparent;cursor:pointer;"],k),L=t.div.withConfig({displayName:"colorInput__TextualPreview",componentId:"sc-1h4cp44-5"})(["padding:6px 12px 6px 38px;text-align:left;flex-grow:1;height:32px;"]),M=t(L).withConfig({displayName:"colorInput__MixedLabel",componentId:"sc-1h4cp44-6"})(["align-self:center;padding:6px 6px 6px 38px;"]),F=t(m).withConfig({displayName:"colorInput__StyledSwatch",componentId:"sc-1h4cp44-7"})(["",";"],E),D=t.div.withConfig({displayName:"colorInput__ChevronContainer",componentId:"sc-1h4cp44-8"})(["width:",";display:flex;justify-content:",";align-items:center;align-self:center;svg{width:24px;height:24px;}"],(e=>{let{isSmall:t}=e;return t?"28px":"58px"}),(e=>{let{isSmall:t}=e;return t?"center":"flex-end"})),H=()=>import("react-color"),Y=r((function ColorInput(t,o){let{onChange:r,value:c=null,label:b=null,changedStyle:E,pickerPlacement:k=d.RIGHT_START,isInDesignMenu:R=!1,hasInputs:Y=!0,pickerProps:B,spacing:G,tooltipPlacement:Z,...z}=t;const U=c===y;c=U?"":c;const V=c?s(c):{color:{r:0,g:0,b:0,a:0}},W=l(c),[X,q]=p(!1),J=i(null),{isEyedropperActive:K}=w((e=>{let{state:{isEyedropperActive:t}}=e;return{isEyedropperActive:t}})),{isRTL:Q,styleConstants:{topOffset:$}={}}=I(),[ee,te]=p(k),{refs:{sidebar:oe}}=v(),re=n((e=>{if(k?.startsWith("top")){const{top:t}=e.current?.getBoundingClientRect()||{};t<=$&&te(k.replace("top","bottom"))}}),[k,$]),pe=c?.type,ie=(!pe||"solid"===pe)&&Y,ne={onClick:()=>q(!0),"aria-label":b,onPointerEnter:()=>H(),onFocus:()=>H(),tabIndex:z.tabIndex};a((()=>()=>q(!1)));const ae=n((()=>q(!1)),[]),se=__("Open color picker","web-stories"),le=R?A:C;return e.createElement(e.Fragment,null,ie?e.createElement(P,{ref:J},e.createElement(_,S({ref:o,"aria-label":b,value:U?null:c,onChange:r,isIndeterminate:U,placeholder:U?x:"",containerStyleOverride:le},z)),e.createElement(N,null,e.createElement(T,{title:se,hasTail:!0,placement:Z},e.createElement(F,S({isSmall:!0,pattern:V},ne))))):e.createElement(T,{title:se,hasTail:!0,placement:Z},e.createElement(O,S({ref:J},ne),e.createElement(N,null,e.createElement(m,{isPreview:!0,role:"status",tabIndex:"-1",pattern:V,isIndeterminate:U})),Y?e.createElement(L,null,e.createElement(g,{size:u.TYPOGRAPHY.PRESET_SIZES.SMALL},W)):e.createElement(e.Fragment,null,U&&e.createElement(M,null,e.createElement(g,{size:u.TYPOGRAPHY.PRESET_SIZES.SMALL,as:"span"},x)),e.createElement(D,{isSmall:U},e.createElement(f.ChevronDown,null))))),e.createElement(h,{isRTL:Q,anchor:J,dock:R?null:oe,isOpen:X,placement:ee,spacing:G,invisible:K,topOffset:$,refCallback:re,resetXOffset:!0,renderContents:t=>{let{propagateDimensionChange:o}=t;return e.createElement(j,S({color:U?null:c,isEyedropperActive:K,onChange:r,onClose:ae,changedStyle:E,onDimensionChange:o},B))}}))}));export{Y as default};
