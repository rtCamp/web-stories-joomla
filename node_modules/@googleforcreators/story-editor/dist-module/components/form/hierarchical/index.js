/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

import e from"react";import"prop-types";import r from"styled-components";import{Text as t,THEME_CONSTANTS as o,themeHelpers as n,useLiveRegion as a,KEYS as l,useKeyDownEffect as i,Input as c,Checkbox as s}from"@googleforcreators/design-system";import{sprintf,_n,__}from"@googleforcreators/i18n";import{useDebouncedCallback as d,useRef as m,useState as p,useCallback as h,usePrevious as u,useEffect as g}from"@googleforcreators/react";import f from"../../directionAware/index.js";function b(){return b=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e},b.apply(this,arguments)}const x=r.div.withConfig({displayName:"hierarchical__Container",componentId:"sc-1pgjcwl-0"})(["margin-bottom:8px;display:block;"]),w=r(t).attrs({forwardedAs:"label",size:o.TYPOGRAPHY.PRESET_SIZES.SMALL}).withConfig({displayName:"hierarchical__Label",componentId:"sc-1pgjcwl-1"})(["margin:0 12px;"]),y=r.div.withConfig({displayName:"hierarchical__Border",componentId:"sc-1pgjcwl-2"})(["padding-top:4px;margin-top:-4px;border:1px solid ",";border-top:none;border-radius:",";"],(e=>{let{theme:r}=e;return r.colors.border.defaultNormal}),(e=>{let{theme:r}=e;return`0 0 ${r.borders.radius.small} ${r.borders.radius.small}`})),_=r.ul.withConfig({displayName:"hierarchical__CheckboxArea",componentId:"sc-1pgjcwl-3"})(["max-height:175px;padding:12px 12px 0 12px;overflow-y:scroll;margin-top:4px;margin-bottom:0;",";:focus-within{",";}"],n.scrollbarCSS,(e=>{let{theme:r}=e;return n.focusCSS(r.colors.border.focus,r.colors.bg.secondary)})),v=r.li.withConfig({displayName:"hierarchical__CheckboxContainer",componentId:"sc-1pgjcwl-4"})(["display:flex;align-items:center;margin-bottom:8px;margin-left:","px;"],(e=>{let{$level:r}=e;return 20*r})),C=r(t).withConfig({displayName:"hierarchical__NoResultsText",componentId:"sc-1pgjcwl-5"})(["margin-bottom:12px;color:",";"],(e=>{let{theme:r}=e;return r.colors.fg.secondary})),E=e=>`hierarchical_term_option_${e}`,Option=r=>{let{optionRefs:t={current:{}},$level:o=0,...n}=r;const{id:a,label:l,onBlur:i,onChange:c,onFocus:d,checked:m,value:p}=n,h=E(n.id),u=`hierarchical_term_${n.label}`;return e.createElement(v,{"aria-selected":m,role:"treeitem",$level:o},e.createElement(s,{id:h,ref:e=>{t.current[a]=e},value:p,checked:m,name:u,onChange:e=>c(e,n),onBlur:i,onFocus:d,tabIndex:-1}),e.createElement(w,{htmlFor:h},l))},HierarchicalInput=r=>{let{className:t,inputValue:n,onInputChange:s,label:w,noOptionsText:v,options:k,onChange:S,...I}=r;const N=a("assertive"),j=d(N,500),P=m(null),A=m(null),[O,R]=p(-1),T=m({}),$=h((e=>{if(document.activeElement===P.current){if(!k.length)return;if(P.current.contains(e.relatedTarget))return void A.current?.focus();if(-1===O){const e=k.find((e=>e.checked))?.id;R(e||0)}else T.current[O]?.focus()}}),[O,k]),B=h((e=>{const r=k.findIndex((e=>e.id===O));switch(e.key){case l.UP:r>0&&R(k[r-1].id);break;case l.DOWN:r<k.length-1&&R(k[r+1].id)}}),[k,O]),L=h((e=>{s(e.target.value)}),[s]),F=h(((e,r)=>{S(e,{id:r.id,checked:!r.checked})}),[S]),Y=u(n);g((()=>{if(Y!==n){const e=k.length,r=sprintf(
/* Translators: %d: Number of results. */
_n("%d result found.","%d results found.","web-stories","web-stories"),e);j(r)}}),[j,k,n,Y]),i(P,{key:["up","down","shift+up","shift+down"]},B,[B]),g((()=>{P.current?.contains(document.activeElement)&&T.current[O]?.focus()}),[O]);const z=Boolean(k.length)||Boolean(n.length);return e.createElement(x,{className:t},e.createElement(c,b({ref:A,value:n,onChange:L,label:w,type:"search",placeholder:__("Search","web-stories")},I)),z&&e.createElement(y,null,e.createElement(f,null,e.createElement(_,{id:"checkbox_list",ref:P,tabIndex:0,onFocus:$,role:"tree","aria-activedescendant":-1!==O?E(O):void 0,"aria-multiselectable":!0},k.length?k.map((r=>e.createElement(Option,b({key:r.id},r,{onChange:F,optionRefs:T})))):e.createElement(C,{role:"treeitem",size:o.TYPOGRAPHY.PRESET_SIZES.SMALL},v)))))};export{HierarchicalInput as default};
