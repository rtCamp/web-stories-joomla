/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

import t from"react";import{__}from"@googleforcreators/i18n";import{useGlobalKeyDownEffect as o,Button as r,BUTTON_VARIANTS as e,BUTTON_TYPES as s,BUTTON_SIZES as i,Icons as a}from"@googleforcreators/design-system";import"prop-types";import{isAfter as p,subMinutes as n,toDate as m,getOptions as l}from"@googleforcreators/date";import"@googleforcreators/transform";import"../../dropTargets/provider.js";import"@googleforcreators/react";import"../../dropTargets/context.js";import"../../../app/history/historyProvider.js";import c from"../../../app/history/useHistory.js";import"@googleforcreators/templates";import"../../../app/config/context.js";import"../../../app/api/context.js";import"@googleforcreators/fonts";import"@googleforcreators/dom";import"../../../constants/fonts.js";import"../../../constants/multipleValue.js";import"../../../app/font/context.js";import"@googleforcreators/media";import"@googleforcreators/tracking";import"@googleforcreators/animation";import"uuid";import"@googleforcreators/masks";import"@googleforcreators/element-library";import"@googleforcreators/elements";import"../../../app/story/context.js";import"@googleforcreators/migration";import"../../../app/story/actions/useSaveStory.js";import"clone-deep";import"../../../app/story/useStoryReducer/useStoryReducer.js";import"@googleforcreators/output";import"../../../app/story/storyTriggers/storyTriggersProvider.js";import"../../../app/story/storyTriggers/storyEvents/onInitialElementAddedRegister.js";import"../../../app/story/storyTriggers/storyEvents/onPageAddedRegister.js";import g from"../../../app/story/useStory.js";import"../../../app/media/useUploadMedia.js";import"@googleforcreators/patterns";import"../../../utils/generateBlurhash.worker.js";import"../../../app/media/media3p/providerConfiguration.js";import"../../../app/media/utils/useFFmpeg.js";import"../../../app/media/media3p/api/context.js";import"../../../app/media/local/constants.js";import"../../../app/media/media3p/providerReducer.js";import"../../../app/media/context.js";import"sat";import"@googleforcreators/units";import"../../../app/layout/context.js";import"../../../app/layout/useZoomSetting.js";import"@googleforcreators/rich-text";import"@googleforcreators/stickers";import"../../library/panes/text/textPresets.js";import"../../../app/canvas/context.js";import"../../../app/currentUser/context.js";import"../../../app/helpCenter/provider.js";import"../../../app/helpCenter/context.js";import"../../helpCenter/constants.js";import"../../../app/rightClickMenu/context.js";import d from"../../tooltip/tooltip.js";import u from"../../../utils/useIsUploadingToStory.js";import f from"./buttonWithChecklistWarning.js";function PlainButton(o){let{text:p,onClick:n,disabled:m}=o;return t.createElement(d,{title:p,hasTail:!0},t.createElement(r,{variant:e.SQUARE,type:s.QUATERNARY,size:i.SMALL,onClick:n,disabled:m,"aria-label":p},t.createElement(a.FloppyDisk,null)))}function UpdateButton(r){let{hasUpdates:e=!1,forceIsSaving:s=!1}=r;const{isSaving:i,status:a,date:d,saveStory:j,canPublish:y}=g((t=>{let{state:{meta:{isSaving:o},story:{status:r,date:e},capabilities:s},actions:{saveStory:i}}=t;return{isSaving:o,status:r,date:e,saveStory:i,canPublish:Boolean(s?.publish)}})),v=i||s,h=u(),{state:{hasNewChanges:x}}=c();o({key:["mod+s"]},(t=>{t.preventDefault(),v||h||j()}),[j,v,h]);const S=!v&&!h&&(x||e),b="draft"===a||!a;if("pending"===a)return t.createElement(PlainButton,{text:__("Save as pending","web-stories"),disabled:!S,onClick:()=>j()});if(b)return t.createElement(PlainButton,{text:__("Save draft","web-stories"),disabled:!S,onClick:()=>j()});const k=p(n(m(d,l()),1),m(new Date,l())),C=__(k&&"private"!==a?"Schedule":"Update","web-stories");return t.createElement(f,{text:C,onClick:()=>j(),disabled:!S,isUploading:h,canPublish:y})}export{UpdateButton as default};
