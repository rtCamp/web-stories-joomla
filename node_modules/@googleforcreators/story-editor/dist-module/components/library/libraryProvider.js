/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

import t from"react";import"prop-types";import{useState as o,useCallback as e,useMemo as r,useEffect as s,useRef as i}from"@googleforcreators/react";import{useFeature as p}from"flagged";import{trackEvent as a,getTimeTracker as m}from"@googleforcreators/tracking";import{loadTextSets as n}from"@googleforcreators/text-sets";import{uniqueEntriesByKey as l}from"@googleforcreators/design-system";import"../canvas/canvasLayout.js";import g from"../canvas/useInsertElement.js";import c from"../canvas/useInsertTextSet.js";import"../../app/highlights/styles.js";import d from"../../app/highlights/useHighlights.js";import"../../constants/fonts.js";import"../../constants/multipleValue.js";import"@googleforcreators/animation";import"uuid";import"@googleforcreators/masks";import"@googleforcreators/element-library";import"@googleforcreators/elements";import"../../app/story/context.js";import"@googleforcreators/migration";import"@googleforcreators/templates";import"../../app/config/context.js";import u from"../../app/config/useConfig.js";import"../../app/api/context.js";import f from"../../app/api/useAPI.js";import"../../app/history/historyProvider.js";import"../../app/history/context.js";import"../../app/story/actions/useSaveStory.js";import"clone-deep";import"../../app/story/useStoryReducer/useStoryReducer.js";import"@googleforcreators/output";import"../../app/story/storyTriggers/storyTriggersProvider.js";import"../../app/story/storyTriggers/storyEvents/onInitialElementAddedRegister.js";import"../../app/story/storyTriggers/storyEvents/onPageAddedRegister.js";import"../../app/highlights/context.js";import"../../app/highlights/states.js";import"../../app/highlights/quickActions/constants.js";import"../../app/highlights/quickActions/useQuickActions.js";import"@googleforcreators/transform";import"../dropTargets/provider.js";import"../dropTargets/context.js";import"@googleforcreators/fonts";import"@googleforcreators/dom";import"../../app/font/context.js";import"@googleforcreators/media";import"@googleforcreators/i18n";import"../../app/media/useUploadMedia.js";import"@googleforcreators/patterns";import"../../utils/generateBlurhash.worker.js";import"../../app/media/media3p/providerConfiguration.js";import"../../app/media/utils/useFFmpeg.js";import"../../app/media/media3p/api/context.js";import"../../app/media/local/constants.js";import"../../app/media/media3p/providerReducer.js";import"../../app/media/context.js";import"sat";import"@googleforcreators/units";import"../../app/layout/context.js";import"../../app/layout/useZoomSetting.js";import"@googleforcreators/rich-text";import"./panes/text/textPresets.js";import"../../app/canvas/context.js";import"../../app/currentUser/context.js";import"../../app/helpCenter/provider.js";import"../../app/helpCenter/context.js";import"../helpCenter/constants.js";import"../../app/rightClickMenu/context.js";import h from"./context.js";import{ELEMS as j,MEDIA as y,MEDIA3P as x,PAGE_TEMPLATES as T,SHAPES as v,TEXT as S,SHOPPING as b}from"./constants.js";const k=new Set([j,y,x,T,v,S,b].map((t=>t.id)));function LibraryProvider(C){let{children:P}=C;const{showMedia3p:I,canViewDefaultTemplates:E}=u(),{actions:{getMedia:w,getCustomPageTemplates:A}}=f(),B=p("shoppingIntegration"),R=p("showElementsTab"),_=Boolean(A),F=E||_,L=Boolean(w),[M,U]=o({}),[q,O]=o({}),[V,D]=o(null),[H,N]=o(1),[Q,Z]=o(!1),z=e((t=>D((o=>l("function"==typeof t?t(o):t,"templateId")))),[]),G=e((t=>{D((o=>o.map((o=>o.templateId===t.templateId?{...o,...t}:o))))}),[]),J=r((()=>[L&&y,I&&x,S,v,R&&j,B&&b,F&&T].filter(Boolean)),[I,R,L,F,B]),[K,W]=o(J[0].id),X=g(),{insertTextSet:Y,insertTextSetByOffset:$}=c(Q),{highlightedTab:tt}=d((t=>{let{section:o}=t;return{highlightedTab:o}}));s((()=>{k.has(tt)&&(W(tt),a("quick_action_tab_change",{name:tt}))}),[tt]);const ot=i(null),et=i(null),rt=i(null),st=i(null),it=i(null),pt=i(null),at=i(null),mt=r((()=>({[y.id]:ot,[x.id]:et,[S.id]:rt,[v.id]:st,[j.id]:it,[T.id]:pt,[b.id]:at})),[]),nt=r((()=>({state:{areTextSetsLoading:q,tab:K,tabRefs:mt,textSets:M,savedTemplates:V,nextTemplatesToFetch:H,shouldUseSmartColor:Q},actions:{setTab:W,insertElement:X,insertTextSet:Y,insertTextSetByOffset:$,setSavedTemplates:z,updateSavedTemplate:G,setNextTemplatesToFetch:N,setShouldUseSmartColor:Z},data:{tabs:J}})),[q,K,mt,M,V,X,Y,$,J,H,N,Q,z,G]);return s((()=>{let t=!0;return K!==S.id||Object.keys(M).length||async function(){const o=m("load_text_sets");O(!0);const e=await n();o(),t&&(U(e),O(!1))}(),()=>{t=!1}}),[K,M]),t.createElement(h.Provider,{value:nt},P)}export{LibraryProvider as default};
