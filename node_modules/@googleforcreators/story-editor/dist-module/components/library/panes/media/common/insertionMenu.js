/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

import e from"react";import t,{css as n}from"styled-components";import"prop-types";import{useRef as o,useState as r,useCallback as i,useMemo as s}from"@googleforcreators/react";import{__}from"@googleforcreators/i18n";import{v4 as a}from"uuid";import{useKeyDownEffect as l,Icons as m,Popup as c,PLACEMENT as p,Menu as d,noop as u}from"@googleforcreators/design-system";import{getSmallestUrlForWidth as f}from"@googleforcreators/media";import g from"../../../../canvas/utils/getElementProperties.js";import b from"../../../../../app/story/useStory.js";import{ActionButton as I}from"../../shared/index.js";import x from"../../../../../utils/useRovingTabIndex/index.js";import y from"../../../../canvas/useFocusCanvas.js";const v=t.div.withConfig({displayName:"insertionMenu__DropDownContainer",componentId:"sc-xjd4tf-0"})(["margin-top:10px;min-width:160px;"]),w=t.div.withConfig({displayName:"insertionMenu__MenuContainer",componentId:"sc-xjd4tf-1"})(["z-index:1;"]),E=n(["min-width:160px;margin-top:0;li{display:block;}"]),h="insert",M="addBackground";function InsertionMenu(t){let{resource:n,display:k,onInsert:j,width:C,index:P,isLocal:O=!1,setParentActive:T=u,setParentInactive:_=u}=t;const B=o(),[S,A]=r(!1),D=i((e=>{e.stopPropagation(),A(!0)}),[]),R=i((()=>{A(!1),B.current?.focus(),T()}),[T]),{currentBackgroundId:$,combineElements:F}=b((e=>({currentBackgroundId:e.state.currentPage?.elements?.[0]?.id,combineElements:e.actions.combineElements}))),{type:N,poster:z}=n,L=[{group:[{label:["image","gif"].includes(N)?__("Insert image","web-stories"):__("Insert video","web-stories"),value:h},{label:__("Add as background","web-stories"),value:M}]}];x({ref:B},[],3);const q=y();l(O?null:B,"tab",q,[q]);const G=s((()=>`list-${a()}`),[]),H=s((()=>`button-${a()}`),[]);return e.createElement(w,null,e.createElement(I,{ref:B,onClick:D,"aria-label":__("Open insertion menu","web-stories"),"aria-pressed":S,"aria-haspopup":!0,"aria-expanded":S,"aria-owns":S?G:null,id:H,$display:k,tabIndex:0===P?0:-1},e.createElement(m.PlusFilledSmall,null)),S&&e.createElement(c,{anchor:B,placement:p.BOTTOM_START,isOpen:S},e.createElement(v,null,e.createElement(d,{parentId:H,listId:G,onMenuItemClick:(e,t)=>{const o=z||f(C,n),r=g(n.type,{resource:n});switch(A(!1),t){case h:j(n,o);break;case M:F({firstElement:r,secondId:$})}_()},options:L,onDismissMenu:R,hasMenuRole:!0,menuStylesOverride:E}))))}export{InsertionMenu as default};
