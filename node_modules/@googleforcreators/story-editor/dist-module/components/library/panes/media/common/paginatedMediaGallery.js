/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

import e from"react";import"prop-types";import{useRef as t,useCallback as r,useDebouncedCallback as o,useEffect as i,useLayoutEffect as n,useState as a}from"@googleforcreators/react";import{__}from"@googleforcreators/i18n";import l from"styled-components";import{Text as s,THEME_CONSTANTS as c}from"@googleforcreators/design-system";import{PROVIDERS as d}from"../../../../../app/media/media3p/providerConfiguration.js";import m from"./mediaGallery.js";import{MediaGalleryMessage as g,MediaGalleryContainer as p,MediaGalleryInnerContainer as u,MediaGalleryLoadingPill as f}from"./styles.js";const y=l(s).withConfig({displayName:"paginatedMediaGallery__StyledText",componentId:"sc-1xn8t7i-0"})(["color:",";"],(e=>{let{theme:t}=e;return t.colors.fg.secondary}));function PaginatedMediaGallery(l){let{providerType:s,resources:E,searchTerm:h,selectedCategoryId:v,isMediaLoading:M,isMediaLoaded:T,hasMore:w,onInsert:L,setNextPage:P,canEditMedia:H}=l;const G=t(),C=r((()=>G.current.clientHeight===G.current.scrollHeight?P():()=>{}),[P]),I=o(C,500),S=r((()=>{const e=G.current;if(!E.length||!e||0===e.clientHeight||!w||!T||M)return;if(e.clientHeight===e.scrollHeight)return void I();e.scrollHeight-e.scrollTop<=e.clientHeight+300&&P()}),[E.length,w,T,M,I,P]);i((()=>{G.current?.scrollTo?.(0,0)}),[h,v]);const b=o(S,500);n((()=>{!async function(){var e;await(e=200,new Promise((t=>setTimeout(t,e)))),S()}()}),[S]),i((()=>{const e=G.current;if(e)return e.addEventListener("scroll",b),window.addEventListener("resize",b),()=>{e.removeEventListener("scroll",b),window.removeEventListener("resize",b)}}),[b]);const x=T&&0===E.length?e.createElement(g,null,__("No media found.","web-stories")):e.createElement("div",{style:{marginBottom:15}},e.createElement(m,{providerType:s,canEditMedia:H,resources:E,onInsert:L})),[j,z]=a(!1);i((()=>{if(M&&w){const e=setTimeout((()=>{z(M)}),1e3);return()=>clearTimeout(e)}z(!1)}),[M,w]);const A="local"!==s&&d[s].attributionComponent&&d[s].attributionComponent();return e.createElement(e.Fragment,null,e.createElement(p,{"data-testid":"media-gallery-container",ref:G},e.createElement(u,null,x)),j&&e.createElement(f,{"data-testid":"loading-pill"},e.createElement(y,{forwardedAs:"span",size:c.TYPOGRAPHY.PRESET_SIZES.SMALL},__("Loadingâ€¦","web-stories"))),!j&&A)}PaginatedMediaGallery.defaultProps={canEditMedia:!1};export{PaginatedMediaGallery as default};
