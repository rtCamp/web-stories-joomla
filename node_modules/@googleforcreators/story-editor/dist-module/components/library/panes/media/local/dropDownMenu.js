/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

import e from"react";import o,{css as r}from"styled-components";import"prop-types";import{useState as t,useRef as s,useCallback as i,useMemo as p}from"@googleforcreators/react";import{__}from"@googleforcreators/i18n";import{v4 as a}from"uuid";import{useKeyDownEffect as n,Icons as m,Popup as l,PLACEMENT as c,Menu as d,noop as g}from"@googleforcreators/design-system";import"@googleforcreators/transform";import"../../../../dropTargets/provider.js";import"../../../../dropTargets/context.js";import"../../../../../app/history/historyProvider.js";import"../../../../../app/history/context.js";import"@googleforcreators/templates";import"../../../../../app/config/context.js";import"../../../../../app/api/context.js";import"@googleforcreators/fonts";import"@googleforcreators/dom";import"../../../../../constants/fonts.js";import"../../../../../constants/multipleValue.js";import"../../../../../app/font/context.js";import"@googleforcreators/media";import"@googleforcreators/tracking";import"@googleforcreators/animation";import"@googleforcreators/masks";import"@googleforcreators/element-library";import"@googleforcreators/elements";import"../../../../../app/story/context.js";import"@googleforcreators/migration";import"../../../../../app/story/actions/useSaveStory.js";import"clone-deep";import"../../../../../app/story/useStoryReducer/useStoryReducer.js";import"@googleforcreators/output";import"../../../../../app/story/storyTriggers/storyTriggersProvider.js";import"../../../../../app/story/storyTriggers/storyEvents/onInitialElementAddedRegister.js";import"../../../../../app/story/storyTriggers/storyEvents/onPageAddedRegister.js";import"../../../../../app/media/useUploadMedia.js";import"@googleforcreators/patterns";import"../../../../../utils/generateBlurhash.worker.js";import"../../../../../app/media/media3p/providerConfiguration.js";import"../../../../../app/media/utils/useFFmpeg.js";import"../../../../../app/media/media3p/api/context.js";import"../../../../../app/media/local/constants.js";import"../../../../../app/media/media3p/providerReducer.js";import"../../../../../app/media/context.js";import u from"../../../../../app/media/local/useLocalMedia.js";import"sat";import"@googleforcreators/units";import"../../../../../app/layout/context.js";import"../../../../../app/layout/useZoomSetting.js";import"@googleforcreators/rich-text";import f from"../../../../canvas/useFocusCanvas.js";import"@googleforcreators/stickers";import"../../text/textPresets.js";import"../../../../../app/canvas/context.js";import"../../../../../app/currentUser/context.js";import"../../../../../app/helpCenter/provider.js";import"../../../../../app/helpCenter/context.js";import"../../../../helpCenter/constants.js";import"../../../../../app/rightClickMenu/context.js";import{ActionButton as j}from"../../shared/index.js";import y from"../../../../../utils/useRovingTabIndex/index.js";import x from"./deleteDialog.js";import h from"./mediaEditDialog.js";const v=o(j).withConfig({displayName:"dropDownMenu__MoreButton",componentId:"sc-1eq0xdj-0"})(["top:4px;right:4px;"]),M=o.div.withConfig({displayName:"dropDownMenu__DropDownContainer",componentId:"sc-1eq0xdj-1"})(["margin-top:10px;"]),w=o.div.withConfig({displayName:"dropDownMenu__MenuContainer",componentId:"sc-1eq0xdj-2"})(["z-index:1;"]),C=r(["min-width:160px;margin-top:0;li{display:block;}"]),b="edit",D="delete";function DropDownMenu(o){let{resource:r,display:j,isMenuOpen:T,onMenuOpen:E,onMenuCancelled:R,onMenuSelected:I,setParentActive:k=g}=o;const S=[{group:[{label:__("Edit meta data","web-stories"),value:b},{label:__("Delete from library","web-stories"),value:D}]}],[_,O]=t(!1),[P,A]=t(!1),F=s(),q=i((()=>{R(),F.current?.focus(),k()}),[R,k]),{canTranscodeResource:B}=u((e=>{let{state:{canTranscodeResource:o}}=e;return{canTranscodeResource:o}})),N=i((()=>{O(!1),q()}),[O,q]),$=i((()=>{A(!1),q()}),[A,q]);y({ref:F.current||null},[],3);const U=f();n(F.current||null,"tab",U,[U]);const z=p((()=>`list-${a()}`),[]),L=p((()=>`button-${a()}`),[]);return B(r)&&e.createElement(w,null,e.createElement(v,{ref:F,onClick:E,"aria-label":__("More","web-stories"),"aria-pressed":T,"aria-haspopup":!0,"aria-expanded":T,"aria-owns":T?z:null,id:L,$display:j,tabIndex:j||T?0:-1},e.createElement(m.DotsFillSmall,null)),(j||T)&&e.createElement(l,{anchor:F,placement:c.BOTTOM_START,isOpen:T},e.createElement(M,null,e.createElement(d,{parentId:L,listId:z,onMenuItemClick:(e,o)=>{switch(I(),o){case b:A(!0);break;case D:O(!0)}},options:S,onDismissMenu:q,hasMenuRole:!0,menuStylesOverride:C}))),_&&e.createElement(x,{mediaId:r.id,type:r.type,onClose:N}),P&&e.createElement(h,{resource:r,onClose:$}))}export{DropDownMenu as default};
