/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

import o from"react";import{__,sprintf,translateToExclusiveList as r}from"@googleforcreators/i18n";import{getExtensionsFromMimeType as t}from"@googleforcreators/media";import{withProtocol as e}from"@googleforcreators/url";import{Input as s}from"@googleforcreators/design-system";import{useState as i,useRef as p,useMemo as a,useLayoutEffect as n,useCallback as m}from"@googleforcreators/react";import l from"styled-components";import"prop-types";import"@googleforcreators/transform";import"../../../../../dropTargets/provider.js";import"../../../../../dropTargets/context.js";import"../../../../../../app/history/historyProvider.js";import"../../../../../../app/history/context.js";import"@googleforcreators/templates";import"../../../../../../app/config/context.js";import g from"../../../../../../app/config/useConfig.js";import"../../../../../../app/api/context.js";import"@googleforcreators/fonts";import"@googleforcreators/dom";import"../../../../../../constants/fonts.js";import"../../../../../../constants/multipleValue.js";import"../../../../../../app/font/context.js";import"@googleforcreators/tracking";import"@googleforcreators/animation";import"uuid";import"@googleforcreators/masks";import"@googleforcreators/element-library";import"@googleforcreators/elements";import"../../../../../../app/story/context.js";import"@googleforcreators/migration";import"../../../../../../app/story/actions/useSaveStory.js";import"clone-deep";import"../../../../../../app/story/useStoryReducer/useStoryReducer.js";import"@googleforcreators/output";import"../../../../../../app/story/storyTriggers/storyTriggersProvider.js";import"../../../../../../app/story/storyTriggers/storyEvents/onInitialElementAddedRegister.js";import"../../../../../../app/story/storyTriggers/storyEvents/onPageAddedRegister.js";import"../../../../../../app/media/useUploadMedia.js";import"@googleforcreators/patterns";import"../../../../../../utils/generateBlurhash.worker.js";import"../../../../../../app/media/media3p/providerConfiguration.js";import"../../../../../../app/media/utils/useFFmpeg.js";import"../../../../../../app/media/media3p/api/context.js";import"../../../../../../app/media/local/constants.js";import"../../../../../../app/media/media3p/providerReducer.js";import"../../../../../../app/media/context.js";import"sat";import"@googleforcreators/units";import"../../../../../../app/layout/context.js";import"../../../../../../app/layout/useZoomSetting.js";import"@googleforcreators/rich-text";import"@googleforcreators/stickers";import"../../../text/textPresets.js";import"../../../../../../app/canvas/context.js";import"../../../../../../app/currentUser/context.js";import"../../../../../../app/helpCenter/provider.js";import"../../../../../../app/helpCenter/context.js";import"../../../../../helpCenter/constants.js";import"../../../../../../app/rightClickMenu/context.js";import c from"../../../../../dialog/dialog.js";import d from"./useInsert.js";import{isValidUrlForHotlinking as u}from"./utils.js";const f=l.form.withConfig({displayName:"hotlinkModal__InputWrapper",componentId:"sc-1tbxkw-0"})(["margin:16px 4px;width:470px;height:100px;"]);function HotlinkModal(l){let{isOpen:j,onClose:y}=l;const{allowedMimeTypes:{image:x,vector:h,video:v}}=g(),[b,k]=i(!1),w=p(null),C=a((()=>[...x,...h,...v]),[x,h,v]),I=a((()=>C.map((o=>t(o))).flat()),[C]);n((()=>{const o=setTimeout((()=>{j&&w.current&&w.current.focus()}));return()=>clearTimeout(o)}),[j,w]);let T=__("No file types are currently supported.","web-stories");I.length&&(T=sprintf(
/* translators: %s is a list of allowed file extensions. */
__("You can insert %s.","web-stories"),r(I)));const[E,M]=i(""),{onInsert:R,isInserting:S,setIsInserting:P}=d({link:E,setLink:M,errorMsg:b,setErrorMsg:k,onClose:y}),B=b||!E||S,U=m((()=>{if(E?.length>0){const o=e(E);M(o),u(o)||k(__("Invalid link.","web-stories"))}}),[E]),A=m((o=>{b&&k(null),M(o)}),[M,b]),F=m((o=>{o.preventDefault(),B||R()}),[B,R]),H=__(S?"Insertingâ€¦":"Insert","web-stories");return o.createElement(c,{onClose:()=>{y(),M(""),k(!1),P(!1)},isOpen:j,title:__("Insert external image or video","web-stories"),onPrimary:()=>R(),primaryText:H,secondaryText:__("Cancel","web-stories"),primaryRest:{disabled:B}},o.createElement(f,{onSubmit:F},o.createElement(s,{ref:w,onChange:o=>{let{target:{value:r}}=o;return A(r)},value:E,hint:b?.length?b:T,hasError:Boolean(b?.length),onBlur:U,label:__("URL","web-stories"),type:"url",required:!0})))}export{HotlinkModal as default};
