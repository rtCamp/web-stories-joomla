/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

import e from"react";import t,{css as o}from"styled-components";import"prop-types";import{useState as i,useCallback as r}from"@googleforcreators/react";import{toDate as a,isValid as s,formatDate as p}from"@googleforcreators/date";import{__,sprintf}from"@googleforcreators/i18n";import{trackError as m}from"@googleforcreators/tracking";import{getSmallestUrlForWidth as n}from"@googleforcreators/media";import{Text as d,TextArea as l,useSnackbar as c,THEME_CONSTANTS as g}from"@googleforcreators/design-system";import"@googleforcreators/templates";import"../../../../../app/config/context.js";import"../../../../../app/api/context.js";import y from"../../../../../app/api/useAPI.js";import"../../../../../constants/fonts.js";import"../../../../../constants/multipleValue.js";import"@googleforcreators/animation";import"uuid";import"@googleforcreators/masks";import"@googleforcreators/element-library";import"@googleforcreators/elements";import"../../../../../app/story/context.js";import"@googleforcreators/migration";import"../../../../../app/history/historyProvider.js";import"../../../../../app/history/context.js";import"../../../../../app/story/actions/useSaveStory.js";import"clone-deep";import"../../../../../app/story/useStoryReducer/useStoryReducer.js";import"@googleforcreators/output";import"../../../../../app/story/storyTriggers/storyTriggersProvider.js";import"../../../../../app/story/storyTriggers/storyEvents/onInitialElementAddedRegister.js";import"../../../../../app/story/storyTriggers/storyEvents/onPageAddedRegister.js";import"../../../../../app/media/useUploadMedia.js";import"@googleforcreators/patterns";import"../../../../../utils/generateBlurhash.worker.js";import"../../../../../app/media/media3p/providerConfiguration.js";import"../../../../../app/media/utils/useFFmpeg.js";import"../../../../../app/media/media3p/api/context.js";import"../../../../../app/media/local/constants.js";import"../../../../../app/media/media3p/providerReducer.js";import"../../../../../app/media/context.js";import u from"../../../../../app/media/local/useLocalMedia.js";import f from"../../../../dialog/dialog.js";const E=o(["display:flex;width:","px;margin-right:28px;"],152),j=t.img.withConfig({displayName:"mediaEditDialog__Image",componentId:"sc-ctku7j-0"})(["",""],E),x=t.video.withConfig({displayName:"mediaEditDialog__Video",componentId:"sc-ctku7j-1"})(["",""],E),h=t.div.withConfig({displayName:"mediaEditDialog__DialogBody",componentId:"sc-ctku7j-2"})(["display:flex;justify-content:left;align-items:flex-start;"]),w=t.div.withConfig({displayName:"mediaEditDialog__MetadataTextContainer",componentId:"sc-ctku7j-3"})(["display:flex;flex-direction:column;margin:0 4px;"]),b=t(d).withConfig({displayName:"mediaEditDialog__DateText",componentId:"sc-ctku7j-4"})(["margin-bottom:8px;"]),v=t(l).withConfig({displayName:"mediaEditDialog__AssistiveTextArea",componentId:"sc-ctku7j-5"})(["margin:20px 0 4px;"]),S=__("Edit Image","web-stories"),_=__("Edit Video","web-stories"),T=__("Assistive text","web-stories"),I=__("Video description","web-stories"),P=__("Describe the appearance and function of the image. Leave empty if the image is purely decorative.","web-stories"),A=__("For indexability and accessibility. Include any burned-in text inside the video.","web-stories");function MediaEditDialog(t){let{resource:o,onClose:l}=t;const{id:E,src:C,creationDate:D,width:M,height:k,type:R,alt:L,poster:N,mimeType:O}=o,{actions:{updateMedia:Y}}=y(),{updateMediaElement:z}=u((e=>{let{actions:{updateMediaElement:t}}=e;return{updateMediaElement:t}})),{showSnackbar:F}=c(),[V,G]=i(L),H=a(D),Z=r((e=>{G(e.target.value)}),[]),B=r((async()=>{try{await Y(E,{altText:V}),z({id:E,data:{alt:V}}),l()}catch(e){m("local_media_edit",e.message),F({message:__("Failed to update, please try again.","web-stories"),dismissible:!0})}}),[V,E,l,F,Y,z]),U="image"===R;return e.createElement(f,{isOpen:!0,onClose:l,title:U?S:_,secondaryText:__("Cancel","web-stories"),onPrimary:B,primaryText:__("Save","web-stories")},e.createElement(h,null,"image"===R?e.createElement(j,{src:n(152,o),alt:L,loading:"lazy",crossOrigin:"anonymous",decoding:"async"}):e.createElement(x,{key:C,crossOrigin:"anonymous",poster:N,preload:"metadata",muted:!0},e.createElement("source",{src:C,type:O})),e.createElement(w,null,s(H)&&e.createElement(b,{forwardedAs:"span",size:g.TYPOGRAPHY.PRESET_SIZES.X_SMALL},sprintf(
/* translators: %s: upload date of media item. */
__("Uploaded: %s","web-stories"),p(D))),e.createElement(d,{as:"span",size:g.TYPOGRAPHY.PRESET_SIZES.SMALL},sprintf(
/* translators: 1: image width. 2: image height. */
__("%1$d x %2$d pixels","web-stories"),M,k)),e.createElement(v,{value:V,"aria-label":U?T:I,type:"text",placeholder:U?T:I,onChange:Z}),e.createElement(d,{size:g.TYPOGRAPHY.PRESET_SIZES.SMALL},U?P:A))))}export{MediaEditDialog as default};
