/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

import e from"react";import{useFeature as o}from"flagged";import{useCallback as t,useEffect as r}from"@googleforcreators/react";import i from"styled-components";import{__,sprintf,_n}from"@googleforcreators/i18n";import{trackEvent as a}from"@googleforcreators/tracking";import{Button as s,Text as m,THEME_CONSTANTS as p,BUTTON_VARIANTS as n,BUTTON_TYPES as l,BUTTON_SIZES as d,Icons as c,PLACEMENT as f}from"@googleforcreators/design-system";import"prop-types";import"../../../../../app/config/context.js";import g from"../../../../../app/config/useConfig.js";import"@googleforcreators/media";import"@googleforcreators/templates";import"../../../../../app/api/context.js";import"../../../../../constants/fonts.js";import"../../../../../constants/multipleValue.js";import"@googleforcreators/animation";import"uuid";import"@googleforcreators/masks";import"@googleforcreators/element-library";import"@googleforcreators/elements";import"../../../../../app/story/context.js";import"@googleforcreators/migration";import"../../../../../app/history/historyProvider.js";import"../../../../../app/history/context.js";import"../../../../../app/story/actions/useSaveStory.js";import"clone-deep";import"../../../../../app/story/useStoryReducer/useStoryReducer.js";import"@googleforcreators/output";import"../../../../../app/story/storyTriggers/storyTriggersProvider.js";import"../../../../../app/story/storyTriggers/storyEvents/onInitialElementAddedRegister.js";import"../../../../../app/story/storyTriggers/storyEvents/onPageAddedRegister.js";import"../../../../../app/media/useUploadMedia.js";import"@googleforcreators/patterns";import"../../../../../utils/generateBlurhash.worker.js";import{LOCAL_MEDIA_TYPE_ALL as u}from"../../../../../app/media/local/types.js";import"../../../../../app/media/media3p/providerConfiguration.js";import"../../../../../app/media/utils/useFFmpeg.js";import"../../../../../app/media/media3p/api/context.js";import"../../../../../app/media/local/constants.js";import"../../../../../app/media/media3p/providerReducer.js";import"../../../../../app/media/context.js";import j from"../../../../../app/media/local/useLocalMedia.js";import"../../../common/index.js";import"../../../../form/color/color.js";import"../../../../form/filterToggle/filterToggle.js";import"../../../../form/linkIcon.js";import"../../../../form/link.js";import"../../../../form/media.js";import y from"../../../../form/mediaUploadButton.js";import"../../../../form/row.js";import"../../../../form/switch.js";import"../../../../form/textArea.js";import"../../../../form/context.js";import"../../../../form/dateTime/dateTime.js";import"../../../../form/required.js";import"../../../../form/radioGroup/index.js";import h from"../../../../form/select/select.js";import"../../../../form/hierarchical/index.js";import{StyledPane as E,PaneInner as T,PaneHeader as M,SearchInputContainer as x,MediaGalleryMessage as S}from"../common/styles.js";import v from"../common/paginatedMediaGallery.js";import I from"../../../../../flags.js";import{PANE_PADDING as w}from"../../shared/index.js";import{focusStyle as b}from"../../../../panels/shared/styles.js";import P from"../../../../tooltip/tooltip.js";import _ from"./useOnMediaSelect.js";import A from"./paneId.js";import R from"./videoOptimizationDialog.js";import C from"./hotlink/hotlink.js";import N from"./mediaRecording/mediaRecording.js";import L from"../../../common/searchInput.js";function k(){return k=Object.assign||function(e){for(var o=1;o<arguments.length;o++){var t=arguments[o];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},k.apply(this,arguments)}const O=i(s).withConfig({displayName:"mediaPane__Button",componentId:"sc-usipec-0"})(["",";"],b),B=i.div.withConfig({displayName:"mediaPane__FilterArea",componentId:"sc-usipec-1"})(["display:flex;justify-content:space-between;margin-top:24px;padding:0 "," 0 ",";"],w,w),U=i(m).attrs({size:p.TYPOGRAPHY.PRESET_SIZES.MEDIUM}).withConfig({displayName:"mediaPane__SearchCount",componentId:"sc-usipec-2"})(["display:flex;align-items:center;justify-content:center;flex-shrink:0;"]),D=i.div.withConfig({displayName:"mediaPane__ButtonsWrapper",componentId:"sc-usipec-3"})(["display:flex;flex:1;justify-content:flex-end;"]),V=u,z=[{value:V,label:__("All Types","web-stories")},{value:"image",label:__("Images","web-stories")},{value:"video",label:__("Video","web-stories")}];function MediaPane(i){const{hasMore:s,media:m,isMediaLoading:p,isMediaLoaded:u,mediaType:w,searchTerm:b,setNextPage:F,setMediaType:G,setSearchTerm:Y,totalItems:H}=j((e=>{let{state:{hasMore:o,media:t,isMediaLoading:r,isMediaLoaded:i,mediaType:a,searchTerm:s,totalItems:m},actions:{setNextPage:p,setMediaType:n,setSearchTerm:l}}=e;return{hasMore:o,media:t,isMediaLoading:r,isMediaLoaded:i,mediaType:a,searchTerm:s,totalItems:m,setNextPage:p,setMediaType:n,setSearchTerm:l}})),q=o("mediaRecording"),{capabilities:{hasUploadMediaAction:Q}}=g(),W=b.length>0,Z=t(((e,o)=>{G({mediaType:o})}),[G]),{onSelect:J,insertMediaElement:K}=_();r((()=>{b.length>0&&a("search",{search_type:"media",search_term:b,search_filter:w})}),[b,w]);const X=o(I.INCREMENTAL_SEARCH_DEBOUNCE_MEDIA),$=t((o=>e.createElement(O,{variant:n.SQUARE,type:l.SECONDARY,size:d.SMALL,onClick:o,"aria-label":__("Upload","web-stories")},e.createElement(c.ArrowCloud,null))),[]);return e.createElement(E,k({id:A},i),e.createElement(T,null,e.createElement(M,null,e.createElement(x,null,e.createElement(L,{initialValue:b,placeholder:__("Search","web-stories"),onSearch:e=>{const o=e.trim();o!==b&&Y({searchTerm:o})},incremental:X})),e.createElement(B,null,e.createElement(h,{selectedValue:w?.toString()||V,onMenuItemClick:Z,options:z,placement:f.BOTTOM_START}),W&&m.length>0&&e.createElement(U,null,sprintf(
/* translators: %d: number of results. */
_n("%s result found.","%s results found.",H,"web-stories"),H)),!W&&e.createElement(D,null,q&&Q&&e.createElement(N,null),e.createElement(C,null),Q&&e.createElement(P,{title:__("Upload","web-stories")},e.createElement(y,{renderButton:$,onInsert:J}))))),u&&!m.length?e.createElement(S,null,__(W?"No results found.":"No media found.","web-stories")):e.createElement(v,{providerType:"local",canEditMedia:Q,resources:m,isMediaLoading:p,isMediaLoaded:u,hasMore:s,onInsert:K,setNextPage:F,searchTerm:b}),e.createElement(R,null)))}export{MediaPane as default};
