/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

import e from"react";import"prop-types";import r from"styled-components";import{useEffect as t,useCallback as o,useRef as a,useMemo as i}from"@googleforcreators/react";import{useFeature as m,useFeatures as s}from"flagged";import{__}from"@googleforcreators/i18n";import{trackEvent as c}from"@googleforcreators/tracking";import n from"../../../../../app/media/useMedia.js";import{StyledPane as l,PaneInner as p,PaneHeader as d,SearchInputContainer as f}from"../common/styles.js";import"../../../common/index.js";import h from"../../../../../flags.js";import{PROVIDERS as g}from"../../../../../app/media/media3p/providerConfiguration.js";import u from"./termsDialog.js";import v from"./paneId.js";import y from"./providerTabList.js";import E from"./providerPanel.js";import j from"../../../common/searchInput.js";function b(){return b=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e},b.apply(this,arguments)}const P=r.div.withConfig({displayName:"media3pPane__PaneBottom",componentId:"sc-1hq1xk8-0"})(["position:relative;height:100%;flex:1 1 auto;min-height:0;"]);function Media3pPane(r){const{isActive:T}=r,{searchTerm:S,selectedProvider:_,setSelectedProvider:C,setSearchTerm:I,media3p:N}=n((e=>{let{media3p:{state:{selectedProvider:r,searchTerm:t},actions:{setSelectedProvider:o,setSearchTerm:a}},media3p:i}=e;return{searchTerm:t,selectedProvider:r,setSelectedProvider:o,setSearchTerm:a,media3p:i}}));t((()=>{T&&!_&&C({provider:Object.keys(g)[0]})}),[T,_,C]);const O=N[_]?.state?.categories?.selectedCategoryId;t((()=>{S.length&&c("search",{search_type:"media3p",search_term:S,search_filter:_,search_category:O})}),[_,S,O]);const k=o((e=>{const r=e.trim();r!==S&&I({searchTerm:r})}),[S,I]),A=m(h.INCREMENTAL_SEARCH_DEBOUNCE_MEDIA),M=a(),x=s(),w=i((()=>Object.keys(g).filter((e=>!g[e].featureName||x[g[e].featureName]))),[x]);return e.createElement(e.Fragment,null,T&&e.createElement(u,null),e.createElement(l,b({id:v},r),e.createElement(p,null,e.createElement(d,null,e.createElement(f,null,e.createElement(j,{initialValue:S,placeholder:__("Search","web-stories"),onSearch:k,incremental:A,disabled:Boolean(_&&g[_].supportsCategories&&N[_]?.state.categories.selectedCategoryId)})),e.createElement(y,{providers:w})),e.createElement(P,{ref:M},w.map((r=>e.createElement(E,{key:r,providerType:r,isActive:r===_,searchTerm:S,role:"tabpanel","aria-labelledby":`provider-tab-${r}`,id:`provider-tabpanel-${r}`})))))))}export{Media3pPane as default};
