/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

import e from"react";import{useState as t,useEffect as r,useRef as o,useMemo as a,useCallback as s}from"@googleforcreators/react";import{_x,__}from"@googleforcreators/i18n";import{trackEvent as l,getTimeTracker as p}from"@googleforcreators/tracking";import m from"styled-components";import"prop-types";import{Headline as n,THEME_CONSTANTS as i,LoadingSpinner as c}from"@googleforcreators/design-system";import"@googleforcreators/templates";import"../../../../app/config/context.js";import"../../../../app/api/context.js";import f from"../../../../app/api/useAPI.js";import{LoadingContainer as d}from"../shared/index.js";import{virtualPaneContainer as g}from"../shared/virtualizedPanelGrid/components.js";import{PAGE_TEMPLATE_TYPES as u}from"./constants.js";import y from"./templateList.js";import j from"../shared/chipGroup/index.js";const x=m.div.withConfig({displayName:"defaultTemplates__ActionRow",componentId:"sc-14vj9wc-0"})(["display:flex;justify-content:space-between;margin:0px 16px 22px 16px;"]),_=m.div.withConfig({displayName:"defaultTemplates__PageTemplatesParentContainer",componentId:"sc-14vj9wc-1"})(["",";margin-top:26px;overflow-x:hidden;overflow-y:scroll;"],g);function DefaultTemplates(m){let{pageSize:g}=m;const{actions:{getPageTemplates:h}}=f(),[w,E]=t([]),[I,P]=t(!1);r((()=>{!async function(){P(!0);const e=p("load_page_templates");E(await h()),P(!1),e()}()}),[h,E]);const T=o(),[b,v]=t(null),S=a((()=>[{id:null,label:_x("All","page templates","web-stories")},...Object.entries(u).map((e=>{let[t,{name:r}]=e;return{id:t,label:r}}))]),[]),z=a((()=>w.reduce(((e,t)=>[...e,...Object.values(t.postersByPage).map(((e,r)=>({id:`${t.slug}_${r}`,title:t.title,story:t.pages[r],...e}))).reduce(((e,t)=>!t.type||b&&t.type!==b?e:[...e,t]),[])]),[])),[w,b]),A=s((e=>{v(e),l("search",{search_type:"page_templates",search_term:"",search_category:e})}),[]);return e.createElement(e.Fragment,null,e.createElement(j,{items:S,selectedItemId:b,selectItem:A,deselectItem:()=>A(null)}),e.createElement(_,{ref:T,tabIndex:-1},e.createElement(x,null,e.createElement(n,{as:"h2",size:i.TYPOGRAPHY.PRESET_SIZES.XXX_SMALL},__("Templates","web-stories"))),!I&&T.current?e.createElement(y,{pageSize:g,parentRef:T,pages:z}):e.createElement(d,null,e.createElement(c,{animationSize:64,numCircles:8}))))}export{DefaultTemplates as default};
