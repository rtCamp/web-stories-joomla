/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

import e from"react";import{useState as t,useRef as r,useCallback as o,useEffect as i}from"@googleforcreators/react";import"prop-types";import a from"styled-components";import{__}from"@googleforcreators/i18n";import{trackEvent as s}from"@googleforcreators/tracking";import{useSnackbar as p,useGridViewKeys as m}from"@googleforcreators/design-system";import{duplicatePage as n}from"@googleforcreators/elements";import{PANE_PADDING as g}from"../shared/index.js";import"../../../../constants/fonts.js";import"../../../../constants/multipleValue.js";import"@googleforcreators/animation";import"uuid";import"@googleforcreators/masks";import"@googleforcreators/element-library";import"../../../../app/story/context.js";import"@googleforcreators/migration";import"@googleforcreators/templates";import"../../../../app/config/context.js";import l from"../../../../app/config/useConfig.js";import"../../../../app/api/context.js";import"../../../../app/history/historyProvider.js";import"../../../../app/history/context.js";import"../../../../app/story/actions/useSaveStory.js";import"clone-deep";import"../../../../app/story/useStoryReducer/useStoryReducer.js";import"@googleforcreators/output";import"../../../../app/story/storyTriggers/storyTriggersProvider.js";import"../../../../app/story/storyTriggers/storyEvents/onInitialElementAddedRegister.js";import"../../../../app/story/storyTriggers/storyEvents/onPageAddedRegister.js";import d from"../../../../app/story/useStory.js";import c from"./defaultPageTemplate.js";import f from"./savedPageTemplate.js";function u(){return u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e},u.apply(this,arguments)}const y=a.div.withConfig({displayName:"templateList__WrapperGrid",componentId:"sc-1ukppvz-0"})(["display:grid;width:100%;margin-left:",";margin-bottom:12px;gap:12px;grid-template-columns:",";grid-template-rows:",";"],g,(e=>{let{columnWidth:t}=e;return`repeat(auto-fit, ${t}px)`}),(e=>{let{rowHeight:t}=e;return`repeat(minmax(${t}px, 1fr))`}));function TemplateList(a){let{pages:g,parentRef:h,pageSize:j,handleDelete:v,fetchTemplates:T,...x}=a;const{addPage:w}=d((e=>{let{actions:t}=e;return{addPage:t.addPage}})),{isRTL:P}=l(),{showSnackbar:R}=p(),[b,S]=t(),k=r(),_=r({}),E=o((e=>{let{templateId:t,version:r,title:o,...i}=e;const a=n(i);w({page:a}),s("insert_page_template",{name:o||"custom"}),R({message:__("Page Template added.","web-stories"),dismissible:!0})}),[w,R]),I=o((e=>{S(e)}),[]),L=v||T;return i((()=>{g.length>0&&(b&&g.some((e=>e.id===b))||S(g[0].id))}),[b,g]),i((()=>{T?.()}),[T]),m({containerRef:h,gridRef:k,itemRefs:_,items:g,currentItemId:b,isRTL:P}),e.createElement(y,{ref:k,columnWidth:j.width,rowHeight:j.containerHeight,role:"list","aria-label":__("Page Template Options","web-stories")},L?g.map(((t,r)=>e.createElement(f,u({key:t.id,"data-testid":`page_template_${t.id}`,ref:e=>_.current[t.id]=e,page:t,pageSize:j,onClick:()=>E(t),handleDelete:v,onFocus:()=>I(t.id),index:r},x)))):g.map((t=>e.createElement(c,u({ref:e=>_.current[t.id]=e,key:t.id,"data-testid":`page_template_${t.id}`,page:t,pageSize:j,onFocus:()=>I(t.id),isActive:b===t.id,onClick:()=>E(t.story),columnWidth:j.width},x)))))}export{TemplateList as default};
