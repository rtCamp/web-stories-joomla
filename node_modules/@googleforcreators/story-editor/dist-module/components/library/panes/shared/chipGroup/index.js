/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

import e from"react";import t from"styled-components";import{useState as o,useRef as i,useCallback as n,useMemo as r}from"@googleforcreators/react";import"prop-types";import{v4 as a}from"uuid";import{__}from"@googleforcreators/i18n";import{Button as s,BUTTON_TYPES as l,BUTTON_SIZES as p,BUTTON_VARIANTS as m,useKeyDownEffect as c,Chip as d,Icons as f}from"@googleforcreators/design-system";import g from"../../../../../utils/useRovingTabIndex/index.js";import x from"../hooks/useExpandAnimation.js";import u from"../hooks/useHandleRowVisibility.js";import{CHIP_COLLAPSED_FULL_HEIGHT as h,CHIP_TOP_MARGIN as b,CHIP_BOTTOM_MARGIN as y,FOCUS_BORDER_SPACING as E}from"./constants.js";const v=t.div.withConfig({displayName:"chipGroup__Section",componentId:"sc-emvo4b-0"})(["height:","px;min-height:","px;background-color:",";display:flex;flex-direction:column;align-items:flex-start;flex:0 1 auto;position:relative;transition:height 0.2s,min-height 0.2s;"],h,h,(e=>{let{theme:t}=e;return t.colors.divider.tertiary})),w=t.div.withConfig({displayName:"chipGroup__Container",componentId:"sc-emvo4b-1"})(["overflow:hidden;margin:","px 12px ","px 24px;"],b,y),I=t.div.withConfig({displayName:"chipGroup__InnerContainer",componentId:"sc-emvo4b-2"})(["display:flex;justify-content:center;flex-wrap:wrap;position:relative;padding:4px 0;transition:transform 0.2s;column-gap:8px;row-gap:14px;"]),C=t(s).attrs({type:l.TERTIARY,size:p.SMALL,variant:m.CIRCLE}).withConfig({displayName:"chipGroup__ExpandButton",componentId:"sc-emvo4b-3"})(["display:flex;position:absolute;bottom:-24px;background:",";max-height:none;width:32px;height:32px;"," visibility:inherit;align-self:center;justify-content:center;align-items:center;"],(e=>{let{theme:t}=e;return t.colors.bg.tertiary}),(e=>{let{isExpanded:t}=e;return t&&"transform: scaleY(-1);"})),ChipGroup=t=>{let{items:s,selectedItemId:l,selectItem:p,deselectItem:m,ariaLabel:R}=t;const[_,k]=o(!1),j=i(),L=i(),G=i([]),[N,A]=o(0),F=n(((e,t)=>{e&&null!==t?m():(k(!1),p(t))}),[m,p]),M=n((()=>k((e=>!e))),[]);x({sectionRef:j,innerContainerRef:L,isExpanded:_,setFocusedRowOffset:A,collapsedHeight:h,bottomMargin:y,topMargin:b}),u({isExpanded:_,innerContainerRef:L,selectedItemId:l,setFocusedRowOffset:A,itemRefs:G,offsetSpacing:E});const S=s.length>0;g({ref:j},[_]),c(j,_?"":"down",(()=>S&&k(!0)),[_,S]);const T=r((()=>`pill-group-${a()}`),[]);return e.createElement(v,{ref:j},S&&e.createElement(e.Fragment,null,e.createElement(w,{id:T,isExpanded:_,role:"listbox","aria-label":R||__("List of filtering options","web-stories")},e.createElement(I,{role:"presentation",ref:L,style:{transform:`translateY(-${N}px`}},s.map(((t,o)=>{const{id:i,label:n}=t,r=i===l,a=r||!r&&0===o?0:-1;return e.createElement(d,{key:i,role:"option",ref:e=>{G.current[i]=e},active:r,"aria-selected":r,onClick:()=>F(r,i),tabIndex:a},n)})))),e.createElement(C,{onClick:M,isExpanded:_,"aria-controls":T,"aria-expanded":_,"aria-label":__("Expand","web-stories")},e.createElement(f.ChevronUp,null))))};export{ChipGroup as default};
