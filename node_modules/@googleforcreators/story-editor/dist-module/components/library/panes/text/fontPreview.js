/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

import t from"react";import"prop-types";import e from"styled-components";import{useRef as o,useEffect as r,useCallback as i,useState as s}from"@googleforcreators/react";import{ThemeGlobals as n,themeHelpers as a,Text as p,useKeyDownEffect as l}from"@googleforcreators/design-system";import{trackEvent as m}from"@googleforcreators/tracking";import{useUnits as c}from"@googleforcreators/units";import{stripHTML as d}from"@googleforcreators/dom";import{sprintf,__}from"@googleforcreators/i18n";import{getHTMLFormatters as g}from"@googleforcreators/rich-text";import"@googleforcreators/transform";import"../../../dropTargets/provider.js";import"../../../dropTargets/context.js";import"../../../../app/history/historyProvider.js";import"../../../../app/history/context.js";import"@googleforcreators/templates";import"../../../../app/config/context.js";import"../../../../app/api/context.js";import"@googleforcreators/fonts";import"../../../../constants/fonts.js";import"../../../../constants/multipleValue.js";import"../../../../app/font/context.js";import f from"../../../../app/font/useFont.js";import"@googleforcreators/media";import u from"../../../../utils/objectWithout.js";import"@googleforcreators/animation";import"uuid";import"@googleforcreators/masks";import"@googleforcreators/element-library";import"@googleforcreators/elements";import"../../../../app/story/context.js";import"@googleforcreators/migration";import"../../../../app/story/actions/useSaveStory.js";import"clone-deep";import"../../../../app/story/useStoryReducer/useStoryReducer.js";import"@googleforcreators/output";import"../../../../app/story/storyTriggers/storyTriggersProvider.js";import"../../../../app/story/storyTriggers/storyEvents/onInitialElementAddedRegister.js";import"../../../../app/story/storyTriggers/storyEvents/onPageAddedRegister.js";import h from"../../../../app/story/useStory.js";import"../../../../app/media/useUploadMedia.js";import"@googleforcreators/patterns";import"../../../../utils/generateBlurhash.worker.js";import"../../../../app/media/media3p/providerConfiguration.js";import"../../../../app/media/utils/useFFmpeg.js";import"../../../../app/media/media3p/api/context.js";import"../../../../app/media/local/constants.js";import"../../../../app/media/media3p/providerReducer.js";import"../../../../app/media/context.js";import"sat";import"../../../../app/layout/context.js";import"../../../../app/layout/useZoomSetting.js";import"@googleforcreators/stickers";import"./textPresets.js";import"../../../../app/canvas/context.js";import"../../../../app/currentUser/context.js";import"../../../../app/helpCenter/provider.js";import"../../../../app/helpCenter/context.js";import"../../../helpCenter/constants.js";import"../../../../app/rightClickMenu/context.js";import"../../../../utils/storyPageToNode.js";import"@ap.cx/hues";import"../../../../app/pageCanvas/context.js";import"../../../../app/pageCanvas/pageCanvasCacheValidator.js";import y from"../../../../app/pageCanvas/useCalculateAccessibleTextColors.js";import"../../../../types.js";import j from"../../useLibrary.js";import x from"../shared/libraryMoveable.js";import v from"../shared/insertionOverlay.js";import S from"../../../../utils/useRovingTabIndex/index.js";import{getTextInlineStyles as C,areAllType as w}from"../../../../utils/presetUtils.js";import b from"../../../../utils/getUpdatedSizeAndPosition.js";import{focusStyle as E}from"../../../panels/shared/styles.js";function P(){return P=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var o=arguments[e];for(var r in o)Object.prototype.hasOwnProperty.call(o,r)&&(t[r]=o[r])}return t},P.apply(this,arguments)}const T=e.button.withConfig({displayName:"fontPreview__Preview",componentId:"sc-kfwh27-0"})(["position:relative;display:flex;align-items:center;background-color:",";padding:8px 0px;border-radius:",";width:100%;border:none;cursor:pointer;text-align:left;"," &."," [role='presentation'],&[data-focus-visible-added] [role='presentation']{",";}"],(t=>{let{theme:e}=t;return e.colors.interactiveBg.secondaryNormal}),(t=>{let{theme:e}=t;return e.borders.radius.small}),(t=>{let{isTextSelected:e}=t;return e?E:"outline: none;"}),n.FOCUS_VISIBLE_SELECTOR,(t=>{let{theme:e}=t;return a.focusCSS(e.colors.border.focus,e.colors.bg.secondary)})),k=e(p).attrs({forwardedAs:"span"}).withConfig({displayName:"fontPreview__PreviewText",componentId:"sc-kfwh27-1"})(["color:",";font-size:","px;font-weight:",";font-family:",";line-height:normal;margin:",";"],(t=>{let{theme:e,isClone:o}=t;return o?e.colors.standard.black:e.colors.fg.primary}),(t=>{let{fontSize:e}=t;return e}),(t=>{let{fontWeight:e}=t;return e}),(t=>{let{fontFamily:e}=t;return e}),(t=>{let{isClone:e}=t;return e?0:"0px 16px"})),F=e.div.withConfig({displayName:"fontPreview__DragContainer",componentId:"sc-kfwh27-2"})(["position:absolute;opacity:0;background-color:",";width:","px;line-height:","px;"],(t=>{let{theme:e}=t;return e.colors.opacity.white24}),(t=>{let{width:e}=t;return e}),(t=>{let{lineHeight:e}=t;return e}));function FontPreview(e){let{title:n,element:a,insertPreset:p,getPosition:E,index:I}=e;const U=g(),{font:_,fontSize:R,content:W}=a,{fontWeight:z}=C(W),{actions:{maybeEnqueueFontStyle:A}}=f(),{dataToEditorX:O,dataToEditorY:L}=c((t=>({dataToEditorX:t.actions.dataToEditorX,dataToEditorY:t.actions.dataToEditorY}))),{shouldUseSmartColor:N}=j((t=>({shouldUseSmartColor:t.state.shouldUseSmartColor}))),B=y(),{isTextSelected:M,updateSelectedElements:V}=h((t=>{let{state:e,actions:o}=t;return{isTextSelected:w("text",e.selectedElements),updateSelectedElements:o.updateSelectedElements}})),X=o(null);r((()=>{A([{font:_,fontWeight:z,content:d(W)}])}),[_,z,W,A]);const Y=i(((t,e)=>{let{fontWeight:o,isItalic:r,isUnderline:i,letterSpacing:s}=t;return e=U.setFontWeight(e,o),e=U.toggleItalic(e,r),e=U.toggleUnderline(e,i),e=U.setLetterSpacing(e,s)}),[U]),H=i((async()=>{if(M)return void V({properties:t=>{const e=Y(C(a.content),t.content),o=u(a,["x","y","content","width"]),r=b({...t,...o});return{...t,...o,...r,content:e}}});let t=a;const e={isPositioned:!1};if(N){const o=E(a);e.isPositioned=!0,t={...a,...o},e.accessibleColors=await B(t)}p(t,e),m("insert_text_preset",{name:n})}),[M,E,a,N,p,n,V,Y,B]),q=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{isClone:o}=e;return t.createElement(k,P({font:_,fontSize:R,fontWeight:z},e),o?d(W):n)};l(X,{key:["enter","space"]},H,[H]),S({ref:X});const[D,Z]=s(!1),G=()=>Z(!0),J=()=>Z(!1);return t.createElement(T,{ref:X,onPointerEnter:G,onFocus:G,onPointerLeave:J,onBlur:J,tabIndex:0===I?0:-1,isTextSelected:M,"aria-label":M?sprintf(
/* translators: %s: preset name */
__("Apply preset: %s","web-stories"),n):null},q(),D&&!M&&t.createElement(v,null),t.createElement(x,{cloneElement:F,cloneProps:{children:q({fontSize:L(R),isClone:!0}),width:O(a.width),lineHeight:Math.ceil(L(R))},elementProps:a,type:"text",onClick:H}))}export{FontPreview as default};
