/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

import t from"react";import e from"styled-components";import"prop-types";import{trackEvent as o}from"@googleforcreators/tracking";import{forwardRef as r,useCallback as i,useState as s}from"@googleforcreators/react";import{dataToEditorX as p,dataToEditorY as a}from"@googleforcreators/units";import{BUTTON_TRANSITION_TIMING as n,ThemeGlobals as m,themeHelpers as c}from"@googleforcreators/design-system";import l from"../../../../../app/layout/useLayout.js";import"../../../../../app/layout/context.js";import"../../../../../app/layout/useZoomSetting.js";import{TEXT_SET_SIZE as g}from"../../../../../constants/index.js";import d from"../../../useLibrary.js";import u from"../../shared/libraryMoveable.js";import"@googleforcreators/transform";import"../../../../dropTargets/provider.js";import"../../../../dropTargets/context.js";import"../../../../../app/history/historyProvider.js";import"../../../../../app/history/context.js";import"@googleforcreators/templates";import"../../../../../app/config/context.js";import f from"../../../../../app/config/useConfig.js";import"../../../../../app/api/context.js";import"@googleforcreators/fonts";import"@googleforcreators/dom";import"../../../../../app/font/context.js";import"@googleforcreators/media";import"@googleforcreators/animation";import"uuid";import"@googleforcreators/masks";import"@googleforcreators/element-library";import"@googleforcreators/elements";import"../../../../../app/story/context.js";import"@googleforcreators/migration";import"../../../../../app/story/actions/useSaveStory.js";import"clone-deep";import"../../../../../app/story/useStoryReducer/useStoryReducer.js";import"@googleforcreators/output";import"../../../../../app/story/storyTriggers/storyTriggersProvider.js";import"../../../../../app/story/storyTriggers/storyEvents/onInitialElementAddedRegister.js";import"../../../../../app/story/storyTriggers/storyEvents/onPageAddedRegister.js";import"@googleforcreators/i18n";import"../../../../../app/media/useUploadMedia.js";import"@googleforcreators/patterns";import"../../../../../utils/generateBlurhash.worker.js";import"../../../../../app/media/media3p/providerConfiguration.js";import"../../../../../app/media/utils/useFFmpeg.js";import"../../../../../app/media/media3p/api/context.js";import"../../../../../app/media/local/constants.js";import"../../../../../app/media/media3p/providerReducer.js";import"../../../../../app/media/context.js";import"sat";import"@googleforcreators/rich-text";import"@googleforcreators/stickers";import"../textPresets.js";import"../../../../../app/canvas/context.js";import"../../../../../app/currentUser/context.js";import"../../../../../app/helpCenter/provider.js";import"../../../../../app/helpCenter/context.js";import"../../../../helpCenter/constants.js";import"../../../../../app/rightClickMenu/context.js";import h from"../../shared/insertionOverlay.js";import x from"../../../../../utils/useRovingTabIndex/index.js";import y from"./textSetElements.js";function j(){return j=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var o=arguments[e];for(var r in o)Object.prototype.hasOwnProperty.call(o,r)&&(t[r]=o[r])}return t},j.apply(this,arguments)}const S=e.button.withConfig({displayName:"textSet__TextSetItem",componentId:"sc-1hor9ow-0"})(["border:0;background:none;position:absolute;top:0;height:","px;width:","px;display:flex;align-items:center;justify-content:center;flex-direction:column;transform:",";background-color:",";border-radius:",";cursor:pointer;transition:background-color ",";outline:none;&."," [role='presentation'],&[data-focus-visible-added] [role='presentation']{",";}"],g,g,(t=>{let{translateX:e,translateY:o}=t;return`translateX(${e}px) translateY(${o}px)`}),(t=>{let{theme:e}=t;return e.colors.interactiveBg.secondaryNormal}),(t=>{let{theme:e}=t;return e.borders.radius.small}),n,m.FOCUS_VISIBLE_SELECTOR,(t=>{let{theme:e}=t;return c.focusCSS(e.colors.border.focus,e.colors.bg.secondary)})),E=e.img.withConfig({displayName:"textSet__TextSetImg",componentId:"sc-1hor9ow-1"})(["width:","px;height:","px;"],g,g),b=e.div.withConfig({displayName:"textSet__DragContainer",componentId:"sc-1hor9ow-2"})(["position:absolute;opacity:0;width:","px;height:","px;background-color:",";"],(t=>{let{width:e}=t;return e}),(t=>{let{height:e}=t;return e}),(t=>{let{theme:e}=t;return e.colors.opacity.white24}));function TextSet(e,r){let{id:n,elements:m,translateY:c,translateX:g,isActive:v,index:T,...I}=e;const{insertTextSet:_}=d((t=>({insertTextSet:t.actions.insertTextSet}))),{cdnURL:w}=f(),{pageWidth:C,pageHeight:R}=l((t=>{let{state:{pageWidth:e,pageHeight:o}}=t;return{pageWidth:e,pageHeight:o}})),O=i((()=>{_(m),o("insert_textset")}),[m,_]),P=i((t=>{let{code:e}=t;"Enter"!==e&&"Space"!==e||O()}),[O]),k="undefined"==typeof WEB_STORIES_DISABLE_OPTIMIZED_RENDERING||"true"!==WEB_STORIES_DISABLE_OPTIMIZED_RENDERING;x({ref:r.current});const[N,D]=s(!1),{textSetHeight:L,textSetWidth:B}=m[0],W=p(B,C),A=a(L,R);return t.createElement(S,j({translateX:g,translateY:c,ref:r,onKeyUp:P,onPointerEnter:()=>D(!0),onPointerLeave:()=>D(!1),tabIndex:0===T?0:-1},I),k?t.createElement(E,{src:`${w}images/text-sets/${n}.png`,alt:"",crossOrigin:"anonymous",decoding:"async"}):t.createElement(y,{isForDisplay:!0,elements:m}),(v||N)&&t.createElement(h,null),t.createElement(u,{type:"textSet",elements:m,elementProps:{},onClick:O,cloneElement:b,cloneProps:{width:W,height:A,children:t.createElement(y,{elements:m,pageSize:{width:C,height:R}})}}))}const v=r(TextSet);TextSet.displayName="TextSet";export{v as default};
