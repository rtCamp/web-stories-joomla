/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

import e from"react";import{useState as t,useRef as s,useMemo as r,useCallback as o,useEffect as a}from"@googleforcreators/react";import"prop-types";import n from"styled-components";import{v4 as l}from"uuid";import{trackEvent as i}from"@googleforcreators/tracking";import{sprintf,_n,translateToInclusiveList as m,_x,__}from"@googleforcreators/i18n";import{localStore as c,LOCAL_STORAGE_PREFIX as p,useLiveRegion as d,Headline as f,THEME_CONSTANTS as S,Text as g,Toggle as x}from"@googleforcreators/design-system";import{FullWidthWrapper as u}from"../../common/styles.js";import"../../shared/index.js";import T from"../../../useLibrary.js";import y from"../../../../../app/story/useStory.js";import{getTextSetsForFonts as E,getInUseFontsForPages as h}from"../../../../../utils/getInUseFonts.js";import{Container as _}from"../../../common/section.js";import{virtualPaneContainer as b}from"../../shared/virtualizedPanelGrid/components.js";import"../../../../../app/config/context.js";import I from"../../../../emptyContentMessage.js";import j from"./textSets.js";import{CATEGORIES as v,PANE_TEXT as w}from"./constants.js";import L from"../../shared/chipGroup/index.js";const P=n.div.withConfig({displayName:"textSetsPane__TitleBar",componentId:"sc-vycaev-0"})(["display:flex;justify-content:space-between;padding:20px 0;"]),C=n.div.withConfig({displayName:"textSetsPane__TextSetsToggle",componentId:"sc-vycaev-1"})(["display:flex;label{cursor:pointer;margin:auto 12px;color:",";}"],(e=>{let{theme:t}=e;return t.colors.fg.secondary})),A=n.div.withConfig({displayName:"textSetsPane__TextSetsWrapper",componentId:"sc-vycaev-2"})(["",";"],b);function TextSetsPane(n){let{paneRef:b}=n;const{areTextSetsLoading:$,textSets:N}=T((e=>{let{state:{areTextSetsLoading:t,textSets:s}}=e;return{areTextSetsLoading:t,textSets:s}})),[G,R]=t(!1),B=s(!1),X=r((()=>Object.values(N).flat()),[N]),F=y((e=>{let{state:{pages:t}}=e;return t})),[H,O]=t(c.getItemByKey(`${p.TEXT_SET_SETTINGS}`)?.selectedCategory),Y=o((()=>E({fonts:h(F),textSets:H?N[H]:X})),[X,F,H,N]),k=o((function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.map((e=>{let{textSetFonts:t=[],textSetCategory:s,elements:r,id:o}=e;return{id:o,title:sprintf(
/* translators: 1: text set category. 2: list of fonts. */
_n("Text set %1$s with %2$s font","Text set %1$s with %2$s fonts",t.length,"web-stories"),v[s],m(t)),elements:r}}))}),[]),z=r((()=>k(G?Y():H?N?.[H]:X)),[H,N,X,k,Y,G]),M=r((()=>[{id:null,label:_x("All","text sets","web-stories")},...Object.keys(N).map((e=>({id:e,label:v[e]??e})))]),[N]),W=d(),K=o((e=>{O(e),W(null===e?__("Show all text sets","web-stories"):sprintf(
/* translators: %s: filter category name */
__("Selected text set filter %s","web-stories"),v[e])),c.setItemByKey(`${p.TEXT_SET_SETTINGS}`,{selectedCategory:e}),B.current=!0}),[W]),Z=o((()=>{requestAnimationFrame((()=>R((e=>!e)))),B.current=!0}),[R]);a((()=>{B.current&&i("search",{search_type:"textsets",search_term:"",search_category:H,search_filter:G?"show_in_use":void 0})}),[H,G]);const q=r((()=>`section-${l()}`),[]),U=r((()=>`toggle_text_sets_${l()}`),[]),D=r((()=>__(G?"No matching Text Sets available. Try adding text to your story.":"No Text Sets available.","web-stories")),[G]);return e.createElement(_,{id:q},e.createElement(P,null,e.createElement(f,{as:"h2",size:S.TYPOGRAPHY.PRESET_SIZES.XXX_SMALL},w.TITLE),e.createElement(C,null,e.createElement(g,{as:"label",htmlFor:U,size:S.TYPOGRAPHY.PRESET_SIZES.SMALL},w.SWITCH_LABEL),e.createElement(x,{id:U,"aria-label":w.SWITCH_LABEL,name:U,checked:G,onChange:Z}))),e.createElement(u,null,e.createElement(L,{items:M,selectedItemId:H,selectItem:K,deselectItem:()=>K(null),ariaLabel:__("Select filter for text sets list","web-stories")})),e.createElement(A,null,z?.length||$?e.createElement(j,{paneRef:b,filteredTextSets:z}):e.createElement(I,null,D)))}export{TextSetsPane as default};
