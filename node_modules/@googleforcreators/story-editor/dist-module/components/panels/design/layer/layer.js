/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

import e from"react";import r,{css as t}from"styled-components";import{rgba as o}from"polished";import{__}from"@googleforcreators/i18n";import{Button as a,BUTTON_TYPES as i,themeHelpers as n,Icons as s,Tooltip as l}from"@googleforcreators/design-system";import{memo as p,useRef as c}from"@googleforcreators/react";import{getDefinitionForType as m}from"@googleforcreators/elements";import{LayerText as d}from"@googleforcreators/element-library";import"../../../../types.js";import"@googleforcreators/transform";import"../../../dropTargets/provider.js";import"../../../dropTargets/context.js";import"../../../../app/history/historyProvider.js";import"../../../../app/history/context.js";import"prop-types";import"@googleforcreators/templates";import"../../../../app/config/context.js";import"../../../../app/api/context.js";import"@googleforcreators/fonts";import"@googleforcreators/dom";import"../../../../constants/fonts.js";import"../../../../constants/multipleValue.js";import{TRACKING_EVENTS as g}from"../../../../constants/performanceTrackingEvents.js";import"../../../../app/font/context.js";import"@googleforcreators/media";import"@googleforcreators/tracking";import"@googleforcreators/animation";import"uuid";import"@googleforcreators/masks";import"../../../../app/story/context.js";import"@googleforcreators/migration";import"../../../../app/story/actions/useSaveStory.js";import"clone-deep";import"../../../../app/story/useStoryReducer/useStoryReducer.js";import"@googleforcreators/output";import"../../../../app/story/storyTriggers/storyTriggersProvider.js";import"../../../../app/story/storyTriggers/storyEvents/onInitialElementAddedRegister.js";import"../../../../app/story/storyTriggers/storyEvents/onPageAddedRegister.js";import u from"../../../../app/story/useStory.js";import"../../../../app/media/useUploadMedia.js";import"@googleforcreators/patterns";import y from"../../../../utils/useCORSProxy.js";import"../../../../utils/generateBlurhash.worker.js";import"../../../../app/media/media3p/providerConfiguration.js";import"../../../../app/media/utils/useFFmpeg.js";import"../../../../app/media/media3p/api/context.js";import"../../../../app/media/local/constants.js";import"../../../../app/media/media3p/providerReducer.js";import"../../../../app/media/context.js";import"sat";import"@googleforcreators/units";import"../../../../app/layout/context.js";import"../../../../app/layout/useZoomSetting.js";import"@googleforcreators/rich-text";import"@googleforcreators/stickers";import"../../../library/panes/text/textPresets.js";import"../../../../app/canvas/context.js";import"../../../../app/currentUser/context.js";import"../../../../app/helpCenter/provider.js";import"../../../../app/helpCenter/context.js";import"../../../helpCenter/constants.js";import"../../../../app/rightClickMenu/context.js";import f from"../../../../utils/usePerformanceTracking.js";import h from"./useLayerSelection.js";import{LAYER_HEIGHT as v}from"./constants.js";const b=r.div.withConfig({displayName:"layer__ActionsContainer",componentId:"sc-aphr0z-0"})(["position:absolute;display:none;align-items:center;height:100%;top:0;right:0;padding-right:6px;column-gap:6px;--background-color:",";--background-color-opaque:",";background-color:var(--background-color);::before{position:absolute;content:'';width:32px;height:100%;top:0;left:0;transform:translateX(-100%);background:linear-gradient( to right,var(--background-color-opaque),var(--background-color) );pointer-events:none;}"],(e=>{let{theme:r}=e;return r.colors.bg.secondary}),(e=>{let{theme:r}=e;return o(r.colors.bg.secondary,0)})),k=r.div.attrs({"data-testid":"layer-option"}).withConfig({displayName:"layer__LayerContainer",componentId:"sc-aphr0z-1"})(["position:relative;height:","px;width:100%;overflow:hidden;:is(:hover,:focus-within) ","{display:inline-flex;}"],v,b),j=r(a).attrs({type:i.PLAIN,tabIndex:-1,role:"option"}).withConfig({displayName:"layer__LayerButton",componentId:"sc-aphr0z-2"})(["position:relative;display:grid;grid-template-columns:36px 1fr;border:0;padding:0;background:transparent;height:100%;width:100%;overflow:hidden;align-items:center;user-select:none;border-radius:0;padding-left:12px;transition:revert;"," :hover{background:",";}:hover + *{--background-color:",";--background-color-opaque:",";}:active{background:",";}:active + *{--background-color:",";--background-color-opaque:",";}"],(e=>{let{isSelected:r,theme:a}=e;return r&&t(["background:",";+ *{--background-color:",";--background-color-opaque:",";--selected-hover-color:",";}"],a.colors.interactiveBg.tertiaryPress,a.colors.interactiveBg.tertiaryPress,o(a.colors.interactiveBg.tertiaryPress,0),a.colors.interactiveBg.tertiaryHover)}),(e=>{let{theme:r}=e;return r.colors.interactiveBg.tertiaryHover}),(e=>{let{theme:r}=e;return r.colors.interactiveBg.tertiaryHover}),(e=>{let{theme:r}=e;return o(r.colors.interactiveBg.tertiaryHover,0)}),(e=>{let{theme:r}=e;return r.colors.interactiveBg.tertiaryPress}),(e=>{let{theme:r}=e;return r.colors.interactiveBg.tertiaryPress}),(e=>{let{theme:r}=e;return o(r.colors.interactiveBg.tertiaryPress,0)})),x=r.div.withConfig({displayName:"layer__LayerIconWrapper",componentId:"sc-aphr0z-3"})(["display:flex;align-items:center;justify-content:flex-start;color:",";"],(e=>{let{theme:r}=e;return r.colors.fg.primary})),E=r.div.withConfig({displayName:"layer__LayerDescription",componentId:"sc-aphr0z-4"})(["position:relative;width:100%;overflow:hidden;display:flex;align-items:center;margin-left:0;text-align:left;color:",";"],(e=>{let{theme:r}=e;return r.colors.fg.primary})),w=r.div.withConfig({displayName:"layer__IconWrapper",componentId:"sc-aphr0z-5"})(["display:flex;align-items:center;justify-content:flex-start;position:absolute;right:0;width:32px;aspect-ratio:1;svg{position:relative;display:block;width:100%;color:",";}"],(e=>{let{theme:r}=e;return r.colors.fg.secondary})),C=r.div.withConfig({displayName:"layer__LayerContentContainer",componentId:"sc-aphr0z-6"})(["margin-right:8px;text-overflow:ellipsis;white-space:nowrap;overflow:hidden;"]),B=r(a).attrs({type:i.PLAIN,tabIndex:-1}).withConfig({displayName:"layer__LayerAction",componentId:"sc-aphr0z-7"})(["position:relative;aspect-ratio:1;width:20px;padding:0;svg{position:absolute;width:32px;height:auto;top:50%;left:50%;transform:translate(-50%,-50%);}&&{transition:revert;background:var(--background-color);}:disabled{color:",";}:hover{color:var( --selected-hover-color,"," );}& + &{margin-left:4px;}*{pointer-events:none;}:focus{","}"],(e=>{let{theme:r}=e;return r.colors.fg.secondary}),(e=>{let{theme:r}=e;return r.colors.fg.secondary}),(e=>{let{theme:r}=e;return n.focusCSS(r.colors.border.focus,"var(--background-color)")}));function P(e){e.stopPropagation(),e.preventDefault()}var I=p((function Layer(r){let{element:t}=r;const{LayerIcon:o,LayerContent:a}=m(t.type),{isSelected:i,handleClick:n}=h(t),{isDefaultBackground:p}=t,{duplicateElementsById:v,deleteElementById:I,currentPageBackgroundColor:L}=u((e=>{let{actions:r,state:t}=e;return{duplicateElementsById:r.duplicateElementsById,deleteElementById:r.deleteElementById,currentPageBackgroundColor:!p||t.currentPage?.backgroundColor}})),{getProxiedUrl:_}=y(),T=c(null);f({node:T.current,eventData:{...g.SELECT_ELEMENT,label:t.type}});const D=c(null);f({node:D.current,eventData:{...g.DELETE_ELEMENT,label:t.type}});const S=`layer-${t.id}`;return e.createElement(k,null,e.createElement(j,{ref:T,id:S,onClick:n,isSelected:i},e.createElement(x,null,e.createElement(o,{element:t,getProxiedUrl:_,currentPageBackgroundColor:L})),e.createElement(E,null,e.createElement(C,null,t.isBackground?e.createElement(d,null,__("Background","web-stories")):e.createElement(a,{element:t})),t.isBackground&&e.createElement(w,null,e.createElement(s.LockClosed,null)))),e.createElement(b,null,t.isBackground?e.createElement(B,{"aria-label":__("Locked","web-stories"),"aria-describedby":S,disabled:!0},e.createElement(s.LockClosed,null)):e.createElement(e.Fragment,null,e.createElement(l,{title:__("Delete Layer","web-stories"),hasTail:!0,isDelayed:!0},e.createElement(B,{ref:D,"aria-label":__("Delete","web-stories"),"aria-describedby":S,onPointerDown:P,onClick:()=>I({elementId:t.id})},e.createElement(s.Trash,null))),e.createElement(l,{title:__("Duplicate Layer","web-stories"),hasTail:!0,isDelayed:!0},e.createElement(B,{"aria-label":__("Duplicate","web-stories"),"aria-describedby":S,onPointerDown:P,onClick:()=>v({elementIds:[t.id]})},e.createElement(s.PagePlus,null))))))}));export{I as default};
