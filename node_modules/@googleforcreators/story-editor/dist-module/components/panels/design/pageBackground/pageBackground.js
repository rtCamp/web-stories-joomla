/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

import e from"styled-components";import t from"react";import{useState as o,useCallback as r,useEffect as i}from"@googleforcreators/react";import{__}from"@googleforcreators/i18n";import"prop-types";import{Button as a,BUTTON_SIZES as s,BUTTON_VARIANTS as p,BUTTON_TYPES as n,Text as c,Icons as m,THEME_CONSTANTS as l,Tooltip as g}from"@googleforcreators/design-system";import{trackEvent as d}from"@googleforcreators/tracking";import{createNewElement as u,getDefinitionForType as f}from"@googleforcreators/elements";import h from"../../../form/color/color.js";import"../../../form/filterToggle/filterToggle.js";import"../../../form/linkIcon.js";import"../../../form/link.js";import"../../../form/media.js";import j from"../../../form/mediaUploadButton.js";import x from"../../../form/row.js";import"../../../form/switch.js";import"../../../form/textArea.js";import"../../../form/context.js";import"../../../form/dateTime/dateTime.js";import"../../../form/required.js";import"../../../form/radioGroup/index.js";import"../../../form/select/select.js";import"../../../form/hierarchical/index.js";import"@googleforcreators/transform";import"../../../dropTargets/provider.js";import"../../../dropTargets/context.js";import"../../../../app/history/historyProvider.js";import"../../../../app/history/context.js";import"@googleforcreators/templates";import"../../../../app/config/context.js";import k from"../../../../app/config/useConfig.js";import"../../../../app/api/context.js";import"@googleforcreators/fonts";import"@googleforcreators/dom";import"../../../../constants/fonts.js";import"../../../../constants/multipleValue.js";import"../../../../app/font/context.js";import"@googleforcreators/media";import"@googleforcreators/animation";import"uuid";import"@googleforcreators/masks";import"@googleforcreators/element-library";import"../../../../app/story/context.js";import"@googleforcreators/migration";import"../../../../app/story/actions/useSaveStory.js";import"clone-deep";import"../../../../app/story/useStoryReducer/useStoryReducer.js";import"@googleforcreators/output";import"../../../../app/story/storyTriggers/storyTriggersProvider.js";import"../../../../app/story/storyTriggers/storyEvents/onInitialElementAddedRegister.js";import"../../../../app/story/storyTriggers/storyEvents/onPageAddedRegister.js";import y from"../../../../app/story/useStory.js";import"../../../../app/media/useUploadMedia.js";import"@googleforcreators/patterns";import C from"../../../../utils/useCORSProxy.js";import"../../../../utils/generateBlurhash.worker.js";import"../../../../app/media/media3p/providerConfiguration.js";import"../../../../app/media/utils/useFFmpeg.js";import"../../../../app/media/media3p/api/context.js";import"../../../../app/media/local/constants.js";import"../../../../app/media/media3p/providerReducer.js";import"../../../../app/media/context.js";import"sat";import"@googleforcreators/units";import E from"../../../../app/layout/useLayout.js";import"../../../../app/layout/context.js";import"../../../../app/layout/useZoomSetting.js";import"@googleforcreators/rich-text";import w from"../../../canvas/utils/getElementProperties.js";import"../../../library/panes/text/textPresets.js";import"../../../../app/canvas/context.js";import"../../../../app/currentUser/context.js";import"../../../../app/helpCenter/provider.js";import"../../../../app/helpCenter/context.js";import"../../../helpCenter/constants.js";import"../../../../app/rightClickMenu/context.js";import"../../../checklist/checklistContext/context.js";import"../../../checklist/checkpointContext/checkpointContext.js";import"../../../checklist/countContext/checkCountContext.js";import"../../../checklist/checklist.js";import{styles as b}from"../../../../app/highlights/index.js";import{ACCESSIBILITY_COPY as P}from"../../../checklist/constants.js";import"../../../checklistCard/styles.js";import"../../../checklist/checks/shared/thumbnailWrapper.js";import"../../../checklistCard/constants.js";import"../../../thumbnail/constants.js";import"../../../thumbnail/styles.js";import"../../../../types.js";import"../../../footer/pagepreview/index.js";import{getPagesWithFailedContrast as B}from"../../../checklist/checks/pageBackgroundLowTextContrast/check.js";import"../../../checklist/checks/videoOptimization.js";import"../../panel/panel.js";import"../../panel/context.js";import"../../panel/shared/title.js";import"../../panel/shared/content.js";import v from"../../panel/simplePanel.js";import R from"../../shared/flipControls.js";import"../../shared/linkRelations.js";import _ from"../warning/warning.js";import S from"../../../../app/highlights/useHighlights.js";import T from"../../../../app/highlights/states.js";const A={horizontal:!1,vertical:!1},I=e(x).withConfig({displayName:"pageBackground__Row",componentId:"sc-1rac0x7-0"})(["justify-content:flex-start;"]),L=e.div.withConfig({displayName:"pageBackground__SelectedMedia",componentId:"sc-1rac0x7-1"})(["width:128px;height:36px;border-radius:4px;border:1px solid ",";display:flex;justify-content:space-between;margin-right:12px;"],(e=>{let{theme:t}=e;return t.colors.border.defaultNormal})),U=e.div.withConfig({displayName:"pageBackground__MediaWrapper",componentId:"sc-1rac0x7-2"})(["height:24px;width:24px;border-radius:4px;overflow:hidden;margin:5px;img{object-fit:cover;max-height:100%;max-width:100%;}"]),M=e(a).withConfig({displayName:"pageBackground__RemoveButton",componentId:"sc-1rac0x7-3"})(["margin:1px;align-self:center;"]),N=e(a).attrs({size:s.SMALL,variant:p.SQUARE,type:n.TERTIARY}).withConfig({displayName:"pageBackground__ReplaceButton",componentId:"sc-1rac0x7-4"})(["margin-right:8px;"]),H=e(c).withConfig({displayName:"pageBackground__Text",componentId:"sc-1rac0x7-5"})(["align-self:center;width:55px;"]);function PageBackgroundPanel(e){let{selectedElements:a,pushUpdate:c}=e;const{isDefaultBackground:x}=a[0],{combineElements:v,currentPage:z,clearBackgroundElement:G,updateCurrentPageProperties:D,currentPageBackgroundColor:F}=y((e=>{let{state:t,actions:o}=e;return{currentPage:t.currentPage,clearBackgroundElement:o.clearBackgroundElement,combineElements:o.combineElements,updateCurrentPageProperties:o.updateCurrentPageProperties,currentPageBackgroundColor:!x||t.currentPage?.backgroundColor}})),{getProxiedUrl:Y}=C(),{capabilities:{hasUploadMediaAction:W}}=k(),Q=E((e=>{let{state:{pageWidth:t,pageHeight:o}}=e;return{width:t,height:o}})),[Z,$]=o(!1),q=r((e=>{D({properties:{backgroundColor:e}})}),[D]),K=r((()=>{c({isBackground:!1,opacity:100},!0),G()}),[c,G]),V=r((e=>{const t=u(e.type,w(e.type,{resource:e}));v({firstElement:t,secondId:a[0].id}),d("replace_background_media")}),[v,a]),J=r((e=>t.createElement(N,{onClick:e,"aria-label":__("Replace","web-stories")},t.createElement(m.ArrowCloud,null))),[]),{highlight:X,resetHighlight:ee,cancelHighlight:te}=S((e=>({highlight:e[T.PAGE_BACKGROUND],resetHighlight:e.onFocusOut,cancelHighlight:e.cancelEffect})));i((()=>{B([z],Q).then((e=>{const t=e[0]?.result,o=t?.some((e=>{let{isBackground:t}=e;return t}));$(Boolean(o))})).catch((()=>{}))}),[z,Q]);const oe=a[0];if(!oe||!oe.isBackground)return null;const re=oe.isBackground&&!x,{backgroundColor:ie}=z,{LayerIcon:ae}=f(oe.type),se=a[0]?.flip||A;return t.createElement(O,{onAnimationEnd:()=>ee(),name:"pageBackground",title:__("Page Background","web-stories"),isPersistable:!X,collapsedByDefault:!1,$_css:X?.showEffect&&b.FLASH},x&&t.createElement(I,null,t.createElement(h,{ref:e=>{e&&X?.focus&&X?.showEffect&&(e.addEventListener("keydown",te,{once:!0}),e.focus())},allowsGradient:!0,value:ie,onChange:q,label:__("Background color","web-stories"),allowsSavedColors:!0,allowsOpacity:!1})),re&&t.createElement(I,{expand:!1},t.createElement(L,null,t.createElement(U,null,t.createElement(ae,{element:oe,getProxiedUrl:Y,currentPageBackgroundColor:F})),t.createElement(H,{size:l.TYPOGRAPHY.PRESET_SIZES.SMALL},__("Media","web-stories")),t.createElement(M,{"aria-label":__("Detach background","web-stories"),onClick:K,size:s.SMALL,variant:p.SQUARE,type:n.TERTIARY},t.createElement(m.Cross,null))),W&&t.createElement(g,{title:__("Replace","web-stories")},t.createElement(j,{buttonInsertText:__("Use as background","web-stories"),onInsert:V,renderButton:J})),t.createElement(R,{onChange:e=>c({flip:e},!0),value:se})),Z&&t.createElement(_,{message:P.lowContrast.backgroundPanel}))}var O=e(v).withConfig({displayName:"pageBackground___StyledSimplePanel",componentId:"sc-1rac0x7-6"})(["",""],(e=>e.$_css));export{PageBackgroundPanel as default};
