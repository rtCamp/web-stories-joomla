/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

import e from"react";import"prop-types";import t,{css as r}from"styled-components";import{useMemo as i,useRef as o,useCallback as a}from"@googleforcreators/react";import{__,_x}from"@googleforcreators/i18n";import n from"@googleforcreators/stickers";import{calcRotatedObjectPositionAndSize as s,dataPixels as l}from"@googleforcreators/units";import{LockToggle as c,Button as m,BUTTON_TYPES as p,BUTTON_SIZES as d,BUTTON_VARIANTS as u,NumericInput as f,Tooltip as g,Icons as h}from"@googleforcreators/design-system";import{getDefinitionForType as b}from"@googleforcreators/elements";import"../../panel/panel.js";import"../../panel/context.js";import"../../panel/shared/title.js";import"../../panel/shared/content.js";import w from"../../panel/simplePanel.js";import x from"../../shared/flipControls.js";import{focusStyle as y,inputContainerStyleOverride as E}from"../../shared/styles.js";import"../../shared/linkRelations.js";import j from"../../shared/getCommonValue.js";import"@googleforcreators/patterns";import"../../../../constants/fonts.js";import{MULTIPLE_VALUE as v,MULTIPLE_DISPLAY_VALUE as k}from"../../../../constants/multipleValue.js";import{TRACKING_EVENTS as A}from"../../../../constants/performanceTrackingEvents.js";import I from"../../shared/useCommonObjectValue.js";import C from"../../../../app/story/useStory.js";import S from"../../../../utils/usePerformanceTracking.js";import M from"./usePresubmitHandlers.js";import{getMultiSelectionMinMaxXY as N,isNum as P}from"./utils.js";import{DEFAULT_FLIP as O,MIN_MAX as T}from"./constants.js";import R from"./opacity.js";import X from"./radius.js";function _(){return _=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},_.apply(this,arguments)}const H=t(c).withConfig({displayName:"sizePosition__StyledLockToggle",componentId:"sc-7rw4xb-0"})(["",";"],y);function Y(e){return n?.[e?.sticker?.type].aspectRatio||1}const z=r(["grid-template-areas:"," 'x . . . y . .' 'w . d . h . l' 'r . . . o . .' 'c c c c c c c';"],(e=>{let{isSingleMedia:t}=e;return t?"'b b b b b . .'":null})),L=r(["grid-template-areas:"," 'x . . . y . .' 'w . d . h . l' 'r . . . f . .' ",";"],(e=>{let{isSingleMedia:t}=e;return t?"'b b b b b . .'":null}),(e=>{let{unlockedRadius:t}=e;return t?"\n  'o . . . . . .'\n  'c c c c c c c'\n":"'o . . . c c c'"})),D=t.div.withConfig({displayName:"sizePosition__Grid",componentId:"sc-7rw4xb-1"})(["display:grid;"," grid-template-columns:1fr 4px 8px 4px 1fr 8px 32px;grid-template-rows:repeat(4,36px);row-gap:16px;align-items:center;justify-items:start;margin-bottom:16px;"],(e=>{let{canFlip:t}=e;return t?L:z})),B=t.div.withConfig({displayName:"sizePosition__Area",componentId:"sc-7rw4xb-2"})(["grid-area:",";width:100%;"],(e=>{let{area:t}=e;return t})),G=t.div.withConfig({displayName:"sizePosition__Dash",componentId:"sc-7rw4xb-3"})(["height:1px;width:100%;background:",";"],(e=>{let{theme:t}=e;return t.colors.divider.primary})),W=t(m).withConfig({displayName:"sizePosition__StyledButton",componentId:"sc-7rw4xb-4"})(["padding:10px 16px;width:100%;",";"],y);function SizePositionPanel(t){const{selectedElements:r,submittedSelectedElements:n,pushUpdate:c,pushUpdateForObject:m}=t,y=j(r,"x"),z=j(r,"y"),L=j(r,"width"),F=j(r,"height"),U=j(r,"rotationAngle"),V=I(r,"flip",O),K=I(r,"borderRadius",{locked:!0}),q=i((()=>j(n,"width")/j(n,"height")),[n]),J=j(r,"lockAspectRatio"),Q=o(null);S({node:Q.current,eventData:A.SET_BACKGROUND_MEDIA});const Z=J===v||J,{currentPage:$,combineElements:ee}=C((e=>({currentPage:e.state.currentPage,combineElements:e.actions.combineElements}))),te=$?.elements[0].id,re=1===r.length,{isMedia:ie}=b(r[0].type),oe=r.every((e=>{let{type:t}=e;return b(t).canFlip})),ae=r.some((e=>{let{type:t}=e;return b(t).isAspectAlwaysLocked})),ne=r.some((e=>{let{type:t}=e;return"text"===t})),se=i((()=>re?s(U,y,z,L,F):{}),[U,y,z,L,F,re]),le=y-se.x,ce=z-se.y,me=re?{minX:T.X.MIN+le-se.width,minY:T.Y.MIN+ce-se.height,maxX:T.X.MAX+le,maxY:T.Y.MAX+ce}:N(r),pe=(e,t)=>J===v?{lockAspectRatio:Z,height:t,width:e}:{height:t,width:e};M(Z,F,L);const de=a((()=>{ee({firstElement:r[0],secondId:te})}),[r,ee,te]),ue=!Z&&ne,fe=v===F?k:null,ge=ue?__("Auto","web-stories"):fe,he=a((e=>({isIndeterminate:v===e,placeholder:v===e?k:null})),[]);return e.createElement(w,{name:"size",title:__("Selection","web-stories")},e.createElement(D,{isSingleMedia:ie&&re,canFlip:oe,unlockedRadius:!K.locked},ie&&re&&e.createElement(B,{area:"b"},e.createElement(W,{ref:Q,onClick:de,type:p.SECONDARY,size:d.SMALL,variant:u.RECTANGLE},__("Set as background","web-stories"))),e.createElement(B,{area:"x"},e.createElement(f,_({suffix:_x("X","Position on X axis","web-stories"),value:y,min:me.minX,max:me.maxX,onChange:(e,t)=>c({x:t},!0),"aria-label":__("X position","web-stories"),canBeNegative:!0},he(y),{containerStyleOverride:E}))),e.createElement(B,{area:"y"},e.createElement(f,_({suffix:_x("Y","Position on Y axis","web-stories"),value:z,min:me.minY,max:me.maxY,onChange:(e,t)=>c({y:t},!0),"aria-label":__("Y position","web-stories"),canBeNegative:!0},he(z),{containerStyleOverride:E}))),e.createElement(B,{area:"w"},e.createElement(f,_({suffix:_x("W","The Width dimension","web-stories"),value:L,min:T.WIDTH.MIN,max:T.WIDTH.MAX,onChange:(e,t)=>{const r=t;let i=F;Z&&(""===r?i="":P(r/q)&&(i=l(r/q))),c((e=>{if("sticker"===e?.type){const t=Y(e);return pe(r,Math.floor(r/t))}return pe(r,i)}),!0)},"aria-label":__("Width","web-stories")},he(L),{containerStyleOverride:E}))),e.createElement(B,{area:"d"},e.createElement(G,null)),e.createElement(B,{area:"h"},e.createElement(f,{suffix:_x("H","The Height dimension","web-stories"),value:ue?"":F,disabled:ue,min:T.HEIGHT.MIN,max:T.HEIGHT.MAX,onChange:(e,t)=>{const r=t;let i=L;Z&&(""===r?i="":P(r*q)&&(i=l(r*q))),c((e=>{if("sticker"===e?.type){const t=Y(e);return pe(Math.floor(r*t),r)}return pe(i,r)}),!0)},"aria-label":__("Height","web-stories"),isIndeterminate:v===F,placeholder:ge,containerStyleOverride:E})),e.createElement(B,{area:"l"},e.createElement(g,{title:__("Lock aspect ratio","web-stories")},e.createElement(H,{"aria-label":__("Lock aspect ratio","web-stories"),title:__("Lock aspect ratio","web-stories"),isLocked:Z||ae,disabled:ae,onClick:()=>!ae&&c({lockAspectRatio:!Z},!0)}))),e.createElement(B,{area:"r"},e.createElement(f,_({suffix:e.createElement(h.Angle,null),unit:_x("Â°","Degrees, 0 - 360.","web-stories"),value:U,min:T.ROTATION.MIN,max:T.ROTATION.MAX,onChange:(e,t)=>c({rotationAngle:t},!0),"aria-label":__("Rotation","web-stories"),canBeNegative:!0},he(U),{containerStyleOverride:E}))),oe&&e.createElement(B,{area:"f"},e.createElement(x,{onChange:e=>m("flip",e,O,!0),value:V})),e.createElement(B,{area:"o"},e.createElement(R,t)),e.createElement(B,{area:"c"},e.createElement(X,t))))}export{SizePositionPanel as default};
