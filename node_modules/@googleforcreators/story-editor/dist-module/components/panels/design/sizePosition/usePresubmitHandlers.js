/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

import{useCallback as t}from"@googleforcreators/react";import{clamp as e,dataPixels as r,calcRotatedObjectPositionAndSize as o}from"@googleforcreators/units";import{getDefinitionForType as i}from"@googleforcreators/elements";import n from"../../../form/usePresubmitHandler.js";import{MIN_MAX as h}from"./constants.js";import{isNum as s}from"./utils.js";function l(l,g,u){n(((t,o,n)=>{let{width:s,height:g}=o,{width:u,height:f}=n;const{type:H}=t,m=Boolean(s),a=Boolean(g);if(!m&&!a)return null;const{updateForResizeEvent:I}=i(H);if(I){return I(t,[m?1:0,a?1:0],e(s,h.WIDTH),e(g,h.HEIGHT))}if(l){const t=u/f;if(!m)return{width:e(r(g*t),h.WIDTH)};if(!a)return{height:e(r(s/t),h.HEIGHT)}}return null}),[l]),n((t=>{let{rotationAngle:e}=t;return{rotationAngle:e%360}}),[]),n((t=>{let{rotationAngle:r,x:i,y:n,width:s,height:l}=t;const g=o(r,i,n,s,l),u=i-g.x,f=n-g.y;return{x:e(i,{MIN:h.X.MIN+u-g.width,MAX:h.X.MAX+u}),y:e(n,{MIN:h.Y.MIN+f-g.height,MAX:h.Y.MAX+f})}}),[]);const f=t(((t,r,o)=>l&&t>=o.MAX?e(o.MAX*r,o):e(t,o)),[l]);n(((t,o)=>{let{height:i}=t,{width:n,height:l}=o;const g=l/n;return i=e(i,h.HEIGHT),s(g)?{height:f(r(i),g,h.HEIGHT)}:{height:e(i,h.HEIGHT)}}),[g,l]),n(((t,o)=>{let{width:i}=t,{width:n,height:l}=o;const g=n/l;return i=e(i,h.WIDTH),s(g)?{width:f(r(i),g,h.WIDTH)}:{width:e(i,h.WIDTH)}}),[u,l])}export{l as default};
