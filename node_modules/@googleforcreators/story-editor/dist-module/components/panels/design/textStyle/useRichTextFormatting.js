/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

import{useMemo as t,useCallback as e,useRef as o,useEffect as r}from"@googleforcreators/react";import{isPatternEqual as i}from"@googleforcreators/patterns";import{useGlobalKeyDownEffect as n}from"@googleforcreators/design-system";import{useRichText as s,getHTMLInfo as a,getHTMLFormatters as p}from"@googleforcreators/rich-text";import"@googleforcreators/transform";import"../../../dropTargets/provider.js";import"../../../dropTargets/context.js";import"../../../../app/history/historyProvider.js";import"../../../../app/history/context.js";import"react";import"prop-types";import"@googleforcreators/templates";import"../../../../app/config/context.js";import"../../../../app/api/context.js";import"@googleforcreators/fonts";import"@googleforcreators/dom";import"../../../../constants/fonts.js";import{MULTIPLE_VALUE as l}from"../../../../constants/multipleValue.js";import"../../../../app/font/context.js";import"@googleforcreators/media";import"@googleforcreators/tracking";import"@googleforcreators/animation";import"uuid";import"@googleforcreators/masks";import"@googleforcreators/element-library";import"@googleforcreators/elements";import"../../../../app/story/context.js";import"@googleforcreators/migration";import"../../../../app/story/actions/useSaveStory.js";import"clone-deep";import"../../../../app/story/useStoryReducer/useStoryReducer.js";import"@googleforcreators/output";import"../../../../app/story/storyTriggers/storyTriggersProvider.js";import"../../../../app/story/storyTriggers/storyEvents/onInitialElementAddedRegister.js";import"../../../../app/story/storyTriggers/storyEvents/onPageAddedRegister.js";import"@googleforcreators/i18n";import"../../../../app/media/useUploadMedia.js";import"../../../../utils/generateBlurhash.worker.js";import"../../../../app/media/media3p/providerConfiguration.js";import"../../../../app/media/utils/useFFmpeg.js";import"../../../../app/media/media3p/api/context.js";import"../../../../app/media/local/constants.js";import"../../../../app/media/media3p/providerReducer.js";import"../../../../app/media/context.js";import"sat";import"@googleforcreators/units";import"../../../../app/layout/context.js";import"../../../../app/layout/useZoomSetting.js";import"@googleforcreators/stickers";import"../../../library/panes/text/textPresets.js";import"../../../../app/canvas/context.js";import c from"../../../../app/canvas/useCanvas.js";import"../../../../app/currentUser/context.js";import"../../../../app/helpCenter/provider.js";import"../../../../app/helpCenter/context.js";import"../../../helpCenter/constants.js";import"../../../../app/rightClickMenu/context.js";function g(t,e){return Object.fromEntries(Object.keys(e).map((o=>{const r=t[o]===l,n=void 0!==t[o]&&!function(t,e){const o=t&&"object"==typeof t&&(t.type||t.color),r=e&&"object"==typeof e&&(e.type||e.color);return o&&r?i(t,e):t===e}(t[o],e[o]);return r||n?[o,l]:[o,e[o]]})))}function m(i,l){const{hasCurrentEditor:m,selectionInfo:d,selectionActions:u}=s((t=>{let{state:e,actions:o}=t;return{hasCurrentEditor:e.hasCurrentEditor,selectionInfo:e.selectionInfo,selectionActions:o.selectionActions}})),{clearEditing:f}=c((t=>{let{actions:{clearEditing:e}}=t;return{clearEditing:e}})),h=t((()=>m?d:i.map((t=>{let{content:e}=t;return e})).map(a).reduce(g,{})),[m,d,i]),j=e((function(t){for(var e=arguments.length,o=new Array(e>1?e-1:0),r=1;r<e;r++)o[r-1]=arguments[r];return l((e=>{let{content:r}=e;return{content:t(r,...o)}}),!0)}),[l]),y=o(null),C=e((function(){for(var t=arguments.length,e=new Array(t),o=0;o<t;o++)e[o]=arguments[o];y.current=e}),[y]);r((()=>{const t=y.current;t&&(j(...t),y.current=null)}),[i,y,j]);const S=t((()=>{const t=p();return m?{handleClickBold:()=>u.toggleBoldInSelection(),handleSelectFontWeight:u.setFontWeightInSelection,handleClickItalic:u.toggleItalicInSelection,handleClickUnderline:u.toggleUnderlineInSelection,handleClickUppercase:u.toggleUppercaseInSelection,handleSetLetterSpacing:u.setLetterSpacingInSelection,handleSetColor:u.setColorInSelection,handleResetFontWeight:async e=>{await f(),C(t.setFontWeight,e)}}:{handleClickBold:e=>j(t.toggleBold,e),handleSelectFontWeight:e=>j(t.setFontWeight,e),handleClickItalic:e=>j(t.toggleItalic,e),handleClickUnderline:e=>j(t.toggleUnderline,e),handleClickUppercase:e=>j(t.toggleUppercase,e),handleSetLetterSpacing:e=>j(t.setLetterSpacing,e),handleSetColor:e=>j(t.setColor,e),handleResetFontWeight:e=>j(t.setFontWeight,e)}}),[m,u,j,f,C]),k=e((()=>i.filter((t=>{let{type:e}=t;return"text"===e})).length>0),[i]);return n({key:["mod+b","mod+u","mod+i"]},(t=>{let{key:e}=t;if(k)switch(e){case"b":S.handleClickBold();break;case"i":S.handleClickItalic();break;case"u":S.handleClickUnderline()}}),[S,k]),{textInfo:h,handlers:S}}export{m as default};
