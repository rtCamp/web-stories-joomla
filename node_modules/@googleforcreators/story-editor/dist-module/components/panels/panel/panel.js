/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

import e from"react";import t from"styled-components";import"prop-types";import{v4 as o}from"uuid";import{useMemo as r,useState as s,useCallback as a,useEffect as i}from"@googleforcreators/react";import{trackEvent as l}from"@googleforcreators/tracking";import{localStore as n,LOCAL_STORAGE_PREFIX as p}from"@googleforcreators/design-system";import"../../../constants/fonts.js";import"../../../constants/multipleValue.js";import"@googleforcreators/animation";import"@googleforcreators/masks";import"@googleforcreators/element-library";import"@googleforcreators/elements";import"../../../app/story/context.js";import"@googleforcreators/migration";import"@googleforcreators/templates";import"../../../app/config/context.js";import"../../../app/api/context.js";import"../../../app/history/historyProvider.js";import"../../../app/history/context.js";import"../../../app/story/actions/useSaveStory.js";import"clone-deep";import"../../../app/story/useStoryReducer/useStoryReducer.js";import"@googleforcreators/output";import"../../../app/story/storyTriggers/storyTriggersProvider.js";import"../../../app/story/storyTriggers/storyEvents/onInitialElementAddedRegister.js";import"../../../app/story/storyTriggers/storyEvents/onPageAddedRegister.js";import m from"../../../app/story/useStory.js";import d from"./context.js";function c(){return c=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var r in o)Object.prototype.hasOwnProperty.call(o,r)&&(e[r]=o[r])}return e},c.apply(this,arguments)}const g=10,y=999999999,h=t.section.withConfig({displayName:"panel__Wrapper",componentId:"sc-1vyy7rt-0"})(["display:flex;flex-direction:column;position:relative;border-bottom:1px solid ",";",""],(e=>{let{theme:t}=e;return t.colors.divider.tertiary}),(e=>{let{noBorder:t}=e;return t&&"border-bottom: none;"}));function Panel(t){let{name:g,children:u,resizable:f=!1,showDragHandle:j,showFocusStyles:b,canCollapse:x=!0,collapsedByDefault:v=!0,initialHeight:E=null,maxHeight:H=y,ariaLabel:P=null,ariaHidden:T=!1,isPersistable:I=!0,...$}=t;const S=0===H?y:H,{selectedElementIds:w}=m((e=>{let{state:{selectedElementIds:t}}=e;return{selectedElementIds:t}})),C=r((()=>I?n.getItemByKey(`${p.PANEL}:${g}`):null),[g,I]),[M,R]=s((()=>!!I&&(C?.isCollapsed??v))),[A,B]=s(Math.min(C?.expandToHeight,S)||E),[_,D]=s(Math.min(C?.height,S)||E),[L,N]=s(!1),[O,k]=s(!1),z=a((e=>{D(Math.min(e,S))}),[S]),F=a((e=>{B(Math.min(e,S))}),[S]),K=a((()=>N(!0)),[]),V=a((()=>{x&&(R(!0),k(!0),f&&z(0),l("panel_toggled",{name:g,status:"collapsed"}))}),[f,x,g,z]),W=a((function(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];R(!1),k(!0),e&&f&&z(A),l("panel_toggled",{name:g,status:"expanded"})}),[f,A,g,z]);i((()=>{I||W(!0)}),[W,I,w]),i((()=>{f&&_<=10&&!M&&V()}),[V,_,f,M]),i((()=>{O||C||!f||(z(E),F(E))}),[O,E,f,C,g,F,z]),i((()=>{S<_&&z(S),S<A&&F(S)}),[A,_,S,z,F]),i((()=>{I&&O&&n.setItemByKey(`${p.PANEL}:${g}`,{height:_,isCollapsed:M,expandToHeight:A})}),[g,M,_,A,O,I]);const q=a((e=>{f&&(k(!0),z(Math.min(e(_),S)),M&&e(_)>10&&W(!1))}),[W,_,M,S,f,z,k]),G=a((()=>{k(!1),M&&W(!0)}),[W,M]),J=`panel-${g}-${o()}`,Q=`panel-title-${g}-${o()}`,U={state:{height:_,resizable:f,showDragHandle:j,showFocusStyles:b,isCollapsed:M,panelContentId:J,panelTitleId:Q,panelTitleReadable:`panel-title-${g}`,ariaHidden:T},actions:{setHeight:q,setExpandToHeight:F,collapse:V,expand:W,resetHeight:G,confirmTitle:K}},X=d.Provider,Y=r((()=>L?{"aria-labelledby":Q}:{"aria-label":P}),[L,Q,P]);return e.createElement(h,c({},Y,{"aria-hidden":T},$),e.createElement(X,{value:U},u))}export{y as MAX_HEIGHT_DEFAULT,g as PANEL_COLLAPSED_THRESHOLD,Panel as default};
