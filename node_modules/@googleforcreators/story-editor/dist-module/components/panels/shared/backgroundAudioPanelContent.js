/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

import o from"react";import"prop-types";import e from"styled-components";import{Button as t,themeHelpers as r,BUTTON_TYPES as i,BUTTON_SIZES as s,BUTTON_VARIANTS as a,Icons as p}from"@googleforcreators/design-system";import{sprintf,__,translateToExclusiveList as n}from"@googleforcreators/i18n";import{useMemo as m,useCallback as l}from"@googleforcreators/react";import{getExtensionsFromMimeType as c}from"@googleforcreators/media";import{v4 as d}from"uuid";import"@googleforcreators/elements";import"@googleforcreators/transform";import"../../dropTargets/provider.js";import"../../dropTargets/context.js";import"../../../app/history/historyProvider.js";import"../../../app/history/context.js";import"@googleforcreators/templates";import"../../../app/config/context.js";import g from"../../../app/config/useConfig.js";import"../../../app/api/context.js";import"@googleforcreators/fonts";import"@googleforcreators/dom";import"../../../constants/fonts.js";import"../../../constants/multipleValue.js";import"../../../app/font/context.js";import"@googleforcreators/tracking";import"@googleforcreators/animation";import"@googleforcreators/masks";import"@googleforcreators/element-library";import"../../../app/story/context.js";import"@googleforcreators/migration";import"../../../app/story/actions/useSaveStory.js";import"clone-deep";import"../../../app/story/useStoryReducer/useStoryReducer.js";import"@googleforcreators/output";import"../../../app/story/storyTriggers/storyTriggersProvider.js";import"../../../app/story/storyTriggers/storyEvents/onInitialElementAddedRegister.js";import"../../../app/story/storyTriggers/storyEvents/onPageAddedRegister.js";import"../../../app/media/useUploadMedia.js";import"@googleforcreators/patterns";import"../../../utils/generateBlurhash.worker.js";import"../../../app/media/media3p/providerConfiguration.js";import"../../../app/media/utils/useFFmpeg.js";import"../../../app/media/media3p/api/context.js";import"../../../app/media/local/constants.js";import"../../../app/media/media3p/providerReducer.js";import"../../../app/media/context.js";import"sat";import"@googleforcreators/units";import"../../../app/layout/context.js";import"../../../app/layout/useZoomSetting.js";import"@googleforcreators/rich-text";import"@googleforcreators/stickers";import"../../library/panes/text/textPresets.js";import"../../../app/canvas/context.js";import"../../../app/currentUser/context.js";import"../../../app/helpCenter/provider.js";import"../../../app/helpCenter/context.js";import"../../helpCenter/constants.js";import"../../../app/rightClickMenu/context.js";import{Z_INDEX_STORY_DETAILS as f}from"../../../constants/zIndex.js";import"../../form/color/color.js";import"../../form/filterToggle/filterToggle.js";import"../../form/linkIcon.js";import"../../form/link.js";import"../../form/media.js";import u from"../../form/row.js";import"../../form/switch.js";import"../../form/textArea.js";import"../../form/context.js";import"../../form/dateTime/dateTime.js";import"../../form/required.js";import"../../form/radioGroup/index.js";import"../../form/select/select.js";import"../../form/hierarchical/index.js";import j from"../../audioPlayer/index.js";import y from"../../tooltip/tooltip.js";import h from"./captionsPanelContent.js";import x from"./loopPanelContent.js";const k=e(t).withConfig({displayName:"backgroundAudioPanelContent__StyledButton",componentId:"sc-lth4t7-0"})(["",";"],(o=>{let{theme:e}=o;return r.focusableOutlineCSS(e.colors.border.focus,e.colors.bg.secondary)})),C=e(k).withConfig({displayName:"backgroundAudioPanelContent__UploadButton",componentId:"sc-lth4t7-1"})(["padding:12px 8px;"]);function BackgroundAudioPanelContent(e){let{backgroundAudio:t,updateBackgroundAudio:r,showCaptions:E=!1,showLoopControl:T=!1,audioId:b}=e;const{allowedMimeTypes:{audio:A},capabilities:{hasUploadMediaAction:v},MediaUpload:S}=g(),w=m((()=>A.map((o=>c(o))).flat()),[A]),{resource:R,tracks:P=[],loop:I=!0}=t||{},U=sprintf(
/* translators: %s: list of allowed file types. */
__("Please choose only %s to insert into page.","web-stories"),n(w)),L=l((o=>{const e={resource:{src:o.src,id:o.id,mimeType:o.mimeType,length:o.length,lengthFormatted:o.lengthFormatted}};E&&(e.tracks=[]),T&&(e.loop=!0),r(e)}),[E,T,r]),M=l((o=>{r({...t,tracks:o})}),[t,r]),B=l((o=>{r({...t,loop:o.target.checked})}),[t,r]),N=l((o=>{let e=[];if(o){const t=P.findIndex((e=>{let{id:t}=e;return t===o}));e=[...P.slice(0,t),...P.slice(t+1)]}M(e)}),[P,M]),F=l((o=>{let{src:e="",id:t,needsProxy:r=!1}=o;const i={track:e,trackId:t,trackName:e.split("/").pop(),id:d(),kind:"captions",srclang:"",label:"",needsProxy:r};M([...P,i])}),[P,M]),O=l((e=>o.createElement(C,{onClick:e,type:i.SECONDARY,size:s.SMALL,variant:a.RECTANGLE},__("Upload an audio file","web-stories"))),[]),z=__("Upload audio captions","web-stories"),_=l((e=>o.createElement(C,{onClick:e,type:i.SECONDARY,size:s.SMALL,variant:a.RECTANGLE},z)),[z]);return o.createElement(o.Fragment,null,!R?.src&&v&&o.createElement(u,{expand:!0},o.createElement(S,{onSelect:L,onSelectErrorMessage:U,type:A,title:__("Upload an audio file","web-stories"),buttonInsertText:__("Select audio file","web-stories"),render:O})),R?.src&&o.createElement(o.Fragment,null,o.createElement(u,null,o.createElement(j,{title:R?.src.substring(R?.src.lastIndexOf("/")+1),src:R?.src,mimeType:R?.mimeType,tracks:P,audioId:b,loop:I}),o.createElement(y,{hasTail:!0,title:__("Remove file","web-stories"),popupZIndexOverride:f},o.createElement(k,{"aria-label":__("Remove file","web-stories"),type:i.TERTIARY,size:s.SMALL,variant:a.SQUARE,onClick:()=>r(null)},o.createElement(p.Trash,null)))),E&&o.createElement(h,{captionText:z,tracks:P||[],handleChangeTrack:F,handleRemoveTrack:N,renderUploadButton:_}),T&&R?.length&&o.createElement(u,{spaceBetween:!1},o.createElement(x,{loop:I,onChange:B}))))}export{BackgroundAudioPanelContent as default};
