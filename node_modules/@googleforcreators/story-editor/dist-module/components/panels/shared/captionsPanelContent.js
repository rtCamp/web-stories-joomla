/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

import e from"react";import t,{css as o}from"styled-components";import"prop-types";import{Input as r,Button as i,themeHelpers as a,BUTTON_TYPES as s,BUTTON_SIZES as p,BUTTON_VARIANTS as n,Icons as m}from"@googleforcreators/design-system";import{__}from"@googleforcreators/i18n";import{useState as l,useMemo as c}from"@googleforcreators/react";import{getExtensionsFromMimeType as g}from"@googleforcreators/media";import{useFeature as d}from"flagged";import"../../form/color/color.js";import"../../form/filterToggle/filterToggle.js";import"../../form/linkIcon.js";import"../../form/link.js";import"../../form/media.js";import"@googleforcreators/transform";import"../../dropTargets/provider.js";import"../../dropTargets/context.js";import"../../../app/history/historyProvider.js";import"../../../app/history/context.js";import"@googleforcreators/templates";import"../../../app/config/context.js";import f from"../../../app/config/useConfig.js";import"../../../app/api/context.js";import"@googleforcreators/fonts";import"@googleforcreators/dom";import"../../../constants/fonts.js";import{MULTIPLE_DISPLAY_VALUE as u}from"../../../constants/multipleValue.js";import"../../../app/font/context.js";import"@googleforcreators/tracking";import"@googleforcreators/animation";import"uuid";import"@googleforcreators/masks";import"@googleforcreators/element-library";import"@googleforcreators/elements";import"../../../app/story/context.js";import"@googleforcreators/migration";import"../../../app/story/actions/useSaveStory.js";import"clone-deep";import"../../../app/story/useStoryReducer/useStoryReducer.js";import"@googleforcreators/output";import"../../../app/story/storyTriggers/storyTriggersProvider.js";import"../../../app/story/storyTriggers/storyEvents/onInitialElementAddedRegister.js";import"../../../app/story/storyTriggers/storyEvents/onPageAddedRegister.js";import"../../../app/media/useUploadMedia.js";import"@googleforcreators/patterns";import"../../../utils/generateBlurhash.worker.js";import"../../../app/media/media3p/providerConfiguration.js";import"../../../app/media/utils/useFFmpeg.js";import"../../../app/media/media3p/api/context.js";import"../../../app/media/local/constants.js";import"../../../app/media/media3p/providerReducer.js";import"../../../app/media/context.js";import"sat";import"@googleforcreators/units";import"../../../app/layout/context.js";import"../../../app/layout/useZoomSetting.js";import"@googleforcreators/rich-text";import"@googleforcreators/stickers";import"../../library/panes/text/textPresets.js";import"../../../app/canvas/context.js";import"../../../app/currentUser/context.js";import"../../../app/helpCenter/provider.js";import"../../../app/helpCenter/context.js";import"../../helpCenter/constants.js";import"../../../app/rightClickMenu/context.js";import j from"../../form/row.js";import"../../form/switch.js";import"../../form/textArea.js";import"../../form/context.js";import"../../form/dateTime/dateTime.js";import"../../form/required.js";import"../../form/radioGroup/index.js";import"../../form/select/select.js";import"../../form/hierarchical/index.js";import y from"../../tooltip/tooltip.js";import{focusStyle as h}from"./styles.js";import x from"./hotlinkModal.js";const C=t.div.withConfig({displayName:"captionsPanelContent__InputRow",componentId:"sc-17hyw65-0"})(["display:flex;flex-grow:1;margin-right:8px;"]),w=t(j).withConfig({displayName:"captionsPanelContent__ButtonRow",componentId:"sc-17hyw65-1"})(["gap:12px;"]),T=t(r).withConfig({displayName:"captionsPanelContent__StyledFileInput",componentId:"sc-17hyw65-2"})((e=>{let{$isIndeterminate:t,theme:r}=e;return o(["",";",";"],h,!t&&o(["* > input:disabled{color:",";}"],r.colors.fg.primary))})),E=t(i).withConfig({displayName:"captionsPanelContent__StyledButton",componentId:"sc-17hyw65-3"})(["",";"],(e=>{let{theme:t}=e;return a.focusableOutlineCSS(t.colors.border.focus,t.colors.bg.secondary)})),b=t(i).withConfig({displayName:"captionsPanelContent__HotlinkButton",componentId:"sc-17hyw65-4"})(["padding:12px 8px;"]);function CaptionsPanelContent(t){let{isIndeterminate:o=!1,tracks:r=[],captionText:i=__("Upload a file","web-stories"),handleChangeTrack:a,handleRemoveTrack:h,renderUploadButton:k,clearFileText:v=__("Remove file","web-stories")}=t;const{allowedMimeTypes:{caption:S=[]},capabilities:{hasUploadMediaAction:I},MediaUpload:R}=f(),[P,A]=l(!1),_=d("captionHotlinking"),F=c((()=>S.map((e=>g(e))).flat()),[S]);if(!S?.length)return null;return e.createElement(e.Fragment,null,o&&e.createElement(j,null,e.createElement(T,{value:u,disabled:!0,"aria-label":__("Filename","web-stories"),onChange:()=>h(),$isIndeterminate:o})),r.map((t=>{let{id:o,trackName:r}=t;return e.createElement(j,{key:`row-filename-${o}`},e.createElement(C,null,e.createElement(T,{value:r,"aria-label":__("Filename","web-stories"),onChange:()=>h(o),disabled:!0})),e.createElement(y,{hasTail:!0,title:v},e.createElement(E,{"aria-label":v,type:s.TERTIARY,size:p.SMALL,variant:n.SQUARE,onClick:()=>h(o)},e.createElement(m.Trash,null))))})),!r.length&&!o&&e.createElement(w,{spaceBetween:!1},I&&e.createElement(R,{onSelect:a,onSelectErrorMessage:__("Please choose a VTT file to use as caption.","web-stories"),type:S,title:i,buttonInsertText:__("Select caption","web-stories"),render:k}),_&&e.createElement(e.Fragment,null,e.createElement(b,{variant:n.RECTANGLE,type:s.SECONDARY,size:p.SMALL,onClick:()=>A(!0)},__("Link to file","web-stories")),e.createElement(x,{title:__("Insert external captions","web-stories"),isOpen:P,onSelect:e=>{a(e),A(!1)},onClose:()=>A(!1),allowedFileTypes:F}))))}export{CaptionsPanelContent as default};
