/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

import e from"react";import t from"prop-types";import r from"styled-components";import{Headline as o,THEME_CONSTANTS as i,Text as s,MEDIA_VARIANTS as a}from"@googleforcreators/design-system";import{useMemo as p,useCallback as m}from"@googleforcreators/react";import{PAGE_RATIO as n}from"@googleforcreators/units";import{__,sprintf,translateToExclusiveList as l}from"@googleforcreators/i18n";import{getExtensionsFromMimeType as d}from"@googleforcreators/media";import"@googleforcreators/transform";import"../../dropTargets/provider.js";import"../../dropTargets/context.js";import"../../../app/history/historyProvider.js";import"../../../app/history/context.js";import"@googleforcreators/templates";import"../../../app/config/context.js";import c from"../../../app/config/useConfig.js";import"../../../app/api/context.js";import"@googleforcreators/fonts";import"@googleforcreators/dom";import{STABLE_ARRAY as g}from"../../../constants/index.js";import"../../../app/font/context.js";import"@googleforcreators/tracking";import"@googleforcreators/animation";import"uuid";import"@googleforcreators/masks";import"@googleforcreators/element-library";import"@googleforcreators/elements";import"../../../app/story/context.js";import"@googleforcreators/migration";import"../../../app/story/actions/useSaveStory.js";import"clone-deep";import"../../../app/story/useStoryReducer/useStoryReducer.js";import"@googleforcreators/output";import"../../../app/story/storyTriggers/storyTriggersProvider.js";import"../../../app/story/storyTriggers/storyEvents/onInitialElementAddedRegister.js";import"../../../app/story/storyTriggers/storyEvents/onPageAddedRegister.js";import h from"../../../app/story/useStory.js";import"../../../app/media/useUploadMedia.js";import"@googleforcreators/patterns";import"../../../utils/generateBlurhash.worker.js";import"../../../app/media/media3p/providerConfiguration.js";import"../../../app/media/utils/useFFmpeg.js";import"../../../app/media/media3p/api/context.js";import"../../../app/media/local/constants.js";import"../../../app/media/media3p/providerReducer.js";import"../../../app/media/context.js";import"sat";import"../../../app/layout/context.js";import"../../../app/layout/useZoomSetting.js";import"@googleforcreators/rich-text";import"@googleforcreators/stickers";import"../../library/panes/text/textPresets.js";import"../../../app/canvas/context.js";import"../../../app/currentUser/context.js";import"../../../app/helpCenter/provider.js";import"../../../app/helpCenter/context.js";import"../../helpCenter/constants.js";import"../../../app/rightClickMenu/context.js";import"../../form/color/color.js";import"../../form/filterToggle/filterToggle.js";import"../../form/linkIcon.js";import"../../form/link.js";import u from"../../form/media.js";import"../../form/row.js";import"../../form/switch.js";import"../../form/textArea.js";import"../../form/context.js";import"../../form/dateTime/dateTime.js";import"../../form/required.js";import"../../form/radioGroup/index.js";import"../../form/select/select.js";import"../../form/hierarchical/index.js";const y=r.div.withConfig({displayName:"storyPreview__PreviewWrapper",componentId:"sc-zk17py-0"})(["width:","px;height:","px;position:relative;margin-top:8px;"],(e=>{let{width:t}=e;return t}),(e=>{let{height:t}=e;return t}));y.propTypes={width:t.number.isRequired,height:t.number.isRequired};const f=r.div.withConfig({displayName:"storyPreview__PreviewContainer",componentId:"sc-zk17py-1"})(["width:","px;height:","px;position:absolute;"],(e=>{let{width:t}=e;return t}),(e=>{let{height:t}=e;return t}));f.propTypes={width:t.number.isRequired,height:t.number.isRequired};const w=r.img.withConfig({displayName:"storyPreview__Image",componentId:"sc-zk17py-2"})(["height:100%;width:100%;display:block;aspect-ratio:",";object-fit:cover;border-radius:",";background:",";"],n,(e=>{let{theme:t}=e;return t.borders.radius.medium}),(e=>{let{theme:t}=e;return t.colors.interactiveBg.primaryNormal})),b=r.div.withConfig({displayName:"storyPreview__EmptyPlaceholder",componentId:"sc-zk17py-3"})(["height:100%;border-radius:",";background:",";"],(e=>{let{theme:t}=e;return t.borders.radius.medium}),(e=>{let{theme:t}=e;return t.colors.interactiveBg.primaryNormal})),v=r.div.withConfig({displayName:"storyPreview__Gradient",componentId:"sc-zk17py-4"})(["position:absolute;bottom:0;height:67%;width:100%;border-radius:",";background:",";"],(e=>{let{theme:t}=e;return t.borders.radius.medium}),(e=>{let{theme:t}=e;return t.colors.gradient.posterOverlay})),j=r.div.withConfig({displayName:"storyPreview__ScrimWrapper",componentId:"sc-zk17py-5"})(["position:absolute;top:0;box-sizing:border-box;width:100%;height:100%;border-radius:",";background:",";padding:8px;"],(e=>{let{theme:t}=e;return t.borders.radius.medium}),(e=>{let{theme:t}=e;return t.colors.opacity.black3})),x=r.div.withConfig({displayName:"storyPreview__ScrimContainer",componentId:"sc-zk17py-6"})(["display:flex;height:100%;width:100%;flex-wrap:wrap;justify-content:space-between;"]),_=r.div.withConfig({displayName:"storyPreview__ScrimTop",componentId:"sc-zk17py-7"})(["display:grid;grid-template-columns:50% 50%;grid-template-rows:auto;grid-template-areas:'publisherLogo editButton';justify-content:inherit;width:100%;"]),P=r.img.withConfig({displayName:"storyPreview__PublisherLogo",componentId:"sc-zk17py-8"})(["grid-area:publisherLogo;height:24px;width:24px;border-radius:2px;box-shadow:0 0 8px rgba(0,0,0,0.08);"]),E=r(u).withConfig({displayName:"storyPreview__StyledMedia",componentId:"sc-zk17py-9"})(["grid-area:editButton;display:flex;flex-direction:row-reverse;"]),k=r.div.withConfig({displayName:"storyPreview__ScrimBottom",componentId:"sc-zk17py-10"})(["width:100%;margin:auto 0 0;align-self:flex-end;"]),S=r(o).attrs({as:"h3",size:i.TYPOGRAPHY.PRESET_SIZES.X_SMALL}).withConfig({displayName:"storyPreview__Title",componentId:"sc-zk17py-11"})(["max-height:calc(1.2em * 3);display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical;padding:0;margin:0 0 4px;overflow:hidden;text-overflow:ellipsis;color:",";"],(e=>{let{theme:t}=e;return t.colors.fg.primary})),T=r(s).attrs({forwardAs:"span",size:i.TYPOGRAPHY.PRESET_SIZES.MEDIUM}).withConfig({displayName:"storyPreview__Publisher",componentId:"sc-zk17py-12"})(["display:block;margin:0;padding:0;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;color:",";"],(e=>{let{theme:t}=e;return t.colors.fg.secondary})),StoryPreview=()=>{const{title:t,featuredMedia:r,publisherLogo:s,updateStory:u}=h((e=>{let{state:{story:t},actions:r}=e;return{title:t?.title,featuredMedia:t?.featuredMedia||{},publisherLogo:t?.publisherLogo||{},updateStory:r.updateStory}})),{allowedImageMimeTypes:C,hasUploadMediaAction:I,publisher:M}=c((e=>{let{allowedMimeTypes:t,capabilities:r,metadata:o}=e;return{allowedImageMimeTypes:t?.image||g,hasUploadMediaAction:r?.hasUploadMediaAction,publisher:o?.publisher}})),N=p((()=>C.map((e=>d(e))).flat()),[C]),z=Math.round(232/n),R=m((e=>u({properties:{featuredMedia:{id:e.id,url:e.src,height:e.height,width:e.width}}})),[u]);let A=__("No file types are currently supported.","web-stories");return N.length&&(A=sprintf(
/* translators: %s: list of allowed file types. */
__("Please choose only %s as a poster.","web-stories"),l(N))),e.createElement(e.Fragment,null,e.createElement(o,{as:"label",size:i.TYPOGRAPHY.PRESET_SIZES.XX_SMALL},__("Cover Preview","web-stories")),e.createElement(y,{width:232,height:z},e.createElement(f,{width:232,height:z},r?.url?e.createElement(w,{crossOrigin:"anonymous",src:r.url,width:r.width,height:r.height,alt:__("Preview image","web-stories"),"data-testid":"story_preview_featured_media"}):e.createElement(b,null),e.createElement(v,null),e.createElement(j,null,e.createElement(x,null,e.createElement(_,null,s?.url?.length>0&&e.createElement(P,{crossOrigin:"anonymous",width:s.width,height:s.height,src:s.url,alt:__("Publisher Logo","web-stories"),"data-testid":"story_preview_logo"}),I&&e.createElement(E,{onChange:R,title:__("Select as poster image","web-stories"),buttonInsertText:__("Select as poster image","web-stories"),type:C,ariaLabel:__("Poster image","web-stories"),onChangeErrorText:A,imgProps:r,canUpload:I,variant:a.NONE,cropParams:{width:640,height:853}})),e.createElement(k,null,t&&e.createElement(S,{"data-testid":"story_preview_title"},t),M&&e.createElement(T,{"data-testid":"story_preview_publisher"},M)))))))};export{w as Image,StoryPreview as default};
