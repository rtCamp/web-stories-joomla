/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

import t from"react";import"prop-types";import{useEffect as r,useRef as o,useState as e,useMemo as s,useCallback as i,useResizeEffect as a}from"@googleforcreators/react";import{__}from"@googleforcreators/i18n";import{trackEvent as n}from"@googleforcreators/tracking";import"@googleforcreators/templates";import"../../app/config/context.js";import"../../app/api/context.js";import p from"../../app/api/useAPI.js";import"../../constants/fonts.js";import"../../constants/multipleValue.js";import"@googleforcreators/animation";import"uuid";import"@googleforcreators/masks";import"@googleforcreators/element-library";import"@googleforcreators/elements";import"../../app/story/context.js";import"@googleforcreators/migration";import"../../app/history/historyProvider.js";import"../../app/history/context.js";import"../../app/story/actions/useSaveStory.js";import"clone-deep";import"../../app/story/useStoryReducer/useStoryReducer.js";import"@googleforcreators/output";import"../../app/story/storyTriggers/storyTriggersProvider.js";import"../../app/story/storyTriggers/storyEvents/onInitialElementAddedRegister.js";import"../../app/story/storyTriggers/storyEvents/onPageAddedRegister.js";import l from"../../app/story/useStory.js";import"../../app/highlights/styles.js";import m from"../../app/highlights/useHighlights.js";import"../../app/highlights/context.js";import c from"../../app/highlights/states.js";import"../../app/highlights/quickActions/constants.js";import"../../app/highlights/quickActions/useQuickActions.js";import g from"../library/library.js";import"../library/constants.js";import d from"../design/designInspector.js";import{INSERT as u,STYLE as h,DOCUMENT as f,PUBLISH_MODAL_DOCUMENT as y}from"./constants.js";import b from"./context.js";const j=new Set([u,f,h]);function SidebarProvider(P){let{sidebarTabs:S,children:E}=P;const{actions:{getAuthors:v}}=p(),{selectedElementIds:A,currentPage:T}=l((t=>{let{state:r}=t;return{selectedElementIds:r.selectedElementIds,currentPage:r.currentPage}})),{tab:x,highlight:I}=m((t=>({tab:t.tab,highlight:t[c.STYLE_PANE]})));r((()=>{j.has(x)&&(w(x),n("quick_action_tab_change",{name:x}))}),[x]);const k=o(null),[R,w]=e(u),[_,q]=e([]),[C,H]=e(null),L=o(),M=o(R),N=o(null),U=o(null),Q=o(null),V=s((()=>({[u]:N,[h]:U,[f]:Q})),[]),[Y,z]=e(!1),B=i((t=>{L.current=t}),[]);a(L,(t=>{let{height:r}=t;return H(r)}),[]),r((()=>{A.length>0&&M.current===f&&w(h)}),[A]),r((()=>{M.current===f&&w(h)}),[T]),r((()=>{const t=U.current;t&&I?.focus&&I?.showEffect&&t.focus()}),[I]);const D=i((()=>{Y||0!==_.length||(z(!0),v().then((t=>{const r=t.map((t=>{let{id:r,name:o}=t;return{id:r,name:o}}));q(r)})).finally((()=>{z(!1)})))}),[Y,_.length,v]),F={state:{tab:R,tabRefs:V,users:_,sidebarContentHeight:C,isUsersLoading:Y},refs:{sidebar:k},actions:{setTab:w,loadUsers:D,setSidebarContentNode:B},data:{tabs:[{id:u,title:__("Insert","web-stories"),Pane:g},{id:h,title:__("Style","web-stories"),Pane:d}]}};return S?.document&&F.data.tabs.push({id:f,...S.document}),S?.publishModal&&(F.data.modalSidebarTab={id:y,...S.publishModal}),t.createElement(b.Provider,{value:F},E)}export{SidebarProvider as default};
