/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

import{useState as t,useRef as e,useEffect as n,useCallback as r,useMemo as a}from"@googleforcreators/react";import"../../constants/fonts.js";import{MEDIA_VIDEO_MINIMUM_DURATION as s}from"../../constants/media.js";import"../../constants/multipleValue.js";function o(o){const[u,i]=t(null),[l,m]=t(null),[d,c]=t(null),[f,p]=t(null),[h,g]=t(null),[M,v]=t(null),[T,E]=t(null),[O,x]=t(!1),L=e(!1);n((()=>{T&&(L.current||(O?T.pause():(T.currentTime=l/1e3,T.play())))}),[T,O,l]);const j=T?T.paused:null;n((()=>{O||(L.current=j)}),[j,O]),n((()=>{if(T&&o)return T.addEventListener("timeupdate",n),T.addEventListener("loadedmetadata",e),()=>{T.removeEventListener("timeupdate",n),T.removeEventListener("loadedmetadata",e)};function t(t){T.currentTime=t/1e3,T.play()}function e(e){const n=Math.floor(1e3*e.target.duration);m(o.start),c(o.start),i(o.start),p(o.end??n),g(o.end??n),v(n),t(o.start)}function n(e){const n=Math.floor(1e3*e.target.currentTime);i(Math.min(n,f)),n>f&&!L.current&&t(l)}}),[l,f,o,T]);const y=r((t=>{t=Math.min(f-s,t),t=Math.max(0,t),m(t),T.currentTime=t/1e3}),[T,f]),V=r((t=>{t=Math.max(l+s,t),t=Math.min(M,t),p(t),T.currentTime=t/1e3}),[T,l,M]);return{hasChanged:a((()=>l!==d||f!==h),[l,d,f,h]),currentTime:u,startOffset:l,endOffset:f,maxOffset:M,setStartOffset:y,setEndOffset:V,setVideoNode:E,setIsDraggingHandles:x}}export{o as default};
