/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

import e from"react";import{renderToStaticMarkup as t}from"@googleforcreators/react";import{duplicateElement as n,getDefinitionForType as o}from"@googleforcreators/elements";function i(e,t){let o={animations:[],elements:[]};for(let i=e.firstChild;i;i=i.nextSibling){if(8!==i.nodeType||-1!==i.nodeValue?.indexOf("Fragment"))continue;const e=JSON.parse(i.nodeValue.replace(new RegExp("_DOUBLEDASH_","g"),"--"));if("story-elements"!==e.sentinel)continue;const a=e.items.reduce(((o,i)=>{let{elements:a,animations:r}=o;const{element:s,elementAnimations:l}=n({element:{...i,id:i.basedOn},animations:e.animations,existingElements:t.elements});return{elements:[...a,s],animations:[...r,...l]}}),{animations:[],elements:[]});return o={animations:[...o.animations,...a.animations],elements:[...o.elements,...a.elements]},o}return o}function a(n,i,a,r){if(!i.length||!r)return;const{clipboardData:s}=r,l={sentinel:"story-elements",items:i.map((e=>({...e,...e.isDefaultBackground?{backgroundColor:n.backgroundColor}:null,basedOn:e.id,id:void 0}))),animations:a},m=JSON.stringify(l).replace(/--/g,"_DOUBLEDASH_"),c=i.map((e=>{const{type:t}=e,{TextContent:n}=o(t);return n?n(e):t})).join("\n"),u=i.map((n=>{const{type:i,x:a,y:r,rotationAngle:s}=n,{Output:l}=o(i);return t(e.createElement(l,{element:n,box:{width:100,height:100,x:a,y:r,rotationAngle:s}}))})).join("\n");s.setData("text/plain",c),s.setData("text/html",`\x3c!-- ${m} --\x3e${u}`)}export{a as addElementsToClipboard,i as processPastedElements};
