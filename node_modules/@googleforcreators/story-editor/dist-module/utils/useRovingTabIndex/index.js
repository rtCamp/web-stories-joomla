/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

import{useCallback as t}from"@googleforcreators/react";import{useKeyDownEffect as o}from"@googleforcreators/design-system";import"react";import"prop-types";import"../../app/config/context.js";import e from"../../app/config/useConfig.js";import{getFocusableChild as r,getNextEnabledElement as n,getAncestorByDepth as i}from"./nestedNavigation.js";import{getNextEnabledSibling as l}from"./flatNavigation.js";function f(t){const o=t.getBoundingClientRect();return{x:o.left+o.width/2,y:o.top+o.height/2}}function a(t,o,e){return e>0?n(t,o,e):l(t,o)}function s(t,o){return(t?"ArrowRight"===o||"ArrowUp"===o||"PageUp"===o:"ArrowLeft"===o||"ArrowUp"===o||"PageUp"===o)?"previousSibling":"nextSibling"}function p(t,o,e){const r=f(t);let n=null,i=null,l=null;for(let g=a(t,o,e);g;g=a(g,o,e)){const t=f(g);if(Math.floor(t.y)===Math.floor(r.y))continue;if(n&&Math.floor(t.y)>Math.floor(i.y))break;const o=(s=r,p=t,Math.pow(s.x-p.x,2)+Math.pow(s.y-p.y,2));(!l||o<l)&&(l=o,i=t,n=g)}var s,p;return n}function g(n){let{ref:l}=n,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],g=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const{isRTL:c}=e(),d=t((t=>{let{key:o,target:e}=t;const n=e,l=s(c,o),f=t=>{if(t){const o=g>0?i(t,g):t;n.tabIndex=-1,t.tabIndex=0,t.focus(),o.scrollIntoView("previousSibling"===l)}};if("ArrowLeft"===o||"ArrowRight"===o){const t=a(n,l,g);t&&f(t)}else if("ArrowUp"===o||"ArrowDown"===o){const t=p(n,l,g);if(t)n.tabIndex=-1,t.tabIndex=0,t.focus();else if("ArrowUp"===o){f(g>0?r(n,g):n.parentNode.firstChild)}else{f(g>0?r(n,g,"lastChild"):n.parentNode.lastChild)}}else if("Home"===o){f(g>0?r(n,g):n.parentNode.firstChild)}else if("End"===o){f(g>0?r(n,g,"lastChild"):n.parentNode.lastChild)}else if("PageDown"===o||"PageUp"===o){let t=n;for(let o=0;a(t,l,g)&&o<5;t=a(t,l,g))o++;f(t)}}),[c,g]);o(l,{key:["up","down","left","right","pageup","pagedown","home","end"]},d,[l,d,...f])}export{g as default,s as getFocusableElementDirection};
