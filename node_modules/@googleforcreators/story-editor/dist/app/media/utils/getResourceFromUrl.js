/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

"use strict";var e=require("@googleforcreators/media");module.exports=async function(t){const{src:i,mimeType:o,width:d,height:h,isMuted:n,length:r,lengthFormatted:a,...g}=t,s=e.getTypeFromMime(o);if(!["image","video"].includes(s))throw new Error("Invalid media type.");const l=d&&h,m={};if("video"===s&&(!l||null===n||null===r||null===a)){const t=await e.preloadVideo(i);await e.seekVideo(t),m.width=t.videoWidth,m.height=t.videoHeight;const o=e.getVideoLength(t);m.length=o.length,m.lengthFormatted=o.lengthFormatted,m.isMuted=!e.hasVideoGotAudio(t)}if("image"===s&&!l){const t=await e.getImageDimensions(i);m.width=t.width,m.height=t.height}return e.createResource({type:s,width:d,height:h,isMuted:n,length:r,lengthFormatted:a,src:i,isExternal:!0,mimeType:o,...g,...m})};
