/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("uuid"),r=require("@googleforcreators/media"),t=require("./constants.js");exports.addItem=function(r,o){let{payload:{file:a,resource:i,onUploadStart:u,onUploadProgress:s,onUploadError:d,onUploadSuccess:n,additionalData:l,posterFile:c,muteVideo:p,trimData:T,originalResourceId:f,elementId:q}}=o;const I=e.v4();i.id||(i.id=e.v4());const S={id:I,file:a,state:t.ITEM_STATUS.PENDING,resource:i,onUploadStart:u,onUploadProgress:s,onUploadError:d,onUploadSuccess:n,additionalData:l,posterFile:c,muteVideo:p,trimData:T,originalResourceId:f,elementId:q};return{...r,queue:[...r.queue,S]}},exports.cancelUploading=function(e,r){let{payload:{id:o}}=r;return{...e,queue:e.queue.map((e=>e.id===o?{...e,state:t.ITEM_STATUS.CANCELLED}:e))}},exports.finishItem=function(e,r){let{payload:{id:o}}=r;return{...e,queue:e.queue.map((e=>e.id===o?{...e,state:t.ITEM_STATUS.FINISHED}:e))}},exports.finishMuting=function(e,r){let{payload:{id:o,file:a,additionalData:i={}}}=r;return{...e,queue:e.queue.map((e=>e.id===o?{...e,file:a,state:t.ITEM_STATUS.MUTED,resource:{...e.resource,isMuted:!0},additionalData:{...e.additionalData,...i}}:e))}},exports.finishTranscoding=function(e,r){let{payload:{id:o,file:a,additionalData:i={}}}=r;return{...e,queue:e.queue.map((e=>e.id===o?{...e,file:a,state:t.ITEM_STATUS.TRANSCODED,resource:{...e.resource,isOptimized:!0},additionalData:{...e.additionalData,...i}}:e))}},exports.finishTrimming=function(e,r){let{payload:{id:o,file:a,additionalData:i={}}}=r;return{...e,queue:e.queue.map((e=>e.id===o?{...e,file:a,state:t.ITEM_STATUS.TRIMMED,additionalData:{...e.additionalData,...i}}:e))}},exports.finishUploading=function(e,o){let{payload:{id:a,resource:i}}=o;const u=e.queue.find((e=>e.id===a));return u?(u.resource.src&&u.resource.src!==i.src&&r.revokeBlob(u.resource.src),i.poster&&u.resource.poster&&u.resource.poster!==i.poster&&r.revokeBlob(u.resource.poster),{...e,queue:e.queue.map((e=>e.id===a?{...e,resource:{...i,poster:i.poster||e.resource.poster},previousResourceId:e.resource.id,posterFile:null,originalResourceId:null,state:t.ITEM_STATUS.UPLOADED}:e))}):e},exports.removeItem=function(e,r){let{payload:{id:t}}=r;const o=e.queue.filter((e=>e.id!==t));return{...e,queue:o}},exports.replacePlaceholderResource=function(e,t){let{payload:{id:o,resource:a,posterFile:i}}=t;const u=e.queue.find((e=>e.id===o));return u&&u.resource.isPlaceholder?(u.resource.src!==a.src&&(r.revokeBlob(u.resource.src),r.revokeBlob(u.resource.poster)),{...e,queue:e.queue.map((e=>e.id===o?{...e,resource:{...a,id:e.resource.id,isPlaceholder:!1},posterFile:i}:e))}):e},exports.startMuting=function(e,r){let{payload:{id:o}}=r;return{...e,queue:e.queue.map((e=>e.id===o?{...e,state:t.ITEM_STATUS.MUTING}:e))}},exports.startTranscoding=function(e,r){let{payload:{id:o}}=r;return{...e,queue:e.queue.map((e=>e.id===o?{...e,state:t.ITEM_STATUS.TRANSCODING}:e))}},exports.startTrimming=function(e,r){let{payload:{id:o}}=r;return{...e,queue:e.queue.map((e=>e.id===o?{...e,state:t.ITEM_STATUS.TRIMMING}:e))}},exports.startUploading=function(e,r){let{payload:{id:o}}=r;return{...e,queue:e.queue.map((e=>e.id===o?{...e,state:t.ITEM_STATUS.UPLOADING}:e))}};
