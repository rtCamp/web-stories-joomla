/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

"use strict";var e=require("@googleforcreators/design-system"),r=require("@googleforcreators/i18n"),t=require("@googleforcreators/react"),s=require("@googleforcreators/tracking"),o=require("uuid"),i=require("../../../constants/index.js"),n=require("../../../components/design/updateProperties.js"),a=require("../../../components/styleManager/useApplyStyle.js"),c=require("../../../utils/getUpdatedSizeAndPosition.js"),l=require("../../../utils/presetUtils.js");require("@googleforcreators/transform"),require("../../../components/dropTargets/provider.js"),require("../../../components/dropTargets/context.js"),require("../../history/historyProvider.js");var u=require("../../history/useHistory.js");require("react"),require("prop-types"),require("@googleforcreators/templates"),require("../../config/context.js"),require("../../api/context.js"),require("@googleforcreators/fonts"),require("@googleforcreators/dom"),require("../../font/context.js"),require("@googleforcreators/media"),require("@googleforcreators/animation"),require("@googleforcreators/masks"),require("@googleforcreators/element-library"),require("@googleforcreators/elements"),require("../../story/context.js"),require("@googleforcreators/migration"),require("../../story/actions/useSaveStory.js"),require("clone-deep"),require("../../story/useStoryReducer/useStoryReducer.js"),require("@googleforcreators/output"),require("../../story/storyTriggers/storyTriggersProvider.js"),require("../../story/storyTriggers/storyEvents/onInitialElementAddedRegister.js"),require("../../story/storyTriggers/storyEvents/onPageAddedRegister.js");var d=require("../../story/useStory.js");require("../../media/useUploadMedia.js"),require("@googleforcreators/patterns"),require("../../../utils/generateBlurhash.worker.js"),require("../../media/media3p/providerConfiguration.js"),require("../../media/utils/useFFmpeg.js"),require("../../media/media3p/api/context.js"),require("../../media/local/constants.js"),require("../../media/media3p/providerReducer.js"),require("../../media/context.js"),require("sat"),require("@googleforcreators/units"),require("../../layout/context.js"),require("../../layout/useZoomSetting.js"),require("@googleforcreators/rich-text"),require("@googleforcreators/stickers"),require("../../../components/library/panes/text/textPresets.js"),require("../../canvas/context.js"),require("../../currentUser/context.js"),require("../../helpCenter/provider.js"),require("../../helpCenter/context.js"),require("../../../components/helpCenter/constants.js"),require("../context.js");var m=require("./constants.js");module.exports=()=>{const g=u((e=>{let{actions:r}=e;return r.undo})),{addAnimations:p,copySelectedElement:q,copiedElementState:y,selectedElement:E,selectedElementType:j,selectedElementAnimations:S,updateSelectedElements:x,isSelectedElementBackground:f}=d((e=>{let{state:r,actions:t}=e;return{addAnimations:t.addAnimations,copiedElementState:r.copiedElementState,copySelectedElement:t.copySelectedElement,selectedElement:r.selectedElements?.[0],selectedElementType:r.selectedElements?.[0]?.type,isSelectedElementBackground:r.selectedElements?.[0]?.isBackground,selectedElementAnimations:r.selectedElementAnimations,updateSelectedElements:t.updateSelectedElements}})),_=e.useSnackbar((e=>e.showSnackbar)),T=t.useRef(g);T.current=g;const k=t.useCallback((()=>{q(),_({actionLabel:r.__("Undo","web-stories"),dismissible:!1,message:r.__("Copied style.","web-stories"),onAction:()=>{T.current(),s.trackEvent("context_menu_action",{name:"undo_copy_styles",element:j,isBackground:f})},actionHelpText:m.UNDO_HELP_TEXT}),s.trackEvent("context_menu_action",{name:"copy_styles",element:j,isBackground:f})}),[q,_,j,f]),v=t.useCallback(((e,r)=>{x({properties:t=>{const s=n(t,e,r),o=c({...t,...s});return{...s,...o}}})}),[x]),b=a({pushUpdate:v}),P=t.useCallback((()=>{const e=E?.id;if(!e||j!==y.type)return;const t=S.length?{...S[0],delete:!0}:void 0,a=y.animations.map((e=>({...e,id:o.v4(),targets:[E.id]})));if(p({animations:a}),"text"===y.type&&y.styles.content){const e=function(e,r){const{textStyles:t}=l.getTextPresets([e.styles],{textStyles:[],colors:[]},i.PRESET_TYPES.STYLE),{colors:s}=l.getTextPresets([e.styles],{textStyles:[],colors:[]},i.PRESET_TYPES.COLOR),{content:o,...n}=e.styles;return{...n,...t[0],...s[0].color,animation:r,border:n.border||null}}(y,t);b(e)}else x({properties:e=>n(e,{...y.styles,animation:t},!0)});_({actionLabel:r.__("Undo","web-stories"),dismissible:!1,message:r.__("Pasted style.","web-stories"),onAction:()=>{T.current(),s.trackEvent("context_menu_action",{name:"undo_paste_styles",element:j,isBackground:f})},actionHelpText:m.UNDO_HELP_TEXT}),s.trackEvent("context_menu_action",{name:"paste_styles",element:j,isBackground:f})}),[p,y,b,E,S,_,x,j,f]);return{copiedElementType:y?.type,handleCopyStyles:k,handlePasteStyles:P}};
