/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

"use strict";var e=require("clone-deep"),r=require("@googleforcreators/react");require("../../history/historyProvider.js");var t=require("../../history/useHistory.js"),s=require("../utils/deleteNestedKeys.js");function c(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var o=c(e);const u=["resource.baseColor","resource.blurHash","resource.id","resource.isMuted","resource.posterId","resource.poster"];module.exports=function(e){let{story:c,current:i,pages:n,selection:a,capabilities:f}=e;const{state:{currentEntry:l},actions:{stateToHistory:y}}=t(),d=r.useRef();r.useEffect((()=>{l&&(d.current=o.default(l))}),[l]);const p=r.useRef(),g=r.useRef();r.useEffect((()=>{p.current=i,g.current=a}),[i,a]);const b=e=>o.default(e).map((e=>(e.elements.forEach(s(u)),e)));r.useEffect((()=>{let e=!1;if(u.length&&d.current&&n?.length){const r={story:c,capabilities:f};if(Object.keys(r).every((e=>JSON.stringify(r[e])===JSON.stringify(d.current[e])))){const r=b(n),t=b(d.current.pages);e=JSON.stringify(r)===JSON.stringify(t)}}e||y({story:c,current:p.current,selection:g.current,pages:n,capabilities:f})}),[c,n,y,f])};
