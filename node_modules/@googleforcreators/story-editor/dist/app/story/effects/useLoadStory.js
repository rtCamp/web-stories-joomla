/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

"use strict";var e=require("@googleforcreators/react"),t=require("@googleforcreators/migration"),r=require("@googleforcreators/elements");require("react"),require("prop-types"),require("@googleforcreators/templates"),require("../../config/context.js"),require("../../api/context.js");var o=require("../../api/useAPI.js");require("../../history/historyProvider.js");var s=require("../../history/useHistory.js"),i=require("../../../utils/getUniquePresets.js");function a(e,o,s,a){const{title:{raw:l=""}={},status:u,slug:n,date:c,modified:d,excerpt:{raw:g=""}={},link:p,storyData:y,permalinkTemplate:f,stylePresets:m={},password:x,previewLink:q,editLink:S,embedPostLink:h,author:k,capabilities:v={publish:!1,"assign-author":!1},extras:b={},featuredMedia:L,publisherLogo:P,taxonomies:j,terms:w}=o,[A,I]=f?f.split(/%(?:postname|pagename)%/):[],D=void 0!==A&&void 0!==I?{prefix:A,suffix:I}:null,H="auto-draft"===u?"draft":u;a();const M=y&&t.migrate(y,y.version||0),B=M?.pages?.length>0?M.pages:[r.createPage()];m.colors?m.colors=i(m.colors):m.colors=[],m.textStyles?m.textStyles=i(m.textStyles):m.textStyles=[];s({pages:B,story:{storyId:e,title:l,status:H,author:k,date:c,modified:d,excerpt:g,slug:n,link:p,extras:b,featuredMedia:L,permalinkConfig:D,publisherLogo:P,password:x,previewLink:q,editLink:S,embedPostLink:h,currentStoryStyles:{colors:M?.currentStoryStyles?.colors?i(M.currentStoryStyles.colors):[]},globalStoryStyles:m,autoAdvance:M?.autoAdvance,defaultPageDuration:M?.defaultPageDuration,backgroundAudio:M?.backgroundAudio,taxonomies:j,terms:w},selection:[],current:null,capabilities:v})}module.exports=function(t){let{storyId:r,story:i,shouldLoad:l,restore:u}=t;const{actions:{getStoryById:n}}=o(),{actions:{clearHistory:c}}=s();e.useEffect((()=>{r&&l&&(i?a(r,i,u,c):n(r).then((e=>{a(r,e,u,c)})))}),[r,i,l,u,n,c])};
