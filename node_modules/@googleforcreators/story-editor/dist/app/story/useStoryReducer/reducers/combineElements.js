/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

"use strict";var e=require("uuid"),r=require("@googleforcreators/masks"),t=require("@googleforcreators/element-library"),s=require("../../../../utils/objectPick.js"),i=require("../../../../utils/objectWithout.js"),n=require("./utils.js");module.exports=function(o,u){let{firstElement:a,secondId:l,shouldRetainAnimations:c=!0}=u;if(!a||!l)return o;const d=a.id,p=a,m=o.pages.findIndex((e=>{let{id:r}=e;return r===o.current})),f=o.pages[m],g=f.elements.findIndex((e=>{let{id:r}=e;return r===l})),h=f.elements[g];if(!p||!p.resource||!h)return o;const k=h.isDefaultBackground?{defaultBackgroundElement:{...h,id:e.v4()}}:{},B=["alt","type","resource","scale","focalX","focalY","tracks","poster"];h.isBackground?(B.push("flip"),B.push("overlay")):(B.push("link"),r.canMaskHaveBorder(h)&&(B.push("border"),r.canSupportMultiBorder(h)&&B.push("borderRadius")));const q=s(p,B),E=s(p,["width","height","x","y"]),I={...i(h,["isDefaultBackground"]),...t.DEFAULT_ATTRIBUTES_FOR_MEDIA,...q,...h.isBackground?E:{}},b=f.elements.filter((e=>{let{id:r}=e;return r!==d})).map((e=>e.id===l?I:e)),j=n.removeAnimationsWithElementIds(f.animations,c?[d]:[d,l]),v={...f,elements:b,...k,animations:j},A=[...o.pages.slice(0,m),v,...o.pages.slice(m+1)];return{...o,pages:A,selection:[l]}};
