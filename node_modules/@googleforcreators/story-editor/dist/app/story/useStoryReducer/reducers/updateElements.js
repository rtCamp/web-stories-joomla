/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

"use strict";var e=require("@googleforcreators/animation"),t=require("./utils.js");module.exports=function(n,i){let{elementIds:r,properties:s}=i;if([e.STORY_ANIMATION_STATE.PLAYING,e.STORY_ANIMATION_STATE.PLAYING_SELECTED,e.STORY_ANIMATION_STATE.SCRUBBING].includes(n.animationState))return n;const a=null===r?n.selection:r;if(0===a.length)return n;const u=n.pages.findIndex((e=>{let{id:t}=e;return t===n.current})),l=n.pages[u],o=l.elements.map((e=>{let{id:t}=e;return t}));if(!(t.intersect(o,a).length>0))return n;const d=l.elements.reduce(((e,n)=>{if(!a.includes(n.id))return e;const{animation:i,...r}=t.updateElementWithUpdater(n,s),u=i?{[i.id]:{...i,targets:[r.id]}}:{};return{...e,...u}}),{}),c=l.elements.reduce(((e,n)=>{if(!a.includes(n.id))return[...e,n];const{animation:i,...r}=t.updateElementWithUpdater(n,s);return[...e,r]}),[]),m=Object.keys(d).length>0,p=m?t.updateAnimations(l.animations||[],d):l.animations,T=p&&{animations:p},A={elements:c},g={...l,...m?T:A},I=[...n.pages.slice(0,u),g,...n.pages.slice(u+1)];return{...n,pages:I}};
