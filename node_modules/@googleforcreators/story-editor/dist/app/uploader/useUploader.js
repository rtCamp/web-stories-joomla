/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

"use strict";var e=require("@googleforcreators/react"),r=require("@googleforcreators/i18n"),o=require("@googleforcreators/media");require("react"),require("prop-types"),require("@googleforcreators/templates"),require("../config/context.js");var t=require("../config/useConfig.js");require("../api/context.js");var s=require("../api/useAPI.js"),i=require("../../utils/createError.js");require("../../constants/fonts.js");var a=require("../../constants/media.js");require("../../constants/multipleValue.js");const l=e=>Math.round(e/Math.pow(1024,2));module.exports=function(){const{actions:{uploadMedia:n}}=s(),{storyId:u,maxUpload:c,allowedMimeTypes:{image:d,vector:p,video:f},capabilities:{hasUploadMediaAction:m}}=t(),g=e.useMemo((()=>[...d,...p,...f]),[d,p,f]),M=e.useMemo((()=>g.map((e=>o.getExtensionsFromMimeType(e))).flat()),[g]),h=e.useCallback((e=>{let{type:r}=e;return g.includes(r)}),[g]),q=e.useCallback((e=>{let{size:r}=e;return r<=c}),[c]),_=e.useCallback(((e,o,t)=>{if(!m){const o=r.__("Sorry, you are not allowed to upload files.","web-stories");throw i("PermissionError",e.name,o)}if(o){if(t){const o=r.sprintf(
/* translators: 1: File size in MB. 2: Maximum allowed file size in MB. */
r.__("Your file is too large (%1$s MB) and cannot be processed. Please try again with a file that is smaller than %2$s MB.","web-stories"),l(e.size),l(a.MEDIA_TRANSCODING_MAX_FILE_SIZE));throw i("SizeError",e.name,o)}}else{if(!q(e)){const o=r.sprintf(
/* translators: first %s is the file size in MB and second %s is the upload file limit in MB */
r.__("Your file is %1$sMB and the upload limit is %2$sMB. Please resize and try again!","web-stories"),l(e.size),l(c));throw i("SizeError",e.name,o)}if(!h(e)){let o=r.__("No file types are currently supported.","web-stories");throw M.length&&(
/* translators: %s is a list of allowed file extensions. */
o=r.sprintf(
/* translators: %s: list of allowed file types. */
r.__("Please choose only %s to upload.","web-stories"),r.translateToExclusiveList(M))),i("ValidError",e.name,o)}}}),[m,q,c,M,h]),w=e.useCallback((function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};_(e);const t={storyId:u,altText:o.getFileName(e),mediaSource:"editor",...r};return n(e,t)}),[_,n,u]);return e.useMemo((()=>({actions:{uploadFile:w,validateFileForUpload:_}})),[_,w])};
