/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

"use strict";var e=require("react");require("prop-types");var t=require("styled-components"),r=require("@googleforcreators/react"),a=require("@googleforcreators/design-system"),o=require("@googleforcreators/i18n");require("@googleforcreators/media");var l=require("../../constants/zIndex.js"),n=require("../tooltip/tooltip.js"),s=require("../../utils/useCORSProxy.js");function i(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var c=i(e),u=i(t);const d=u.default(a.Button).withConfig({displayName:"audioPlayer__StyledButton",componentId:"sc-cot87i-0"})(["",";"],(e=>{let{theme:t}=e;return a.themeHelpers.focusableOutlineCSS(t.colors.border.focus,t.colors.bg.secondary)})),p=u.default.div.withConfig({displayName:"audioPlayer__Wrapper",componentId:"sc-cot87i-1"})((e=>{let{theme:r}=e;return t.css(["position:relative;min-width:40px;width:100%;height:36px;display:flex;align-items:center;justify-content:space-between;color:",";",";"],r.colors.fg.primary,a.themeHelpers.expandPresetStyles({preset:{...r.typography.presets.paragraph[a.THEME_CONSTANTS.TYPOGRAPHY.PRESET_SIZES.SMALL]},theme:r}))})),m=u.default.audio.withConfig({displayName:"audioPlayer__Audio",componentId:"sc-cot87i-2"})(["display:none;"]);module.exports=function AudioPlayer(e){let{title:t,src:i,mimeType:u,tracks:f=[],audioId:y,loop:E}=e;const[g,S]=r.useState(!1),T=r.useRef(),{getProxiedUrl:v}=s(),_=r.useCallback((()=>{const e=T.current;e&&(g?e.pause():e.play().catch((()=>{})))}),[g]);r.useEffect((()=>{const e=T.current;if(!e)return;const t=()=>S(!0),r=()=>S(!1),a=()=>{e.currentTime=0,S(!1)};return e.addEventListener("play",t),e.addEventListener("pause",r),e.addEventListener("ended",a),()=>{e.removeEventListener("play",t),e.removeEventListener("pause",r),e.removeEventListener("ended",a)}}),[T]);const h=g?o.__("Pause","web-stories"):o.__("Play","web-stories"),I=f.map((e=>{const t=v(e,e?.track);return{...e,track:t}}));return c.default.createElement(p,null,c.default.createElement(m,{crossOrigin:"anonymous",loop:E,ref:T,id:y},c.default.createElement("source",{src:i,type:u}),I&&I.map(((e,t)=>{let{srclang:r,label:a,track:o,id:l}=e;return c.default.createElement("track",{srcLang:r,label:a,kind:"metadata",src:o,key:l,default:0===t})}))),c.default.createElement("div",null,t),c.default.createElement(n,{hasTail:!0,title:h,popupZIndexOverride:l.Z_INDEX_STORY_DETAILS},c.default.createElement(d,{type:a.BUTTON_TYPES.TERTIARY,size:a.BUTTON_SIZES.SMALL,variant:a.BUTTON_VARIANTS.SQUARE,"aria-label":h,onClick:_},g?c.default.createElement(a.Icons.StopFilled,null):c.default.createElement(a.Icons.PlayFilled,null))))};
