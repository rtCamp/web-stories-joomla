/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

"use strict";var e=require("react");require("prop-types");var r=require("@googleforcreators/react"),t=require("styled-components"),o=require("@googleforcreators/patterns"),i=require("@googleforcreators/units"),s=require("@googleforcreators/animation"),a=require("@googleforcreators/transform"),n=require("@googleforcreators/elements"),l=require("@googleforcreators/element-library"),u=require("@googleforcreators/masks");require("../../types.js");var p=require("../../utils/useCORSProxy.js");require("../dropTargets/provider.js"),require("../dropTargets/context.js"),require("../../app/history/historyProvider.js"),require("../../app/history/context.js"),require("@googleforcreators/templates"),require("../../app/config/context.js"),require("../../app/api/context.js"),require("@googleforcreators/fonts"),require("@googleforcreators/dom"),require("../../constants/fonts.js"),require("../../constants/multipleValue.js"),require("../../app/font/context.js");var c=require("../../app/font/useFont.js");require("@googleforcreators/media"),require("@googleforcreators/tracking"),require("uuid"),require("../../app/story/context.js"),require("@googleforcreators/migration"),require("../../app/story/actions/useSaveStory.js"),require("clone-deep"),require("../../app/story/useStoryReducer/useStoryReducer.js"),require("@googleforcreators/output"),require("../../app/story/storyTriggers/storyTriggersProvider.js"),require("../../app/story/storyTriggers/storyEvents/onInitialElementAddedRegister.js"),require("../../app/story/storyTriggers/storyEvents/onPageAddedRegister.js"),require("@googleforcreators/i18n"),require("../../app/media/useUploadMedia.js"),require("../../utils/generateBlurhash.worker.js"),require("@googleforcreators/design-system"),require("../../app/media/media3p/providerConfiguration.js"),require("../../app/media/utils/useFFmpeg.js"),require("../../app/media/media3p/api/context.js"),require("../../app/media/local/constants.js"),require("../../app/media/media3p/providerReducer.js"),require("../../app/media/context.js");var d=require("../../app/media/local/useLocalMedia.js");function g(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}require("sat"),require("../../app/layout/context.js"),require("../../app/layout/useZoomSetting.js"),require("@googleforcreators/rich-text"),require("@googleforcreators/stickers"),require("../library/panes/text/textPresets.js"),require("../../app/canvas/context.js"),require("../../app/currentUser/context.js"),require("../../app/helpCenter/provider.js"),require("../../app/helpCenter/context.js"),require("../helpCenter/constants.js"),require("../../app/rightClickMenu/context.js");var y=g(e),m=g(t);function f(){return f=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e},f.apply(this,arguments)}const q=m.default.div.attrs((e=>{let{previewMode:r,x:t,y:o,width:i,height:s,rotationAngle:a}=e;return r?{style:{position:"absolute",zIndex:1,left:`${t}px`,top:`${o}px`,width:`${i}px`,height:`${s}px`,transform:`rotate(${a}deg)`}}:{}})).withConfig({displayName:"displayElement__Wrapper",componentId:"sc-1uos4dq-0"})([""," "," "," contain:layout;transition:opacity 0.15s cubic-bezier(0,0,0.54,1);",""],(e=>{let{previewMode:r}=e;return!r&&l.elementWithPosition}),(e=>{let{previewMode:r}=e;return!r&&l.elementWithSize}),(e=>{let{previewMode:r}=e;return!r&&l.elementWithRotation}),(e=>{let{isBackground:r,theme:o}=e;return r&&t.css(["border-radius:",";overflow:hidden;"],o.borders.radius.small)})),h=m.default.div.withConfig({displayName:"displayElement__BackgroundOverlay",componentId:"sc-1uos4dq-1"})(["position:absolute;width:100%;height:100%;top:0;left:0;"]),v=m.default.div.withConfig({displayName:"displayElement__ReplacementContainer",componentId:"sc-1uos4dq-2"})(["transition:opacity 0.25s cubic-bezier(0,0,0.54,1);pointer-events:none;opacity:",";height:100%;"],(e=>{let{hasReplacement:r}=e;return r?1:0}));function AnimationWrapper(e){let{children:r,id:t,isAnimatable:o}=e;return o?y.default.createElement(s.StoryAnimation.WAAPIWrapper,{target:t},r):r}var x=r.memo((function DisplayElement(e){let{element:t,previewMode:s,isAnimatable:g=!1}=e;const{getBox:m,dataToEditorX:x}=i.useUnits((e=>({getBox:e.actions.getBox,dataToEditorX:e.actions.dataToEditorX}))),{getProxiedUrl:j}=p(),{actions:{maybeEnqueueFontStyle:E}}=c(),[b,R]=r.useState(null),w=Boolean(b),{id:C,opacity:P,type:T,isBackground:M,overlay:S,border:B={},flip:k}=t,{isCurrentResourceProcessing:A,isCurrentResourceUploading:$}=d((e=>{let{state:r}=e;return n.ELEMENT_TYPES.IMAGE===T?{isCurrentResourceProcessing:r.isCurrentResourceProcessing,isCurrentResourceUploading:r.isCurrentResourceUploading}:{}})),U=w?{...t,type:b.resource.type,resource:b.resource,scale:b.scale,focalX:b.focalX,focalY:b.focalY,flip:M?b.flip:k,overlay:M?b.overlay:S}:null,{Display:W}=n.getDefinitionForType(T),{Display:D}=n.getDefinitionForType(b?.resource.type)||{},F=r.useRef(null),I=m(t);a.useTransformHandler(C,(e=>{const r=F.current;if(null===e)r.style.transform="",r.style.width="",r.style.height="";else{const{translate:t,rotate:o,resize:i,dropTargets:s}=e;r.style.transform=`translate(${t?.[0]}px, ${t?.[1]}px) rotate(${o}deg)`,i&&0!==i[0]&&0!==i[1]&&(r.style.width=`${i[0]}px`,r.style.height=`${i[1]}px`),void 0!==s?.hover&&(r.style.opacity=s.hover?0:1),void 0!==s?.replacement&&R(s.replacement||null)}}));const _=r.useRef(null);l.useColorTransformHandler({id:C,targetRef:_,resetOnNullTransform:!1});const O=u.getResponsiveBorder(B,s,x);return y.default.createElement(q,f({ref:F,"data-element-id":C,isBackground:t.isBackground,previewMode:s},I),y.default.createElement(AnimationWrapper,{id:C,isAnimatable:g},y.default.createElement(u.DisplayWithMask,{element:t,fill:!0,box:I,style:{opacity:void 0!==P?P/100:null,...u.shouldDisplayBorder(t)?u.getBorderPositionCSS({...O,width:`${I.width}px`,height:`${I.height}px`}):null},previewMode:s,responsiveBorder:O},y.default.createElement(W,{element:t,previewMode:s,box:I,getProxiedUrl:j,isCurrentResourceProcessing:A,isCurrentResourceUploading:$,maybeEnqueueFontStyle:E})),!s&&y.default.createElement(v,{hasReplacement:w},U&&y.default.createElement(u.DisplayWithMask,{element:U,fill:!0,box:I,style:{opacity:P?P/100:null},previewMode:s},y.default.createElement(D,{element:U,box:I,getProxiedUrl:j,isCurrentResourceProcessing:A,isCurrentResourceUploading:$,maybeEnqueueFontStyle:E}))),M&&S&&!w&&y.default.createElement(h,{ref:_,style:o.generatePatternStyles(S)})))}));module.exports=x;
