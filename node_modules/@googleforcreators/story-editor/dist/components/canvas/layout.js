/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react"),r=require("styled-components");require("prop-types");var t=require("@googleforcreators/react"),o=require("@googleforcreators/i18n"),a=require("@googleforcreators/patterns"),i=require("@googleforcreators/units"),l=require("@googleforcreators/design-system"),n=require("../../constants/index.js");require("@googleforcreators/transform"),require("../dropTargets/provider.js"),require("../dropTargets/context.js"),require("../../app/history/historyProvider.js"),require("../../app/history/context.js"),require("@googleforcreators/templates"),require("../../app/config/context.js"),require("../../app/api/context.js"),require("@googleforcreators/fonts"),require("@googleforcreators/dom"),require("../../app/font/context.js"),require("@googleforcreators/media"),require("@googleforcreators/tracking"),require("@googleforcreators/animation"),require("uuid"),require("@googleforcreators/masks"),require("@googleforcreators/element-library"),require("@googleforcreators/elements"),require("../../app/story/context.js"),require("@googleforcreators/migration"),require("../../app/story/actions/useSaveStory.js"),require("clone-deep"),require("../../app/story/useStoryReducer/useStoryReducer.js"),require("@googleforcreators/output"),require("../../app/story/storyTriggers/storyTriggersProvider.js"),require("../../app/story/storyTriggers/storyEvents/onInitialElementAddedRegister.js"),require("../../app/story/storyTriggers/storyEvents/onPageAddedRegister.js"),require("../../app/media/useUploadMedia.js"),require("../../utils/generateBlurhash.worker.js"),require("../../app/media/media3p/providerConfiguration.js"),require("../../app/media/utils/useFFmpeg.js"),require("../../app/media/media3p/api/context.js"),require("../../app/media/local/constants.js"),require("../../app/media/media3p/providerReducer.js"),require("../../app/media/context.js"),require("sat");var s=require("../../app/layout/useLayout.js");require("../../app/layout/context.js"),require("../../app/layout/useZoomSetting.js"),require("@googleforcreators/rich-text"),require("@googleforcreators/stickers"),require("../library/panes/text/textPresets.js"),require("../../app/canvas/context.js"),require("../../app/currentUser/context.js"),require("../../app/helpCenter/provider.js"),require("../../app/helpCenter/context.js"),require("../helpCenter/constants.js"),require("../../app/rightClickMenu/context.js");var p=require("../footer/useFooterHeight.js"),d=require("../footer/constants.js"),c=require("../../utils/pointerEventsCss.js"),u=require("./usePinchToZoom.js");function g(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var f=g(e),h=g(r);function v(){return v=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e},v.apply(this,arguments)}const m=l.THEME_CONSTANTS.LARGE_BUTTON_SIZE+8,w=h.default.section.withConfig({displayName:"layout__LayerGrid",componentId:"sc-1n0mp4m-0"})([""," position:absolute;top:0;left:0;right:0;bottom:0;"," display:grid;grid:'h h h h h h h' ","px '. . . . . . .' minmax(16px,1fr) '. b . p . f .' var(--viewport-height-px) '. . . . . . .' 1fr 'w w w w w w w' ","px '. . . . . . .' ","px / 1fr var(--page-nav-width) var(--page-nav-gap) var(--viewport-width-px) var(--page-nav-gap) var(--page-nav-width) 1fr;height:100%;"],c,(e=>{let{zIndex:r}=e;return"number"==typeof r?`z-index: ${r};`:""}),n.HEADER_HEIGHT,(e=>{let{footerHeight:r}=e;return r}),d.FOOTER_BOTTOM_MARGIN),x=h.default.div.withConfig({displayName:"layout__Area",componentId:"sc-1n0mp4m-1"})([""," grid-area:",";overflow:",";position:relative;width:100%;height:100%;",";"],c,(e=>{let{area:r}=e;return r}),(e=>{let{showOverflow:r}=e;return r?"visible":"hidden"}),(e=>{let{zIndex:r}=e;return void 0!==r?`z-index: ${r}`:null})),y=h.default(x).attrs({area:"p"}).withConfig({displayName:"layout__PageAreaContainer",componentId:"sc-1n0mp4m-2"})(["position:relative;display:flex;justify-content:",";align-items:",";overflow:",";",""],(e=>{let{hasHorizontalOverflow:r}=e;return r?"flex-start":"center"}),(e=>{let{hasVerticalOverflow:r}=e;return r?"flex-start":"center"}),(e=>{let{showOverflow:r}=e;return r?"visible":"var(--overflow-x) var(--overflow-y)"}),(e=>{let{isControlled:r,hasVerticalOverflow:t,hasHorizontalOverflow:o,showOverflow:a}=e;return r&&`\n      overflow: ${a?"visible":"hidden"};\n      width: calc(\n        100% - ${t?l.themeHelpers.SCROLLBAR_WIDTH:0}px\n      );\n      height: calc(\n        100% - ${o?l.themeHelpers.SCROLLBAR_WIDTH:0}px\n      );\n    `})),q=t.forwardRef((function Layer(e,r){let{children:t,...o}=e;const a=p();return f.default.createElement(w,v({ref:r,footerHeight:a},o),t)})),O=h.default.div.withConfig({displayName:"layout__PaddedPage",componentId:"sc-1n0mp4m-3"})(["padding:calc(0.5 * var(--page-padding-px));"]),_=h.default.div.withConfig({displayName:"layout__PageClip",componentId:"sc-1n0mp4m-4"})(["",""],(e=>{let{hasHorizontalOverflow:r,hasVerticalOverflow:t}=e;return(r||t)&&`\n      overflow: hidden;\n      width: ${r?"calc(var(--page-width-px) + var(--page-padding-px))":`calc(var(--viewport-width-px) - ${l.themeHelpers.SCROLLBAR_WIDTH}px)`};\n      flex-basis: ${r?"calc(var(--page-width-px) + var(--page-padding-px))":`calc(var(--viewport-width-px) - ${l.themeHelpers.SCROLLBAR_WIDTH}px)`};\n      height: ${t?"calc(var(--fullbleed-height-px) + var(--page-padding-px))":`calc(var(--viewport-height-px) - ${l.themeHelpers.SCROLLBAR_WIDTH}px)`};\n      flex-shrink: 0;\n      flex-grow: 0;\n      display: flex;\n      justify-content: center;\n      align-items: center;\n    `})),j=h.default.div.withConfig({displayName:"layout__FullbleedContainer",componentId:"sc-1n0mp4m-5"})([""," overflow:visible;position:relative;width:var(--page-width-px);height:var(--fullbleed-height-px);display:flex;justify-content:center;align-items:center;border-radius:5px;",";",""],(e=>{let{background:r}=e;return a.generatePatternStyles(r)}),(e=>{let{isControlled:r}=e;return r&&"\n      left: var(--scroll-left-px);\n      top: var(--scroll-top-px);\n    "}),(e=>{let{isBackgroundSelected:r,theme:t}=e;return r&&`\n      &:before {\n        content: '';\n        position: absolute;\n        top: -4px;\n        left: -4px;\n        right: -4px;\n        bottom: -4px;\n        border: ${t.colors.border.selection} 1px solid;\n        border-radius: ${t.borders.radius.medium};\n      }\n    `})),b=h.default.div.withConfig({displayName:"layout__PageAreaWithoutOverflow",componentId:"sc-1n0mp4m-6"})(["overflow:",";position:relative;width:var(--page-width-px);height:var(--fullbleed-height-px);display:flex;justify-content:center;align-items:center;"],(e=>{let{showOverflow:r}=e;return r?"initial":"hidden"})),H=h.default.div.withConfig({displayName:"layout__PageAreaSafeZone",componentId:"sc-1n0mp4m-7"})(["width:var(--page-width-px);height:var(--page-height-px);overflow:visible;position:relative;"]),C=h.default(x).attrs({area:"h"}).withConfig({displayName:"layout__HeadArea",componentId:"sc-1n0mp4m-8"})([""]);h.default(x).attrs({area:"m"}).withConfig({displayName:"layout__MenuArea",componentId:"sc-1n0mp4m-9"})([""]);const A=h.default(x).withConfig({displayName:"layout__NavArea",componentId:"sc-1n0mp4m-10"})(["display:flex;align-items:center;justify-content:center;"]),R=h.default(A).attrs({area:"b"}).withConfig({displayName:"layout__NavPrevArea",componentId:"sc-1n0mp4m-11"})([""]),T=h.default(A).attrs({area:"f"}).withConfig({displayName:"layout__NavNextArea",componentId:"sc-1n0mp4m-12"})([""]),N=h.default.div.withConfig({displayName:"layout__PageMenuArea",componentId:"sc-1n0mp4m-13"})(["grid-area:p;position:absolute;right:calc(-24px + var(--page-padding-px));top:calc(0.5 * var(--page-padding-px));min-height:calc(100% - var(--page-padding-px));"]),E=h.default(x).attrs({area:"w",showOverflow:!0}).withConfig({displayName:"layout__FooterArea",componentId:"sc-1n0mp4m-14"})([""]);const I=t.forwardRef((function PageArea(e,r){let{children:a,fullbleedRef:i=null,fullBleedContainerLabel:l=o.__("Fullbleed area","web-stories"),overlay:n=[],background:p,isControlled:d=!1,className:c="",showOverflow:g=!1,isBackgroundSelected:h=!1,pageAreaRef:m=t.createRef(),withSafezone:w=!0,...x}=e;const q=t.useRef(),C=i||q,{hasVerticalOverflow:A,hasHorizontalOverflow:R,zoomSetting:T,scrollLeft:N,scrollTop:E}=s((e=>{let{state:{hasVerticalOverflow:r,hasHorizontalOverflow:t,zoomSetting:o,scrollLeft:a,scrollTop:i}}=e;return{hasVerticalOverflow:r,hasHorizontalOverflow:t,zoomSetting:o,scrollLeft:a,scrollTop:i}})),I=t.useRef();I.current={top:E,left:N},t.useEffect((()=>{d||(C.current.scrollTop=I.current.top,C.current.scrollLeft=I.current.left)}),[d,T,C]);const P=t.useRef(null);return u({containerRef:P}),f.default.createElement(y,v({showOverflow:g,isControlled:d,hasHorizontalOverflow:R,hasVerticalOverflow:A,className:c,"data-scroll-container":!0},x),f.default.createElement(_,{hasHorizontalOverflow:R,hasVerticalOverflow:A},f.default.createElement(O,{ref:P},f.default.createElement(j,{"aria-label":l,role:"region",ref:C,"data-testid":"fullbleed",background:p,isControlled:d,isBackgroundSelected:h},f.default.createElement(b,{ref:m,showOverflow:g},w?f.default.createElement(H,{ref:r,"data-testid":"safezone"},a):a,n)))))}));exports.FooterArea=E,exports.HeadArea=C,exports.Layer=q,exports.NavNextArea=T,exports.NavPrevArea=R,exports.PageArea=I,exports.PageMenuArea=N,exports.useLayoutParams=function(e){const{setWorkspaceSize:r}=s((e=>{let{actions:{setWorkspaceSize:r}}=e;return{setWorkspaceSize:r}})),o=p();t.useResizeEffect(e,(e=>{let{width:t,height:a}=e;const i=a-n.HEADER_HEIGHT-n.HEADER_GAP-o-d.FOOTER_BOTTOM_MARGIN;r({width:t,height:a,availableHeight:i})}),[r,o])},exports.useLayoutParamsCssVars=function(){const{pageWidth:e,pageHeight:r,pagePadding:t,viewportWidth:o,viewportHeight:a,hasPageNavigation:l,hasVerticalOverflow:n,hasHorizontalOverflow:p,scrollLeft:d,scrollTop:c}=s((e=>{let{state:{pageWidth:r,pageHeight:t,pagePadding:o,viewportWidth:a,viewportHeight:i,hasPageNavigation:l,hasVerticalOverflow:n,hasHorizontalOverflow:s,scrollLeft:p,scrollTop:d}}=e;return{pageWidth:r,pageHeight:t,pagePadding:o,viewportWidth:a,viewportHeight:i,hasPageNavigation:l,hasVerticalOverflow:n,hasHorizontalOverflow:s,scrollLeft:p,scrollTop:d}})),u=e/i.FULLBLEED_RATIO;return{"--page-nav-width":`${l?m:0}px`,"--page-nav-gap":(l?20:0)+"px","--page-width-px":`${e}px`,"--page-height-px":`${r}px`,"--page-padding-px":`${t}px`,"--fullbleed-height-px":`${u}px`,"--viewport-width-px":`${o}px`,"--viewport-height-px":`${a}px`,"--overflow-x":p?"scroll":"visible","--overflow-y":n?"scroll":"visible","--scroll-left-px":-d+"px","--scroll-top-px":-c+"px"}};
