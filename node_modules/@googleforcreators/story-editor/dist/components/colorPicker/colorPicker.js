/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

"use strict";var e=require("react"),r=require("react-transition-group");require("prop-types");var o=require("styled-components"),t=require("@googleforcreators/react"),a=require("@googleforcreators/i18n"),s=require("@googleforcreators/patterns"),l=require("@googleforcreators/design-system"),n=require("@googleforcreators/transform"),i=require("../../utils/useFocusTrapping.js"),c=require("../../app/story/useStory.js"),u=require("./customColorPicker.js"),d=require("./basicColorPicker.js");function p(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var g=p(e);const f=p(o).default.div.withConfig({displayName:"colorPicker__Container",componentId:"sc-1xsejx6-0"})(["border-radius:8px;background:",";user-select:none;display:flex;flex-direction:column;gap:12px;align-items:stretch;",";overflow:hidden;&.picker-appear{opacity:0.01;margin-top:-10px;&.picker-appear-active{opacity:1;margin-top:0;transition:300ms ease-out;transition-property:opacity,margin-top;}}"],(e=>{let{theme:r}=e;return r.colors.bg.secondary}),(e=>{let{maxHeight:r}=e;return r?`\n          height: ${r}px;\n          width: ${208+l.themeHelpers.SCROLLBAR_WIDTH}px;\n        `:"\n          width: 208px;\n        "}));module.exports=function ColorPicker(e){let{onChange:o,isEyedropperActive:p=!1,color:m=null,allowsGradient:h=!1,allowsOpacity:C=!0,allowsSavedColors:y=!1,hasEyedropper:k=!0,maxHeight:w=null,onClose:S=(()=>{}),changedStyle:b="background",onDimensionChange:x=(()=>{}),allowsSavedColorDeletion:q=!0,shouldCloseOnSelection:E=!1}=e;const[v,D]=t.useState(!1),[j,O]=t.useState(s.hasGradient(m)),P=t.useCallback((()=>{O(!0),x()}),[x]),R=t.useCallback((()=>{O(!1),x()}),[x]),{actions:{pushTransform:T}}=n.useTransform(),{selectedElementIds:H=[]}=c((e=>{let{state:{selectedElementIds:r}}=e;return{selectedElementIds:r}})),I=t.useDebouncedCallback(o,100,{leading:!0}),_=t.useRef(!0);t.useEffect((()=>()=>{_.current=!1}),[]);const G=t.useCallback((e=>{_.current?I(e):o(e),H.forEach((r=>{T(r,{color:e,style:b,staticTransformation:!0})}))}),[o,I,H,b,T]),A=t.useRef();t.useFocusOut(A,(()=>{p||v||S()}),[p,v]);const F=t.useRef(document.activeElement),L=t.useCallback((e=>{F.current&&F.current.focus(),S(e)}),[S]);l.useKeyDownEffect(A,"esc",L),i({ref:A});const N=j?u:d;return g.default.createElement(r.CSSTransition,{nodeRef:A,in:!0,appear:!0,classNames:"picker",timeout:300},g.default.createElement(f,{role:"dialog","aria-label":a.__("Color and gradient picker","web-stories"),ref:A,maxHeight:w},g.default.createElement(N,{color:m,allowsGradient:h,allowsOpacity:C,handleColorChange:G,showCustomPicker:P,hideCustomPicker:R,handleClose:L,hasEyedropper:k,allowsSavedColors:y,showDialog:v,setShowDialog:D,changedStyle:b,allowsSavedColorDeletion:q,shouldCloseOnSelection:E})))};
