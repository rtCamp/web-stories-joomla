/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

"use strict";var e=require("react");require("prop-types");var t=require("styled-components"),n=require("@googleforcreators/react");require("../../types.js");var r=require("../form/context.js"),l=require("../../utils/useHandlers.js"),s=require("./updateProperties.js");function u(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var a=u(e),i=u(t);function o(){return o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},o.apply(this,arguments)}const c=i.default.form.withConfig({displayName:"designPanel__Form",componentId:"sc-178nkfr-0"})(["padding:0;margin:0;"]),d=i.default.input.attrs({type:"submit"}).withConfig({displayName:"designPanel__AutoSubmitButton",componentId:"sc-178nkfr-1"})(["display:none;"]);module.exports=function DesignPanel(e){let{panelType:t,selectedElements:u,onSetProperties:i,registerSubmitHandler:p,...f}=e;const m=n.useRef(null),[b,g]=l(),h=n.useMemo((()=>({isMultiple:u.length>1,registerPresubmitHandler:g})),[u,g]),[v,y]=n.useState({}),E=n.useMemo((()=>u.map((e=>({...e,...v[e.id]})))),[u,v]),j=n.useCallback((e=>{if(0===Object.keys(e).length)return;const t=e;b.length>0&&u.forEach((n=>{const r=s(n,e[n.id],!0);let l=r;b.forEach((e=>{const t=e({...n,...l},r,n);l={...l,...t}})),t[n.id]=l})),i((e=>t[e.id]))}),[b,u,i]),k=p(n.useCallback((e=>{e&&(e.preventDefault(),y({})),j(v)}),[j,v])),q=n.useCallback((()=>{setTimeout((()=>{const e=m.current;e&&e.dispatchEvent(new window.Event("submit",{cancelable:!0,bubbles:!0}))}))}),[]),P=n.useCallback((function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];y((t=>{const n={};return u.forEach((r=>{const l={...r,...t[r.id]},u=s(l,e,!1);n[r.id]={...t[r.id],...u}})),n})),t&&q()}),[u,q]),C=n.useCallback((function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];P((r=>{const l=r[e]||n;return{[e]:t?{...l,...s(l,t,!1)}:null}}),r)}),[P]),w=t;return a.default.createElement(c,{ref:m,onSubmit:k},a.default.createElement(d,null),a.default.createElement(r.Provider,{value:h},a.default.createElement(w,o({selectedElements:E,submittedSelectedElements:u,pushUpdate:P,pushUpdateForObject:C,submit:q},f))))};
