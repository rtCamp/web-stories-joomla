/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

"use strict";var e=require("react"),r=require("@googleforcreators/react"),t=require("styled-components"),o=require("@googleforcreators/migration"),s=require("@googleforcreators/design-system");require("../../constants/fonts.js"),require("../../constants/multipleValue.js"),require("@googleforcreators/animation"),require("uuid"),require("@googleforcreators/masks"),require("@googleforcreators/element-library"),require("@googleforcreators/elements"),require("prop-types"),require("../../app/story/context.js"),require("@googleforcreators/templates"),require("../../app/config/context.js"),require("../../app/api/context.js"),require("../../app/history/historyProvider.js"),require("../../app/history/context.js"),require("../../app/story/actions/useSaveStory.js"),require("clone-deep"),require("../../app/story/useStoryReducer/useStoryReducer.js"),require("@googleforcreators/output"),require("../../app/story/storyTriggers/storyTriggersProvider.js"),require("../../app/story/storyTriggers/storyEvents/onInitialElementAddedRegister.js"),require("../../app/story/storyTriggers/storyEvents/onPageAddedRegister.js");var a=require("../../app/story/useStory.js"),n=require("./dummyData.js");function l(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var c=l(e),i=l(t);const u=i.default.div.withConfig({displayName:"devTools__Container",componentId:"sc-1mo3vwv-0"})(["position:fixed;z-index:2147483646;bottom:0;left:0;display:flex;flex-direction:column;width:35%;height:50%;border:6px solid ",";background:",";color:",";"],(e=>{let{theme:r}=e;return r.colors.bg.secondary}),(e=>{let{theme:r}=e;return r.colors.bg.primary}),(e=>{let{theme:r}=e;return r.colors.fg.secondary})),p=i.default.textarea.withConfig({displayName:"devTools__Textarea",componentId:"sc-1mo3vwv-1"})(["flex:1;border:0;background:",";color:",";white-space:nowrap;overflow:auto;"],(e=>{let{theme:r}=e;return r.colors.bg.primary}),(e=>{let{theme:r}=e;return r.colors.fg.secondary})),d=i.default.div.withConfig({displayName:"devTools__Options",componentId:"sc-1mo3vwv-2"})(["display:flex;justify-content:space-between;padding:6px;"]),m=i.default.label.withConfig({displayName:"devTools__Label",componentId:"sc-1mo3vwv-3"})(["margin-right:6px;"]),g=i.default.button.withConfig({displayName:"devTools__Button",componentId:"sc-1mo3vwv-4"})(["margin-left:6px;"]),y=e=>{const r=[];return[{...e,pages:e.pages.map((e=>({...e,elements:e.elements.map((e=>{const t={...e};return"resource"in e&&(t.resource={...e.resource},"video"===e.type&&(t.resource.mimeType="video/mp4",t.resource.src=n.dummyVideo,t.resource.poster=n.dummyImage,r.push(t.id)),"image"===e.type&&(t.resource.mimeType="image/png",t.resource.src=n.dummyImage)),t}))})))},r]},f=e=>{if(!e.length)return e;const r=e.match(/\/([^/?#]+)[^/]*$/);return r.length>1?`__WEB_STORIES_TEMPLATE_BASE_URL__/images/templates/%%templateName%%/${r[1]}`:e};module.exports=function DevTools(){const[e,t]=r.useState(!1),[n,l]=r.useState(!1),[i,h]=r.useState(!1),[v,b]=r.useState(!1),{showSnackbar:q}=s.useSnackbar(),E=r.useRef(),{reducerState:S,restore:T}=a((e=>{let{internal:r}=e;return{reducerState:r.reducerState,restore:r.restore}})),{pages:w,current:x,selection:_,story:{globalStoryStyles:C}}=S,j={current:x,selection:_,story:{globalStoryStyles:C},version:o.DATA_VERSION,pages:w},k=i?y(j)[0]:v?(I=j,{...I,current:null,selection:[],story:{},pages:I.pages.map((e=>({...e,elements:e.elements.map((e=>{const r={...e};return"resource"in e&&(r.resource={...e.resource},"video"===e.type&&(r.resource.id=0,r.resource.posterId=0,r.resource.src=f(r.resource.src),r.resource.poster=f(r.resource.poster)),"image"===e.type&&(r.resource.id=0,r.resource.sizes=[],r.resource.src=f(r.resource.src))),r})),pageTemplateType:e?.pageTemplateType??""})))}):j;var I;const N=()=>t((e=>!e));s.useGlobalKeyDownEffect({key:"mod+shift+alt+j",editable:!0},N);const R=JSON.stringify(k,null,2),A=n?window.btoa(R):R,[D,B]=r.useState(A);return r.useEffect((()=>B(A)),[A]),e?c.default.createElement(u,null,c.default.createElement(d,null,c.default.createElement("div",null,c.default.createElement(m,{title:"For easier sharing thru various channels"},c.default.createElement("input",{type:"checkbox",checked:n,onChange:()=>l((e=>!e))}),"Base64"),c.default.createElement(m,{title:"Replace resources with dummy resources"},c.default.createElement("input",{type:"checkbox",checked:i,onChange:()=>h((e=>!e))}),"Dummy resources"),c.default.createElement(m,{title:"Export as Template"},c.default.createElement("input",{type:"checkbox",checked:v,onChange:()=>b((e=>!e))}),"Template")),c.default.createElement("div",null,c.default.createElement(g,{title:"Load data from input",onClick:()=>{let e=D;try{e=window.atob(e)}catch(e){}const r=JSON.parse(e),t={...r,story:{...S.story,...r.story},capabilities:S.capabilities},[o,s]=i?y(t):[t,[]];T(o),s.length>0&&s.forEach((e=>{const r=document.getElementById(`video-${e}`);r&&r.load()})),q({message:"Story restored from input",timeout:1200})}},"Load"),c.default.createElement(g,{title:"Copy data to clipboard",onClick:()=>{E.current.select(),document.execCommand("copy"),E.current.setSelectionRange(0,0),q({message:"Copied to clipboard",timeout:1200})}},"Copy"),c.default.createElement(g,{title:"Close DevTools",onClick:N},"X"))),c.default.createElement(p,{ref:E,className:"mousetrap",value:D,onChange:e=>B(e.target.value)})):null};
