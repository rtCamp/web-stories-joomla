/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

"use strict";var e=require("react"),t=require("@googleforcreators/react");require("prop-types");var r=require("styled-components"),s=require("@googleforcreators/i18n"),n=require("@googleforcreators/design-system"),i=require("../../constants/zIndex.js");require("../canvas/editLayerFocusManager/context.js");var o=require("../canvas/editLayerFocusManager/useFocusGroupRef.js"),a=require("../canvas/editLayerFocusManager/constants.js");require("./context/context.js");var l=require("./context/provider.js"),u=require("./menus/selector.js");function c(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var d=c(e),p=c(r);const y=s.__("To exit the floating menu, press Escape.","web-stories"),f=p.default.section.withConfig({displayName:"menu__MenuWrapper",componentId:"sc-pi2qzl-0"})(["display:flex;position:absolute;z-index:",";opacity:",";transition:140ms opacity;"],i.Z_INDEX_FLOATING_MENU,(e=>{let{visuallyHidden:t}=e;return t?0:1})),m=t.memo(t.forwardRef((function FloatingMenu(e,r){let{selectionIdentifier:c,selectedElementType:p,handleDismiss:m,visuallyHidden:g}=e;const v=o(a.EDIT_ELEMENT),E=n.useLiveRegion(),x=t.useCallback((()=>{E(y)}),[E]);return t.useLayoutEffect((()=>{const e=r.current,t=()=>{e.style.width="";const t=e.getBoundingClientRect();e.style.setProperty("--width",`${t.width.toFixed(2)}px`),e.style.setProperty("--height",`${t.height.toFixed(2)}px`),e.style.width="var(--width)"};t();const s=new MutationObserver(t),n=e.querySelector("[role=menu]");return s.observe(n,{childList:!0}),()=>s.disconnect()}),[r,c]),d.default.createElement(f,{ref:r,"aria-label":s.__("Design menu","web-stories"),visuallyHidden:g},d.default.createElement(l,{handleDismiss:m},d.default.createElement(n.ContextMenu,{isInline:!0,isHorizontal:!0,isSecondary:!0,isAlwaysVisible:!0,tabIndex:-1,ref:v,dismissOnEscape:!1,onFocus:x,"aria-label":s.__("Design options for selected element","web-stories"),onMouseDown:e=>{e.stopPropagation()},popoverZIndex:i.Z_INDEX_FLOATING_MENU},d.default.createElement(u,{selectedElementType:p}))))})));module.exports=m;
