/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

"use strict";var e=require("@googleforcreators/react"),r=require("@googleforcreators/design-system"),t=require("@googleforcreators/elements");require("@googleforcreators/transform"),require("../../dropTargets/provider.js"),require("../../dropTargets/context.js"),require("../../../app/history/historyProvider.js"),require("../../../app/history/context.js"),require("react"),require("prop-types"),require("@googleforcreators/templates"),require("../../../app/config/context.js");var o=require("../../../app/config/useConfig.js");require("../../../app/api/context.js"),require("@googleforcreators/fonts"),require("@googleforcreators/dom"),require("../../../constants/fonts.js"),require("../../../constants/multipleValue.js"),require("../../../app/font/context.js"),require("@googleforcreators/media"),require("@googleforcreators/tracking"),require("@googleforcreators/animation"),require("uuid"),require("@googleforcreators/masks"),require("@googleforcreators/element-library"),require("../../../app/story/context.js"),require("@googleforcreators/migration"),require("../../../app/story/actions/useSaveStory.js"),require("clone-deep"),require("../../../app/story/useStoryReducer/useStoryReducer.js"),require("@googleforcreators/output"),require("../../../app/story/storyTriggers/storyTriggersProvider.js"),require("../../../app/story/storyTriggers/storyEvents/onInitialElementAddedRegister.js"),require("../../../app/story/storyTriggers/storyEvents/onPageAddedRegister.js");var s=require("../../../app/story/useStory.js");function i(e,r,t,o){const s=o?-1:1;return e===r?s:e===t?-s:0}require("@googleforcreators/i18n"),require("../../../app/media/useUploadMedia.js"),require("@googleforcreators/patterns"),require("../../../utils/generateBlurhash.worker.js"),require("../../../app/media/media3p/providerConfiguration.js"),require("../../../app/media/utils/useFFmpeg.js"),require("../../../app/media/media3p/api/context.js"),require("../../../app/media/local/constants.js"),require("../../../app/media/media3p/providerReducer.js"),require("../../../app/media/context.js"),require("sat"),require("@googleforcreators/units"),require("../../../app/layout/context.js"),require("../../../app/layout/useZoomSetting.js"),require("@googleforcreators/rich-text"),require("@googleforcreators/stickers"),require("../../library/panes/text/textPresets.js"),require("../../../app/canvas/context.js"),require("../../../app/currentUser/context.js"),require("../../../app/helpCenter/provider.js"),require("../../../app/helpCenter/context.js"),require("../../helpCenter/constants.js"),require("../../../app/rightClickMenu/context.js"),module.exports=function(a){let{listElement:u,pageRefs:n}=a;const{isRTL:g}=o(),{addPageAt:p,arrangePage:c,currentPage:l,currentPageId:d,deletePage:q,pages:f,setCurrentPage:m}=s((e=>{let{state:{pages:r,currentPage:t,currentPageId:o},actions:{addPageAt:s,arrangePage:i,deletePage:a,setCurrentPage:u}}=e;return{addPageAt:s,arrangePage:i,currentPage:t,currentPageId:o,deletePage:a,pages:r,setCurrentPage:u}})),y=e.useMemo((()=>f.map((e=>{let{id:r}=e;return r}))),[f]);r.useEscapeToBlurEffect(u,[u]),r.useKeyDownEffect(u,{key:["up","down","left","right"]},(e=>{let{key:r}=e;const t=i(r,"ArrowRight","ArrowLeft",g);if(0===t)return;const o=y.indexOf(d)+t;if(o>=0&&o<y.length){const e=y[o];m({pageId:e});const r=(n.current&&n.current[e])?.querySelector("button");r&&r.focus()}}),[d,g,y,m,n,u]),r.useKeyDownEffect(u,{key:["mod+up","mod+down","mod+left","mod+right"],shift:!0},(e=>{const{key:r,shiftKey:t}=e;e.preventDefault();const o=i(r,"ArrowRight","ArrowLeft",g);if(0===o)return;const s=y.indexOf(d);let a=s+o;t&&(a=o<0?0:y.length-1),a!==s&&a>=0&&a<y.length&&c({pageId:d,position:a})}),[c,d,g,y,m]),r.useKeyDownEffect(u,"delete",(()=>{q({pageId:d});const e=document.activeElement,r=()=>{if(document.activeElement!==e){const e=u.querySelector('[role="option"][tabindex="0"]');if(e)return void e.focus()}setTimeout(r,100)};r()}),[d,q,u]),r.useKeyDownEffect(u,"clone",(()=>{const e=y.indexOf(l.id);p({page:t.duplicatePage(l),position:e+1})}),[p,l,y])};
