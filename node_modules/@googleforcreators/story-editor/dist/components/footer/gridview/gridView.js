/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

"use strict";var e=require("react"),r=require("styled-components");require("prop-types");var t=require("@googleforcreators/react"),i=require("@googleforcreators/i18n"),o=require("@googleforcreators/units"),a=require("@googleforcreators/design-system");require("@googleforcreators/transform"),require("../../dropTargets/provider.js"),require("../../dropTargets/context.js"),require("../../../app/history/historyProvider.js"),require("../../../app/history/context.js"),require("@googleforcreators/templates"),require("../../../app/config/context.js");var s=require("../../../app/config/useConfig.js");require("../../../app/api/context.js"),require("@googleforcreators/fonts"),require("@googleforcreators/dom"),require("../../../constants/fonts.js"),require("../../../constants/multipleValue.js"),require("../../../app/font/context.js"),require("@googleforcreators/media"),require("@googleforcreators/tracking"),require("@googleforcreators/animation"),require("uuid"),require("@googleforcreators/masks"),require("@googleforcreators/element-library"),require("@googleforcreators/elements"),require("../../../app/story/context.js"),require("@googleforcreators/migration"),require("../../../app/story/actions/useSaveStory.js"),require("clone-deep"),require("../../../app/story/useStoryReducer/useStoryReducer.js"),require("@googleforcreators/output"),require("../../../app/story/storyTriggers/storyTriggersProvider.js"),require("../../../app/story/storyTriggers/storyEvents/onInitialElementAddedRegister.js"),require("../../../app/story/storyTriggers/storyEvents/onPageAddedRegister.js");var n=require("../../../app/story/useStory.js");require("../../../app/media/useUploadMedia.js"),require("@googleforcreators/patterns"),require("../../../utils/generateBlurhash.worker.js"),require("../../../app/media/media3p/providerConfiguration.js"),require("../../../app/media/utils/useFFmpeg.js"),require("../../../app/media/media3p/api/context.js"),require("../../../app/media/local/constants.js"),require("../../../app/media/media3p/providerReducer.js"),require("../../../app/media/context.js"),require("sat"),require("../../../app/layout/context.js"),require("../../../app/layout/useZoomSetting.js"),require("@googleforcreators/rich-text"),require("@googleforcreators/stickers"),require("../../library/panes/text/textPresets.js"),require("../../../app/canvas/context.js"),require("../../../app/currentUser/context.js"),require("../../../app/helpCenter/provider.js"),require("../../../app/helpCenter/context.js"),require("../../helpCenter/constants.js"),require("../../../app/rightClickMenu/context.js");var l=require("../../reorderable/reorderable.js"),p=require("../../reorderable/reorderableItem.js"),u=require("../../reorderable/reorderableSeparator.js");require("../../reorderable/context.js");var d=require("../pagepreview/index.js");function g(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var c=g(e),f=g(r);const m=f.default.section.withConfig({displayName:"gridView__Container",componentId:"sc-ytsaos-0"})(["display:flex;flex-direction:column;height:100%;width:100%;padding:32px;"]),h=f.default.header.withConfig({displayName:"gridView__TopRow",componentId:"sc-ytsaos-1"})(["display:flex;justify-content:space-between;align-items:center;margin-bottom:36px;@media ","{margin-bottom:72px;}@media ","{margin-bottom:112px;}"],(e=>{let{theme:r}=e;return r.breakpoint.desktop}),(e=>{let{theme:r}=e;return r.breakpoint.wide})),q=f.default(l).withConfig({displayName:"gridView__Wrapper",componentId:"sc-ytsaos-2"})(["position:relative;overflow-y:auto;overflow-y:overlay;overflow-x:hidden;flex-grow:1;display:flex;flex-direction:column;pointer-events:all;padding:4px;"]),y=f.default.div.withConfig({displayName:"gridView__Grid",componentId:"sc-ytsaos-3"})(["position:relative;display:grid;grid-template-columns:",";grid-template-rows:repeat(auto-fill,","px);grid-gap:","px;justify-content:center;align-items:flex-start;flex-grow:1;"],(e=>{let{pageWidth:r}=e;return`repeat(auto-fit, minmax(${r}px, max-content))`}),(e=>{let{pageHeight:r}=e;return r}),(e=>{let{gapWidth:r}=e;return r})),x=f.default.div.withConfig({displayName:"gridView__NoButton",componentId:"sc-ytsaos-4"})(["flex:0 0 56px;"]),w=f.default(a.Button).withConfig({displayName:"gridView__ClickableButton",componentId:"sc-ytsaos-5"})(["pointer-events:all;"]),j=f.default(a.Slider).withConfig({displayName:"gridView__ClickableSlider",componentId:"sc-ytsaos-6"})(["pointer-events:all;width:366px;"]),b=f.default(u).withConfig({displayName:"gridView__PageSeparator",componentId:"sc-ytsaos-7"})(["position:absolute;bottom:0;left:","px;width:","px;height:","px;display:flex;justify-content:center;align-items:center;",""],(e=>{let{width:r}=e;return r/2}),(e=>{let{width:r,margin:t}=e;return r+t}),(e=>{let{height:r}=e;return r}),(e=>{let{before:r,width:t,margin:i}=e;return r&&`\n      left: -${(t+2*i)/2}px;\n    `})),v=f.default.div.withConfig({displayName:"gridView__Line",componentId:"sc-ytsaos-8"})(["background:",";height:","px;width:2px;margin:0px;"],(e=>{let{theme:r}=e;return r.colors.border.selection}),(e=>{let{height:r}=e;return r})),_=f.default.div.withConfig({displayName:"gridView__ItemContainer",componentId:"sc-ytsaos-9"})(["display:flex;flex-direction:row;position:relative;"]);module.exports=function GridView(e){let{onClose:r}=e;const{pages:l,currentPageId:u,currentPageIndex:g,setCurrentPage:f,arrangePage:I}=n((e=>{let{state:{pages:r,currentPageIndex:t,currentPageId:i},actions:{setCurrentPage:o,arrangePage:a}}=e;return{pages:r,currentPageIndex:t,currentPageId:i,setCurrentPage:o,arrangePage:a}})),{isRTL:C}=s(),[E,P]=t.useState(4),[R,S]=t.useState(null),T=t.useRef();t.useResizeEffect(T,(e=>{let{width:r}=e;return S(r)}),[]);const k=(R-20*(E-1))/E,V=12*Math.floor(k/12),N=V*E,A=Math.floor((R-N)/(E-1)),B=V/o.PAGE_RATIO,M=e=>()=>f({pageId:e.id}),U=t.useRef(),G=t.useRef({}),W=t.useCallback(((e,r)=>{I({pageId:e,position:r})}),[I]);a.useGridViewKeys({containerRef:T,gridRef:U,itemRefs:G,isRTL:C,currentItemId:u,items:l,arrangeItem:W});const z=Math.min(B-24,64);return c.default.createElement(m,{"aria-label":i.__("Grid View","web-stories")},c.default.createElement(h,null,c.default.createElement(w,{variant:a.BUTTON_VARIANTS.SQUARE,type:a.BUTTON_TYPES.TERTIARY,size:a.BUTTON_SIZES.MEDIUM,onClick:r,"aria-label":i.__("Close","web-stories")},c.default.createElement(a.Icons.Cross,null)),c.default.createElement(j,{min:4,max:12,majorStep:1,minorStep:1,value:E,handleChange:e=>P(e),"aria-label":i.__("Pages per row","web-stories")}),c.default.createElement(x,null)),c.default.createElement(q,{"aria-label":i.__("Grid View Pages List","web-stories"),ref:T,onPositionChange:(e,r)=>{const t=l[e].id;I({pageId:t,position:r}),f({pageId:t})},mode:"grid",getItemSize:()=>B,scrollSize:64},c.default.createElement(y,{pageWidth:V,pageHeight:B,gapWidth:A,ref:U},l.map(((e,r)=>{const t=r===g,o=l.length>1;return c.default.createElement(_,{key:e.id,ref:r=>{G.current[e.id]=r}},c.default.createElement(b,{position:r,width:V,height:B,margin:A,before:!0},c.default.createElement(v,{height:z})),c.default.createElement(p,{position:r},c.default.createElement(d,{key:e.id,label:t?i.sprintf(
/* translators: %s: page number. */
i.__("Page %s (current page)","web-stories"),r+1):i.sprintf(
/* translators: %s: page number. */
i.__("Page %s","web-stories"),r+1),tabIndex:t&&o?0:-1,isActive:t&&o,page:e,width:V,height:B,onClick:M(e),isInteractive:o,gridRef:U,role:"option"})),c.default.createElement(b,{position:r+1,width:V,height:B,margin:A},c.default.createElement(v,{height:z})))})))))};
