/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

"use strict";var e=require("react"),r=require("styled-components");require("prop-types");var t=require("@googleforcreators/react"),o=require("@googleforcreators/i18n"),a=require("@googleforcreators/patterns"),n=require("@googleforcreators/design-system");require("../../../constants/fonts.js");var i=require("../../../constants/multipleValue.js"),s=require("../../colorPicker/colorPicker.js"),l=require("../../sidebar/useSidebar.js"),p=require("../../tooltip/tooltip.js"),u=require("../../panels/shared/styles.js");require("@googleforcreators/transform"),require("../../dropTargets/provider.js"),require("../../dropTargets/context.js"),require("../../../app/history/historyProvider.js"),require("../../../app/history/context.js"),require("@googleforcreators/templates"),require("../../../app/config/context.js");var c=require("../../../app/config/useConfig.js");require("../../../app/api/context.js"),require("@googleforcreators/fonts"),require("@googleforcreators/dom"),require("../../../app/font/context.js"),require("@googleforcreators/media"),require("@googleforcreators/tracking"),require("@googleforcreators/animation"),require("uuid"),require("@googleforcreators/masks"),require("@googleforcreators/element-library"),require("@googleforcreators/elements"),require("../../../app/story/context.js"),require("@googleforcreators/migration"),require("../../../app/story/actions/useSaveStory.js"),require("clone-deep"),require("../../../app/story/useStoryReducer/useStoryReducer.js"),require("@googleforcreators/output"),require("../../../app/story/storyTriggers/storyTriggersProvider.js"),require("../../../app/story/storyTriggers/storyEvents/onInitialElementAddedRegister.js"),require("../../../app/story/storyTriggers/storyEvents/onPageAddedRegister.js"),require("../../../app/media/useUploadMedia.js"),require("../../../utils/generateBlurhash.worker.js"),require("../../../app/media/media3p/providerConfiguration.js"),require("../../../app/media/utils/useFFmpeg.js"),require("../../../app/media/media3p/api/context.js"),require("../../../app/media/local/constants.js"),require("../../../app/media/media3p/providerReducer.js"),require("../../../app/media/context.js"),require("sat"),require("@googleforcreators/units"),require("../../../app/layout/context.js"),require("../../../app/layout/useZoomSetting.js"),require("@googleforcreators/rich-text"),require("@googleforcreators/stickers"),require("../../library/panes/text/textPresets.js"),require("../../../app/canvas/context.js");var d=require("../../../app/canvas/useCanvas.js");function f(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}function g(e){if(e&&e.__esModule)return e;var r=Object.create(null);return e&&Object.keys(e).forEach((function(t){if("default"!==t){var o=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(r,t,o.get?o:{enumerable:!0,get:function(){return e[t]}})}})),r.default=e,Object.freeze(r)}require("../../../app/currentUser/context.js"),require("../../../app/helpCenter/provider.js"),require("../../../app/helpCenter/context.js"),require("../../helpCenter/constants.js"),require("../../../app/rightClickMenu/context.js");var m=f(e),h=f(r);function q(){return q=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e},q.apply(this,arguments)}const x=h.default.div.withConfig({displayName:"colorInput__Preview",componentId:"sc-1h4cp44-0"})(["height:36px;color:",";cursor:pointer;position:relative;width:100%;padding:0;"],(e=>{let{theme:r}=e;return r.colors.fg.primary})),y=h.default(n.HexInput).withConfig({displayName:"colorInput__Input",componentId:"sc-1h4cp44-1"})(["min-width:100px;div{background-color:transparent;}input{padding-left:26px;}"]),v=h.default(p).withConfig({displayName:"colorInput__Tooltip",componentId:"sc-1h4cp44-2"})(["width:100%;height:100%;"]),j=r.css(["position:absolute;top:0;left:0;border-radius:50px;width:24px;height:24px;"]),E=r.css(["overflow:hidden;border:1px solid ",";outline:none;background:transparent;"],(e=>{let{theme:r}=e;return r.colors.border.defaultNormal})),b=r.css(["",";padding-right:6px;"],u.inputContainerStyleOverride),C=h.default(x).attrs({as:"button",type:"button"}).withConfig({displayName:"colorInput__ColorButton",componentId:"sc-1h4cp44-3"})(["border-radius:4px;"," display:flex;&:focus{box-shadow:0px 0px 0 2px ",",0px 0px 0 4px ",";border-color:",";}"],E,(e=>{let{theme:r}=e;return r.colors.bg.primary}),(e=>{let{theme:r}=e;return r.colors.border.focus}),(e=>{let{theme:r}=e;return r.colors.border.defaultHover})),I=h.default.div.withConfig({displayName:"colorInput__ColorPreview",componentId:"sc-1h4cp44-4"})([""," top:6px;left:6px;padding:0;background:transparent;cursor:pointer;"],j),S=h.default.div.withConfig({displayName:"colorInput__TextualPreview",componentId:"sc-1h4cp44-5"})(["padding:6px 12px 6px 38px;text-align:left;flex-grow:1;height:32px;"]),P=h.default(S).withConfig({displayName:"colorInput__MixedLabel",componentId:"sc-1h4cp44-6"})(["align-self:center;padding:6px 6px 6px 38px;"]),w=h.default(n.Swatch).withConfig({displayName:"colorInput__StyledSwatch",componentId:"sc-1h4cp44-7"})(["",";"],u.focusStyle),T=h.default.div.withConfig({displayName:"colorInput__ChevronContainer",componentId:"sc-1h4cp44-8"})(["width:",";display:flex;justify-content:",";align-items:center;align-self:center;svg{width:24px;height:24px;}"],(e=>{let{isSmall:r}=e;return r?"28px":"58px"}),(e=>{let{isSmall:r}=e;return r?"center":"flex-end"})),_=()=>Promise.resolve().then((function(){return g(require("react-color"))})),O=t.forwardRef((function ColorInput(e,r){let{onChange:p,value:f=null,label:g=null,changedStyle:h,pickerPlacement:j=n.PLACEMENT.RIGHT_START,isInDesignMenu:E=!1,hasInputs:O=!0,pickerProps:k,spacing:A,tooltipPlacement:L,...R}=e;const N=f===i.MULTIPLE_VALUE;f=N?"":f;const M=f?a.getOpaquePattern(f):{color:{r:0,g:0,b:0,a:0}},U=a.getPreviewText(f),[D,H]=t.useState(!1),Y=t.useRef(null),{isEyedropperActive:F}=d((e=>{let{state:{isEyedropperActive:r}}=e;return{isEyedropperActive:r}})),{isRTL:V,styleConstants:{topOffset:z}={}}=c(),[B,G]=t.useState(j),{refs:{sidebar:Z}}=l(),W=t.useCallback((e=>{if(j?.startsWith("top")){const{top:r}=e.current?.getBoundingClientRect()||{};r<=z&&G(j.replace("top","bottom"))}}),[j,z]),X=f?.type,J=(!X||"solid"===X)&&O,K={onClick:()=>H(!0),"aria-label":g,onPointerEnter:()=>_(),onFocus:()=>_(),tabIndex:R.tabIndex};t.useUnmount((()=>()=>H(!1)));const Q=t.useCallback((()=>H(!1)),[]),$=o.__("Open color picker","web-stories"),ee=E?b:u.inputContainerStyleOverride;return m.default.createElement(m.default.Fragment,null,J?m.default.createElement(x,{ref:Y},m.default.createElement(y,q({ref:r,"aria-label":g,value:N?null:f,onChange:p,isIndeterminate:N,placeholder:N?i.MULTIPLE_DISPLAY_VALUE:"",containerStyleOverride:ee},R)),m.default.createElement(I,null,m.default.createElement(v,{title:$,hasTail:!0,placement:L},m.default.createElement(w,q({isSmall:!0,pattern:M},K))))):m.default.createElement(v,{title:$,hasTail:!0,placement:L},m.default.createElement(C,q({ref:Y},K),m.default.createElement(I,null,m.default.createElement(n.Swatch,{isPreview:!0,role:"status",tabIndex:"-1",pattern:M,isIndeterminate:N})),O?m.default.createElement(S,null,m.default.createElement(n.Text,{size:n.THEME_CONSTANTS.TYPOGRAPHY.PRESET_SIZES.SMALL},U)):m.default.createElement(m.default.Fragment,null,N&&m.default.createElement(P,null,m.default.createElement(n.Text,{size:n.THEME_CONSTANTS.TYPOGRAPHY.PRESET_SIZES.SMALL,as:"span"},i.MULTIPLE_DISPLAY_VALUE)),m.default.createElement(T,{isSmall:N},m.default.createElement(n.Icons.ChevronDown,null))))),m.default.createElement(n.Popup,{isRTL:V,anchor:Y,dock:E?null:Z,isOpen:D,placement:B,spacing:A,invisible:F,topOffset:z,refCallback:W,resetXOffset:!0,renderContents:e=>{let{propagateDimensionChange:r}=e;return m.default.createElement(s,q({color:N?null:f,isEyedropperActive:F,onChange:p,onClose:Q,changedStyle:h,onDimensionChange:r},k))}}))}));module.exports=O;
