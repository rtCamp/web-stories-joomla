/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

"use strict";var e=require("react"),r=require("@googleforcreators/i18n"),t=require("@googleforcreators/design-system");require("prop-types");var o=require("@googleforcreators/date");require("@googleforcreators/transform"),require("../../dropTargets/provider.js"),require("@googleforcreators/react"),require("../../dropTargets/context.js"),require("../../../app/history/historyProvider.js");var s=require("../../../app/history/useHistory.js");require("@googleforcreators/templates"),require("../../../app/config/context.js"),require("../../../app/api/context.js"),require("@googleforcreators/fonts"),require("@googleforcreators/dom"),require("../../../constants/fonts.js"),require("../../../constants/multipleValue.js"),require("../../../app/font/context.js"),require("@googleforcreators/media"),require("@googleforcreators/tracking"),require("@googleforcreators/animation"),require("uuid"),require("@googleforcreators/masks"),require("@googleforcreators/element-library"),require("@googleforcreators/elements"),require("../../../app/story/context.js"),require("@googleforcreators/migration"),require("../../../app/story/actions/useSaveStory.js"),require("clone-deep"),require("../../../app/story/useStoryReducer/useStoryReducer.js"),require("@googleforcreators/output"),require("../../../app/story/storyTriggers/storyTriggersProvider.js"),require("../../../app/story/storyTriggers/storyEvents/onInitialElementAddedRegister.js"),require("../../../app/story/storyTriggers/storyEvents/onPageAddedRegister.js");var i=require("../../../app/story/useStory.js");require("../../../app/media/useUploadMedia.js"),require("@googleforcreators/patterns"),require("../../../utils/generateBlurhash.worker.js"),require("../../../app/media/media3p/providerConfiguration.js"),require("../../../app/media/utils/useFFmpeg.js"),require("../../../app/media/media3p/api/context.js"),require("../../../app/media/local/constants.js"),require("../../../app/media/media3p/providerReducer.js"),require("../../../app/media/context.js"),require("sat"),require("@googleforcreators/units"),require("../../../app/layout/context.js"),require("../../../app/layout/useZoomSetting.js"),require("@googleforcreators/rich-text"),require("@googleforcreators/stickers"),require("../../library/panes/text/textPresets.js"),require("../../../app/canvas/context.js"),require("../../../app/currentUser/context.js"),require("../../../app/helpCenter/provider.js"),require("../../../app/helpCenter/context.js"),require("../../helpCenter/constants.js"),require("../../../app/rightClickMenu/context.js");var a=require("../../tooltip/tooltip.js"),u=require("../../../utils/useIsUploadingToStory.js"),n=require("./buttonWithChecklistWarning.js");function l(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var p=l(e);function PlainButton(e){let{text:r,onClick:o,disabled:s}=e;return p.default.createElement(a,{title:r,hasTail:!0},p.default.createElement(t.Button,{variant:t.BUTTON_VARIANTS.SQUARE,type:t.BUTTON_TYPES.QUATERNARY,size:t.BUTTON_SIZES.SMALL,onClick:o,disabled:s,"aria-label":r},p.default.createElement(t.Icons.FloppyDisk,null)))}module.exports=function UpdateButton(e){let{hasUpdates:a=!1,forceIsSaving:l=!1}=e;const{isSaving:c,status:g,date:d,saveStory:q,canPublish:f}=i((e=>{let{state:{meta:{isSaving:r},story:{status:t,date:o},capabilities:s},actions:{saveStory:i}}=e;return{isSaving:r,status:t,date:o,saveStory:i,canPublish:Boolean(s?.publish)}})),j=c||l,y=u(),{state:{hasNewChanges:m}}=s();t.useGlobalKeyDownEffect({key:["mod+s"]},(e=>{e.preventDefault(),j||y||q()}),[q,j,y]);const v=!j&&!y&&(m||a),S="draft"===g||!g;if("pending"===g)return p.default.createElement(PlainButton,{text:r.__("Save as pending","web-stories"),disabled:!v,onClick:()=>q()});if(S)return p.default.createElement(PlainButton,{text:r.__("Save draft","web-stories"),disabled:!v,onClick:()=>q()});const b=o.isAfter(o.subMinutes(o.toDate(d,o.getOptions()),1),o.toDate(new Date,o.getOptions()))&&"private"!==g?r.__("Schedule","web-stories"):r.__("Update","web-stories");return p.default.createElement(n,{text:b,onClick:()=>q(),disabled:!v,isUploading:y,canPublish:f})};
