/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

"use strict";var e=require("react"),t=require("styled-components");require("prop-types");var n=require("@googleforcreators/react"),r=require("@googleforcreators/i18n"),s=require("uuid"),o=require("@googleforcreators/design-system"),a=require("@googleforcreators/media"),i=require("../../../../canvas/utils/getElementProperties.js"),u=require("../../../../../app/story/useStory.js"),l=require("../../shared/index.js"),c=require("../../../../../utils/useRovingTabIndex/index.js"),d=require("../../../../canvas/useFocusCanvas.js");function p(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var m=p(e),f=p(t);const g=f.default.div.withConfig({displayName:"insertionMenu__DropDownContainer",componentId:"sc-xjd4tf-0"})(["margin-top:10px;min-width:160px;"]),b=f.default.div.withConfig({displayName:"insertionMenu__MenuContainer",componentId:"sc-xjd4tf-1"})(["z-index:1;"]),v=t.css(["min-width:160px;margin-top:0;li{display:block;}"]),I="insert",y="addBackground";module.exports=function InsertionMenu(e){let{resource:t,display:p,onInsert:f,width:E,index:q,isLocal:w=!1,setParentActive:x=o.noop,setParentInactive:_=o.noop}=e;const M=n.useRef(),[h,k]=n.useState(!1),C=n.useCallback((e=>{e.stopPropagation(),k(!0)}),[]),j=n.useCallback((()=>{k(!1),M.current?.focus(),x()}),[x]),{currentBackgroundId:P,combineElements:S}=u((e=>({currentBackgroundId:e.state.currentPage?.elements?.[0]?.id,combineElements:e.actions.combineElements}))),{type:T,poster:A}=t,B=[{group:[{label:["image","gif"].includes(T)?r.__("Insert image","web-stories"):r.__("Insert video","web-stories"),value:I},{label:r.__("Add as background","web-stories"),value:y}]}];c.default({ref:M},[],3);const O=d();o.useKeyDownEffect(w?null:M,"tab",O,[O]);const D=n.useMemo((()=>`list-${s.v4()}`),[]),R=n.useMemo((()=>`button-${s.v4()}`),[]);return m.default.createElement(b,null,m.default.createElement(l.ActionButton,{ref:M,onClick:C,"aria-label":r.__("Open insertion menu","web-stories"),"aria-pressed":h,"aria-haspopup":!0,"aria-expanded":h,"aria-owns":h?D:null,id:R,$display:p,tabIndex:0===q?0:-1},m.default.createElement(o.Icons.PlusFilledSmall,null)),h&&m.default.createElement(o.Popup,{anchor:M,placement:o.PLACEMENT.BOTTOM_START,isOpen:h},m.default.createElement(g,null,m.default.createElement(o.Menu,{parentId:R,listId:D,onMenuItemClick:(e,n)=>{const r=A||a.getSmallestUrlForWidth(E,t),s=i(t.type,{resource:t});switch(k(!1),n){case I:f(t,r);break;case y:S({firstElement:s,secondId:P})}_()},options:B,onDismissMenu:j,hasMenuRole:!0,menuStylesOverride:v}))))};
