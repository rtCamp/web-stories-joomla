/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

"use strict";var e=require("react");require("prop-types");var t=require("@googleforcreators/react"),r=require("@googleforcreators/i18n"),a=require("styled-components"),n=require("@googleforcreators/design-system"),i=require("../../../../../app/media/media3p/providerConfiguration.js"),l=require("./mediaGallery.js"),o=require("./styles.js");function s(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var d=s(e);const c=s(a).default(n.Text).withConfig({displayName:"paginatedMediaGallery__StyledText",componentId:"sc-1xn8t7i-0"})(["color:",";"],(e=>{let{theme:t}=e;return t.colors.fg.secondary}));function PaginatedMediaGallery(e){let{providerType:a,resources:s,searchTerm:u,selectedCategoryId:f,isMediaLoading:g,isMediaLoaded:m,hasMore:E,onInsert:y,setNextPage:p,canEditMedia:M}=e;const v=t.useRef(),T=t.useCallback((()=>v.current.clientHeight===v.current.scrollHeight?p():()=>{}),[p]),h=t.useDebouncedCallback(T,500),C=t.useCallback((()=>{const e=v.current;if(!s.length||!e||0===e.clientHeight||!E||!m||g)return;if(e.clientHeight===e.scrollHeight)return void h();e.scrollHeight-e.scrollTop<=e.clientHeight+300&&p()}),[s.length,E,m,g,h,p]);t.useEffect((()=>{v.current?.scrollTo?.(0,0)}),[u,f]);const P=t.useDebouncedCallback(C,500);t.useLayoutEffect((()=>{!async function(){var e;await(e=200,new Promise((t=>setTimeout(t,e)))),C()}()}),[C]),t.useEffect((()=>{const e=v.current;if(e)return e.addEventListener("scroll",P),window.addEventListener("resize",P),()=>{e.removeEventListener("scroll",P),window.removeEventListener("resize",P)}}),[P]);const b=m&&0===s.length?d.default.createElement(o.MediaGalleryMessage,null,r.__("No media found.","web-stories")):d.default.createElement("div",{style:{marginBottom:15}},d.default.createElement(l,{providerType:a,canEditMedia:M,resources:s,onInsert:y})),[L,w]=t.useState(!1);t.useEffect((()=>{if(g&&E){const e=setTimeout((()=>{w(g)}),1e3);return()=>clearTimeout(e)}w(!1)}),[g,E]);const G="local"!==a&&i.PROVIDERS[a].attributionComponent&&i.PROVIDERS[a].attributionComponent();return d.default.createElement(d.default.Fragment,null,d.default.createElement(o.MediaGalleryContainer,{"data-testid":"media-gallery-container",ref:v},d.default.createElement(o.MediaGalleryInnerContainer,null,b)),L&&d.default.createElement(o.MediaGalleryLoadingPill,{"data-testid":"loading-pill"},d.default.createElement(c,{forwardedAs:"span",size:n.THEME_CONSTANTS.TYPOGRAPHY.PRESET_SIZES.SMALL},r.__("Loadingâ€¦","web-stories"))),!L&&G)}PaginatedMediaGallery.defaultProps={canEditMedia:!1},module.exports=PaginatedMediaGallery;
