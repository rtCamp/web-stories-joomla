/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

"use strict";var e=require("react"),r=require("styled-components");require("prop-types");var t=require("@googleforcreators/react"),a=require("@googleforcreators/date"),i=require("@googleforcreators/i18n"),o=require("@googleforcreators/tracking"),s=require("@googleforcreators/media"),d=require("@googleforcreators/design-system");require("@googleforcreators/templates"),require("../../../../../app/config/context.js"),require("../../../../../app/api/context.js");var l=require("../../../../../app/api/useAPI.js");require("../../../../../constants/fonts.js"),require("../../../../../constants/multipleValue.js"),require("@googleforcreators/animation"),require("uuid"),require("@googleforcreators/masks"),require("@googleforcreators/element-library"),require("@googleforcreators/elements"),require("../../../../../app/story/context.js"),require("@googleforcreators/migration"),require("../../../../../app/history/historyProvider.js"),require("../../../../../app/history/context.js"),require("../../../../../app/story/actions/useSaveStory.js"),require("clone-deep"),require("../../../../../app/story/useStoryReducer/useStoryReducer.js"),require("@googleforcreators/output"),require("../../../../../app/story/storyTriggers/storyTriggersProvider.js"),require("../../../../../app/story/storyTriggers/storyEvents/onInitialElementAddedRegister.js"),require("../../../../../app/story/storyTriggers/storyEvents/onPageAddedRegister.js"),require("../../../../../app/media/useUploadMedia.js"),require("@googleforcreators/patterns"),require("../../../../../utils/generateBlurhash.worker.js"),require("../../../../../app/media/media3p/providerConfiguration.js"),require("../../../../../app/media/utils/useFFmpeg.js"),require("../../../../../app/media/media3p/api/context.js"),require("../../../../../app/media/local/constants.js"),require("../../../../../app/media/media3p/providerReducer.js"),require("../../../../../app/media/context.js");var n=require("../../../../../app/media/local/useLocalMedia.js"),u=require("../../../../dialog/dialog.js");function p(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var c=p(e),g=p(r);const m=r.css(["display:flex;width:","px;margin-right:28px;"],152),f=g.default.img.withConfig({displayName:"mediaEditDialog__Image",componentId:"sc-ctku7j-0"})(["",""],m),y=g.default.video.withConfig({displayName:"mediaEditDialog__Video",componentId:"sc-ctku7j-1"})(["",""],m),_=g.default.div.withConfig({displayName:"mediaEditDialog__DialogBody",componentId:"sc-ctku7j-2"})(["display:flex;justify-content:left;align-items:flex-start;"]),q=g.default.div.withConfig({displayName:"mediaEditDialog__MetadataTextContainer",componentId:"sc-ctku7j-3"})(["display:flex;flex-direction:column;margin:0 4px;"]),E=g.default(d.Text).withConfig({displayName:"mediaEditDialog__DateText",componentId:"sc-ctku7j-4"})(["margin-bottom:8px;"]),x=g.default(d.TextArea).withConfig({displayName:"mediaEditDialog__AssistiveTextArea",componentId:"sc-ctku7j-5"})(["margin:20px 0 4px;"]),j=i.__("Edit Image","web-stories"),T=i.__("Edit Video","web-stories"),S=i.__("Assistive text","web-stories"),h=i.__("Video description","web-stories"),b=i.__("Describe the appearance and function of the image. Leave empty if the image is purely decorative.","web-stories"),v=i.__("For indexability and accessibility. Include any burned-in text inside the video.","web-stories");module.exports=function MediaEditDialog(e){let{resource:r,onClose:p}=e;const{id:g,src:m,creationDate:w,width:A,height:C,type:k,alt:I,poster:M,mimeType:P}=r,{actions:{updateMedia:D}}=l(),{updateMediaElement:N}=n((e=>{let{actions:{updateMediaElement:r}}=e;return{updateMediaElement:r}})),{showSnackbar:R}=d.useSnackbar(),[O,L]=t.useState(I),H=a.toDate(w),Y=t.useCallback((e=>{L(e.target.value)}),[]),F=t.useCallback((async()=>{try{await D(g,{altText:O}),N({id:g,data:{alt:O}}),p()}catch(e){o.trackError("local_media_edit",e.message),R({message:i.__("Failed to update, please try again.","web-stories"),dismissible:!0})}}),[O,g,p,R,D,N]),V="image"===k;return c.default.createElement(u,{isOpen:!0,onClose:p,title:V?j:T,secondaryText:i.__("Cancel","web-stories"),onPrimary:F,primaryText:i.__("Save","web-stories")},c.default.createElement(_,null,"image"===k?c.default.createElement(f,{src:s.getSmallestUrlForWidth(152,r),alt:I,loading:"lazy",crossOrigin:"anonymous",decoding:"async"}):c.default.createElement(y,{key:m,crossOrigin:"anonymous",poster:M,preload:"metadata",muted:!0},c.default.createElement("source",{src:m,type:P})),c.default.createElement(q,null,a.isValid(H)&&c.default.createElement(E,{forwardedAs:"span",size:d.THEME_CONSTANTS.TYPOGRAPHY.PRESET_SIZES.X_SMALL},i.sprintf(
/* translators: %s: upload date of media item. */
i.__("Uploaded: %s","web-stories"),a.formatDate(w))),c.default.createElement(d.Text,{as:"span",size:d.THEME_CONSTANTS.TYPOGRAPHY.PRESET_SIZES.SMALL},i.sprintf(
/* translators: 1: image width. 2: image height. */
i.__("%1$d x %2$d pixels","web-stories"),A,C)),c.default.createElement(x,{value:O,"aria-label":V?S:h,type:"text",placeholder:V?S:h,onChange:Y}),c.default.createElement(d.Text,{size:d.THEME_CONSTANTS.TYPOGRAPHY.PRESET_SIZES.SMALL},V?b:v))))};
