/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

"use strict";var e=require("react"),r=require("flagged"),t=require("@googleforcreators/react"),a=require("styled-components"),i=require("@googleforcreators/i18n"),s=require("@googleforcreators/tracking"),o=require("@googleforcreators/design-system");require("prop-types"),require("../../../../../app/config/context.js");var l=require("../../../../../app/config/useConfig.js");require("@googleforcreators/media"),require("@googleforcreators/templates"),require("../../../../../app/api/context.js"),require("../../../../../constants/fonts.js"),require("../../../../../constants/multipleValue.js"),require("@googleforcreators/animation"),require("uuid"),require("@googleforcreators/masks"),require("@googleforcreators/element-library"),require("@googleforcreators/elements"),require("../../../../../app/story/context.js"),require("@googleforcreators/migration"),require("../../../../../app/history/historyProvider.js"),require("../../../../../app/history/context.js"),require("../../../../../app/story/actions/useSaveStory.js"),require("clone-deep"),require("../../../../../app/story/useStoryReducer/useStoryReducer.js"),require("@googleforcreators/output"),require("../../../../../app/story/storyTriggers/storyTriggersProvider.js"),require("../../../../../app/story/storyTriggers/storyEvents/onInitialElementAddedRegister.js"),require("../../../../../app/story/storyTriggers/storyEvents/onPageAddedRegister.js"),require("../../../../../app/media/useUploadMedia.js"),require("@googleforcreators/patterns"),require("../../../../../utils/generateBlurhash.worker.js");var n=require("../../../../../app/media/local/types.js");require("../../../../../app/media/media3p/providerConfiguration.js"),require("../../../../../app/media/utils/useFFmpeg.js"),require("../../../../../app/media/media3p/api/context.js"),require("../../../../../app/media/local/constants.js"),require("../../../../../app/media/media3p/providerReducer.js"),require("../../../../../app/media/context.js");var u=require("../../../../../app/media/local/useLocalMedia.js");require("../../../common/index.js"),require("../../../../form/color/color.js"),require("../../../../form/filterToggle/filterToggle.js"),require("../../../../form/linkIcon.js"),require("../../../../form/link.js"),require("../../../../form/media.js");var d=require("../../../../form/mediaUploadButton.js");require("../../../../form/row.js"),require("../../../../form/switch.js"),require("../../../../form/textArea.js"),require("../../../../form/context.js"),require("../../../../form/dateTime/dateTime.js"),require("../../../../form/required.js"),require("../../../../form/radioGroup/index.js");var c=require("../../../../form/select/select.js");require("../../../../form/hierarchical/index.js");var p=require("../common/styles.js"),m=require("../common/paginatedMediaGallery.js"),f=require("../../../../../flags.js"),g=require("../../shared/index.js"),q=require("../../../../panels/shared/styles.js"),j=require("../../../../tooltip/tooltip.js"),y=require("./useOnMediaSelect.js"),h=require("./paneId.js"),E=require("./videoOptimizationDialog.js"),T=require("./hotlink/hotlink.js"),_=require("./mediaRecording/mediaRecording.js"),M=require("../../../common/searchInput.js");function S(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var v=S(e),I=S(a);function A(){return A=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])}return e},A.apply(this,arguments)}const P=I.default(o.Button).withConfig({displayName:"mediaPane__Button",componentId:"sc-usipec-0"})(["",";"],q.focusStyle),x=I.default.div.withConfig({displayName:"mediaPane__FilterArea",componentId:"sc-usipec-1"})(["display:flex;justify-content:space-between;margin-top:24px;padding:0 "," 0 ",";"],g.PANE_PADDING,g.PANE_PADDING),N=I.default(o.Text).attrs({size:o.THEME_CONSTANTS.TYPOGRAPHY.PRESET_SIZES.MEDIUM}).withConfig({displayName:"mediaPane__SearchCount",componentId:"sc-usipec-2"})(["display:flex;align-items:center;justify-content:center;flex-shrink:0;"]),b=I.default.div.withConfig({displayName:"mediaPane__ButtonsWrapper",componentId:"sc-usipec-3"})(["display:flex;flex:1;justify-content:flex-end;"]),C=n.LOCAL_MEDIA_TYPE_ALL,w=[{value:C,label:i.__("All Types","web-stories")},{value:"image",label:i.__("Images","web-stories")},{value:"video",label:i.__("Video","web-stories")}];module.exports=function MediaPane(e){const{hasMore:a,media:n,isMediaLoading:g,isMediaLoaded:q,mediaType:S,searchTerm:I,setNextPage:L,setMediaType:R,setSearchTerm:O,totalItems:k}=u((e=>{let{state:{hasMore:r,media:t,isMediaLoading:a,isMediaLoaded:i,mediaType:s,searchTerm:o,totalItems:l},actions:{setNextPage:n,setMediaType:u,setSearchTerm:d}}=e;return{hasMore:r,media:t,isMediaLoading:a,isMediaLoaded:i,mediaType:s,searchTerm:o,totalItems:l,setNextPage:n,setMediaType:u,setSearchTerm:d}})),B=r.useFeature("mediaRecording"),{capabilities:{hasUploadMediaAction:U}}=l(),D=I.length>0,G=t.useCallback(((e,r)=>{R({mediaType:r})}),[R]),{onSelect:F,insertMediaElement:V}=y();t.useEffect((()=>{I.length>0&&s.trackEvent("search",{search_type:"media",search_term:I,search_filter:S})}),[I,S]);const Y=r.useFeature(f.INCREMENTAL_SEARCH_DEBOUNCE_MEDIA),H=t.useCallback((e=>v.default.createElement(P,{variant:o.BUTTON_VARIANTS.SQUARE,type:o.BUTTON_TYPES.SECONDARY,size:o.BUTTON_SIZES.SMALL,onClick:e,"aria-label":i.__("Upload","web-stories")},v.default.createElement(o.Icons.ArrowCloud,null))),[]);return v.default.createElement(p.StyledPane,A({id:h},e),v.default.createElement(p.PaneInner,null,v.default.createElement(p.PaneHeader,null,v.default.createElement(p.SearchInputContainer,null,v.default.createElement(M,{initialValue:I,placeholder:i.__("Search","web-stories"),onSearch:e=>{const r=e.trim();r!==I&&O({searchTerm:r})},incremental:Y})),v.default.createElement(x,null,v.default.createElement(c,{selectedValue:S?.toString()||C,onMenuItemClick:G,options:w,placement:o.PLACEMENT.BOTTOM_START}),D&&n.length>0&&v.default.createElement(N,null,i.sprintf(
/* translators: %d: number of results. */
i._n("%s result found.","%s results found.",k,"web-stories"),k)),!D&&v.default.createElement(b,null,B&&U&&v.default.createElement(_,null),v.default.createElement(T,null),U&&v.default.createElement(j,{title:i.__("Upload","web-stories")},v.default.createElement(d,{renderButton:H,onInsert:F}))))),q&&!n.length?v.default.createElement(p.MediaGalleryMessage,null,D?i.__("No results found.","web-stories"):i.__("No media found.","web-stories")):v.default.createElement(m,{providerType:"local",canEditMedia:U,resources:n,isMediaLoading:g,isMediaLoaded:q,hasMore:a,onInsert:V,setNextPage:L,searchTerm:I}),v.default.createElement(E,null)))};
