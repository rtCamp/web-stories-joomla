/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

"use strict";var e=require("react");require("prop-types");var r=require("styled-components"),t=require("@googleforcreators/react"),a=require("flagged"),i=require("@googleforcreators/i18n"),s=require("@googleforcreators/tracking"),o=require("../../../../../app/media/useMedia.js"),l=require("../common/styles.js");require("../../../common/index.js");var n=require("../../../../../flags.js"),c=require("../../../../../app/media/media3p/providerConfiguration.js"),d=require("./termsDialog.js"),u=require("./paneId.js"),m=require("./providerTabList.js"),p=require("./providerPanel.js"),f=require("../../../common/searchInput.js");function h(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var v=h(e);function g(){return g=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])}return e},g.apply(this,arguments)}const E=h(r).default.div.withConfig({displayName:"media3pPane__PaneBottom",componentId:"sc-1hq1xk8-0"})(["position:relative;height:100%;flex:1 1 auto;min-height:0;"]);module.exports=function Media3pPane(e){const{isActive:r}=e,{searchTerm:h,selectedProvider:P,setSelectedProvider:q,setSearchTerm:y,media3p:S}=o((e=>{let{media3p:{state:{selectedProvider:r,searchTerm:t},actions:{setSelectedProvider:a,setSearchTerm:i}},media3p:s}=e;return{searchTerm:t,selectedProvider:r,setSelectedProvider:a,setSearchTerm:i,media3p:s}}));t.useEffect((()=>{r&&!P&&q({provider:Object.keys(c.PROVIDERS)[0]})}),[r,P,q]);const j=S[P]?.state?.categories?.selectedCategoryId;t.useEffect((()=>{h.length&&s.trackEvent("search",{search_type:"media3p",search_term:h,search_filter:P,search_category:j})}),[P,h,j]);const b=t.useCallback((e=>{const r=e.trim();r!==h&&y({searchTerm:r})}),[h,y]),I=a.useFeature(n.INCREMENTAL_SEARCH_DEBOUNCE_MEDIA),R=t.useRef(),O=a.useFeatures(),T=t.useMemo((()=>Object.keys(c.PROVIDERS).filter((e=>!c.PROVIDERS[e].featureName||O[c.PROVIDERS[e].featureName]))),[O]);return v.default.createElement(v.default.Fragment,null,r&&v.default.createElement(d,null),v.default.createElement(l.StyledPane,g({id:u},e),v.default.createElement(l.PaneInner,null,v.default.createElement(l.PaneHeader,null,v.default.createElement(l.SearchInputContainer,null,v.default.createElement(f,{initialValue:h,placeholder:i.__("Search","web-stories"),onSearch:b,incremental:I,disabled:Boolean(P&&c.PROVIDERS[P].supportsCategories&&S[P]?.state.categories.selectedCategoryId)})),v.default.createElement(m,{providers:T})),v.default.createElement(E,{ref:R},T.map((e=>v.default.createElement(p,{key:e,providerType:e,isActive:e===P,searchTerm:h,role:"tabpanel","aria-labelledby":`provider-tab-${e}`,id:`provider-tabpanel-${e}`})))))))};
