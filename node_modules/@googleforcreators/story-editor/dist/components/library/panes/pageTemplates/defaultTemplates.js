/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

"use strict";var e=require("react"),t=require("@googleforcreators/react"),a=require("@googleforcreators/i18n"),r=require("@googleforcreators/tracking"),s=require("styled-components");require("prop-types");var l=require("@googleforcreators/design-system");require("@googleforcreators/templates"),require("../../../../app/config/context.js"),require("../../../../app/api/context.js");var n=require("../../../../app/api/useAPI.js"),i=require("../shared/index.js"),o=require("../shared/virtualizedPanelGrid/components.js"),u=require("./constants.js"),c=require("./templateList.js"),p=require("../shared/chipGroup/index.js");function d(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var m=d(e),f=d(s);const g=f.default.div.withConfig({displayName:"defaultTemplates__ActionRow",componentId:"sc-14vj9wc-0"})(["display:flex;justify-content:space-between;margin:0px 16px 22px 16px;"]),E=f.default.div.withConfig({displayName:"defaultTemplates__PageTemplatesParentContainer",componentId:"sc-14vj9wc-1"})(["",";margin-top:26px;overflow-x:hidden;overflow-y:scroll;"],o.virtualPaneContainer);module.exports=function DefaultTemplates(e){let{pageSize:s}=e;const{actions:{getPageTemplates:o}}=n(),[d,f]=t.useState([]),[_,q]=t.useState(!1);t.useEffect((()=>{!async function(){q(!0);const e=r.getTimeTracker("load_page_templates");f(await o()),q(!1),e()}()}),[o,f]);const y=t.useRef(),[T,j]=t.useState(null),v=t.useMemo((()=>[{id:null,label:a._x("All","page templates","web-stories")},...Object.entries(u.PAGE_TEMPLATE_TYPES).map((e=>{let[t,{name:a}]=e;return{id:t,label:a}}))]),[]),x=t.useMemo((()=>d.reduce(((e,t)=>{const a=Object.values(t.postersByPage).map(((e,a)=>({id:`${t.slug}_${a}`,title:t.title,story:t.pages[a],...e})));return[...e,...a.reduce(((e,t)=>!t.type||T&&t.type!==T?e:[...e,t]),[])]}),[])),[d,T]),S=t.useCallback((e=>{j(e),r.trackEvent("search",{search_type:"page_templates",search_term:"",search_category:e})}),[]);return m.default.createElement(m.default.Fragment,null,m.default.createElement(p,{items:v,selectedItemId:T,selectItem:S,deselectItem:()=>S(null)}),m.default.createElement(E,{ref:y,tabIndex:-1},m.default.createElement(g,null,m.default.createElement(l.Headline,{as:"h2",size:l.THEME_CONSTANTS.TYPOGRAPHY.PRESET_SIZES.XXX_SMALL},a.__("Templates","web-stories"))),!_&&y.current?m.default.createElement(c,{pageSize:s,parentRef:y,pages:x}):m.default.createElement(i.LoadingContainer,null,m.default.createElement(l.LoadingSpinner,{animationSize:64,numCircles:8}))))};
