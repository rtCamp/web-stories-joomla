/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

"use strict";var e=require("react"),t=require("styled-components"),i=require("@googleforcreators/react");require("prop-types");var n=require("uuid"),r=require("@googleforcreators/i18n"),o=require("@googleforcreators/design-system"),a=require("../../../../../utils/useRovingTabIndex/index.js"),s=require("../hooks/useExpandAnimation.js"),l=require("../hooks/useHandleRowVisibility.js"),d=require("./constants.js");function u(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var c=u(e),p=u(t);const f=p.default.div.withConfig({displayName:"chipGroup__Section",componentId:"sc-emvo4b-0"})(["height:","px;min-height:","px;background-color:",";display:flex;flex-direction:column;align-items:flex-start;flex:0 1 auto;position:relative;transition:height 0.2s,min-height 0.2s;"],d.CHIP_COLLAPSED_FULL_HEIGHT,d.CHIP_COLLAPSED_FULL_HEIGHT,(e=>{let{theme:t}=e;return t.colors.divider.tertiary})),m=p.default.div.withConfig({displayName:"chipGroup__Container",componentId:"sc-emvo4b-1"})(["overflow:hidden;margin:","px 12px ","px 24px;"],d.CHIP_TOP_MARGIN,d.CHIP_BOTTOM_MARGIN),g=p.default.div.withConfig({displayName:"chipGroup__InnerContainer",componentId:"sc-emvo4b-2"})(["display:flex;justify-content:center;flex-wrap:wrap;position:relative;padding:4px 0;transition:transform 0.2s;column-gap:8px;row-gap:14px;"]),x=p.default(o.Button).attrs({type:o.BUTTON_TYPES.TERTIARY,size:o.BUTTON_SIZES.SMALL,variant:o.BUTTON_VARIANTS.CIRCLE}).withConfig({displayName:"chipGroup__ExpandButton",componentId:"sc-emvo4b-3"})(["display:flex;position:absolute;bottom:-24px;background:",";max-height:none;width:32px;height:32px;"," visibility:inherit;align-self:center;justify-content:center;align-items:center;"],(e=>{let{theme:t}=e;return t.colors.bg.tertiary}),(e=>{let{isExpanded:t}=e;return t&&"transform: scaleY(-1);"}));module.exports=e=>{let{items:t,selectedItemId:u,selectItem:p,deselectItem:_,ariaLabel:I}=e;const[h,C]=i.useState(!1),E=i.useRef(),b=i.useRef(),y=i.useRef([]),[R,v]=i.useState(0),T=i.useCallback(((e,t)=>{e&&null!==t?_():(C(!1),p(t))}),[_,p]),L=i.useCallback((()=>C((e=>!e))),[]);s({sectionRef:E,innerContainerRef:b,isExpanded:h,setFocusedRowOffset:v,collapsedHeight:d.CHIP_COLLAPSED_FULL_HEIGHT,bottomMargin:d.CHIP_BOTTOM_MARGIN,topMargin:d.CHIP_TOP_MARGIN}),l({isExpanded:h,innerContainerRef:b,selectedItemId:u,setFocusedRowOffset:v,itemRefs:y,offsetSpacing:d.FOCUS_BORDER_SPACING});const w=t.length>0;a.default({ref:E},[h]),o.useKeyDownEffect(E,h?"":"down",(()=>w&&C(!0)),[h,w]);const O=i.useMemo((()=>`pill-group-${n.v4()}`),[]);return c.default.createElement(f,{ref:E},w&&c.default.createElement(c.default.Fragment,null,c.default.createElement(m,{id:O,isExpanded:h,role:"listbox","aria-label":I||r.__("List of filtering options","web-stories")},c.default.createElement(g,{role:"presentation",ref:b,style:{transform:`translateY(-${R}px`}},t.map(((e,t)=>{const{id:i,label:n}=e,r=i===u,a=r||!r&&0===t?0:-1;return c.default.createElement(o.Chip,{key:i,role:"option",ref:e=>{y.current[i]=e},active:r,"aria-selected":r,onClick:()=>T(r,i),tabIndex:a},n)})))),c.default.createElement(x,{onClick:L,isExpanded:h,"aria-controls":O,"aria-expanded":h,"aria-label":r.__("Expand","web-stories")},c.default.createElement(o.Icons.ChevronUp,null))))};
