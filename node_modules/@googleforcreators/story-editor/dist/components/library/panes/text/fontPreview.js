/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

"use strict";var e=require("react");require("prop-types");var r=require("styled-components"),t=require("@googleforcreators/react"),o=require("@googleforcreators/design-system"),i=require("@googleforcreators/tracking"),s=require("@googleforcreators/units"),n=require("@googleforcreators/dom"),a=require("@googleforcreators/i18n"),l=require("@googleforcreators/rich-text");require("@googleforcreators/transform"),require("../../../dropTargets/provider.js"),require("../../../dropTargets/context.js"),require("../../../../app/history/historyProvider.js"),require("../../../../app/history/context.js"),require("@googleforcreators/templates"),require("../../../../app/config/context.js"),require("../../../../app/api/context.js"),require("@googleforcreators/fonts"),require("../../../../constants/fonts.js"),require("../../../../constants/multipleValue.js"),require("../../../../app/font/context.js");var u=require("../../../../app/font/useFont.js");require("@googleforcreators/media");var c=require("../../../../utils/objectWithout.js");require("@googleforcreators/animation"),require("uuid"),require("@googleforcreators/masks"),require("@googleforcreators/element-library"),require("@googleforcreators/elements"),require("../../../../app/story/context.js"),require("@googleforcreators/migration"),require("../../../../app/story/actions/useSaveStory.js"),require("clone-deep"),require("../../../../app/story/useStoryReducer/useStoryReducer.js"),require("@googleforcreators/output"),require("../../../../app/story/storyTriggers/storyTriggersProvider.js"),require("../../../../app/story/storyTriggers/storyEvents/onInitialElementAddedRegister.js"),require("../../../../app/story/storyTriggers/storyEvents/onPageAddedRegister.js");var p=require("../../../../app/story/useStory.js");require("../../../../app/media/useUploadMedia.js"),require("@googleforcreators/patterns"),require("../../../../utils/generateBlurhash.worker.js"),require("../../../../app/media/media3p/providerConfiguration.js"),require("../../../../app/media/utils/useFFmpeg.js"),require("../../../../app/media/media3p/api/context.js"),require("../../../../app/media/local/constants.js"),require("../../../../app/media/media3p/providerReducer.js"),require("../../../../app/media/context.js"),require("sat"),require("../../../../app/layout/context.js"),require("../../../../app/layout/useZoomSetting.js"),require("@googleforcreators/stickers"),require("./textPresets.js"),require("../../../../app/canvas/context.js"),require("../../../../app/currentUser/context.js"),require("../../../../app/helpCenter/provider.js"),require("../../../../app/helpCenter/context.js"),require("../../../helpCenter/constants.js"),require("../../../../app/rightClickMenu/context.js"),require("../../../../utils/storyPageToNode.js"),require("@ap.cx/hues"),require("../../../../app/pageCanvas/context.js"),require("../../../../app/pageCanvas/pageCanvasCacheValidator.js");var d=require("../../../../app/pageCanvas/useCalculateAccessibleTextColors.js");require("../../../../types.js");var g=require("../../useLibrary.js"),f=require("../shared/libraryMoveable.js"),q=require("../shared/insertionOverlay.js"),m=require("../../../../utils/useRovingTabIndex/index.js"),y=require("../../../../utils/presetUtils.js"),h=require("../../../../utils/getUpdatedSizeAndPosition.js"),j=require("../../../panels/shared/styles.js");function x(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var v=x(e),S=x(r);function C(){return C=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e},C.apply(this,arguments)}const b=S.default.button.withConfig({displayName:"fontPreview__Preview",componentId:"sc-kfwh27-0"})(["position:relative;display:flex;align-items:center;background-color:",";padding:8px 0px;border-radius:",";width:100%;border:none;cursor:pointer;text-align:left;"," &."," [role='presentation'],&[data-focus-visible-added] [role='presentation']{",";}"],(e=>{let{theme:r}=e;return r.colors.interactiveBg.secondaryNormal}),(e=>{let{theme:r}=e;return r.borders.radius.small}),(e=>{let{isTextSelected:r}=e;return r?j.focusStyle:"outline: none;"}),o.ThemeGlobals.FOCUS_VISIBLE_SELECTOR,(e=>{let{theme:r}=e;return o.themeHelpers.focusCSS(r.colors.border.focus,r.colors.bg.secondary)})),T=S.default(o.Text).attrs({forwardedAs:"span"}).withConfig({displayName:"fontPreview__PreviewText",componentId:"sc-kfwh27-1"})(["color:",";font-size:","px;font-weight:",";font-family:",";line-height:normal;margin:",";"],(e=>{let{theme:r,isClone:t}=e;return t?r.colors.standard.black:r.colors.fg.primary}),(e=>{let{fontSize:r}=e;return r}),(e=>{let{fontWeight:r}=e;return r}),(e=>{let{fontFamily:r}=e;return r}),(e=>{let{isClone:r}=e;return r?0:"0px 16px"})),w=S.default.div.withConfig({displayName:"fontPreview__DragContainer",componentId:"sc-kfwh27-2"})(["position:absolute;opacity:0;background-color:",";width:","px;line-height:","px;"],(e=>{let{theme:r}=e;return r.colors.opacity.white24}),(e=>{let{width:r}=e;return r}),(e=>{let{lineHeight:r}=e;return r}));module.exports=function FontPreview(e){let{title:r,element:j,insertPreset:x,getPosition:S,index:E}=e;const P=l.getHTMLFormatters(),{font:k,fontSize:I,content:_}=j,{fontWeight:U}=y.getTextInlineStyles(_),{actions:{maybeEnqueueFontStyle:F}}=u(),{dataToEditorX:L,dataToEditorY:R}=s.useUnits((e=>({dataToEditorX:e.actions.dataToEditorX,dataToEditorY:e.actions.dataToEditorY}))),{shouldUseSmartColor:A}=g((e=>({shouldUseSmartColor:e.state.shouldUseSmartColor}))),M=d(),{isTextSelected:W,updateSelectedElements:z}=p((e=>{let{state:r,actions:t}=e;return{isTextSelected:y.areAllType("text",r.selectedElements),updateSelectedElements:t.updateSelectedElements}})),H=t.useRef(null);t.useEffect((()=>{F([{font:k,fontWeight:U,content:n.stripHTML(_)}])}),[k,U,_,F]);const O=t.useCallback(((e,r)=>{let{fontWeight:t,isItalic:o,isUnderline:i,letterSpacing:s}=e;return r=P.setFontWeight(r,t),r=P.toggleItalic(r,o),r=P.toggleUnderline(r,i),r=P.setLetterSpacing(r,s)}),[P]),N=t.useCallback((async()=>{if(W)return void z({properties:e=>{const r=O(y.getTextInlineStyles(j.content),e.content),t=c(j,["x","y","content","width"]),o=h({...e,...t});return{...e,...t,...o,content:r}}});let e=j;const t={isPositioned:!1};if(A){const r=S(j);t.isPositioned=!0,e={...j,...r},t.accessibleColors=await M(e)}x(e,t),i.trackEvent("insert_text_preset",{name:r})}),[W,S,j,A,x,r,z,O,M]),B=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{isClone:t}=e;return v.default.createElement(T,C({font:k,fontSize:I,fontWeight:U},e),t?n.stripHTML(_):r)};o.useKeyDownEffect(H,{key:["enter","space"]},N,[N]),m.default({ref:H});const[V,X]=t.useState(!1),Y=()=>X(!0),D=()=>X(!1);return v.default.createElement(b,{ref:H,onPointerEnter:Y,onFocus:Y,onPointerLeave:D,onBlur:D,tabIndex:0===E?0:-1,isTextSelected:W,"aria-label":W?a.sprintf(
/* translators: %s: preset name */
a.__("Apply preset: %s","web-stories"),r):null},B(),V&&!W&&v.default.createElement(q,null),v.default.createElement(f,{cloneElement:w,cloneProps:{children:B({fontSize:R(I),isClone:!0}),width:L(j.width),lineHeight:Math.ceil(R(I))},elementProps:j,type:"text",onClick:N}))};
