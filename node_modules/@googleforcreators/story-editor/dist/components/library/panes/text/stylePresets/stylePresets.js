/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

"use strict";var e=require("react"),r=require("@googleforcreators/design-system"),t=require("@googleforcreators/i18n"),s=require("styled-components"),o=require("@googleforcreators/react"),a=require("@googleforcreators/rich-text");require("@googleforcreators/transform"),require("../../../../dropTargets/provider.js"),require("../../../../dropTargets/context.js"),require("../../../../../app/history/historyProvider.js"),require("../../../../../app/history/context.js"),require("prop-types"),require("@googleforcreators/templates"),require("../../../../../app/config/context.js");var i=require("../../../../../app/config/useConfig.js");require("../../../../../app/api/context.js"),require("@googleforcreators/fonts"),require("@googleforcreators/dom");var l=require("../../../../../constants/index.js");require("../../../../../app/font/context.js"),require("@googleforcreators/media"),require("@googleforcreators/tracking"),require("@googleforcreators/animation"),require("uuid"),require("@googleforcreators/masks"),require("@googleforcreators/element-library"),require("@googleforcreators/elements"),require("../../../../../app/story/context.js"),require("@googleforcreators/migration"),require("../../../../../app/story/actions/useSaveStory.js"),require("clone-deep"),require("../../../../../app/story/useStoryReducer/useStoryReducer.js"),require("@googleforcreators/output"),require("../../../../../app/story/storyTriggers/storyTriggersProvider.js"),require("../../../../../app/story/storyTriggers/storyEvents/onInitialElementAddedRegister.js"),require("../../../../../app/story/storyTriggers/storyEvents/onPageAddedRegister.js");var n=require("../../../../../app/story/useStory.js");require("../../../../../app/media/useUploadMedia.js"),require("@googleforcreators/patterns"),require("../../../../../utils/generateBlurhash.worker.js"),require("../../../../../app/media/media3p/providerConfiguration.js"),require("../../../../../app/media/utils/useFFmpeg.js"),require("../../../../../app/media/media3p/api/context.js"),require("../../../../../app/media/local/constants.js"),require("../../../../../app/media/media3p/providerReducer.js"),require("../../../../../app/media/context.js"),require("sat"),require("@googleforcreators/units"),require("../../../../../app/layout/context.js"),require("../../../../../app/layout/useZoomSetting.js"),require("@googleforcreators/stickers");var u=require("../textPresets.js");require("../../../../../app/canvas/context.js"),require("../../../../../app/currentUser/context.js"),require("../../../../../app/helpCenter/provider.js"),require("../../../../../app/helpCenter/context.js"),require("../../../../helpCenter/constants.js"),require("../../../../../app/rightClickMenu/context.js");var p=require("../../../../../utils/useAddPreset.js"),c=require("../../../../styleManager/styleGroup.js"),d=require("../../../../styleManager/styleManager.js"),g=require("../../../../styleManager/components.js"),y=require("../../../useLibrary.js"),m=require("../../../../../utils/presetUtils.js"),f=require("../../../../styleManager/useApplyStyle.js"),q=require("../../../../design/updateProperties.js"),S=require("../../../../../utils/getUpdatedSizeAndPosition.js"),E=require("../../shared/insertionOverlay.js"),j=require("../../../common/section.js");function T(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var x=T(e),v=T(s);function h(){return h=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])}return e},h.apply(this,arguments)}const _=v.default(j.Container).withConfig({displayName:"stylePresets__SectionContainer",componentId:"sc-bczcw0-0"})(["padding:16px 0;margin-bottom:-24px;border-top:1px solid ",";border-bottom:1px solid ",";"],(e=>{let{theme:r}=e;return r.colors.divider.tertiary}),(e=>{let{theme:r}=e;return r.colors.divider.tertiary})),P=v.default.div.withConfig({displayName:"stylePresets__TitleBar",componentId:"sc-bczcw0-1"})(["display:flex;padding-bottom:16px;justify-content:space-between;align-items:center;"]),b=v.default.div.withConfig({displayName:"stylePresets__StylesWrapper",componentId:"sc-bczcw0-2"})([""]),C=v.default(r.Button).withConfig({displayName:"stylePresets__StyledButton",componentId:"sc-bczcw0-3"})(["margin-left:auto;"]),A=v.default(r.Text).withConfig({displayName:"stylePresets__NoStylesText",componentId:"sc-bczcw0-4"})(["color:",";"],(e=>{let{theme:r}=e;return r.colors.fg.tertiary})),R={x:40};var w=o.memo((function PresetPanel(){const{textStyles:e,isText:s,updateSelectedElements:j}=n((e=>{let{state:r,actions:t}=e;return{isText:Boolean(r.selectedElements&&m.areAllType("text",r.selectedElements)),textStyles:r.story?.globalStoryStyles?.textStyles||[],updateSelectedElements:t.updateSelectedElements}})),{insertElement:T}=y((e=>({insertElement:e.actions.insertElement}))),{setColor:v,setFontWeight:w,setLetterSpacing:I,toggleItalic:N,toggleUnderline:L}=a.getHTMLFormatters(),M=o.useRef(null),O=o.useRef(null),[U,k]=o.useState(!1),{isRTL:z,styleConstants:{topOffset:B}={}}=i(),Y=e.length>0,F=o.useCallback((e=>{j({properties:r=>{const t=q(r,e,!0),s=S({...r,...t});return{...t,...s}}})}),[j]),H=f({pushUpdate:F}),{addGlobalPreset:G}=p({presetType:l.PRESET_TYPES.STYLE}),W=e=>{s?H(e):((e=>{const{color:r,fontWeight:t,isItalic:s,isUnderline:o,letterSpacing:a}=e;let i=u.DEFAULT_PRESET.content;i=v(i,r),i=w(i,t),i=N(i,s),i=L(i,o),i=I(i,a),T("text",{...u.DEFAULT_PRESET,...e,content:i})})(e),k(!1))},Z=s?{}:{activeItemOverlay:x.default.createElement(E,null),applyLabel:t.__("Add new text","web-stories")};return x.default.createElement(_,null,x.default.createElement(P,null,x.default.createElement(r.Headline,{as:"h2",size:r.THEME_CONSTANTS.TYPOGRAPHY.PRESET_SIZES.XXX_SMALL},t.__("Saved Styles","web-stories")),x.default.createElement(C,{type:r.BUTTON_TYPES.TERTIARY,size:r.BUTTON_SIZES.SMALL,variant:r.BUTTON_VARIANTS.SQUARE,onClick:G,"aria-label":t.__("Add style","web-stories"),disabled:!s},x.default.createElement(r.Icons.Plus,null))),Y&&x.default.createElement(x.default.Fragment,null,x.default.createElement(b,{ref:O},x.default.createElement(c,h({styles:[...e].reverse().slice(0,2),handleClick:W,buttonWidth:150},Z))),x.default.createElement(g.MoreButton,{ref:M,onClick:()=>k(!0),"aria-haspopup":"dialog","aria-expanded":U},t.__("More styles","web-stories"),x.default.createElement(r.Icons.ChevronDownSmall,null)),x.default.createElement(r.Popup,{topOffset:B,isRTL:z,anchor:M,isOpen:U,placement:r.PLACEMENT.RIGHT_START,spacing:R,renderContents:()=>x.default.createElement(d,h({styles:e,applyStyle:W,onClose:()=>k(!1)},Z))})),!Y&&x.default.createElement(g.NoStylesWrapper,null,x.default.createElement(A,{size:r.THEME_CONSTANTS.TYPOGRAPHY.PRESET_SIZES.SMALL},t.__("No Styles Saved","web-stories"))))}));module.exports=w;
