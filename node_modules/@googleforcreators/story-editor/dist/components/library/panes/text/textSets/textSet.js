/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

"use strict";var e=require("react"),r=require("styled-components");require("prop-types");var t=require("@googleforcreators/tracking"),o=require("@googleforcreators/react"),i=require("@googleforcreators/units"),a=require("@googleforcreators/design-system"),s=require("../../../../../app/layout/useLayout.js");require("../../../../../app/layout/context.js"),require("../../../../../app/layout/useZoomSetting.js");var n=require("../../../../../constants/index.js"),u=require("../../../useLibrary.js"),l=require("../../shared/libraryMoveable.js");require("@googleforcreators/transform"),require("../../../../dropTargets/provider.js"),require("../../../../dropTargets/context.js"),require("../../../../../app/history/historyProvider.js"),require("../../../../../app/history/context.js"),require("@googleforcreators/templates"),require("../../../../../app/config/context.js");var p=require("../../../../../app/config/useConfig.js");require("../../../../../app/api/context.js"),require("@googleforcreators/fonts"),require("@googleforcreators/dom"),require("../../../../../app/font/context.js"),require("@googleforcreators/media"),require("@googleforcreators/animation"),require("uuid"),require("@googleforcreators/masks"),require("@googleforcreators/element-library"),require("@googleforcreators/elements"),require("../../../../../app/story/context.js"),require("@googleforcreators/migration"),require("../../../../../app/story/actions/useSaveStory.js"),require("clone-deep"),require("../../../../../app/story/useStoryReducer/useStoryReducer.js"),require("@googleforcreators/output"),require("../../../../../app/story/storyTriggers/storyTriggersProvider.js"),require("../../../../../app/story/storyTriggers/storyEvents/onInitialElementAddedRegister.js"),require("../../../../../app/story/storyTriggers/storyEvents/onPageAddedRegister.js"),require("@googleforcreators/i18n"),require("../../../../../app/media/useUploadMedia.js"),require("@googleforcreators/patterns"),require("../../../../../utils/generateBlurhash.worker.js"),require("../../../../../app/media/media3p/providerConfiguration.js"),require("../../../../../app/media/utils/useFFmpeg.js"),require("../../../../../app/media/media3p/api/context.js"),require("../../../../../app/media/local/constants.js"),require("../../../../../app/media/media3p/providerReducer.js"),require("../../../../../app/media/context.js"),require("sat"),require("@googleforcreators/rich-text"),require("@googleforcreators/stickers"),require("../textPresets.js"),require("../../../../../app/canvas/context.js"),require("../../../../../app/currentUser/context.js"),require("../../../../../app/helpCenter/provider.js"),require("../../../../../app/helpCenter/context.js"),require("../../../../helpCenter/constants.js"),require("../../../../../app/rightClickMenu/context.js");var c=require("../../shared/insertionOverlay.js"),d=require("../../../../../utils/useRovingTabIndex/index.js"),g=require("./textSetElements.js");function q(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var f=q(e),m=q(r);function h(){return h=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e},h.apply(this,arguments)}const x=m.default.button.withConfig({displayName:"textSet__TextSetItem",componentId:"sc-1hor9ow-0"})(["border:0;background:none;position:absolute;top:0;height:","px;width:","px;display:flex;align-items:center;justify-content:center;flex-direction:column;transform:",";background-color:",";border-radius:",";cursor:pointer;transition:background-color ",";outline:none;&."," [role='presentation'],&[data-focus-visible-added] [role='presentation']{",";}"],n.TEXT_SET_SIZE,n.TEXT_SET_SIZE,(e=>{let{translateX:r,translateY:t}=e;return`translateX(${r}px) translateY(${t}px)`}),(e=>{let{theme:r}=e;return r.colors.interactiveBg.secondaryNormal}),(e=>{let{theme:r}=e;return r.borders.radius.small}),a.BUTTON_TRANSITION_TIMING,a.ThemeGlobals.FOCUS_VISIBLE_SELECTOR,(e=>{let{theme:r}=e;return a.themeHelpers.focusCSS(r.colors.border.focus,r.colors.bg.secondary)})),y=m.default.img.withConfig({displayName:"textSet__TextSetImg",componentId:"sc-1hor9ow-1"})(["width:","px;height:","px;"],n.TEXT_SET_SIZE,n.TEXT_SET_SIZE),S=m.default.div.withConfig({displayName:"textSet__DragContainer",componentId:"sc-1hor9ow-2"})(["position:absolute;opacity:0;width:","px;height:","px;background-color:",";"],(e=>{let{width:r}=e;return r}),(e=>{let{height:r}=e;return r}),(e=>{let{theme:r}=e;return r.colors.opacity.white24}));function TextSet(e,r){let{id:a,elements:n,translateY:q,translateX:m,isActive:E,index:j,...T}=e;const{insertTextSet:v}=u((e=>({insertTextSet:e.actions.insertTextSet}))),{cdnURL:I}=p(),{pageWidth:_,pageHeight:b}=s((e=>{let{state:{pageWidth:r,pageHeight:t}}=e;return{pageWidth:r,pageHeight:t}})),w=o.useCallback((()=>{v(n),t.trackEvent("insert_textset")}),[n,v]),C=o.useCallback((e=>{let{code:r}=e;"Enter"!==r&&"Space"!==r||w()}),[w]),R="undefined"==typeof WEB_STORIES_DISABLE_OPTIMIZED_RENDERING||"true"!==WEB_STORIES_DISABLE_OPTIMIZED_RENDERING;d.default({ref:r.current});const[k,N]=o.useState(!1),{textSetHeight:O,textSetWidth:P}=n[0],X=i.dataToEditorX(P,_),B=i.dataToEditorY(O,b);return f.default.createElement(x,h({translateX:m,translateY:q,ref:r,onKeyUp:C,onPointerEnter:()=>N(!0),onPointerLeave:()=>N(!1),tabIndex:0===j?0:-1},T),R?f.default.createElement(y,{src:`${I}images/text-sets/${a}.png`,alt:"",crossOrigin:"anonymous",decoding:"async"}):f.default.createElement(g,{isForDisplay:!0,elements:n}),(E||k)&&f.default.createElement(c,null),f.default.createElement(l,{type:"textSet",elements:n,elementProps:{},onClick:w,cloneElement:S,cloneProps:{width:X,height:B,children:f.default.createElement(g,{elements:n,pageSize:{width:_,height:b}})}}))}const E=o.forwardRef(TextSet);TextSet.displayName="TextSet",module.exports=E;
