/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

"use strict";var e=require("react"),t=require("@googleforcreators/react");require("prop-types");var s=require("styled-components"),r=require("uuid"),a=require("@googleforcreators/tracking"),l=require("@googleforcreators/i18n"),n=require("@googleforcreators/design-system"),o=require("../../common/styles.js");require("../../shared/index.js");var i=require("../../../useLibrary.js"),u=require("../../../../../app/story/useStory.js"),c=require("../../../../../utils/getInUseFonts.js"),d=require("../../../common/section.js"),S=require("../../shared/virtualizedPanelGrid/components.js");require("../../../../../app/config/context.js");var T=require("../../../../emptyContentMessage.js"),m=require("./textSets.js"),f=require("./constants.js"),E=require("../../shared/chipGroup/index.js");function _(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var g=_(e),p=_(s);const x=p.default.div.withConfig({displayName:"textSetsPane__TitleBar",componentId:"sc-vycaev-0"})(["display:flex;justify-content:space-between;padding:20px 0;"]),y=p.default.div.withConfig({displayName:"textSetsPane__TextSetsToggle",componentId:"sc-vycaev-1"})(["display:flex;label{cursor:pointer;margin:auto 12px;color:",";}"],(e=>{let{theme:t}=e;return t.colors.fg.secondary})),h=p.default.div.withConfig({displayName:"textSetsPane__TextSetsWrapper",componentId:"sc-vycaev-2"})(["",";"],S.virtualPaneContainer);module.exports=function TextSetsPane(e){let{paneRef:s}=e;const{areTextSetsLoading:S,textSets:_}=i((e=>{let{state:{areTextSetsLoading:t,textSets:s}}=e;return{areTextSetsLoading:t,textSets:s}})),[p,v]=t.useState(!1),b=t.useRef(!1),I=t.useMemo((()=>Object.values(_).flat()),[_]),C=u((e=>{let{state:{pages:t}}=e;return t})),[q,A]=t.useState(n.localStore.getItemByKey(`${n.LOCAL_STORAGE_PREFIX.TEXT_SET_SETTINGS}`)?.selectedCategory),L=t.useCallback((()=>c.getTextSetsForFonts({fonts:c.getInUseFontsForPages(C),textSets:q?_[q]:I})),[I,C,q,_]),P=t.useCallback((function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.map((e=>{let{textSetFonts:t=[],textSetCategory:s,elements:r,id:a}=e;return{id:a,title:l.sprintf(
/* translators: 1: text set category. 2: list of fonts. */
l._n("Text set %1$s with %2$s font","Text set %1$s with %2$s fonts",t.length,"web-stories"),f.CATEGORIES[s],l.translateToInclusiveList(t)),elements:r}}))}),[]),j=t.useMemo((()=>P(p?L():q?_?.[q]:I)),[q,_,I,P,L,p]),w=t.useMemo((()=>[{id:null,label:l._x("All","text sets","web-stories")},...Object.keys(_).map((e=>({id:e,label:f.CATEGORIES[e]??e})))]),[_]),R=n.useLiveRegion(),N=t.useCallback((e=>{A(e),R(null===e?l.__("Show all text sets","web-stories"):l.sprintf(
/* translators: %s: filter category name */
l.__("Selected text set filter %s","web-stories"),f.CATEGORIES[e])),n.localStore.setItemByKey(`${n.LOCAL_STORAGE_PREFIX.TEXT_SET_SETTINGS}`,{selectedCategory:e}),b.current=!0}),[R]),O=t.useCallback((()=>{requestAnimationFrame((()=>v((e=>!e)))),b.current=!0}),[v]);t.useEffect((()=>{b.current&&a.trackEvent("search",{search_type:"textsets",search_term:"",search_category:q,search_filter:p?"show_in_use":void 0})}),[q,p]);const F=t.useMemo((()=>`section-${r.v4()}`),[]),G=t.useMemo((()=>`toggle_text_sets_${r.v4()}`),[]),M=t.useMemo((()=>p?l.__("No matching Text Sets available. Try adding text to your story.","web-stories"):l.__("No Text Sets available.","web-stories")),[p]);return g.default.createElement(d.Container,{id:F},g.default.createElement(x,null,g.default.createElement(n.Headline,{as:"h2",size:n.THEME_CONSTANTS.TYPOGRAPHY.PRESET_SIZES.XXX_SMALL},f.PANE_TEXT.TITLE),g.default.createElement(y,null,g.default.createElement(n.Text,{as:"label",htmlFor:G,size:n.THEME_CONSTANTS.TYPOGRAPHY.PRESET_SIZES.SMALL},f.PANE_TEXT.SWITCH_LABEL),g.default.createElement(n.Toggle,{id:G,"aria-label":f.PANE_TEXT.SWITCH_LABEL,name:G,checked:p,onChange:O}))),g.default.createElement(o.FullWidthWrapper,null,g.default.createElement(E,{items:w,selectedItemId:q,selectItem:N,deselectItem:()=>N(null),ariaLabel:l.__("Select filter for text sets list","web-stories")})),g.default.createElement(h,null,j?.length||S?g.default.createElement(m,{paneRef:s,filteredTextSets:j}):g.default.createElement(T,null,M)))};
