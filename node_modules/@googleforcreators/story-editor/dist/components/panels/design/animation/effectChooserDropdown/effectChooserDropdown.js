/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

"use strict";var e=require("react"),t=require("@googleforcreators/react");require("prop-types");var r=require("@googleforcreators/i18n"),o=require("flagged"),i=require("styled-components"),n=require("@googleforcreators/design-system"),s=require("../../../shared/styles.js"),a=require("./dropdownConstants.js");require("./types.js");var c=require("./utils/getDisabledBackgroundEffects.js"),l=require("./utils/generateDynamicProps.js"),u=require("./styles.js"),f=require("./dropdownItem.js");function d(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var p=d(e);const m=t.forwardRef((function EffectChooserDropdown(e,d){let{onAnimationSelected:m,onNoEffectSelected:O,isBackgroundEffects:y=!1,selectedEffectType:D,disabledTypeOptionsMap:E,direction:v,selectButtonStylesOverride:g}=e;const{enableExperimentalAnimationEffects:b}=o.useFeatures(),q=t.useMemo((()=>a.getDirectionalEffect(D,v)),[D,v]),M=t.useMemo((()=>y&&c(a.backgroundEffectOptions,E)),[E,y]),I=y?n.PLACEMENT.BOTTOM:n.PLACEMENT.TOP,j=y?a.backgroundEffectOptions:a.foregroundEffectOptions,A=t.useMemo((()=>b?Object.values(j):Object.values(j).filter((e=>{let{value:t}=e;return-1===a.experimentalEffects.indexOf(t)}))),[j,b]),N=t.useMemo((()=>A?.map((e=>{const t=y&&M.includes(e.value);return{...e,disabled:t,tooltip:t&&E[e.animation?.value]?.tooltip}}))),[A,y,M,E]),T=t.useCallback(((e,t)=>{if(e.preventDefault(),t===a.NO_ANIMATION)return void(Boolean(q)&&O());const r=j[t]?.animation,o=l({animation:r,disabledTypeOptionsMap:E});m({animation:o.value,panDir:o?.panDirection,zoomDirection:o?.zoomDirection,flyInDir:o?.flyInDirection,rotateInDir:o?.rotateInDirection,whooshInDir:o?.whooshInDirection,scaleDirection:o?.scaleDirection})}),[j,E,m,q,O]),w=q&&q!==a.NO_ANIMATION?u.styleOverrideForSelectButton:s.focusStyle,h=i.css([""," ",""],w,void 0!==g&&g);return p.default.createElement(n.DropDown,{ref:d,options:N,placeholder:r._x("None","animation effect","web-stories"),selectedValue:q,ariaLabel:r.__("Animation: Effect Chooser","web-stories"),menuStylesOverride:u.styleOverrideForAnimationEffectMenu,renderItem:f,onMenuItemClick:T,placement:I,isKeepMenuOpenOnSelection:!0,selectButtonStylesOverride:h})}));module.exports=m;
