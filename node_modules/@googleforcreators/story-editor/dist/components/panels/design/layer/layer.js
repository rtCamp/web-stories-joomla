/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

"use strict";var e=require("react"),r=require("styled-components"),t=require("polished"),o=require("@googleforcreators/i18n"),a=require("@googleforcreators/design-system"),i=require("@googleforcreators/react"),n=require("@googleforcreators/elements"),l=require("@googleforcreators/element-library");require("../../../../types.js"),require("@googleforcreators/transform"),require("../../../dropTargets/provider.js"),require("../../../dropTargets/context.js"),require("../../../../app/history/historyProvider.js"),require("../../../../app/history/context.js"),require("prop-types"),require("@googleforcreators/templates"),require("../../../../app/config/context.js"),require("../../../../app/api/context.js"),require("@googleforcreators/fonts"),require("@googleforcreators/dom"),require("../../../../constants/fonts.js"),require("../../../../constants/multipleValue.js");var s=require("../../../../constants/performanceTrackingEvents.js");require("../../../../app/font/context.js"),require("@googleforcreators/media"),require("@googleforcreators/tracking"),require("@googleforcreators/animation"),require("uuid"),require("@googleforcreators/masks"),require("../../../../app/story/context.js"),require("@googleforcreators/migration"),require("../../../../app/story/actions/useSaveStory.js"),require("clone-deep"),require("../../../../app/story/useStoryReducer/useStoryReducer.js"),require("@googleforcreators/output"),require("../../../../app/story/storyTriggers/storyTriggersProvider.js"),require("../../../../app/story/storyTriggers/storyEvents/onInitialElementAddedRegister.js"),require("../../../../app/story/storyTriggers/storyEvents/onPageAddedRegister.js");var c=require("../../../../app/story/useStory.js");require("../../../../app/media/useUploadMedia.js"),require("@googleforcreators/patterns");var u=require("../../../../utils/useCORSProxy.js");require("../../../../utils/generateBlurhash.worker.js"),require("../../../../app/media/media3p/providerConfiguration.js"),require("../../../../app/media/utils/useFFmpeg.js"),require("../../../../app/media/media3p/api/context.js"),require("../../../../app/media/local/constants.js"),require("../../../../app/media/media3p/providerReducer.js"),require("../../../../app/media/context.js"),require("sat"),require("@googleforcreators/units"),require("../../../../app/layout/context.js"),require("../../../../app/layout/useZoomSetting.js"),require("@googleforcreators/rich-text"),require("@googleforcreators/stickers"),require("../../../library/panes/text/textPresets.js"),require("../../../../app/canvas/context.js"),require("../../../../app/currentUser/context.js"),require("../../../../app/helpCenter/provider.js"),require("../../../../app/helpCenter/context.js"),require("../../../helpCenter/constants.js"),require("../../../../app/rightClickMenu/context.js");var d=require("../../../../utils/usePerformanceTracking.js"),p=require("./useLayerSelection.js"),g=require("./constants.js");function f(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var m=f(e),y=f(r);const h=y.default.div.withConfig({displayName:"layer__ActionsContainer",componentId:"sc-aphr0z-0"})(["position:absolute;display:none;align-items:center;height:100%;top:0;right:0;padding-right:6px;column-gap:6px;--background-color:",";--background-color-opaque:",";background-color:var(--background-color);::before{position:absolute;content:'';width:32px;height:100%;top:0;left:0;transform:translateX(-100%);background:linear-gradient( to right,var(--background-color-opaque),var(--background-color) );pointer-events:none;}"],(e=>{let{theme:r}=e;return r.colors.bg.secondary}),(e=>{let{theme:r}=e;return t.rgba(r.colors.bg.secondary,0)})),v=y.default.div.attrs({"data-testid":"layer-option"}).withConfig({displayName:"layer__LayerContainer",componentId:"sc-aphr0z-1"})(["position:relative;height:","px;width:100%;overflow:hidden;:is(:hover,:focus-within) ","{display:inline-flex;}"],g.LAYER_HEIGHT,h),q=y.default(a.Button).attrs({type:a.BUTTON_TYPES.PLAIN,tabIndex:-1,role:"option"}).withConfig({displayName:"layer__LayerButton",componentId:"sc-aphr0z-2"})(["position:relative;display:grid;grid-template-columns:36px 1fr;border:0;padding:0;background:transparent;height:100%;width:100%;overflow:hidden;align-items:center;user-select:none;border-radius:0;padding-left:12px;transition:revert;"," :hover{background:",";}:hover + *{--background-color:",";--background-color-opaque:",";}:active{background:",";}:active + *{--background-color:",";--background-color-opaque:",";}"],(e=>{let{isSelected:o,theme:a}=e;return o&&r.css(["background:",";+ *{--background-color:",";--background-color-opaque:",";--selected-hover-color:",";}"],a.colors.interactiveBg.tertiaryPress,a.colors.interactiveBg.tertiaryPress,t.rgba(a.colors.interactiveBg.tertiaryPress,0),a.colors.interactiveBg.tertiaryHover)}),(e=>{let{theme:r}=e;return r.colors.interactiveBg.tertiaryHover}),(e=>{let{theme:r}=e;return r.colors.interactiveBg.tertiaryHover}),(e=>{let{theme:r}=e;return t.rgba(r.colors.interactiveBg.tertiaryHover,0)}),(e=>{let{theme:r}=e;return r.colors.interactiveBg.tertiaryPress}),(e=>{let{theme:r}=e;return r.colors.interactiveBg.tertiaryPress}),(e=>{let{theme:r}=e;return t.rgba(r.colors.interactiveBg.tertiaryPress,0)})),b=y.default.div.withConfig({displayName:"layer__LayerIconWrapper",componentId:"sc-aphr0z-3"})(["display:flex;align-items:center;justify-content:flex-start;color:",";"],(e=>{let{theme:r}=e;return r.colors.fg.primary})),E=y.default.div.withConfig({displayName:"layer__LayerDescription",componentId:"sc-aphr0z-4"})(["position:relative;width:100%;overflow:hidden;display:flex;align-items:center;margin-left:0;text-align:left;color:",";"],(e=>{let{theme:r}=e;return r.colors.fg.primary})),k=y.default.div.withConfig({displayName:"layer__IconWrapper",componentId:"sc-aphr0z-5"})(["display:flex;align-items:center;justify-content:flex-start;position:absolute;right:0;width:32px;aspect-ratio:1;svg{position:relative;display:block;width:100%;color:",";}"],(e=>{let{theme:r}=e;return r.colors.fg.secondary})),j=y.default.div.withConfig({displayName:"layer__LayerContentContainer",componentId:"sc-aphr0z-6"})(["margin-right:8px;text-overflow:ellipsis;white-space:nowrap;overflow:hidden;"]),x=y.default(a.Button).attrs({type:a.BUTTON_TYPES.PLAIN,tabIndex:-1}).withConfig({displayName:"layer__LayerAction",componentId:"sc-aphr0z-7"})(["position:relative;aspect-ratio:1;width:20px;padding:0;svg{position:absolute;width:32px;height:auto;top:50%;left:50%;transform:translate(-50%,-50%);}&&{transition:revert;background:var(--background-color);}:disabled{color:",";}:hover{color:var( --selected-hover-color,"," );}& + &{margin-left:4px;}*{pointer-events:none;}:focus{","}"],(e=>{let{theme:r}=e;return r.colors.fg.secondary}),(e=>{let{theme:r}=e;return r.colors.fg.secondary}),(e=>{let{theme:r}=e;return a.themeHelpers.focusCSS(r.colors.border.focus,"var(--background-color)")}));function _(e){e.stopPropagation(),e.preventDefault()}var w=i.memo((function Layer(e){let{element:r}=e;const{LayerIcon:t,LayerContent:g}=n.getDefinitionForType(r.type),{isSelected:f,handleClick:y}=p(r),{isDefaultBackground:w}=r,{duplicateElementsById:C,deleteElementById:I,currentPageBackgroundColor:B}=c((e=>{let{actions:r,state:t}=e;return{duplicateElementsById:r.duplicateElementsById,deleteElementById:r.deleteElementById,currentPageBackgroundColor:!w||t.currentPage?.backgroundColor}})),{getProxiedUrl:T}=u(),P=i.useRef(null);d({node:P.current,eventData:{...s.TRACKING_EVENTS.SELECT_ELEMENT,label:r.type}});const L=i.useRef(null);d({node:L.current,eventData:{...s.TRACKING_EVENTS.DELETE_ELEMENT,label:r.type}});const N=`layer-${r.id}`;return m.default.createElement(v,null,m.default.createElement(q,{ref:P,id:N,onClick:y,isSelected:f},m.default.createElement(b,null,m.default.createElement(t,{element:r,getProxiedUrl:T,currentPageBackgroundColor:B})),m.default.createElement(E,null,m.default.createElement(j,null,r.isBackground?m.default.createElement(l.LayerText,null,o.__("Background","web-stories")):m.default.createElement(g,{element:r})),r.isBackground&&m.default.createElement(k,null,m.default.createElement(a.Icons.LockClosed,null)))),m.default.createElement(h,null,r.isBackground?m.default.createElement(x,{"aria-label":o.__("Locked","web-stories"),"aria-describedby":N,disabled:!0},m.default.createElement(a.Icons.LockClosed,null)):m.default.createElement(m.default.Fragment,null,m.default.createElement(a.Tooltip,{title:o.__("Delete Layer","web-stories"),hasTail:!0,isDelayed:!0},m.default.createElement(x,{ref:L,"aria-label":o.__("Delete","web-stories"),"aria-describedby":N,onPointerDown:_,onClick:()=>I({elementId:r.id})},m.default.createElement(a.Icons.Trash,null))),m.default.createElement(a.Tooltip,{title:o.__("Duplicate Layer","web-stories"),hasTail:!0,isDelayed:!0},m.default.createElement(x,{"aria-label":o.__("Duplicate","web-stories"),"aria-describedby":N,onPointerDown:_,onClick:()=>C({elementIds:[r.id]})},m.default.createElement(a.Icons.PagePlus,null))))))}));module.exports=w;
