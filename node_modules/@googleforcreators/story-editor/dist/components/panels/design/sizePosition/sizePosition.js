/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

"use strict";var e=require("react");require("prop-types");var t=require("styled-components"),r=require("@googleforcreators/react"),i=require("@googleforcreators/i18n"),a=require("@googleforcreators/stickers"),n=require("@googleforcreators/units"),l=require("@googleforcreators/design-system"),o=require("@googleforcreators/elements");require("../../panel/panel.js"),require("../../panel/context.js"),require("../../panel/shared/title.js"),require("../../panel/shared/content.js");var s=require("../../panel/simplePanel.js"),c=require("../../shared/flipControls.js"),u=require("../../shared/styles.js");require("../../shared/linkRelations.js");var d=require("../../shared/getCommonValue.js");require("@googleforcreators/patterns"),require("../../../../constants/fonts.js");var m=require("../../../../constants/multipleValue.js"),p=require("../../../../constants/performanceTrackingEvents.js"),f=require("../../shared/useCommonObjectValue.js"),g=require("../../../../app/story/useStory.js"),_=require("../../../../utils/usePerformanceTracking.js"),E=require("./usePresubmitHandlers.js"),h=require("./utils.js"),b=require("./constants.js"),y=require("./opacity.js"),I=require("./radius.js");function M(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var x=M(e),A=M(t),w=M(a);function N(){return N=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},N.apply(this,arguments)}const L=A.default(l.LockToggle).withConfig({displayName:"sizePosition__StyledLockToggle",componentId:"sc-7rw4xb-0"})(["",";"],u.focusStyle);function T(e){return w.default?.[e?.sticker?.type].aspectRatio||1}const v=t.css(["grid-template-areas:"," 'x . . . y . .' 'w . d . h . l' 'r . . . o . .' 'c c c c c c c';"],(e=>{let{isSingleMedia:t}=e;return t?"'b b b b b . .'":null})),S=t.css(["grid-template-areas:"," 'x . . . y . .' 'w . d . h . l' 'r . . . f . .' ",";"],(e=>{let{isSingleMedia:t}=e;return t?"'b b b b b . .'":null}),(e=>{let{unlockedRadius:t}=e;return t?"\n  'o . . . . . .'\n  'c c c c c c c'\n":"'o . . . c c c'"})),P=A.default.div.withConfig({displayName:"sizePosition__Grid",componentId:"sc-7rw4xb-1"})(["display:grid;"," grid-template-columns:1fr 4px 8px 4px 1fr 8px 32px;grid-template-rows:repeat(4,36px);row-gap:16px;align-items:center;justify-items:start;margin-bottom:16px;"],(e=>{let{canFlip:t}=e;return t?S:v})),q=A.default.div.withConfig({displayName:"sizePosition__Area",componentId:"sc-7rw4xb-2"})(["grid-area:",";width:100%;"],(e=>{let{area:t}=e;return t})),j=A.default.div.withConfig({displayName:"sizePosition__Dash",componentId:"sc-7rw4xb-3"})(["height:1px;width:100%;background:",";"],(e=>{let{theme:t}=e;return t.colors.divider.primary})),k=A.default(l.Button).withConfig({displayName:"sizePosition__StyledButton",componentId:"sc-7rw4xb-4"})(["padding:10px 16px;width:100%;",";"],u.focusStyle);module.exports=function SizePositionPanel(e){const{selectedElements:t,submittedSelectedElements:a,pushUpdate:M,pushUpdateForObject:A}=e,w=d(t,"x"),v=d(t,"y"),S=d(t,"width"),C=d(t,"height"),O=d(t,"rotationAngle"),X=f(t,"flip",b.DEFAULT_FLIP),U=f(t,"borderRadius",{locked:!0}),R=r.useMemo((()=>d(a,"width")/d(a,"height")),[a]),D=d(t,"lockAspectRatio"),Y=r.useRef(null);_({node:Y.current,eventData:p.TRACKING_EVENTS.SET_BACKGROUND_MEDIA});const V=D===m.MULTIPLE_VALUE||D,{currentPage:F,combineElements:H}=g((e=>({currentPage:e.state.currentPage,combineElements:e.actions.combineElements}))),z=F?.elements[0].id,B=1===t.length,{isMedia:G}=o.getDefinitionForType(t[0].type),W=t.every((e=>{let{type:t}=e;return o.getDefinitionForType(t).canFlip})),K=t.some((e=>{let{type:t}=e;return o.getDefinitionForType(t).isAspectAlwaysLocked})),Z=t.some((e=>{let{type:t}=e;return"text"===t})),J=r.useMemo((()=>B?n.calcRotatedObjectPositionAndSize(O,w,v,S,C):{}),[O,w,v,S,C,B]),Q=w-J.x,$=v-J.y,ee=B?{minX:b.MIN_MAX.X.MIN+Q-J.width,minY:b.MIN_MAX.Y.MIN+$-J.height,maxX:b.MIN_MAX.X.MAX+Q,maxY:b.MIN_MAX.Y.MAX+$}:h.getMultiSelectionMinMaxXY(t),te=(e,t)=>D===m.MULTIPLE_VALUE?{lockAspectRatio:V,height:t,width:e}:{height:t,width:e};E(V,C,S);const re=r.useCallback((()=>{H({firstElement:t[0],secondId:z})}),[t,H,z]),ie=!V&&Z,ae=m.MULTIPLE_VALUE===C?m.MULTIPLE_DISPLAY_VALUE:null,ne=ie?i.__("Auto","web-stories"):ae,le=r.useCallback((e=>({isIndeterminate:m.MULTIPLE_VALUE===e,placeholder:m.MULTIPLE_VALUE===e?m.MULTIPLE_DISPLAY_VALUE:null})),[]);return x.default.createElement(s,{name:"size",title:i.__("Selection","web-stories")},x.default.createElement(P,{isSingleMedia:G&&B,canFlip:W,unlockedRadius:!U.locked},G&&B&&x.default.createElement(q,{area:"b"},x.default.createElement(k,{ref:Y,onClick:re,type:l.BUTTON_TYPES.SECONDARY,size:l.BUTTON_SIZES.SMALL,variant:l.BUTTON_VARIANTS.RECTANGLE},i.__("Set as background","web-stories"))),x.default.createElement(q,{area:"x"},x.default.createElement(l.NumericInput,N({suffix:i._x("X","Position on X axis","web-stories"),value:w,min:ee.minX,max:ee.maxX,onChange:(e,t)=>M({x:t},!0),"aria-label":i.__("X position","web-stories"),canBeNegative:!0},le(w),{containerStyleOverride:u.inputContainerStyleOverride}))),x.default.createElement(q,{area:"y"},x.default.createElement(l.NumericInput,N({suffix:i._x("Y","Position on Y axis","web-stories"),value:v,min:ee.minY,max:ee.maxY,onChange:(e,t)=>M({y:t},!0),"aria-label":i.__("Y position","web-stories"),canBeNegative:!0},le(v),{containerStyleOverride:u.inputContainerStyleOverride}))),x.default.createElement(q,{area:"w"},x.default.createElement(l.NumericInput,N({suffix:i._x("W","The Width dimension","web-stories"),value:S,min:b.MIN_MAX.WIDTH.MIN,max:b.MIN_MAX.WIDTH.MAX,onChange:(e,t)=>{const r=t;let i=C;V&&(""===r?i="":h.isNum(r/R)&&(i=n.dataPixels(r/R))),M((e=>{if("sticker"===e?.type){const t=T(e);return te(r,Math.floor(r/t))}return te(r,i)}),!0)},"aria-label":i.__("Width","web-stories")},le(S),{containerStyleOverride:u.inputContainerStyleOverride}))),x.default.createElement(q,{area:"d"},x.default.createElement(j,null)),x.default.createElement(q,{area:"h"},x.default.createElement(l.NumericInput,{suffix:i._x("H","The Height dimension","web-stories"),value:ie?"":C,disabled:ie,min:b.MIN_MAX.HEIGHT.MIN,max:b.MIN_MAX.HEIGHT.MAX,onChange:(e,t)=>{const r=t;let i=S;V&&(""===r?i="":h.isNum(r*R)&&(i=n.dataPixels(r*R))),M((e=>{if("sticker"===e?.type){const t=T(e);return te(Math.floor(r*t),r)}return te(i,r)}),!0)},"aria-label":i.__("Height","web-stories"),isIndeterminate:m.MULTIPLE_VALUE===C,placeholder:ne,containerStyleOverride:u.inputContainerStyleOverride})),x.default.createElement(q,{area:"l"},x.default.createElement(l.Tooltip,{title:i.__("Lock aspect ratio","web-stories")},x.default.createElement(L,{"aria-label":i.__("Lock aspect ratio","web-stories"),title:i.__("Lock aspect ratio","web-stories"),isLocked:V||K,disabled:K,onClick:()=>!K&&M({lockAspectRatio:!V},!0)}))),x.default.createElement(q,{area:"r"},x.default.createElement(l.NumericInput,N({suffix:x.default.createElement(l.Icons.Angle,null),unit:i._x("Â°","Degrees, 0 - 360.","web-stories"),value:O,min:b.MIN_MAX.ROTATION.MIN,max:b.MIN_MAX.ROTATION.MAX,onChange:(e,t)=>M({rotationAngle:t},!0),"aria-label":i.__("Rotation","web-stories"),canBeNegative:!0},le(O),{containerStyleOverride:u.inputContainerStyleOverride}))),W&&x.default.createElement(q,{area:"f"},x.default.createElement(c,{onChange:e=>A("flip",e,b.DEFAULT_FLIP,!0),value:X})),x.default.createElement(q,{area:"o"},x.default.createElement(y.default,e)),x.default.createElement(q,{area:"c"},x.default.createElement(I.default,e))))};
