/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

"use strict";var e=require("react");require("prop-types");var r=require("styled-components"),t=require("@googleforcreators/design-system"),o=require("@googleforcreators/i18n"),a=require("@googleforcreators/react"),i=require("@googleforcreators/media"),s=require("uuid");require("@googleforcreators/elements"),require("@googleforcreators/transform"),require("../../dropTargets/provider.js"),require("../../dropTargets/context.js"),require("../../../app/history/historyProvider.js"),require("../../../app/history/context.js"),require("@googleforcreators/templates"),require("../../../app/config/context.js");var l=require("../../../app/config/useConfig.js");require("../../../app/api/context.js"),require("@googleforcreators/fonts"),require("@googleforcreators/dom"),require("../../../constants/fonts.js"),require("../../../constants/multipleValue.js"),require("../../../app/font/context.js"),require("@googleforcreators/tracking"),require("@googleforcreators/animation"),require("@googleforcreators/masks"),require("@googleforcreators/element-library"),require("../../../app/story/context.js"),require("@googleforcreators/migration"),require("../../../app/story/actions/useSaveStory.js"),require("clone-deep"),require("../../../app/story/useStoryReducer/useStoryReducer.js"),require("@googleforcreators/output"),require("../../../app/story/storyTriggers/storyTriggersProvider.js"),require("../../../app/story/storyTriggers/storyEvents/onInitialElementAddedRegister.js"),require("../../../app/story/storyTriggers/storyEvents/onPageAddedRegister.js"),require("../../../app/media/useUploadMedia.js"),require("@googleforcreators/patterns"),require("../../../utils/generateBlurhash.worker.js"),require("../../../app/media/media3p/providerConfiguration.js"),require("../../../app/media/utils/useFFmpeg.js"),require("../../../app/media/media3p/api/context.js"),require("../../../app/media/local/constants.js"),require("../../../app/media/media3p/providerReducer.js"),require("../../../app/media/context.js"),require("sat"),require("@googleforcreators/units"),require("../../../app/layout/context.js"),require("../../../app/layout/useZoomSetting.js"),require("@googleforcreators/rich-text"),require("@googleforcreators/stickers"),require("../../library/panes/text/textPresets.js"),require("../../../app/canvas/context.js"),require("../../../app/currentUser/context.js"),require("../../../app/helpCenter/provider.js"),require("../../../app/helpCenter/context.js"),require("../../helpCenter/constants.js"),require("../../../app/rightClickMenu/context.js");var n=require("../../../constants/zIndex.js");require("../../form/color/color.js"),require("../../form/filterToggle/filterToggle.js"),require("../../form/linkIcon.js"),require("../../form/link.js"),require("../../form/media.js");var u=require("../../form/row.js");require("../../form/switch.js"),require("../../form/textArea.js"),require("../../form/context.js"),require("../../form/dateTime/dateTime.js"),require("../../form/required.js"),require("../../form/radioGroup/index.js"),require("../../form/select/select.js"),require("../../form/hierarchical/index.js");var c=require("../../audioPlayer/index.js"),p=require("../../tooltip/tooltip.js"),d=require("./captionsPanelContent.js"),g=require("./loopPanelContent.js");function m(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var f=m(e),q=m(r);const j=q.default(t.Button).withConfig({displayName:"backgroundAudioPanelContent__StyledButton",componentId:"sc-lth4t7-0"})(["",";"],(e=>{let{theme:r}=e;return t.themeHelpers.focusableOutlineCSS(r.colors.border.focus,r.colors.bg.secondary)})),T=q.default(j).withConfig({displayName:"backgroundAudioPanelContent__UploadButton",componentId:"sc-lth4t7-1"})(["padding:12px 8px;"]);module.exports=function BackgroundAudioPanelContent(e){let{backgroundAudio:r,updateBackgroundAudio:m,showCaptions:q=!1,showLoopControl:y=!1,audioId:E}=e;const{allowedMimeTypes:{audio:h},capabilities:{hasUploadMediaAction:x},MediaUpload:k}=l(),C=a.useMemo((()=>h.map((e=>i.getExtensionsFromMimeType(e))).flat()),[h]),{resource:S,tracks:_=[],loop:b=!0}=r||{},v=o.sprintf(
/* translators: %s: list of allowed file types. */
o.__("Please choose only %s to insert into page.","web-stories"),o.translateToExclusiveList(C)),A=a.useCallback((e=>{const r={resource:{src:e.src,id:e.id,mimeType:e.mimeType,length:e.length,lengthFormatted:e.lengthFormatted}};q&&(r.tracks=[]),y&&(r.loop=!0),m(r)}),[q,y,m]),I=a.useCallback((e=>{m({...r,tracks:e})}),[r,m]),N=a.useCallback((e=>{m({...r,loop:e.target.checked})}),[r,m]),R=a.useCallback((e=>{let r=[];if(e){const t=_.findIndex((r=>{let{id:t}=r;return t===e}));r=[..._.slice(0,t),..._.slice(t+1)]}I(r)}),[_,I]),U=a.useCallback((e=>{let{src:r="",id:t,needsProxy:o=!1}=e;const a={track:r,trackId:t,trackName:r.split("/").pop(),id:s.v4(),kind:"captions",srclang:"",label:"",needsProxy:o};I([..._,a])}),[_,I]),B=a.useCallback((e=>f.default.createElement(T,{onClick:e,type:t.BUTTON_TYPES.SECONDARY,size:t.BUTTON_SIZES.SMALL,variant:t.BUTTON_VARIANTS.RECTANGLE},o.__("Upload an audio file","web-stories"))),[]),w=o.__("Upload audio captions","web-stories"),P=a.useCallback((e=>f.default.createElement(T,{onClick:e,type:t.BUTTON_TYPES.SECONDARY,size:t.BUTTON_SIZES.SMALL,variant:t.BUTTON_VARIANTS.RECTANGLE},w)),[w]);return f.default.createElement(f.default.Fragment,null,!S?.src&&x&&f.default.createElement(u,{expand:!0},f.default.createElement(k,{onSelect:A,onSelectErrorMessage:v,type:h,title:o.__("Upload an audio file","web-stories"),buttonInsertText:o.__("Select audio file","web-stories"),render:B})),S?.src&&f.default.createElement(f.default.Fragment,null,f.default.createElement(u,null,f.default.createElement(c,{title:S?.src.substring(S?.src.lastIndexOf("/")+1),src:S?.src,mimeType:S?.mimeType,tracks:_,audioId:E,loop:b}),f.default.createElement(p,{hasTail:!0,title:o.__("Remove file","web-stories"),popupZIndexOverride:n.Z_INDEX_STORY_DETAILS},f.default.createElement(j,{"aria-label":o.__("Remove file","web-stories"),type:t.BUTTON_TYPES.TERTIARY,size:t.BUTTON_SIZES.SMALL,variant:t.BUTTON_VARIANTS.SQUARE,onClick:()=>m(null)},f.default.createElement(t.Icons.Trash,null)))),q&&f.default.createElement(d,{captionText:w,tracks:_||[],handleChangeTrack:U,handleRemoveTrack:R,renderUploadButton:P}),y&&S?.length&&f.default.createElement(u,{spaceBetween:!1},f.default.createElement(g,{loop:b,onChange:N}))))};
