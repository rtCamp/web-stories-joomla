/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

"use strict";var e=require("react");require("prop-types");var r=require("@googleforcreators/react"),t=require("@googleforcreators/i18n"),s=require("@googleforcreators/tracking");require("@googleforcreators/templates"),require("../../app/config/context.js"),require("../../app/api/context.js");var i=require("../../app/api/useAPI.js");require("../../constants/fonts.js"),require("../../constants/multipleValue.js"),require("@googleforcreators/animation"),require("uuid"),require("@googleforcreators/masks"),require("@googleforcreators/element-library"),require("@googleforcreators/elements"),require("../../app/story/context.js"),require("@googleforcreators/migration"),require("../../app/history/historyProvider.js"),require("../../app/history/context.js"),require("../../app/story/actions/useSaveStory.js"),require("clone-deep"),require("../../app/story/useStoryReducer/useStoryReducer.js"),require("@googleforcreators/output"),require("../../app/story/storyTriggers/storyTriggersProvider.js"),require("../../app/story/storyTriggers/storyEvents/onInitialElementAddedRegister.js"),require("../../app/story/storyTriggers/storyEvents/onPageAddedRegister.js");var a=require("../../app/story/useStory.js");require("../../app/highlights/styles.js");var o=require("../../app/highlights/useHighlights.js");require("../../app/highlights/context.js");var u=require("../../app/highlights/states.js");require("../../app/highlights/quickActions/constants.js"),require("../../app/highlights/quickActions/useQuickActions.js");var n=require("../library/library.js");require("../library/constants.js");var l=require("../design/designInspector.js"),c=require("./constants.js"),g=require("./context.js");function p(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var d=p(e);const h=new Set([c.INSERT,c.DOCUMENT,c.STYLE]);module.exports=function SidebarProvider(e){let{sidebarTabs:p,children:f}=e;const{actions:{getAuthors:q}}=i(),{selectedElementIds:E,currentPage:y}=a((e=>{let{state:r}=e;return{selectedElementIds:r.selectedElementIds,currentPage:r.currentPage}})),{tab:b,highlight:j}=o((e=>({tab:e.tab,highlight:e[u.default.STYLE_PANE]})));r.useEffect((()=>{h.has(b)&&(m(b),s.trackEvent("quick_action_tab_change",{name:b}))}),[b]);const S=r.useRef(null),[T,m]=r.useState(c.INSERT),[v,R]=r.useState([]),[P,I]=r.useState(null),N=r.useRef(),C=r.useRef(T),M=r.useRef(null),_=r.useRef(null),k=r.useRef(null),A=r.useMemo((()=>({[c.INSERT]:M,[c.STYLE]:_,[c.DOCUMENT]:k})),[]),[L,U]=r.useState(!1),x=r.useCallback((e=>{N.current=e}),[]);r.useResizeEffect(N,(e=>{let{height:r}=e;return I(r)}),[]),r.useEffect((()=>{E.length>0&&C.current===c.DOCUMENT&&m(c.STYLE)}),[E]),r.useEffect((()=>{C.current===c.DOCUMENT&&m(c.STYLE)}),[y]),r.useEffect((()=>{const e=_.current;e&&j?.focus&&j?.showEffect&&e.focus()}),[j]);const D=r.useCallback((()=>{L||0!==v.length||(U(!0),q().then((e=>{const r=e.map((e=>{let{id:r,name:t}=e;return{id:r,name:t}}));R(r)})).finally((()=>{U(!1)})))}),[L,v.length,q]),O={state:{tab:T,tabRefs:A,users:v,sidebarContentHeight:P,isUsersLoading:L},refs:{sidebar:S},actions:{setTab:m,loadUsers:D,setSidebarContentNode:x},data:{tabs:[{id:c.INSERT,title:t.__("Insert","web-stories"),Pane:n},{id:c.STYLE,title:t.__("Style","web-stories"),Pane:l}]}};return p?.document&&O.data.tabs.push({id:c.DOCUMENT,...p.document}),p?.publishModal&&(O.data.modalSidebarTab={id:c.PUBLISH_MODAL_DOCUMENT,...p.publishModal}),d.default.createElement(g.Provider,{value:O},f)};
