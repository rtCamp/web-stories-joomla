/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

"use strict";var e=require("react"),t=require("@googleforcreators/i18n"),r=require("react-transition-group"),a=require("@googleforcreators/react"),o=require("styled-components"),n=require("@googleforcreators/design-system");require("prop-types");var s=require("../../utils/useFocusTrapping.js"),l=require("./header.js"),i=require("./styleGroup.js"),u=require("./useDeleteStyle.js"),c=require("./confirmationDialog.js"),d=require("./constants.js");function p(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var m=p(e),f=p(o);function y(){return y=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e},y.apply(this,arguments)}const g=f.default.div.withConfig({displayName:"styleManager__Container",componentId:"sc-4hlmhs-0"})(["border-radius:8px;background:",";width:256px;user-select:none;display:flex;flex-direction:column;align-items:stretch;overflow:hidden;&.style-manager-appear{opacity:0.01;margin-top:-10px;&.style-manager-appear-active{opacity:1;margin-top:0;transition:300ms ease-out;transition-property:opacity,margin-top;}}"],(e=>{let{theme:t}=e;return t.colors.bg.secondary})),E=f.default.div.withConfig({displayName:"styleManager__Body",componentId:"sc-4hlmhs-1"})(["display:flex;margin:8px 12px 16px;"]),h=f.default(n.Text).attrs({size:n.THEME_CONSTANTS.TYPOGRAPHY.PRESET_SIZES.SMALL}).withConfig({displayName:"styleManager__StyledText",componentId:"sc-4hlmhs-2"})(["margin:0 0 0 8px;color:",";"],(e=>{let{theme:t}=e;return t.colors.fg.primary}));module.exports=function StyleManager(e){let{styles:o,onClose:p,applyStyle:f,...S}=e;const[_,v]=a.useState(!1),[q,x]=a.useState(!1),[C,b]=a.useState(null),T=a.useRef(null),j=a.useRef(document.activeElement),w=a.useCallback((e=>{j.current&&j.current.focus(),p(e)}),[p]);n.useKeyDownEffect(T,"esc",w);const M=u({onEmpty:w});return a.useFocusOut(T,(()=>{q||p()}),[q]),s({ref:T}),m.default.createElement(r.CSSTransition,{nodeRef:T,in:!0,appear:!0,classNames:"style-manager",timeout:300},m.default.createElement(g,{role:"dialog","aria-label":t.__("Style presets manager","web-stories"),ref:T},m.default.createElement(l,{handleClose:w,isEditMode:_,setIsEditMode:v},m.default.createElement(h,null,t.__("Saved Styles","web-stories"))),m.default.createElement(E,null,m.default.createElement(i,y({styles:[...o].reverse(),handleClick:e=>{if(!_)return void f(e);n.localStore.getItemByKey(n.LOCAL_STORAGE_PREFIX[d.STORAGE_KEY])?M(e):(x(!0),b(e))},isEditMode:_,buttonWidth:106},S))),q&&m.default.createElement(c,{onClose:()=>x(!1),onPrimary:()=>{M(C),b(null),x(!1)}})))};
