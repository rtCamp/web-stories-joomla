/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

"use strict";var e=require("@googleforcreators/react");require("../../constants/fonts.js");var t=require("../../constants/media.js");require("../../constants/multipleValue.js"),module.exports=function(a){const[n,s]=e.useState(null),[r,u]=e.useState(null),[l,o]=e.useState(null),[i,c]=e.useState(null),[f,d]=e.useState(null),[m,M]=e.useState(null),[E,I]=e.useState(null),[h,O]=e.useState(!1),S=e.useRef(!1);e.useEffect((()=>{E&&(S.current||(h?E.pause():(E.currentTime=r/1e3,E.play())))}),[E,h,r]);const g=E?E.paused:null;e.useEffect((()=>{h||(S.current=g)}),[g,h]),e.useEffect((()=>{if(E&&a)return E.addEventListener("timeupdate",n),E.addEventListener("loadedmetadata",t),()=>{E.removeEventListener("timeupdate",n),E.removeEventListener("loadedmetadata",t)};function e(e){E.currentTime=e/1e3,E.play()}function t(t){const n=Math.floor(1e3*t.target.duration);u(a.start),o(a.start),s(a.start),c(a.end??n),d(a.end??n),M(n),e(a.start)}function n(t){const a=Math.floor(1e3*t.target.currentTime);s(Math.min(a,i)),a>i&&!S.current&&e(r)}}),[r,i,a,E]);const p=e.useCallback((e=>{e=Math.min(i-t.MEDIA_VIDEO_MINIMUM_DURATION,e),e=Math.max(0,e),u(e),E.currentTime=e/1e3}),[E,i]),v=e.useCallback((e=>{e=Math.max(r+t.MEDIA_VIDEO_MINIMUM_DURATION,e),e=Math.min(m,e),c(e),E.currentTime=e/1e3}),[E,r,m]);return{hasChanged:e.useMemo((()=>r!==l||i!==f),[r,l,i,f]),currentTime:n,startOffset:r,endOffset:i,maxOffset:m,setStartOffset:p,setEndOffset:v,setVideoNode:I,setIsDraggingHandles:O}};
