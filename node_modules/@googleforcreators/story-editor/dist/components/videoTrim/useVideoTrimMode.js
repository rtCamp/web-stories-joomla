/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

"use strict";var e=require("@googleforcreators/react"),r=require("@googleforcreators/tracking"),t=require("@googleforcreators/media");require("@googleforcreators/transform"),require("../dropTargets/provider.js"),require("../dropTargets/context.js"),require("../../app/history/historyProvider.js"),require("../../app/history/context.js"),require("react"),require("prop-types"),require("@googleforcreators/templates"),require("../../app/config/context.js"),require("../../app/api/context.js");var o=require("../../app/api/useAPI.js");require("@googleforcreators/fonts"),require("@googleforcreators/dom"),require("../../constants/fonts.js"),require("../../constants/multipleValue.js"),require("../../app/font/context.js"),require("@googleforcreators/animation"),require("uuid"),require("@googleforcreators/masks"),require("@googleforcreators/element-library"),require("@googleforcreators/elements"),require("../../app/story/context.js"),require("@googleforcreators/migration"),require("../../app/story/actions/useSaveStory.js"),require("clone-deep"),require("../../app/story/useStoryReducer/useStoryReducer.js"),require("@googleforcreators/output"),require("../../app/story/storyTriggers/storyTriggersProvider.js"),require("../../app/story/storyTriggers/storyEvents/onInitialElementAddedRegister.js"),require("../../app/story/storyTriggers/storyEvents/onPageAddedRegister.js");var i=require("../../app/story/useStory.js");require("@googleforcreators/i18n"),require("../../app/media/useUploadMedia.js"),require("@googleforcreators/patterns"),require("../../utils/generateBlurhash.worker.js"),require("@googleforcreators/design-system"),require("../../app/media/media3p/providerConfiguration.js");var s=require("../../app/media/utils/useFFmpeg.js");require("../../app/media/media3p/api/context.js"),require("../../app/media/local/constants.js"),require("../../app/media/media3p/providerReducer.js"),require("../../app/media/context.js");var a=require("../../app/media/local/useLocalMedia.js");require("sat"),require("@googleforcreators/units"),require("../../app/layout/context.js"),require("../../app/layout/useZoomSetting.js"),require("@googleforcreators/rich-text"),require("@googleforcreators/stickers"),require("../library/panes/text/textPresets.js"),require("../../app/canvas/context.js");var u=require("../../app/canvas/useCanvas.js");require("../../app/currentUser/context.js"),require("../../app/helpCenter/provider.js"),require("../../app/helpCenter/context.js"),require("../helpCenter/constants.js"),require("../../app/rightClickMenu/context.js"),module.exports=function(){const{isEditing:n,isTrimMode:p,setEditingElementWithState:l,clearEditing:g}=u((e=>{let{state:{isEditing:r,editingElementState:{isTrimMode:t}={}},actions:{setEditingElementWithState:o,clearEditing:i}}=e;return{isEditing:r,isTrimMode:t,setEditingElementWithState:o,clearEditing:i}})),{selectedElement:c}=i((e=>{let{state:{selectedElements:r}}=e;return{selectedElement:1===r.length?r[0]:null}})),{actions:{getMediaById:d}}=o(),[q,m]=e.useState(null),{isCurrentResourceUploading:j}=a((e=>{let{state:{isCurrentResourceUploading:r}}=e;return{isCurrentResourceUploading:r}})),f=e.useCallback((()=>{const{resource:e}=c,{trimData:r}=e,o={element:c,resource:e,start:0,end:null};d&&r?.original?(m(null),d(r.original).then((e=>({element:c,resource:e,start:t.getMsFromHMS(r.start),end:t.getMsFromHMS(r.end)})),(()=>o)).then((e=>m(e)))):m(o)}),[d,c]),y=e.useCallback((()=>{n?g():(l(c.id,{isTrimMode:!0,hasEditMenu:!0,showOverflow:!1}),f()),r.trackEvent("video_trim_mode_toggled",{status:n?"closed":"open"})}),[n,g,l,c,f]),{isTranscodingEnabled:v}=s(),E=e.useMemo((()=>{if("video"!==c?.type||!c?.resource)return!1;const{id:e,isExternal:r}=c.resource;return v&&!r&&!j(e)}),[c,v,j]);return{isTrimMode:Boolean(n&&p),hasTrimMode:E,toggleTrimMode:y,videoData:q}};
