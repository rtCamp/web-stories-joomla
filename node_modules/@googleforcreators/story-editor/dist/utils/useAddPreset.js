/**
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

"use strict";var e=require("@googleforcreators/react");require("@googleforcreators/transform"),require("../components/dropTargets/provider.js"),require("../components/dropTargets/context.js"),require("../app/history/historyProvider.js"),require("../app/history/context.js"),require("react"),require("prop-types"),require("@googleforcreators/templates"),require("../app/config/context.js"),require("../app/api/context.js"),require("@googleforcreators/fonts"),require("@googleforcreators/dom"),require("../constants/fonts.js"),require("../constants/multipleValue.js"),require("../app/font/context.js"),require("@googleforcreators/media"),require("@googleforcreators/tracking"),require("@googleforcreators/animation"),require("uuid"),require("@googleforcreators/masks"),require("@googleforcreators/element-library"),require("@googleforcreators/elements"),require("../app/story/context.js"),require("@googleforcreators/migration");var r=require("./getUniquePresets.js");require("../app/story/actions/useSaveStory.js"),require("clone-deep"),require("../app/story/useStoryReducer/useStoryReducer.js"),require("@googleforcreators/output"),require("../app/story/storyTriggers/storyTriggersProvider.js"),require("../app/story/storyTriggers/storyEvents/onInitialElementAddedRegister.js"),require("../app/story/storyTriggers/storyEvents/onPageAddedRegister.js");var t=require("../app/story/useStory.js");require("@googleforcreators/i18n"),require("../app/media/useUploadMedia.js"),require("@googleforcreators/patterns"),require("./generateBlurhash.worker.js"),require("@googleforcreators/design-system"),require("../app/media/media3p/providerConfiguration.js"),require("../app/media/utils/useFFmpeg.js"),require("../app/media/media3p/api/context.js"),require("../app/media/local/constants.js"),require("../app/media/media3p/providerReducer.js"),require("../app/media/context.js"),require("sat"),require("@googleforcreators/units"),require("../app/layout/context.js"),require("../app/layout/useZoomSetting.js"),require("@googleforcreators/rich-text"),require("@googleforcreators/stickers"),require("../components/library/panes/text/textPresets.js"),require("../app/canvas/context.js"),require("../app/currentUser/context.js"),require("../app/helpCenter/provider.js"),require("../app/helpCenter/context.js"),require("../components/helpCenter/constants.js"),require("../app/rightClickMenu/context.js");var o=require("./presetUtils.js");module.exports=function(s){let{presetType:a,isBackgroundColor:i}=s;const{currentPage:u,currentStoryStyles:l={colors:[]},selectedElements:p,globalStoryStyles:n={colors:[],textStyles:[]},updateStory:c}=t((e=>{let{state:{currentPage:r,selectedElements:t,story:{globalStoryStyles:o,currentStoryStyles:s}},actions:{updateStory:a}}=e;return{currentPage:r,currentStoryStyles:s,selectedElements:t,globalStoryStyles:o,updateStory:a}})),{colors:g,textStyles:q}=n,{colors:y}=l,d=o.areAllType("text",p),j=p?.[0]?.id===u?.elements?.[0]?.id,m=e.useCallback(((e,r)=>d?{...e,...o.getTextPresets(p,r,a,i)}:j?{...e,...o.getPagePreset(u,r)}:{...e,...o.getShapePresets(p,r)}),[u,j,d,a,p,i]),S=e.useCallback((e=>{c({properties:{currentStoryStyles:{colors:r([...y,...e.colors])}}})}),[y,c]),f=e.useCallback((e=>{c({properties:{globalStoryStyles:{textStyles:r([...q,...e.textStyles]),colors:r([...g,...e.colors])}}})}),[g,q,c]),x=e.useCallback((function(e){let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const t=r?l:n;if((e=m(e,t)).colors?.length>0||e.textStyles?.length>0)return r?S(e,t):f(e,t),e}),[m,l,n,f,S]);return{addGlobalPreset:e=>(e.stopPropagation(),x({textStyles:[],colors:[]})),addLocalPreset:e=>(e.stopPropagation(),x({colors:[]},!0))}};
