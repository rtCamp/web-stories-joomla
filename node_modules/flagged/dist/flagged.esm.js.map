{"version":3,"file":"flagged.esm.js","sources":["../src/index.tsx"],"sourcesContent":["import * as React from 'react';\n\ntype FeatureGroup = {\n  [featureName: string]: boolean | FeatureGroup;\n};\n\nexport type FeatureFlags = string[] | FeatureGroup;\n\nconst FeatureFlagsContext = React.createContext<FeatureGroup>({});\n\nfunction transformFlags(features: FeatureFlags) {\n  if (!Array.isArray(features)) return features;\n  return Object.fromEntries(features.map(feature => [feature, true]));\n}\n\nfunction mergeFeatures(a: FeatureGroup, b: FeatureGroup): FeatureGroup {\n  return { ...a, ...b };\n}\n\nexport function FlagsProvider({\n  features = {},\n  children,\n}: {\n  features?: FeatureFlags;\n  children: React.ReactNode;\n}) {\n  const currentFeatures = useFeatures();\n  return (\n    <FeatureFlagsContext.Provider\n      value={mergeFeatures(\n        transformFlags(currentFeatures),\n        transformFlags(features)\n      )}\n    >\n      {children}\n    </FeatureFlagsContext.Provider>\n  );\n}\n\n// Custom Hook API\nexport function useFeatures(): FeatureGroup {\n  return React.useContext(FeatureFlagsContext);\n}\n\n// Custom Hook API\nexport function useFeature(name: string): boolean | FeatureGroup {\n  const features = useFeatures();\n  if (Array.isArray(features)) return features.includes(name);\n  if (typeof features[name] === 'boolean') return features[name];\n  return name\n    .split('/')\n    .reduce<FeatureGroup | boolean>((featureGroup, featureName: string) => {\n      if (typeof featureGroup === 'boolean') return featureGroup;\n      if (featureGroup[featureName] === undefined) return false;\n      return featureGroup[featureName];\n    }, features);\n}\n\n// Render Prop API\nexport function Feature({\n  name,\n  children,\n  render = children,\n}: {\n  name: string;\n  children?:\n    | React.ReactNode\n    | ((hasFeature: boolean | FeatureGroup) => JSX.Element);\n  render?:\n    | React.ReactNode\n    | ((hasFeature: boolean | FeatureGroup) => JSX.Element);\n}) {\n  const hasFeature = useFeature(name);\n  if (typeof render === 'function') return render(hasFeature);\n  if (!hasFeature) return null;\n  return render;\n}\n\n// High Order Component API\nexport function withFeature(featureName: string) {\n  return (Component: Function) => (props: React.ComponentProps<any>) => {\n    return (\n      <Feature name={featureName}>\n        <Component {...props} />\n      </Feature>\n    );\n  };\n}\n"],"names":["FeatureFlagsContext","React","transformFlags","features","Array","isArray","Object","fromEntries","map","feature","mergeFeatures","a","b","FlagsProvider","children","currentFeatures","useFeatures","Provider","value","useFeature","name","includes","split","reduce","featureGroup","featureName","undefined","Feature","render","hasFeature","withFeature","Component","props"],"mappings":";;;;;;;;;;;;;;;;;;;;AAQA,IAAMA,mBAAmB,gBAAGC,aAAA,CAAkC,EAAlC,CAA5B;;AAEA,SAASC,cAAT,CAAwBC,QAAxB;AACE,MAAI,CAACC,KAAK,CAACC,OAAN,CAAcF,QAAd,CAAL,EAA8B,OAAOA,QAAP;AAC9B,SAAOG,MAAM,CAACC,WAAP,CAAmBJ,QAAQ,CAACK,GAAT,CAAa,UAAAC,OAAO;AAAA,WAAI,CAACA,OAAD,EAAU,IAAV,CAAJ;AAAA,GAApB,CAAnB,CAAP;AACD;;AAED,SAASC,aAAT,CAAuBC,CAAvB,EAAwCC,CAAxC;AACE,sBAAYD,CAAZ,EAAkBC,CAAlB;AACD;;SAEeC;2BACdV;MAAAA,sCAAW;MACXW,gBAAAA;AAKA,MAAMC,eAAe,GAAGC,WAAW,EAAnC;AACA,SACEf,aAAA,CAACD,mBAAmB,CAACiB,QAArB;AACEC,IAAAA,KAAK,EAAER,aAAa,CAClBR,cAAc,CAACa,eAAD,CADI,EAElBb,cAAc,CAACC,QAAD,CAFI;GADtB,EAMGW,QANH,CADF;AAUD;;SAGeE;AACd,SAAOf,UAAA,CAAiBD,mBAAjB,CAAP;AACD;;SAGemB,WAAWC;AACzB,MAAMjB,QAAQ,GAAGa,WAAW,EAA5B;AACA,MAAIZ,KAAK,CAACC,OAAN,CAAcF,QAAd,CAAJ,EAA6B,OAAOA,QAAQ,CAACkB,QAAT,CAAkBD,IAAlB,CAAP;AAC7B,MAAI,OAAOjB,QAAQ,CAACiB,IAAD,CAAf,KAA0B,SAA9B,EAAyC,OAAOjB,QAAQ,CAACiB,IAAD,CAAf;AACzC,SAAOA,IAAI,CACRE,KADI,CACE,GADF,EAEJC,MAFI,CAE2B,UAACC,YAAD,EAAeC,WAAf;AAC9B,QAAI,OAAOD,YAAP,KAAwB,SAA5B,EAAuC,OAAOA,YAAP;AACvC,QAAIA,YAAY,CAACC,WAAD,CAAZ,KAA8BC,SAAlC,EAA6C,OAAO,KAAP;AAC7C,WAAOF,YAAY,CAACC,WAAD,CAAnB;AACD,GANI,EAMFtB,QANE,CAAP;AAOD;;SAGewB;MACdP,aAAAA;MACAN,iBAAAA;2BACAc;MAAAA,mCAASd;AAUT,MAAMe,UAAU,GAAGV,UAAU,CAACC,IAAD,CAA7B;AACA,MAAI,OAAOQ,MAAP,KAAkB,UAAtB,EAAkC,OAAOA,MAAM,CAACC,UAAD,CAAb;AAClC,MAAI,CAACA,UAAL,EAAiB,OAAO,IAAP;AACjB,SAAOD,MAAP;AACD;;SAGeE,YAAYL;AAC1B,SAAO,UAACM,SAAD;AAAA,WAAyB,UAACC,KAAD;AAC9B,aACE/B,aAAA,CAAC0B,OAAD;AAASP,QAAAA,IAAI,EAAEK;OAAf,EACExB,aAAA,CAAC8B,SAAD,oBAAeC,MAAf,CADF,CADF;AAKD,KANM;AAAA,GAAP;AAOD;;;;"}